MACRO ASSEMBLER BLHELI                                      05/25/15 19:28:26 PAGE     1


DOS MACRO ASSEMBLER MA51 V06.16.13.326
OBJECT MODULE PLACED IN OUTPUT\PLATINUM_PRO_30A_MULTI_REV11_2.OBJ
ASSEMBLER INVOKED BY: SET(BESC=159) OBJECT(OUTPUT\PLATINUM_PRO_30A_MULTI_REV11_2.OBJ) DEBUG EP QUIET PIN(C:\SILABS\MCU\INC;C:\PROGRA~1\RAISONANCE\RIDE\INC;C:\PROGRA~1\RAISONANCE\RIDE\INC\51) 

LOC     OBJ           LINE    SOURCE
                         1     $NOMOD51
                         2     ;**** **** **** **** ****
                         3     ;
                         4     ; BLHeli program for controlling brushless motors in helicopters and multirotors
                         5     ;
                         6     ; Copyright 2011, 2012 Steffen Skaug
                         7     ; This program is distributed under the terms of the GNU General Public License
                         8     ;
                         9     ; This file is part of BLHeli.
                        10     ;
                        11     ; BLHeli is free software: you can redistribute it and/or modify
                        12     ; it under the terms of the GNU General Public License as published by
                        13     ; the Free Software Foundation, either version 3 of the License, or
                        14     ; (at your option) any later version.
                        15     ;
                        16     ; BLHeli is distributed in the hope that it will be useful,
                        17     ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                        18     ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                        19     ; GNU General Public License for more details.
                        20     ;
                        21     ; You should have received a copy of the GNU General Public License
                        22     ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                        23     ;
                        24     ;**** **** **** **** ****
                        25     ;
                        26     ; The software was initially designed for use with Eflite mCP X, but is now adapted to copters/planes in general
                        27     ;
                        28     ; The software was inspired by and started from from Bernard Konze's BLMC: http://home.versanet.de/~bkonze/blc_6a/blc_6a.htm
                        29     ; And also Simon Kirby's TGY: https://github.com/sim-/tgy
                        30     ;
                        31     ; This file is best viewed with tab width set to 5
                        32     ;
                        33     ; The input signal can be positive 1kHz, 2kHz, 4kHz, 8kHz or 12kHz PWM (e.g. taken from the "resistor tap" on mCPx)
                        34     ; And the input signal can be PPM (1-2ms) at rates up to several hundred Hz.
                        35     ; The code adapts itself to the various input modes/frequencies
                        36     ; The code ESC can also be programmed to accept inverted input signal.
                        37     ;
                        38     ; The first lines of the software must be modified according to the chosen environment:
                        39     ; Uncomment the selected ESC and main/tail/multi mode
                        40     ; BESC EQU "ESC"_"mode" 						
                        41     ; 
                        42     ;**** **** **** **** ****
                        43     ; Revision history:
                        44     ; - Rev1.0: Initial revision based upon BLHeli for AVR controllers
                        45     ; - Rev2.0: Changed "Eeprom" initialization, layout and defaults
                        46     ;           Various changes and improvements to comparator reading. Now using timer1 for time from pwm on/off
                        47     ;           Beeps are made louder
                        48     ;           Added programmable low voltage limit
                        49     ;           Added programmable damped tail mode (only for 1S ESCs)
                        50     ;           Added programmable motor rotation direction
                        51     ; - Rev2.1: (minor changes by 4712)
                        52     ;		  Added Disable TX Programming by PC Setup Application 
                        53     ;		  therfore changed EEPROM_LAYOUT_REVISION = 8					
                        54     ;		  Added Vdd Monitor as reset source when writing to "EEProm"
                        55     ;		  Changed for use of batch file to assemble, link and make hex files	
                        56     ; - Rev2.2: (minor changes by 4712)
                        57     ;           Added Disable Throttle Re-Arming every motor start by PC Setup Application 
                        58     ; - Rev2.3: (minor changes by 4712)
                        59     ;           Added bugfixed (2x CLR C before j(n)c operations)thx Steffen!			
                        60     ; - Rev2.4: Revisions 2.1 to 2.3 integrated
                        61     ; - Rev3.0: Added PPM (1050us-1866us) as accepted input signal
                        62     ;           Added startup rpm as a programming parameter
                        63     ;           Added startup acceleration as a programming parameter
                        64     ;           Added option for using voltage measurements to compensate motor power
                        65     ;           Added governor target by setup as a governor mode option
                        66     ;           Governor is kept active regardless of rpm
                        67     ;           Smooth governor spoolup/down in arm and setup modes
                        68     ;           Increased governor P and I gain programming ranges
                        69     ;           Increased and changed low voltage limit programming range
                        70     ;           Disabled tx programming entry for all but the first arming sequence after power on
                        71     ;           Made it possible to skip parameters in tx programming by setting throttle midstick
                        72     ;           Made it default not to rearm for every restart
                        73     ; - Rev3.1: Fixed bug that prevented chosen parameter to be set in tx programming
                        74     ; - Rev3.2: ...also updated the EEPROM revision parameter
                        75     ; - Rev3.3: Fixed negative number bug in voltage compensation
                        76     ;           Fixed bug in startup power calculation for non-default power
                        77     ;           Prevented possibility for voltage compensation fighting low voltage limiting
                        78     ;           Applied overall spoolup control to ensure soft spoolup in any mode
                        79     ;           Added a delay of 3 seconds from initiation of main motor stop until new startup is allowed
                        80     ;           Reduced beep power to reduce power consumption for very strong motors/ESCs
                        81     ; - Rev3.4: Fixed bug that prevented full power in governor arm and setup modes
                        82     ;           Increased NFETON_DELAY for XP_7A and XP_12A to allow for more powerful fets
                        83     ;           Increased initial spoolup power, and linked to startup power
                        84     ; - Rev4.0: Fixed bug that made tail tx program beeps very weak
                        85     ;           Added thermal protection feature
                        86     ;           Governor P and I gain ranges are extended up to 8.0x gain
                        87     ;           Startup sequence is aborted upon zero throttle
                        88     ;           Avoided voltage compensation function induced latency for tail when voltage compensation is not enabled
                        89     ;           Improved input signal frequency detection robustness
                        90     ; - Rev4.1: Increased thermal protection temperature limits
                        91     ; - Rev5.0: Added multi(copter) operating mode. TAIL define changed to MODE with three modes: MAIN, TAIL and MULTI
                        92     ;           Added programmable commutation timing
                        93     ;           Added a damped light mode that has less damping, but that can be used with all escs
                        94     ;           Added programmable damping force
                        95     ;           Added thermal protection for startup too
                        96     ;           Added wait beeps when waiting more than 30 sec for throttle above zero (after having been armed)
                        97     ;           Modified tail idling to provide option for very low speeds
                        98     ;           Changed PPM range to 1150-1830us
                        99     ;           Arming sequence is dropped for PPM input, unless it is governor arm mode
                       100     ;           Loss of input signal will immediately stop the motor for PPM input
                       101     ;           Bug corrected in Turnigy Plush 6A voltage measurement setup
                       102     ;           FET switching delays are set for original fets. Stronger/doubled/tripled etc fets may require faster pfet off switching
                       103     ;           Miscellaneous other changes
                       104     ; - Rev6.0: Reverted comparator reading routine to rev5.0 equivalent, in order to avoid tail motor stops
                       105     ;           Added governor range programmability
                       106     ;           Implemented startup retry sequence with varying startup power for multi mode
                       107     ;           In damped light mode, damping is now applied to the active nfet phase for fully damped capable ESCs
                       108     ; - Rev6.1: Added input signal qualification criteria for PPM, to avoid triggering on noise spikes (fix for plush hardware)
                       109     ;           Changed main and multi mode stop criteria. Will now be in run mode, even if RC pulse input is zero
                       110     ;           Fixed bug in commutation that caused rough running in damped light mode
                       111     ;           Miscellaneous other changes
                       112     ; - Rev7.0  Added direct startup mode programmability
                       113     ;           Added throttle calibration. Min>=1000us and Max<=2000us. Difference must be >520us, otherwise max is shifted so that difference=520us
                       114     ;           Added programmable throttle change rate
                       115     ;           Added programmable beep strength, beacon strength and beacon delay
                       116     ;           Reduced power step to full power significantly
                       117     ;           Miscellaneous other changes
                       118     ; - Rev8.0  Added a 2 second delay after power up, to wait for receiver initialization
                       119     ;           Added a programming option for disabling low voltage limit, and made it default for MULTI
                       120     ;           Added programable demag compensation, using the concept of SimonK
                       121     ;           Improved robustness against noisy input signal
                       122     ;           Refined direct startup
                       123     ;           Removed voltage compensation
                       124     ;           Miscellaneous other changes
                       125     ; - Rev9.0  Increased programming range for startup power, and made its default ESC dependent
                       126     ;           Made default startup method ESC dependent
                       127     ;           Even more smooth and gentle spoolup for MAIN, to suit larger helis
                       128     ;           Improved transition from stepped startup to run
                       129     ;           Refined direct startup
                       130     ; - Rev9.1  Fixed bug that changed FW revision after throttle calibration or TX programming
                       131     ; - Rev9.2  Altered timing of throttle calibration in order to work with MultiWii calibration firmware
                       132     ;           Reduced main spoolup time to around 5 seconds
                       133     ;           Changed default beacon delay to 3 minutes
                       134     ; - Rev9.3  Fixed bug in Plush 60/80A temperature reading, that caused failure in operation above 4S
                       135     ;           Corrected temperature limit for HiModel cool 22/33/41A, RCTimer 6A, Skywalker 20/40A, Turnigy AE45A, Plush 40/60/80A. Limit was previously set too high
                       136     ; - Rev9.4  Improved timing for increased maximum rpm limit
                       137     ; - Rev10.0 Added closed loop mode for multi
                       138     ;           Added high/low BEC voltage option (for the ESCs where HW supports it)
                       139     ;           Added method of resetting all programmed parameter values to defaults by TX programming
                       140     ;           Added Turnigy K-force 40A and Turnigy K-force 120A HV ESCs
                       141     ;           Enabled fully damped mode for several ESCs
                       142     ;           Extended startup power range downwards to enable very smooth start for large heli main motors
                       143     ;           Extended damping force with a highest setting
                       144     ;           Corrected temperature limits for F310 chips (Plush 40A and AE 45A)
                       145     ;           Implemented temperature reading average in order to avoid problems with ADC noise on Skywalkers
                       146     ;           Increased switching delays for XP 7A fast, in order to avoid cross conduction of N and P fets
                       147     ;           Miscellaneous other changes
                       148     ; - Rev10.1 Relaxed RC signal jitter requirement during frequency measurement
                       149     ;           Corrected bug that prevented using governor low
                       150     ;           Enabled vdd monitor always, in order to reduce likelihood of accidental overwriting of adjustments
                       151     ;           Fixed bug that caused stop for PPM input above 2048us, and moved upper accepted limit to 2160us
                       152     ; - Rev10.2 Corrected temperature limit for AE20-30/XP7-25, where limit was too high
                       153     ;           Corrected temperature limit for 120HV, where limit was too low
                       154     ;           Fixed bug that caused AE20/25/30A not to run in reverse
                       155     ; - Rev10.3 Removed vdd monitor for 1S capable ESCs, in order to avoid brownouts/resets
                       156     ;           Made auto bailout spoolup for main more smooth
                       157     ; - Rev10.4 Ensured that main spoolup and governor activation will always be smooth, regardless of throttle input
                       158     ;           Added capability to operate on 12kHz input signal too
                       159     ; - Rev11.0 Fixed bug of programming default values for governor in MULTI mode
                       160     ;           Disabled interrupts explicitly some places, to avoid possibilities for unintentional fet switching
                       161     ;           Changed interrupt disable strategy, to always allow pwm interrupts, to avoid noise when running at low rpms
                       162     ;           Added governor middle range for MAIN mode
                       163     ;           Added bidirectional mode for TAIL and MULTI mode with PPM input
                       164     ;           Changed and improved demag compensation
                       165     ;           Miscellaneous other changes
                       166     ; - Rev11.1 Fixed bug of slow acceleration response for MAIN mode running without governor
                       167     ;           Fixed bug with PWM input, where throttle remains high even when zeroing throttle (seen on V922 tail)
                       168     ;           Fixed bug in bidirectional operation, where direction change could cause reset
                       169     ;           Improved autorotation bailout for MAIN
                       170     ;           Reduced min speed back to 1220 erpm
                       171     ;           Misc code cleanups
                       172     ; - Rev11.2 Fixed throttle calibration bug
                       173     ;           Added high side driver precharge for all-nfet ESCs
                       174     ;           Optimized timing in general and for demag compensation in particular
                       175     ;           Auto bailout functionality modified
                       176     ;           Governor is deactivated for throttle inputs below 10%
                       177     ;           Increased beacon delay times
                       178     ;
                       179     ;
                       180     ;**** **** **** **** ****
                       181     ; Up to 8K Bytes of In-System Self-Programmable Flash
                       182     ; 768 Bytes Internal SRAM
                       183     ;
                       184     ;**** **** **** **** ****
                       185     ; Master clock is internal 24MHz oscillator
                       186     ; Timer 0 (167/500ns counts) always counts up and is used for
                       187     ; - PWM generation
                       188     ; Timer 1 (167/500ns counts) always counts up and is used for
                       189     ; - Time from pwm on/off event
                       190     ; Timer 2 (500ns counts) always counts up and is used for
                       191     ; - RC pulse timeout/skip counts and commutation times
                       192     ; Timer 3 (500ns counts) always counts up and is used for
                       193     ; - Commutation timeouts
                       194     ; PCA0 (500ns counts) always counts up and is used for
                       195     ; - RC pulse measurement
                       196     ;
                       197     ;**** **** **** **** ****
                       198     ; Interrupt handling
                       199     ; The F330/2 does not disable interrupts when entering an interrupt routine.
                       200     ; Also some interrupt flags need to be cleared by software
                       201     ; The code disables interrupts in interrupt routines, in order to avoid too nested interrupts
                       202     ; - Interrupts are disabled during beeps, to avoid audible interference from interrupts
                       203     ; - RC pulse interrupts are periodically disabled in order to reduce interference with pwm interrupts.
                       204     ;
                       205     ;**** **** **** **** ****
                       206     ; Motor control:
                       207     ; - Brushless motor control with 6 states for each electrical 360 degrees
                       208     ; - An advance timing of 0deg has zero cross 30deg after one commutation and 30deg before the next
                       209     ; - Timing advance in this implementation is set to 15deg nominally
                       210     ; - "Damped" commutation schemes are available, where more than one pfet is on when pwm is off. This will absorb energy from bemf and make step settling more damped.
                       211     ; Motor sequence starting from zero crossing:
                       212     ; - Timer wait: Wt_Comm			15deg	; Time to wait from zero cross to actual commutation
                       213     ; - Timer wait: Wt_Advance		15deg	; Time to wait for timing advance. Nominal commutation point is after this
                       214     ; - Timer wait: Wt_Zc_Scan		7.5deg	; Time to wait before looking for zero cross
                       215     ; - Scan for zero cross			22.5deg	, Nominal, with some motor variations
                       216     ;
                       217     ; Motor startup in stepper mode:
                       218     ; Initial motor rotations are done with the motor controlled as a stepper motor.
                       219     ; In this stepper motor mode comparator information is not used.
                       220     ; Settle phase is the first, where there are a few commutations with increasing step length, in order to settle the motor in a predefined position.
                       221     ; Stepper phase comes next, where there is a step length decrease sequence.
                       222     ; Direct startup is the last phase, for synchronization before normal bemf commutation run begins.
                       223     ; Motor startup in direct mode:
                       224     ; Direct startup is the only phase, before normal bemf commutation run begins.
                       225     ;
                       226     ;**** **** **** **** ****
                       227     ; List of enumerated supported ESCs and modes  (main, tail or multi)
  0001                 228     XP_3A_MAIN 					EQU 1
  0002                 229     XP_3A_TAIL 					EQU 2
  0003                 230     XP_3A_MULTI 					EQU 3
  0004                 231     XP_7A_MAIN 					EQU 4
  0005                 232     XP_7A_TAIL 					EQU 5
  0006                 233     XP_7A_MULTI 					EQU 6
  0007                 234     XP_7A_FAST_MAIN 				EQU 7
  0008                 235     XP_7A_FAST_TAIL 				EQU 8
  0009                 236     XP_7A_FAST_MULTI 				EQU 9
  000A                 237     XP_12A_MAIN 					EQU 10
  000B                 238     XP_12A_TAIL 					EQU 11
  000C                 239     XP_12A_MULTI 					EQU 12
  000D                 240     XP_18A_MAIN 					EQU 13
  000E                 241     XP_18A_TAIL 					EQU 14
  000F                 242     XP_18A_MULTI 					EQU 15
  0010                 243     XP_25A_MAIN 					EQU 16
  0011                 244     XP_25A_TAIL 					EQU 17
  0012                 245     XP_25A_MULTI 					EQU 18
  0013                 246     XP_35A_SW_MAIN 				EQU 19
  0014                 247     XP_35A_SW_TAIL 				EQU 20
  0015                 248     XP_35A_SW_MULTI 				EQU 21
  0016                 249     DP_3A_MAIN 					EQU 22
  0017                 250     DP_3A_TAIL  					EQU 23
  0018                 251     DP_3A_MULTI  					EQU 24
  0019                 252     SUPERMICRO_3P5A_MAIN 			EQU 25
  001A                 253     SUPERMICRO_3P5A_TAIL 			EQU 26   
  001B                 254     SUPERMICRO_3P5A_MULTI 			EQU 27   
  001C                 255     TURNIGY_PLUSH_6A_MAIN 			EQU 28
  001D                 256     TURNIGY_PLUSH_6A_TAIL 			EQU 29   
  001E                 257     TURNIGY_PLUSH_6A_MULTI 			EQU 30   
  001F                 258     TURNIGY_PLUSH_10A_MAIN 			EQU 31
  0020                 259     TURNIGY_PLUSH_10A_TAIL 			EQU 32   
  0021                 260     TURNIGY_PLUSH_10A_MULTI 			EQU 33   
  0022                 261     TURNIGY_PLUSH_12A_MAIN 			EQU 34
  0023                 262     TURNIGY_PLUSH_12A_TAIL 			EQU 35   
  0024                 263     TURNIGY_PLUSH_12A_MULTI 			EQU 36   
  0025                 264     TURNIGY_PLUSH_18A_MAIN 			EQU 37
  0026                 265     TURNIGY_PLUSH_18A_TAIL 			EQU 38   
  0027                 266     TURNIGY_PLUSH_18A_MULTI 			EQU 39   
  0028                 267     TURNIGY_PLUSH_25A_MAIN 			EQU 40
  0029                 268     TURNIGY_PLUSH_25A_TAIL 			EQU 41   
  002A                 269     TURNIGY_PLUSH_25A_MULTI 			EQU 42   
  002B                 270     TURNIGY_PLUSH_30A_MAIN 			EQU 43
  002C                 271     TURNIGY_PLUSH_30A_TAIL 			EQU 44   
  002D                 272     TURNIGY_PLUSH_30A_MULTI 			EQU 45   
  002E                 273     TURNIGY_PLUSH_40A_MAIN 			EQU 46
  002F                 274     TURNIGY_PLUSH_40A_TAIL 			EQU 47   
  0030                 275     TURNIGY_PLUSH_40A_MULTI 			EQU 48   
  0031                 276     TURNIGY_PLUSH_60A_MAIN 			EQU 49
  0032                 277     TURNIGY_PLUSH_60A_TAIL 			EQU 50   
  0033                 278     TURNIGY_PLUSH_60A_MULTI 			EQU 51   
  0034                 279     TURNIGY_PLUSH_80A_MAIN 			EQU 52
  0035                 280     TURNIGY_PLUSH_80A_TAIL 			EQU 53   
  0036                 281     TURNIGY_PLUSH_80A_MULTI 			EQU 54   
  0037                 282     TURNIGY_PLUSH_NFET_18A_MAIN 		EQU 55
  0038                 283     TURNIGY_PLUSH_NFET_18A_TAIL 		EQU 56   
  0039                 284     TURNIGY_PLUSH_NFET_18A_MULTI 		EQU 57   
  003A                 285     TURNIGY_PLUSH_NFET_25A_MAIN 		EQU 58
  003B                 286     TURNIGY_PLUSH_NFET_25A_TAIL 		EQU 59   
  003C                 287     TURNIGY_PLUSH_NFET_25A_MULTI 		EQU 60   
  003D                 288     TURNIGY_PLUSH_NFET_30A_MAIN 		EQU 61
  003E                 289     TURNIGY_PLUSH_NFET_30A_TAIL 		EQU 62   
  003F                 290     TURNIGY_PLUSH_NFET_30A_MULTI 		EQU 63   
  0040                 291     TURNIGY_AE_20A_MAIN 			EQU 64
  0041                 292     TURNIGY_AE_20A_TAIL 			EQU 65   
  0042                 293     TURNIGY_AE_20A_MULTI 			EQU 66   
  0043                 294     TURNIGY_AE_25A_MAIN 			EQU 67
  0044                 295     TURNIGY_AE_25A_TAIL 			EQU 68   
  0045                 296     TURNIGY_AE_25A_MULTI 			EQU 69   
  0046                 297     TURNIGY_AE_30A_MAIN 			EQU 70
  0047                 298     TURNIGY_AE_30A_TAIL 			EQU 71   
  0048                 299     TURNIGY_AE_30A_MULTI 			EQU 72   
  0049                 300     TURNIGY_AE_45A_MAIN 			EQU 73
  004A                 301     TURNIGY_AE_45A_TAIL 			EQU 74   
  004B                 302     TURNIGY_AE_45A_MULTI 			EQU 75   
  004C                 303     TURNIGY_KFORCE_40A_MAIN 			EQU 76   
  004D                 304     TURNIGY_KFORCE_40A_TAIL 			EQU 77   
  004E                 305     TURNIGY_KFORCE_40A_MULTI 		EQU 78   
  004F                 306     TURNIGY_KFORCE_70A_HV_MAIN 		EQU 79   
  0050                 307     TURNIGY_KFORCE_70A_HV_TAIL 		EQU 80   
  0051                 308     TURNIGY_KFORCE_70A_HV_MULTI 		EQU 81   
  0052                 309     TURNIGY_KFORCE_120A_HV_MAIN 		EQU 82   
  0053                 310     TURNIGY_KFORCE_120A_HV_TAIL 		EQU 83   
  0054                 311     TURNIGY_KFORCE_120A_HV_MULTI 		EQU 84   
  0055                 312     TURNIGY_KFORCE_120A_HV_V2_MAIN	EQU 85   
  0056                 313     TURNIGY_KFORCE_120A_HV_V2_TAIL 	EQU 86   
  0057                 314     TURNIGY_KFORCE_120A_HV_V2_MULTI 	EQU 87   
  0058                 315     SKYWALKER_12A_MAIN 				EQU 88
  0059                 316     SKYWALKER_12A_TAIL 				EQU 89   
  005A                 317     SKYWALKER_12A_MULTI 			EQU 90   
  005B                 318     SKYWALKER_20A_MAIN 				EQU 91
  005C                 319     SKYWALKER_20A_TAIL 				EQU 92   
  005D                 320     SKYWALKER_20A_MULTI 			EQU 93   
  005E                 321     SKYWALKER_40A_MAIN 				EQU 94
  005F                 322     SKYWALKER_40A_TAIL 				EQU 95   
  0060                 323     SKYWALKER_40A_MULTI 			EQU 96   
  0061                 324     HIMODEL_COOL_22A_MAIN 			EQU 97
  0062                 325     HIMODEL_COOL_22A_TAIL 			EQU 98   
  0063                 326     HIMODEL_COOL_22A_MULTI 			EQU 99   
  0064                 327     HIMODEL_COOL_33A_MAIN 			EQU 100
  0065                 328     HIMODEL_COOL_33A_TAIL 			EQU 101   
  0066                 329     HIMODEL_COOL_33A_MULTI 			EQU 102  
  0067                 330     HIMODEL_COOL_41A_MAIN 			EQU 103
  0068                 331     HIMODEL_COOL_41A_TAIL 			EQU 104  
  0069                 332     HIMODEL_COOL_41A_MULTI 			EQU 105  
  006A                 333     RCTIMER_6A_MAIN 				EQU 106   
  006B                 334     RCTIMER_6A_TAIL 				EQU 107  
  006C                 335     RCTIMER_6A_MULTI 				EQU 108  
  006D                 336     ALIGN_RCE_BL15X_MAIN			EQU 109   
  006E                 337     ALIGN_RCE_BL15X_TAIL 			EQU 110  
  006F                 338     ALIGN_RCE_BL15X_MULTI 			EQU 111  
  0070                 339     ALIGN_RCE_BL15P_MAIN			EQU 112  
  0071                 340     ALIGN_RCE_BL15P_TAIL 			EQU 113  
  0072                 341     ALIGN_RCE_BL15P_MULTI 			EQU 114  
  0073                 342     ALIGN_RCE_BL35X_MAIN			EQU 115  
  0074                 343     ALIGN_RCE_BL35X_TAIL 			EQU 116  
  0075                 344     ALIGN_RCE_BL35X_MULTI 			EQU 117  
  0076                 345     ALIGN_RCE_BL35P_MAIN			EQU 118   
  0077                 346     ALIGN_RCE_BL35P_TAIL 			EQU 119  
  0078                 347     ALIGN_RCE_BL35P_MULTI 			EQU 120  
  0079                 348     GAUI_GE_183_18A_MAIN			EQU 121   
  007A                 349     GAUI_GE_183_18A_TAIL 			EQU 122  
  007B                 350     GAUI_GE_183_18A_MULTI 			EQU 123  
  007C                 351     H_KING_10A_MAIN				EQU 124   
  007D                 352     H_KING_10A_TAIL 				EQU 125  
  007E                 353     H_KING_10A_MULTI 				EQU 126  
  007F                 354     H_KING_20A_MAIN				EQU 127   
  0080                 355     H_KING_20A_TAIL 				EQU 128  
  0081                 356     H_KING_20A_MULTI 				EQU 129  
  0082                 357     H_KING_35A_MAIN				EQU 130   
  0083                 358     H_KING_35A_TAIL 				EQU 131 
  0084                 359     H_KING_35A_MULTI 				EQU 132  
  0085                 360     H_KING_50A_MAIN				EQU 133   
  0086                 361     H_KING_50A_TAIL 				EQU 134  
  0087                 362     H_KING_50A_MULTI 				EQU 135  
  0088                 363     POLARIS_THUNDER_12A_MAIN			EQU 136   
  0089                 364     POLARIS_THUNDER_12A_TAIL 		EQU 137  
  008A                 365     POLARIS_THUNDER_12A_MULTI 		EQU 138  
  008B                 366     POLARIS_THUNDER_20A_MAIN			EQU 139   
  008C                 367     POLARIS_THUNDER_20A_TAIL 		EQU 140  
  008D                 368     POLARIS_THUNDER_20A_MULTI 		EQU 141  
  008E                 369     POLARIS_THUNDER_30A_MAIN			EQU 142   
  008F                 370     POLARIS_THUNDER_30A_TAIL 		EQU 143  
  0090                 371     POLARIS_THUNDER_30A_MULTI 		EQU 144  
  0091                 372     POLARIS_THUNDER_40A_MAIN			EQU 145   
  0092                 373     POLARIS_THUNDER_40A_TAIL 		EQU 146  
  0093                 374     POLARIS_THUNDER_40A_MULTI 		EQU 147  
  0094                 375     POLARIS_THUNDER_60A_MAIN			EQU 148   
  0095                 376     POLARIS_THUNDER_60A_TAIL 		EQU 149  
  0096                 377     POLARIS_THUNDER_60A_MULTI 		EQU 150  
  0097                 378     POLARIS_THUNDER_80A_MAIN			EQU 151   
  0098                 379     POLARIS_THUNDER_80A_TAIL 		EQU 152  
  0099                 380     POLARIS_THUNDER_80A_MULTI 		EQU 153  
  009A                 381     POLARIS_THUNDER_100A_MAIN		EQU 154   
  009B                 382     POLARIS_THUNDER_100A_TAIL 		EQU 155  
  009C                 383     POLARIS_THUNDER_100A_MULTI 		EQU 156  
  009D                 384     PLATINUM_PRO_30A_MAIN			EQU 157   
  009E                 385     PLATINUM_PRO_30A_TAIL 			EQU 158  
  009F                 386     PLATINUM_PRO_30A_MULTI 			EQU 159  
  00A0                 387     EAZY_3AV2_MAIN					EQU 160   
  00A1                 388     EAZY_3AV2_TAIL 				EQU 161  
  00A2                 389     EAZY_3AV2_MULTI 				EQU 162  
  00A3                 390     TAROT_30A_MAIN					EQU 163   
  00A4                 391     TAROT_30A_TAIL 				EQU 164  
  00A5                 392     TAROT_30A_MULTI 				EQU 165  
  00A6                 393     SKYIII_30A_MAIN				EQU 166   
  00A7                 394     SKYIII_30A_TAIL 				EQU 167  
  00A8                 395     SKYIII_30A_MULTI 				EQU 168  
                       396     
                       397     ;**** **** **** **** ****
                       398     ; Select the ESC and mode to use (or unselect all for use with external batch compile file)
                       399     ;BESC EQU XP_3A_Main
                       400     ;BESC EQU XP_3A_Tail
                       401     ;BESC EQU XP_3A_Multi
                       402     ;BESC EQU XP_7A_Main
                       403     ;BESC EQU XP_7A_Tail
                       404     ;BESC EQU XP_7A_Multi
                       405     ;BESC EQU XP_7A_Fast_Main
                       406     ;BESC EQU XP_7A_Fast_Tail
                       407     ;BESC EQU XP_7A_Fast_Multi
                       408     ;BESC EQU XP_12A_Main
                       409     ;BESC EQU XP_12A_Tail 
                       410     ;BESC EQU XP_12A_Multi
                       411     ;BESC EQU XP_18A_Main 
                       412     ;BESC EQU XP_18A_Tail 
                       413     ;BESC EQU XP_18A_Multi
                       414     ;BESC EQU XP_25A_Main 
                       415     ;BESC EQU XP_25A_Tail 
                       416     ;BESC EQU XP_25A_Multi
                       417     ;BESC EQU XP_35A_SW_Main
                       418     ;BESC EQU XP_35A_SW_Tail 
                       419     ;BESC EQU XP_35A_SW_Multi
                       420     ;BESC EQU DP_3A_Main 						
                       421     ;BESC EQU DP_3A_Tail
                       422     ;BESC EQU DP_3A_Multi
                       423     ;BESC EQU Supermicro_3p5A_Main
                       424     ;BESC EQU Supermicro_3p5A_Tail
                       425     ;BESC EQU Supermicro_3p5A_Multi
                       426     ;BESC EQU Turnigy_Plush_6A_Main 
                       427     ;BESC EQU Turnigy_Plush_6A_Tail 
                       428     ;BESC EQU Turnigy_Plush_6A_Multi
                       429     ;BESC EQU Turnigy_Plush_10A_Main 
                       430     ;BESC EQU Turnigy_Plush_10A_Tail 
                       431     ;BESC EQU Turnigy_Plush_10A_Multi
                       432     ;BESC EQU Turnigy_Plush_12A_Main 
                       433     ;BESC EQU Turnigy_Plush_12A_Tail 
                       434     ;BESC EQU Turnigy_Plush_12A_Multi
                       435     ;BESC EQU Turnigy_Plush_18A_Main 
                       436     ;BESC EQU Turnigy_Plush_18A_Tail 
                       437     ;BESC EQU Turnigy_Plush_18A_Multi
                       438     ;BESC EQU Turnigy_Plush_25A_Main 
                       439     ;BESC EQU Turnigy_Plush_25A_Tail
                       440     ;BESC EQU Turnigy_Plush_25A_Multi
                       441     ;BESC EQU Turnigy_Plush_30A_Main 
                       442     ;BESC EQU Turnigy_Plush_30A_Tail 
                       443     ;BESC EQU Turnigy_Plush_30A_Multi
                       444     ;BESC EQU Turnigy_Plush_40A_Main  
                       445     ;BESC EQU Turnigy_Plush_40A_Tail 
                       446     ;BESC EQU Turnigy_Plush_40A_Multi
                       447     ;BESC EQU Turnigy_Plush_60A_Main
                       448     ;BESC EQU Turnigy_Plush_60A_Tail 
                       449     ;BESC EQU Turnigy_Plush_60A_Multi
                       450     ;BESC EQU Turnigy_Plush_80A_Main
                       451     ;BESC EQU Turnigy_Plush_80A_Tail 
                       452     ;BESC EQU Turnigy_Plush_80A_Multi
                       453     ;BESC EQU Turnigy_Plush_Nfet_18A_Main 
                       454     ;BESC EQU Turnigy_Plush_Nfet_18A_Tail 
                       455     ;BESC EQU Turnigy_Plush_Nfet_18A_Multi
                       456     ;BESC EQU Turnigy_Plush_Nfet_25A_Main 
                       457     ;BESC EQU Turnigy_Plush_Nfet_25A_Tail
                       458     ;BESC EQU Turnigy_Plush_Nfet_25A_Multi
                       459     ;BESC EQU Turnigy_Plush_Nfet_30A_Main  
                       460     ;BESC EQU Turnigy_Plush_Nfet_30A_Tail 
                       461     ;BESC EQU Turnigy_Plush_Nfet_30A_Multi
                       462     ;BESC EQU Turnigy_AE_20A_Main 
                       463     ;BESC EQU Turnigy_AE_20A_Tail 
                       464     ;BESC EQU Turnigy_AE_20A_Multi
                       465     ;BESC EQU Turnigy_AE_25A_Main 
                       466     ;BESC EQU Turnigy_AE_25A_Tail 
                       467     ;BESC EQU Turnigy_AE_25A_Multi
                       468     ;BESC EQU Turnigy_AE_30A_Main 
                       469     ;BESC EQU Turnigy_AE_30A_Tail 
                       470     ;BESC EQU Turnigy_AE_30A_Multi
                       471     ;BESC EQU Turnigy_AE_45A_Main
                       472     ;BESC EQU Turnigy_AE_45A_Tail 
                       473     ;BESC EQU Turnigy_AE_45A_Multi
                       474     ;BESC EQU Turnigy_KForce_40A_Main
                       475     ;BESC EQU Turnigy_KForce_40A_Tail 
                       476     ;BESC EQU Turnigy_KForce_40A_Multi
                       477     ;BESC EQU Turnigy_KForce_70A_HV_Main
                       478     ;BESC EQU Turnigy_KForce_70A_HV_Tail 
                       479     ;BESC EQU Turnigy_KForce_70A_HV_Multi
                       480     ;BESC EQU Turnigy_KForce_120A_HV_Main
                       481     ;BESC EQU Turnigy_KForce_120A_HV_Tail 
                       482     ;BESC EQU Turnigy_KForce_120A_HV_Multi
                       483     ;BESC EQU Turnigy_KForce_120A_HV_v2_Main
                       484     ;BESC EQU Turnigy_KForce_120A_HV_v2_Tail 
                       485     ;BESC EQU Turnigy_KForce_120A_HV_v2_Multi
                       486     ;BESC EQU Skywalker_12A_Main
                       487     ;BESC EQU Skywalker_12A_Tail 
                       488     ;BESC EQU Skywalker_12A_Multi
                       489     ;BESC EQU Skywalker_20A_Main
                       490     ;BESC EQU Skywalker_20A_Tail 
                       491     ;BESC EQU Skywalker_20A_Multi
                       492     ;BESC EQU Skywalker_40A_Main 
                       493     ;BESC EQU Skywalker_40A_Tail 
                       494     ;BESC EQU Skywalker_40A_Multi
                       495     ;BESC EQU HiModel_Cool_22A_Main
                       496     ;BESC EQU HiModel_Cool_22A_Tail
                       497     ;BESC EQU HiModel_Cool_22A_Multi
                       498     ;BESC EQU HiModel_Cool_33A_Main
                       499     ;BESC EQU HiModel_Cool_33A_Tail
                       500     ;BESC EQU HiModel_Cool_33A_Multi
                       501     ;BESC EQU HiModel_Cool_41A_Main
                       502     ;BESC EQU HiModel_Cool_41A_Tail
                       503     ;BESC EQU HiModel_Cool_41A_Multi
                       504     ;BESC EQU RCTimer_6A_Main
                       505     ;BESC EQU RCTimer_6A_Tail
                       506     ;BESC EQU RCTimer_6A_Multi
                       507     ;BESC EQU Align_RCE_BL15X_Main
                       508     ;BESC EQU Align_RCE_BL15X_Tail
                       509     ;BESC EQU Align_RCE_BL15X_Multi
                       510     ;BESC EQU Align_RCE_BL15P_Main
                       511     ;BESC EQU Align_RCE_BL15P_Tail
                       512     ;BESC EQU Align_RCE_BL15P_Multi
                       513     ;BESC EQU Align_RCE_BL35X_Main 
                       514     ;BESC EQU Align_RCE_BL35X_Tail
                       515     ;BESC EQU Align_RCE_BL35X_Multi
                       516     ;BESC EQU Align_RCE_BL35P_Main
                       517     ;BESC EQU Align_RCE_BL35P_Tail
                       518     ;BESC EQU Align_RCE_BL35P_Multi
                       519     ;BESC EQU Gaui_GE_183_18A_Main
                       520     ;BESC EQU Gaui_GE_183_18A_Tail
                       521     ;BESC EQU Gaui_GE_183_18A_Multi
                       522     ;BESC EQU H_King_10A_Main
                       523     ;BESC EQU H_King_10A_Tail
                       524     ;BESC EQU H_King_10A_Multi
                       525     ;BESC EQU H_King_20A_Main
                       526     ;BESC EQU H_King_20A_Tail
                       527     ;BESC EQU H_King_20A_Multi
                       528     ;BESC EQU H_King_35A_Main
                       529     ;BESC EQU H_King_35A_Tail
                       530     ;BESC EQU H_King_35A_Multi
                       531     ;BESC EQU H_King_50A_Main
                       532     ;BESC EQU H_King_50A_Tail
                       533     ;BESC EQU H_King_50A_Multi
                       534     ;BESC EQU Polaris_Thunder_12A_Main
                       535     ;BESC EQU Polaris_Thunder_12A_Tail
                       536     ;BESC EQU Polaris_Thunder_12A_Multi
                       537     ;BESC EQU Polaris_Thunder_20A_Main
                       538     ;BESC EQU Polaris_Thunder_20A_Tail
                       539     ;BESC EQU Polaris_Thunder_20A_Multi
                       540     ;BESC EQU Polaris_Thunder_30A_Main
                       541     ;BESC EQU Polaris_Thunder_30A_Tail
                       542     ;BESC EQU Polaris_Thunder_30A_Multi
                       543     ;BESC EQU Polaris_Thunder_40A_Main
                       544     ;BESC EQU Polaris_Thunder_40A_Tail
                       545     ;BESC EQU Polaris_Thunder_40A_Multi
                       546     ;BESC EQU Polaris_Thunder_60A_Main
                       547     ;BESC EQU Polaris_Thunder_60A_Tail
                       548     ;BESC EQU Polaris_Thunder_60A_Multi
                       549     ;BESC EQU Polaris_Thunder_80A_Main
                       550     ;BESC EQU Polaris_Thunder_80A_Tail
                       551     ;BESC EQU Polaris_Thunder_80A_Multi
                       552     ;BESC EQU Polaris_Thunder_100A_Main
                       553     ;BESC EQU Polaris_Thunder_100A_Tail
                       554     ;BESC EQU Polaris_Thunder_100A_Multi
                       555     ;BESC EQU Platinum_Pro_30A_Main
                       556     ;BESC EQU Platinum_Pro_30A_Tail
                       557     ;BESC EQU Platinum_Pro_30A_Multi
                       558     ;BESC EQU EAZY_3Av2_Main
                       559     ;BESC EQU EAZY_3Av2_Tail
                       560     ;BESC EQU EAZY_3Av2_Multi
                       561     ;BESC EQU Tarot_30A_Main
                       562     ;BESC EQU Tarot_30A_Tail
                       563     ;BESC EQU Tarot_30A_Multi
                       564     ;BESC EQU SkyIII_30A_Main
                       565     ;BESC EQU SkyIII_30A_Tail
                       566     ;BESC EQU SkyIII_30A_Multi
                       567     
                       568     ;**** **** **** **** ****
                       569     ; ESC selection statements
                       570     IF BESC == XP_3A_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (XP_3A.INC)			; Select XP 3A pinout
                               ENDIF
                       574     
                       575     IF BESC == XP_3A_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (XP_3A.INC)			; Select XP 3A pinout
                               ENDIF
                       579     
                       580     IF BESC == XP_3A_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (XP_3A.INC)			; Select XP 3A pinout
                               ENDIF
                       584     
                       585     IF BESC == XP_7A_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (XP_7A.INC)			; Select XP 7A pinout
                               ENDIF
                       589     
                       590     IF BESC == XP_7A_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (XP_7A.INC)			; Select XP 7A pinout
                               ENDIF
                       594     
                       595     IF BESC == XP_7A_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (XP_7A.INC)			; Select XP 7A pinout
                               ENDIF
                       599     
                       600     IF BESC == XP_7A_FAST_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (XP_7A_FAST.INC)		; Select XP 7A Fast pinout
                               ENDIF
                       604     
                       605     IF BESC == XP_7A_FAST_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (XP_7A_FAST.INC)		; Select XP 7A Fast pinout
                               ENDIF
                       609     
                       610     IF BESC == XP_7A_FAST_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (XP_7A_FAST.INC)		; Select XP 7A Fast pinout
                               ENDIF
                       614     
                       615     IF BESC == XP_12A_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (XP_12A.INC)			; Select XP 12A pinout
                               ENDIF
                       619     
                       620     IF BESC == XP_12A_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (XP_12A.INC)			; Select XP 12A pinout
                               ENDIF
                       624     
                       625     IF BESC == XP_12A_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (XP_12A.INC)			; Select XP 12A pinout
                               ENDIF
                       629     
                       630     IF BESC == XP_18A_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (XP_18A.INC)			; Select XP 18A pinout
                               ENDIF
                       634     
                       635     IF BESC == XP_18A_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (XP_18A.INC)			; Select XP 18A pinout
                               ENDIF
                       639     
                       640     IF BESC == XP_18A_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (XP_18A.INC)			; Select XP 18A pinout
                               ENDIF
                       644     
                       645     IF BESC == XP_25A_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (XP_25A.INC)			; Select XP 25A pinout
                               ENDIF
                       649     
                       650     IF BESC == XP_25A_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (XP_25A.INC)			; Select XP 25A pinout
                               ENDIF
                       654     
                       655     IF BESC == XP_25A_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (XP_25A.INC)			; Select XP 25A pinout
                               ENDIF
                       659     
                       660     IF BESC == XP_35A_SW_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (XP_35A_SW.INC)			; Select XP 35A SW pinout
                               ENDIF
                       664     
                       665     IF BESC == XP_35A_SW_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (XP_35A_SW.INC)			; Select XP 35A SW pinout
                               ENDIF
                       669     
                       670     IF BESC == XP_35A_SW_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (XP_35A_SW.INC)			; Select XP 35A SW pinout
                               ENDIF
                       674     
                       675     IF BESC == DP_3A_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (DP_3A.INC)			; Select DP 3A pinout
                               ENDIF
                       679     
                       680     IF BESC == DP_3A_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (DP_3A.INC)			; Select DP 3A pinout
                               ENDIF
                       684     
                       685     IF BESC == DP_3A_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (DP_3A.INC)			; Select DP 3A pinout
                               ENDIF
                       689     
                       690     IF BESC == SUPERMICRO_3P5A_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (SUPERMICRO_3P5A.INC)	; Select Supermicro 3.5A pinout
                               ENDIF
                       694     
                       695     IF BESC == SUPERMICRO_3P5A_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (SUPERMICRO_3P5A.INC)	; Select Supermicro 3.5A pinout
                               ENDIF
                       699     
                       700     IF BESC == SUPERMICRO_3P5A_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (SUPERMICRO_3P5A.INC)	; Select Supermicro 3.5A pinout
                               ENDIF
                       704     
                       705     IF BESC == TURNIGY_PLUSH_6A_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (TURNIGY_PLUSH_6A.INC)	; Select Turnigy Plush 6A pinout
                               ENDIF
                       709     
                       710     IF BESC == TURNIGY_PLUSH_6A_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (TURNIGY_PLUSH_6A.INC)	; Select Turnigy Plush 6A pinout
                               ENDIF
                       714     
                       715     IF BESC == TURNIGY_PLUSH_6A_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (TURNIGY_PLUSH_6A.INC)	; Select Turnigy Plush 6A pinout
                               ENDIF
                       719     
                       720     IF BESC == TURNIGY_PLUSH_10A_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (TURNIGY_PLUSH_10A.INC)	; Select Turnigy Plush 10A pinout
                               ENDIF
                       724     
                       725     IF BESC == TURNIGY_PLUSH_10A_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (TURNIGY_PLUSH_10A.INC)	; Select Turnigy Plush 10A pinout
                               ENDIF
                       729     
                       730     IF BESC == TURNIGY_PLUSH_10A_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (TURNIGY_PLUSH_10A.INC)	; Select Turnigy Plush 10A pinout
                               ENDIF
                       734     
                       735     IF BESC == TURNIGY_PLUSH_12A_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (TURNIGY_PLUSH_12A.INC)	; Select Turnigy Plush 12A pinout
                               ENDIF
                       739     
                       740     IF BESC == TURNIGY_PLUSH_12A_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (TURNIGY_PLUSH_12A.INC)	; Select Turnigy Plush 12A pinout
                               ENDIF
                       744     
                       745     IF BESC == TURNIGY_PLUSH_12A_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (TURNIGY_PLUSH_12A.INC)	; Select Turnigy Plush 12A pinout
                               ENDIF
                       749     
                       750     IF BESC == TURNIGY_PLUSH_18A_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (TURNIGY_PLUSH_18A.INC)	; Select Turnigy Plush 18A pinout
                               ENDIF
                       754     
                       755     IF BESC == TURNIGY_PLUSH_18A_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (TURNIGY_PLUSH_18A.INC)	; Select Turnigy Plush 18A pinout
                               ENDIF
                       759     
                       760     IF BESC == TURNIGY_PLUSH_18A_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (TURNIGY_PLUSH_18A.INC)	; Select Turnigy Plush 18A pinout
                               ENDIF
                       764     
                       765     IF BESC == TURNIGY_PLUSH_25A_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (TURNIGY_PLUSH_25A.INC)	; Select Turnigy Plush 25A pinout
                               ENDIF
                       769     
                       770     IF BESC == TURNIGY_PLUSH_25A_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (TURNIGY_PLUSH_25A.INC)	; Select Turnigy Plush 25A pinout
                               ENDIF
                       774     
                       775     IF BESC == TURNIGY_PLUSH_25A_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (TURNIGY_PLUSH_25A.INC)	; Select Turnigy Plush 25A pinout
                               ENDIF
                       779     
                       780     IF BESC == TURNIGY_PLUSH_30A_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (TURNIGY_PLUSH_30A.INC)	; Select Turnigy Plush 30A pinout
                               ENDIF
                       784     
                       785     IF BESC == TURNIGY_PLUSH_30A_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (TURNIGY_PLUSH_30A.INC)	; Select Turnigy Plush 30A pinout
                               ENDIF
                       789     
                       790     IF BESC == TURNIGY_PLUSH_30A_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (TURNIGY_PLUSH_30A.INC)	; Select Turnigy Plush 30A pinout
                               ENDIF
                       794     
                       795     IF BESC == TURNIGY_PLUSH_40A_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (TURNIGY_PLUSH_40A.INC)	; Select Turnigy Plush 40A pinout
                               ENDIF
                       799     
                       800     IF BESC == TURNIGY_PLUSH_40A_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (TURNIGY_PLUSH_40A.INC)	; Select Turnigy Plush 40A pinout
                               ENDIF
                       804     
                       805     IF BESC == TURNIGY_PLUSH_40A_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (TURNIGY_PLUSH_40A.INC)	; Select Turnigy Plush 40A pinout
                               ENDIF
                       809     
                       810     IF BESC == TURNIGY_PLUSH_60A_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (TURNIGY_PLUSH_60A.INC)	; Select Turnigy Plush 60A pinout
                               ENDIF
                       814     
                       815     IF BESC == TURNIGY_PLUSH_60A_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (TURNIGY_PLUSH_60A.INC)	; Select Turnigy Plush 60A pinout
                               ENDIF
                       819     
                       820     IF BESC == TURNIGY_PLUSH_60A_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (TURNIGY_PLUSH_60A.INC)	; Select Turnigy Plush 60A pinout
                               ENDIF
                       824     
                       825     IF BESC == TURNIGY_PLUSH_80A_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (TURNIGY_PLUSH_80A.INC)	; Select Turnigy Plush 80A pinout
                               ENDIF
                       829     
                       830     IF BESC == TURNIGY_PLUSH_80A_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (TURNIGY_PLUSH_80A.INC)	; Select Turnigy Plush 80A pinout
                               ENDIF
                       834     
                       835     IF BESC == TURNIGY_PLUSH_80A_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (TURNIGY_PLUSH_80A.INC)	; Select Turnigy Plush 80A pinout
                               ENDIF
                       839     
                       840     IF BESC == TURNIGY_PLUSH_NFET_18A_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (TURNIGY_PLUSH_NFET_18A.INC)	; Select Turnigy Plush Nfet 18A pinout
                               ENDIF
                       844     
                       845     IF BESC == TURNIGY_PLUSH_NFET_18A_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (TURNIGY_PLUSH_NFET_18A.INC)	; Select Turnigy Plush Nfet 18A pinout
                               ENDIF
                       849     
                       850     IF BESC == TURNIGY_PLUSH_NFET_18A_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (TURNIGY_PLUSH_NFET_18A.INC)	; Select Turnigy Plush Nfet 18A pinout
                               ENDIF
                       854     
                       855     IF BESC == TURNIGY_PLUSH_NFET_25A_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (TURNIGY_PLUSH_NFET_25A.INC)	; Select Turnigy Plush Nfet 25A pinout
                               ENDIF
                       859     
                       860     IF BESC == TURNIGY_PLUSH_NFET_25A_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (TURNIGY_PLUSH_NFET_25A.INC)	; Select Turnigy Plush Nfet 25A pinout
                               ENDIF
                       864     
                       865     IF BESC == TURNIGY_PLUSH_NFET_25A_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (TURNIGY_PLUSH_NFET_25A.INC)	; Select Turnigy Plush Nfet 25A pinout
                               ENDIF
                       869     
                       870     IF BESC == TURNIGY_PLUSH_NFET_30A_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (TURNIGY_PLUSH_NFET_30A.INC)	; Select Turnigy Plush Nfet 30A pinout
                               ENDIF
                       874     
                       875     IF BESC == TURNIGY_PLUSH_NFET_30A_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (TURNIGY_PLUSH_NFET_30A.INC)	; Select Turnigy Plush Nfet 30A pinout
                               ENDIF
                       879     
                       880     IF BESC == TURNIGY_PLUSH_NFET_30A_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (TURNIGY_PLUSH_NFET_30A.INC)	; Select Turnigy Plush Nfet 30A pinout
                               ENDIF
                       884     
                       885     IF BESC == TURNIGY_AE_20A_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (TURNIGY_AE_20A.INC)		; Select Turnigy AE-20A pinout
                               ENDIF
                       889     
                       890     IF BESC == TURNIGY_AE_20A_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (TURNIGY_AE_20A.INC)		; Select Turnigy AE-20A pinout
                               ENDIF
                       894     
                       895     IF BESC == TURNIGY_AE_20A_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (TURNIGY_AE_20A.INC)		; Select Turnigy AE-20A pinout
                               ENDIF
                       899     
                       900     IF BESC == TURNIGY_AE_25A_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (TURNIGY_AE_25A.INC)		; Select Turnigy AE-25A pinout
                               ENDIF
                       904     
                       905     IF BESC == TURNIGY_AE_25A_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (TURNIGY_AE_25A.INC)		; Select Turnigy AE-25A pinout
                               ENDIF
                       909     
                       910     IF BESC == TURNIGY_AE_25A_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (TURNIGY_AE_25A.INC)		; Select Turnigy AE-25A pinout
                               ENDIF
                       914     
                       915     IF BESC == TURNIGY_AE_30A_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (TURNIGY_AE_30A.INC)		; Select Turnigy AE-30A pinout
                               ENDIF
                       919     
                       920     IF BESC == TURNIGY_AE_30A_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (TURNIGY_AE_30A.INC)		; Select Turnigy AE-30A pinout
                               ENDIF
                       924     
                       925     IF BESC == TURNIGY_AE_30A_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (TURNIGY_AE_30A.INC)		; Select Turnigy AE-30A pinout
                               ENDIF
                       929     
                       930     IF BESC == TURNIGY_AE_45A_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (TURNIGY_AE_45A.INC)		; Select Turnigy AE-45A pinout
                               ENDIF
                       934     
                       935     IF BESC == TURNIGY_AE_45A_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (TURNIGY_AE_45A.INC)		; Select Turnigy AE-45A pinout
                               ENDIF
                       939     
                       940     IF BESC == TURNIGY_AE_45A_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (TURNIGY_AE_45A.INC)		; Select Turnigy AE-45A pinout
                               ENDIF
                       944     
                       945     IF BESC == TURNIGY_KFORCE_40A_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (TURNIGY_KFORCE_40A.INC)	; Select Turnigy KForce 40A pinout
                               ENDIF
                       949     
                       950     IF BESC == TURNIGY_KFORCE_40A_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (TURNIGY_KFORCE_40A.INC)	; Select Turnigy KForce 40A pinout
                               ENDIF
                       954     
                       955     IF BESC == TURNIGY_KFORCE_40A_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (TURNIGY_KFORCE_40A.INC)	; Select Turnigy KForce 40A pinout
                               ENDIF
                       959     
                       960     IF BESC == TURNIGY_KFORCE_70A_HV_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (TURNIGY_KFORCE_70A_HV.INC)	; Select Turnigy KForce 70A HV pinout
                               ENDIF
                       964     
                       965     IF BESC == TURNIGY_KFORCE_70A_HV_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (TURNIGY_KFORCE_70A_HV.INC)	; Select Turnigy KForce 70A HV pinout
                               ENDIF
                       969     
                       970     IF BESC == TURNIGY_KFORCE_70A_HV_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (TURNIGY_KFORCE_70A_HV.INC)	; Select Turnigy KForce 70A HV pinout
                               ENDIF
                       974     
                       975     IF BESC == TURNIGY_KFORCE_120A_HV_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (TURNIGY_KFORCE_120A_HV.INC)	; Select Turnigy KForce 120A HV pinout
                               ENDIF
                       979     
                       980     IF BESC == TURNIGY_KFORCE_120A_HV_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (TURNIGY_KFORCE_120A_HV.INC)	; Select Turnigy KForce 120A HV pinout
                               ENDIF
                       984     
                       985     IF BESC == TURNIGY_KFORCE_120A_HV_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (TURNIGY_KFORCE_120A_HV.INC)	; Select Turnigy KForce 120A HV pinout
                               ENDIF
                       989     
                       990     IF BESC == TURNIGY_KFORCE_120A_HV_V2_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (TURNIGY_KFORCE_120A_HV_V2.INC); Select Turnigy KForce 120A HV v2 pinout
                               ENDIF
                       994     
                       995     IF BESC == TURNIGY_KFORCE_120A_HV_V2_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (TURNIGY_KFORCE_120A_HV_V2.INC); Select Turnigy KForce 120A HV v2 pinout
                               ENDIF
                       999     
                      1000     IF BESC == TURNIGY_KFORCE_120A_HV_V2_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (TURNIGY_KFORCE_120A_HV_V2.INC); Select Turnigy KForce 120A HV v2 pinout
                               ENDIF
                      1004     
                      1005     IF BESC == SKYWALKER_12A_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (SKYWALKER_12A.INC)		; Select Skywalker 12A pinout
                               ENDIF
                      1009     
                      1010     IF BESC == SKYWALKER_12A_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (SKYWALKER_12A.INC)		; Select Skywalker 12A pinout
                               ENDIF
                      1014     
                      1015     IF BESC == SKYWALKER_12A_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (SKYWALKER_12A.INC)		; Select Skywalker 12A pinout
                               ENDIF
                      1019     
                      1020     IF BESC == SKYWALKER_20A_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (SKYWALKER_20A.INC)		; Select Skywalker 20A pinout
                               ENDIF
                      1024     
                      1025     IF BESC == SKYWALKER_20A_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (SKYWALKER_20A.INC)		; Select Skywalker 20A pinout
                               ENDIF
                      1029     
                      1030     IF BESC == SKYWALKER_20A_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (SKYWALKER_20A.INC)		; Select Skywalker 20A pinout
                               ENDIF
                      1034     
                      1035     IF BESC == SKYWALKER_40A_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (SKYWALKER_40A.INC)		; Select Skywalker 40A pinout
                               ENDIF
                      1039     
                      1040     IF BESC == SKYWALKER_40A_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (SKYWALKER_40A.INC)		; Select Skywalker 40A pinout
                               ENDIF
                      1044     
                      1045     IF BESC == SKYWALKER_40A_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (SKYWALKER_40A.INC)		; Select Skywalker 40A pinout
                               ENDIF
                      1049     
                      1050     IF BESC == HIMODEL_COOL_22A_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (HIMODEL_COOL_22A.INC)	; Select HiModel Cool 22A pinout
                               ENDIF
                      1054     
                      1055     IF BESC == HIMODEL_COOL_22A_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (HIMODEL_COOL_22A.INC)	; Select HiModel Cool 22A pinout
                               ENDIF
                      1059     
                      1060     IF BESC == HIMODEL_COOL_22A_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (HIMODEL_COOL_22A.INC)	; Select HiModel Cool 22A pinout
                               ENDIF
                      1064     
                      1065     IF BESC == HIMODEL_COOL_33A_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (HIMODEL_COOL_33A.INC)	; Select HiModel Cool 33A pinout
                               ENDIF
                      1069     
                      1070     IF BESC == HIMODEL_COOL_33A_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (HIMODEL_COOL_33A.INC)	; Select HiModel Cool 33A pinout
                               ENDIF
                      1074     
                      1075     IF BESC == HIMODEL_COOL_33A_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (HIMODEL_COOL_33A.INC)	; Select HiModel Cool 33A pinout
                               ENDIF
                      1079     
                      1080     IF BESC == HIMODEL_COOL_41A_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (HIMODEL_COOL_41A.INC)	; Select HiModel Cool 41A pinout
                               ENDIF
                      1084     
                      1085     IF BESC == HIMODEL_COOL_41A_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (HIMODEL_COOL_41A.INC)	; Select HiModel Cool 41A pinout
                               ENDIF
                      1089     
                      1090     IF BESC == HIMODEL_COOL_41A_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (HIMODEL_COOL_41A.INC)	; Select HiModel Cool 41A pinout
                               ENDIF
                      1094     
                      1095     IF BESC == RCTIMER_6A_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (RCTIMER_6A.INC)		; Select RC Timer 6A pinout
                               ENDIF
                      1099     
                      1100     IF BESC == RCTIMER_6A_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (RCTIMER_6A.INC)		; Select RC Timer 6A pinout
                               ENDIF
                      1104     
                      1105     IF BESC == RCTIMER_6A_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (RCTIMER_6A.INC)		; Select RC Timer 6A pinout
                               ENDIF
                      1109     
                      1110     IF BESC == ALIGN_RCE_BL15X_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (ALIGN_RCE_BL15X.INC)	; Select Align RCE-BL15X pinout
                               ENDIF
                      1114     
                      1115     IF BESC == ALIGN_RCE_BL15X_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (ALIGN_RCE_BL15X.INC)	; Select Align RCE-BL15X pinout
                               ENDIF
                      1119     
                      1120     IF BESC == ALIGN_RCE_BL15X_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (ALIGN_RCE_BL15X.INC)	; Select Align RCE-BL15X pinout
                               ENDIF
                      1124     
                      1125     IF BESC == ALIGN_RCE_BL15P_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (ALIGN_RCE_BL15P.INC)	; Select Align RCE-BL15P pinout
                               ENDIF
                      1129     
                      1130     IF BESC == ALIGN_RCE_BL15P_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (ALIGN_RCE_BL15P.INC)	; Select Align RCE-BL15P pinout
                               ENDIF
                      1134     
                      1135     IF BESC == ALIGN_RCE_BL15P_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (ALIGN_RCE_BL15P.INC)	; Select Align RCE-BL15P pinout
                               ENDIF
                      1139     
                      1140     IF BESC == ALIGN_RCE_BL35X_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (ALIGN_RCE_BL35X.INC)	; Select Align RCE-BL35X pinout
                               ENDIF
                      1144     
                      1145     IF BESC == ALIGN_RCE_BL35X_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (ALIGN_RCE_BL35X.INC)	; Select Align RCE-BL35X pinout
                               ENDIF
                      1149     
                      1150     IF BESC == ALIGN_RCE_BL35X_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (ALIGN_RCE_BL35X.INC)	; Select Align RCE-BL35X pinout
                               ENDIF
                      1154     
                      1155     IF BESC == ALIGN_RCE_BL35P_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (ALIGN_RCE_BL35P.INC)	; Select Align RCE-BL35P pinout
                               ENDIF
                      1159     
                      1160     IF BESC == ALIGN_RCE_BL35P_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (ALIGN_RCE_BL35P.INC)	; Select Align RCE-BL35P pinout
                               ENDIF
                      1164     
                      1165     IF BESC == ALIGN_RCE_BL35P_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (ALIGN_RCE_BL35P.INC)	; Select Align RCE-BL35P pinout
                               ENDIF
                      1169     
                      1170     IF BESC == GAUI_GE_183_18A_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (GAUI_GE_183_18A.INC)	; Select Gaui GE-183 18A pinout
                               ENDIF
                      1174     
                      1175     IF BESC == GAUI_GE_183_18A_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (GAUI_GE_183_18A.INC)	; Select Gaui GE-183 18A pinout
                               ENDIF
                      1179     
                      1180     IF BESC == GAUI_GE_183_18A_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (GAUI_GE_183_18A.INC)	; Select Gaui GE-183 18A pinout
                               ENDIF
                      1184     
                      1185     IF BESC == H_KING_10A_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (H_KING_10A.INC)		; Select H-King 10A pinout
                               ENDIF
                      1189     
                      1190     IF BESC == H_KING_10A_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (H_KING_10A.INC)		; Select H-King 10A pinout
                               ENDIF
                      1194     
                      1195     IF BESC == H_KING_10A_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (H_KING_10A.INC)		; Select H-King 10A pinout
                               ENDIF
                      1199     
                      1200     IF BESC == H_KING_20A_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (H_KING_20A.INC)		; Select H-King 20A pinout
                               ENDIF
                      1204     
                      1205     IF BESC == H_KING_20A_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (H_KING_20A.INC)		; Select H-King 20A pinout
                               ENDIF
                      1209     
                      1210     IF BESC == H_KING_20A_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (H_KING_20A.INC)		; Select H-King 20A pinout
                               ENDIF
                      1214     
                      1215     IF BESC == H_KING_35A_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (H_KING_35A.INC)		; Select H-King 35A pinout
                               ENDIF
                      1219     
                      1220     IF BESC == H_KING_35A_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (H_KING_35A.INC)		; Select H-King 35A pinout
                               ENDIF
                      1224     
                      1225     IF BESC == H_KING_35A_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (H_KING_35A.INC)		; Select H-King 35A pinout
                               ENDIF
                      1229     
                      1230     IF BESC == H_KING_50A_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (H_KING_50A.INC)		; Select H-King 50A pinout
                               ENDIF
                      1234     
                      1235     IF BESC == H_KING_50A_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (H_KING_50A.INC)		; Select H-King 50A pinout
                               ENDIF
                      1239     
                      1240     IF BESC == H_KING_50A_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (H_KING_50A.INC)		; Select H-King 50A pinout
                               ENDIF
                      1244     
                      1245     IF BESC == POLARIS_THUNDER_12A_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (POLARIS_THUNDER_12A.INC)	; Select Polaris Thunder 12A pinout
                               ENDIF
                      1249     
                      1250     IF BESC == POLARIS_THUNDER_12A_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (POLARIS_THUNDER_12A.INC)	; Select Polaris Thunder 12A pinout
                               ENDIF
                      1254     
                      1255     IF BESC == POLARIS_THUNDER_12A_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (POLARIS_THUNDER_12A.INC)	; Select Polaris Thunder 12A pinout
                               ENDIF
                      1259     
                      1260     IF BESC == POLARIS_THUNDER_20A_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (POLARIS_THUNDER_20A.INC)	; Select Polaris Thunder 20A pinout
                               ENDIF
                      1264     
                      1265     IF BESC == POLARIS_THUNDER_20A_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (POLARIS_THUNDER_20A.INC)	; Select Polaris Thunder 20A pinout
                               ENDIF
                      1269     
                      1270     IF BESC == POLARIS_THUNDER_20A_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (POLARIS_THUNDER_20A.INC)	; Select Polaris Thunder 20A pinout
                               ENDIF
                      1274     
                      1275     IF BESC == POLARIS_THUNDER_30A_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (POLARIS_THUNDER_30A.INC)	; Select Polaris Thunder 30A pinout
                               ENDIF
                      1279     
                      1280     IF BESC == POLARIS_THUNDER_30A_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (POLARIS_THUNDER_30A.INC)	; Select Polaris Thunder 30A pinout
                               ENDIF
                      1284     
                      1285     IF BESC == POLARIS_THUNDER_30A_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (POLARIS_THUNDER_30A.INC)	; Select Polaris Thunder 30A pinout
                               ENDIF
                      1289     
                      1290     IF BESC == POLARIS_THUNDER_40A_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (POLARIS_THUNDER_40A.INC)	; Select Polaris Thunder 40A pinout
                               ENDIF
                      1294     
                      1295     IF BESC == POLARIS_THUNDER_40A_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (POLARIS_THUNDER_40A.INC)	; Select Polaris Thunder 40A pinout
                               ENDIF
                      1299     
                      1300     IF BESC == POLARIS_THUNDER_40A_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (POLARIS_THUNDER_40A.INC)	; Select Polaris Thunder 40A pinout
                               ENDIF
                      1304     
                      1305     IF BESC == POLARIS_THUNDER_60A_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (POLARIS_THUNDER_60A.INC)	; Select Polaris Thunder 60A pinout
                               ENDIF
                      1309     
                      1310     IF BESC == POLARIS_THUNDER_60A_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (POLARIS_THUNDER_60A.INC)	; Select Polaris Thunder 60A pinout
                               ENDIF
                      1314     
                      1315     IF BESC == POLARIS_THUNDER_60A_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (POLARIS_THUNDER_60A.INC)	; Select Polaris Thunder 60A pinout
                               ENDIF
                      1319     
                      1320     IF BESC == POLARIS_THUNDER_80A_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (POLARIS_THUNDER_80A.INC)	; Select Polaris Thunder 80A pinout
                               ENDIF
                      1324     
                      1325     IF BESC == POLARIS_THUNDER_80A_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (POLARIS_THUNDER_80A.INC)	; Select Polaris Thunder 80A pinout
                               ENDIF
                      1329     
                      1330     IF BESC == POLARIS_THUNDER_80A_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (POLARIS_THUNDER_80A.INC)	; Select Polaris Thunder 80A pinout
                               ENDIF
                      1334     
                      1335     IF BESC == POLARIS_THUNDER_100A_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (POLARIS_THUNDER_100A.INC); Select Polaris Thunder 100A pinout
                               ENDIF
                      1339     
                      1340     IF BESC == POLARIS_THUNDER_100A_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (POLARIS_THUNDER_100A.INC); Select Polaris Thunder 100A pinout
                               ENDIF
                      1344     
                      1345     IF BESC == POLARIS_THUNDER_100A_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (POLARIS_THUNDER_100A.INC); Select Polaris Thunder 100A pinout
                               ENDIF
                      1349     
                      1350     IF BESC == PLATINUM_PRO_30A_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (PLATINUM_PRO_30A.INC)	; Select Platinum Pro 30A pinout
                               ENDIF
                      1354     
                      1355     IF BESC == PLATINUM_PRO_30A_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (PLATINUM_PRO_30A.INC)	; Select Platinum Pro 30A pinout
                               ENDIF
                      1359     
                      1360     IF BESC == PLATINUM_PRO_30A_MULTI
  0002                1361     MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                      1362     $INCLUDE (PLATINUM_PRO_30A.INC)	; Select Platinum Pro 30A pinout
                      1972     ENDIF
                      1973     
                      1974     IF BESC == EAZY_3AV2_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (EAZY_3AV2.INC)			; Select Platinum Pro 30A pinout
                               ENDIF
                      1978     
                      1979     IF BESC == EAZY_3AV2_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (EAZY_3AV2.INC)			; Select Platinum Pro 30A pinout
                               ENDIF
                      1983     
                      1984     IF BESC == EAZY_3AV2_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (EAZY_3AV2.INC)			; Select Platinum Pro 30A pinout
                               ENDIF
                      1988     
                      1989     IF BESC == TAROT_30A_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (TAROT_30A.INC)			; Select Tarot 30A pinout
                               ENDIF
                      1993     
                      1994     IF BESC == TAROT_30A_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (TAROT_30A.INC)			; Select Tarot 30A pinout
                               ENDIF
                      1998     
                      1999     IF BESC == TAROT_30A_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (TAROT_30A.INC)			; Select Tarot 30A pinout
                               ENDIF
                      2003     
                      2004     IF BESC == SKYIII_30A_MAIN
                               MODE 	EQU 	0				; Choose mode. Set to 0 for main motor
                               $INCLUDE (SKYIII_30A.INC)		; Select SkyIII 30A pinout
                               ENDIF
                      2008     
                      2009     IF BESC == SKYIII_30A_TAIL
                               MODE 	EQU 	1				; Choose mode. Set to 1 for tail motor
                               $INCLUDE (SKYIII_30A.INC)		; Select SkyIII 30A pinout
                               ENDIF
                      2013     
                      2014     IF BESC == SKYIII_30A_MULTI
                               MODE 	EQU 	2				; Choose mode. Set to 2 for multirotor
                               $INCLUDE (SKYIII_30A.INC)		; Select SkyIII 30A pinout
                               ENDIF
                      2018     
                      2019     ;**** **** **** **** ****
                      2020     ; TX programming defaults
                      2021     ;
                      2022     ; Parameter dependencies:
                      2023     ; - Governor P gain, I gain and Range is only used if one of the three governor modes is selected
                      2024     ; - Governor setup target is only used if Setup governor mode is selected (or closed loop mode is on for multi)
                      2025     ; - Startup rpm and startup accel is only used if stepped startup method is selected
                      2026     ; - Damping force is only used if DampedLight or Damped is selected
                      2027     ;
                      2028     ; Main
  0007                2029     DEFAULT_PGM_MAIN_P_GAIN 			EQU 7 	; 1=0.13		2=0.17		3=0.25		4=0.38 		5=0.50 	6=0.75 	7=1.00 8=1.5 9=2.0 10=3.0 11=4.0 12=6.0 13=8.0
  0007                2030     DEFAULT_PGM_MAIN_I_GAIN 			EQU 7 	; 1=0.13		2=0.17		3=0.25		4=0.38 		5=0.50 	6=0.75 	7=1.00 8=1.5 9=2.0 10=3.0 11=4.0 12=6.0 13=8.0
  0001                2031     DEFAULT_PGM_MAIN_GOVERNOR_MODE 	EQU 1 	; 1=Tx 		2=Arm 		3=Setup		4=Off
  0001                2032     DEFAULT_PGM_MAIN_GOVERNOR_RANGE 	EQU 1 	; 1=High		2=Middle		3=Low
  0004                2033     DEFAULT_PGM_MAIN_LOW_VOLTAGE_LIM	EQU 4 	; 1=Off		2=3.0V/c		3=3.1V/c		4=3.2V/c		5=3.3V/c	6=3.4V/c
  0003                2034     DEFAULT_PGM_MAIN_STARTUP_RPM		EQU 3 	; 1=0.67		2=0.8 		3=1.00 		4=1.25 		5=1.5
  0001                2035     DEFAULT_PGM_MAIN_STARTUP_ACCEL	EQU 1 	; 1=0.4 		2=0.7 		3=1.0 		4=1.5 		5=2.3
  0003                2036     DEFAULT_PGM_MAIN_COMM_TIMING		EQU 3 	; 1=Low 		2=MediumLow 	3=Medium 		4=MediumHigh 	5=High
  000D                2037     DEFAULT_PGM_MAIN_THROTTLE_RATE	EQU 13	; 1=2		2=3			3=4			4=6 			5=8	 	6=12 	7=16	  8=24  9=32  10=48  11=64  12=128 13=255
  0001                2038     DEFAULT_PGM_MAIN_DAMPING_FORCE	EQU 1 	; 1=VeryLow 	2=Low 		3=MediumLow 	4=MediumHigh 	5=High	6=Highest
  0002                2039     DEFAULT_PGM_MAIN_PWM_FREQ 		EQU 2 	; 1=High 		2=Low		3=DampedLight
  0001                2040     DEFAULT_PGM_MAIN_DEMAG_COMP 		EQU 1 	; 1=Disabled	2=Low		3=High
  0001                2041     DEFAULT_PGM_MAIN_DIRECTION		EQU 1 	; 1=Normal 	2=Reversed
  0001                2042     DEFAULT_PGM_MAIN_RCP_PWM_POL 		EQU 1 	; 1=Positive 	2=Negative
  00B4                2043     DEFAULT_PGM_MAIN_GOV_SETUP_TARGET	EQU 180	; Target for governor in setup mode. Corresponds to 70% throttle
  0000                2044     DEFAULT_PGM_MAIN_REARM_START		EQU 0 	; 1=Enabled 	0=Disabled
  0078                2045     DEFAULT_PGM_MAIN_BEEP_STRENGTH	EQU 120	; Beep strength
  00C8                2046     DEFAULT_PGM_MAIN_BEACON_STRENGTH	EQU 200	; Beacon strength
  0004                2047     DEFAULT_PGM_MAIN_BEACON_DELAY		EQU 4 	; 1=1m		2=2m			3=5m			4=10m		5=Infinite
                      2048     ; Tail
  0003                2049     DEFAULT_PGM_TAIL_GAIN 			EQU 3 	; 1=0.75 		2=0.88 		3=1.00 		4=1.12 		5=1.25
  0004                2050     DEFAULT_PGM_TAIL_IDLE_SPEED 		EQU 4 	; 1=Low 		2=MediumLow 	3=Medium 		4=MediumHigh 	5=High
  0003                2051     DEFAULT_PGM_TAIL_STARTUP_RPM		EQU 3 	; 1=0.67		2=0.8 		3=1.00 		4=1.25 		5=1.5
  0005                2052     DEFAULT_PGM_TAIL_STARTUP_ACCEL	EQU 5 	; 1=0.4 		2=0.7 		3=1.0 		4=1.5 		5=2.3
  0003                2053     DEFAULT_PGM_TAIL_COMM_TIMING		EQU 3 	; 1=Low 		2=MediumLow 	3=Medium 		4=MediumHigh 	5=High
  000D                2054     DEFAULT_PGM_TAIL_THROTTLE_RATE	EQU 13	; 1=2		2=3			3=4			4=6 			5=8	 	6=12 	7=16	  8=24  9=32  10=48  11=64  12=128 13=255
  0005                2055     DEFAULT_PGM_TAIL_DAMPING_FORCE	EQU 5 	; 1=VeryLow 	2=Low 		3=MediumLow 	4=MediumHigh 	5=High	6=Highest
                      2056     IF DAMPED_MODE_ENABLE == 1
  0004                2057     DEFAULT_PGM_TAIL_PWM_FREQ	 	EQU 4 	; 1=High 		2=Low 		3=DampedLight  4=Damped 	
                      2058     ELSE
                               DEFAULT_PGM_TAIL_PWM_FREQ	 	EQU 3 	; 1=High 		2=Low		3=DampedLight
                               ENDIF
  0001                2061     DEFAULT_PGM_TAIL_DEMAG_COMP 		EQU 1 	; 1=Disabled	2=Low		3=High
  0001                2062     DEFAULT_PGM_TAIL_DIRECTION		EQU 1 	; 1=Normal 	2=Reversed	3=Bidirectional
  0001                2063     DEFAULT_PGM_TAIL_RCP_PWM_POL 		EQU 1 	; 1=Positive 	2=Negative
  00FA                2064     DEFAULT_PGM_TAIL_BEEP_STRENGTH	EQU 250	; Beep strength
  00FA                2065     DEFAULT_PGM_TAIL_BEACON_STRENGTH	EQU 250	; Beacon strength
  0004                2066     DEFAULT_PGM_TAIL_BEACON_DELAY		EQU 4 	; 1=1m		2=2m			3=5m			4=10m		5=Infinite
                      2067     ; Multi
  0009                2068     DEFAULT_PGM_MULTI_P_GAIN 		EQU 9 	; 1=0.13		2=0.17		3=0.25		4=0.38 		5=0.50 	6=0.75 	7=1.00 8=1.5 9=2.0 10=3.0 11=4.0 12=6.0 13=8.0
  0009                2069     DEFAULT_PGM_MULTI_I_GAIN 		EQU 9 	; 1=0.13		2=0.17		3=0.25		4=0.38 		5=0.50 	6=0.75 	7=1.00 8=1.5 9=2.0 10=3.0 11=4.0 12=6.0 13=8.0
  0004                2070     DEFAULT_PGM_MULTI_GOVERNOR_MODE 	EQU 4 	; 1=HiRange	2=MidRange	3=LoRange		4=Off
  0003                2071     DEFAULT_PGM_MULTI_GAIN 			EQU 3 	; 1=0.75 		2=0.88 		3=1.00 		4=1.12 		5=1.25
  0001                2072     DEFAULT_PGM_MULTI_LOW_VOLTAGE_LIM	EQU 1 	; 1=Off		2=3.0V/c		3=3.1V/c		4=3.2V/c		5=3.3V/c	6=3.4V/c
  0001                2073     DEFAULT_PGM_MULTI_STARTUP_RPM		EQU 1 	; 1=0.67		2=0.8 		3=1.00 		4=1.25 		5=1.5
  0005                2074     DEFAULT_PGM_MULTI_STARTUP_ACCEL	EQU 5 	; 1=0.4 		2=0.7 		3=1.0 		4=1.5 		5=2.3
  0003                2075     DEFAULT_PGM_MULTI_COMM_TIMING		EQU 3 	; 1=Low 		2=MediumLow 	3=Medium 		4=MediumHigh 	5=High
  000D                2076     DEFAULT_PGM_MULTI_THROTTLE_RATE	EQU 13	; 1=2		2=3			3=4			4=6 			5=8	 	6=12 	7=16	  8=24  9=32  10=48  11=64  12=128 13=255
  0006                2077     DEFAULT_PGM_MULTI_DAMPING_FORCE	EQU 6 	; 1=VeryLow 	2=Low 		3=MediumLow 	4=MediumHigh 	5=High	6=Highest
                      2078     IF DAMPED_MODE_ENABLE == 1
  0001                2079     DEFAULT_PGM_MULTI_PWM_FREQ	 	EQU 1 	; 1=High 		2=Low 		3=DampedLight  4=Damped 	
                      2080     ELSE
                               DEFAULT_PGM_MULTI_PWM_FREQ	 	EQU 1 	; 1=High 		2=Low		3=DampedLight
                               ENDIF
  0002                2083     DEFAULT_PGM_MULTI_DEMAG_COMP 		EQU 2 	; 1=Disabled	2=Low		3=High
  0001                2084     DEFAULT_PGM_MULTI_DIRECTION		EQU 1 	; 1=Normal 	2=Reversed	3=Bidirectional
  0001                2085     DEFAULT_PGM_MULTI_RCP_PWM_POL 	EQU 1 	; 1=Positive 	2=Negative
  0028                2086     DEFAULT_PGM_MULTI_BEEP_STRENGTH	EQU 40	; Beep strength
  0050                2087     DEFAULT_PGM_MULTI_BEACON_STRENGTH	EQU 80	; Beacon strength
  0004                2088     DEFAULT_PGM_MULTI_BEACON_DELAY	EQU 4 	; 1=1m		2=2m			3=5m			4=10m		5=Infinite
                      2089     ; Common
  0001                2090     DEFAULT_PGM_ENABLE_TX_PROGRAM 	EQU 1 	; 1=Enabled 	0=Disabled
  0025                2091     DEFAULT_PGM_PPM_MIN_THROTTLE		EQU 37	; 4*37+1000=1148
  00D0                2092     DEFAULT_PGM_PPM_MAX_THROTTLE		EQU 208	; 4*208+1000=1832
  007A                2093     DEFAULT_PGM_PPM_CENTER_THROTTLE	EQU 122	; 4*122+1000=1488 (used in bidirectional mode)
  0000                2094     DEFAULT_PGM_BEC_VOLTAGE_HIGH		EQU 0	; 0=Low		1= High
                      2095     
                      2096     ;**** **** **** **** ****
                      2097     ; Constant definitions for main
                      2098     IF MODE == 0
                               
                               GOV_SPOOLRATE		EQU	2	; Number of steps for governor requested pwm per 32ms
                               
                               RCP_TIMEOUT_PPM	EQU	10	; Number of timer2H overflows (about 32ms) before considering rc pulse lost
                               RCP_TIMEOUT		EQU	64	; Number of timer2L overflows (about 128us) before considering rc pulse lost
                               RCP_SKIP_RATE		EQU 	32	; Number of timer2L overflows (about 128us) before reenabling rc pulse detection
                               RCP_MIN			EQU 	0	; This is minimum RC pulse length
                               RCP_MAX			EQU 	255	; This is maximum RC pulse length
                               RCP_VALIDATE		EQU 	2	; Require minimum this pulse length to validate RC pulse
                               RCP_STOP			EQU 	1	; Stop motor at or below this pulse length
                               RCP_STOP_LIMIT		EQU 	250	; Stop motor if this many timer2H overflows (~32ms) are below stop limit
                               
                               PWM_SETTLE		EQU 	50 	; PWM used when in start settling phase (also max power during direct start)
                               PWM_STEPPER		EQU 	80 	; PWM used when in start stepper phase
                               
                               COMM_TIME_RED		EQU 	8	; Fixed reduction (in us) for commutation wait (to account for fixed delays)
                               COMM_TIME_MIN		EQU 	1	; Minimum time (in us) for commutation wait
                               
                               TEMP_CHECK_RATE	EQU 	8	; Number of adc conversions for each check of temperature (the other conversions are used for voltage)
                               
                               ENDIF
                      2120     ; Constant definitions for tail
                      2121     IF MODE == 1
                               
                               GOV_SPOOLRATE		EQU	1	; Number of steps for governor requested pwm per 32ms
                               RCP_TIMEOUT_PPM	EQU	10	; Number of timer2H overflows (about 32ms) before considering rc pulse lost
                               RCP_TIMEOUT		EQU 	24	; Number of timer2L overflows (about 128us) before considering rc pulse lost
                               RCP_SKIP_RATE		EQU 	6	; Number of timer2L overflows (about 128us) before reenabling rc pulse detection
                               RCP_MIN			EQU 	0	; This is minimum RC pulse length
                               RCP_MAX			EQU 	255	; This is maximum RC pulse length
                               RCP_VALIDATE		EQU 	2	; Require minimum this pulse length to validate RC pulse
                               RCP_STOP			EQU 	1	; Stop motor at or below this pulse length
                               RCP_STOP_LIMIT		EQU 	130	; Stop motor if this many timer2H overflows (~32ms) are below stop limit
                               
                               PWM_SETTLE		EQU 	50 	; PWM used when in start settling phase (also max power during direct start)
                               PWM_STEPPER		EQU 	120 	; PWM used when in start stepper phase
                               
                               COMM_TIME_RED		EQU 	8	; Fixed reduction (in us) for commutation wait (to account for fixed delays)
                               COMM_TIME_MIN		EQU 	1	; Minimum time (in us) for commutation wait
                               
                               TEMP_CHECK_RATE	EQU 	8	; Number of adc conversions for each check of temperature (the other conversions are used for voltage)
                               
                               ENDIF
                      2142     ; Constant definitions for multi
                      2143     IF MODE == 2
                      2144     
  0001                2145     GOV_SPOOLRATE		EQU	1	; Number of steps for governor requested pwm per 32ms
                      2146     
  000A                2147     RCP_TIMEOUT_PPM	EQU	10	; Number of timer2H overflows (about 32ms) before considering rc pulse lost
  0018                2148     RCP_TIMEOUT		EQU 	24	; Number of timer2L overflows (about 128us) before considering rc pulse lost
  0006                2149     RCP_SKIP_RATE		EQU 	6	; Number of timer2L overflows (about 128us) before reenabling rc pulse detection
  0000                2150     RCP_MIN			EQU 	0	; This is minimum RC pulse length
  00FF                2151     RCP_MAX			EQU 	255	; This is maximum RC pulse length
  0002                2152     RCP_VALIDATE		EQU 	2	; Require minimum this pulse length to validate RC pulse
  0001                2153     RCP_STOP			EQU 	1	; Stop motor at or below this pulse length
  00FA                2154     RCP_STOP_LIMIT		EQU 	250	; Stop motor if this many timer2H overflows (~32ms) are below stop limit
                      2155     
  0032                2156     PWM_SETTLE		EQU 	50 	; PWM used when in start settling phase (also max power during direct start)
  0078                2157     PWM_STEPPER		EQU 	120 	; PWM used when in start stepper phase
                      2158     
  000A                2159     COMM_TIME_RED		EQU 	10	; Fixed reduction (in us) for commutation wait (to account for fixed delays)
  0001                2160     COMM_TIME_MIN		EQU 	1	; Minimum time (in us) for commutation wait
                      2161     
  0008                2162     TEMP_CHECK_RATE	EQU 	8	; Number of adc conversions for each check of temperature (the other conversions are used for voltage)
                      2163     
                      2164     ENDIF
                      2165     
                      2166     ; Skypup 2015.05.25
  0002                2167     THR_DELTA			EQU	2	; 
  00A0                2168     THR_SWITCH		EQU	0A0H	; 
                      2169     
                      2170     ;**** **** **** **** ****
                      2171     ; Temporary register definitions
  REG                 2172     TEMP1		EQU	R0
  REG                 2173     TEMP2		EQU	R1
  REG                 2174     TEMP3		EQU	R2
  REG                 2175     TEMP4		EQU	R3
  REG                 2176     TEMP5		EQU	R4
  REG                 2177     TEMP6		EQU	R5
  REG                 2178     TEMP7		EQU	R6
  REG                 2179     TEMP8		EQU	R7
                      2180     
                      2181     ;**** **** **** **** ****
                      2182     ; Register definitions
------                2183     DSEG AT 20H					; Variables segment 
                      2184     
0020                  2185     BIT_ACCESS: 				DS	1		; Variable at bit accessible address (for non interrupt routines)
0021                  2186     BIT_ACCESS_INT: 			DS	1		; Variable at bit accessible address (for interrupts)
                      2187     
0022                  2188     REQUESTED_PWM: 				DS	1		; Requested pwm (from RC pulse value)
0023                  2189     GOVERNOR_REQ_PWM: 			DS	1		; Governor requested pwm (sets governor target)
0024                  2190     CURRENT_PWM: 				DS	1		; Current pwm
0025                  2191     CURRENT_PWM_LIMITED: 		DS	1		; Current pwm that is limited (applied to the motor output)
0026                  2192     RCP_PREV_EDGE_L: 			DS	1		; RC pulse previous edge timer3 timestamp (lo byte)
0027                  2193     RCP_PREV_EDGE_H: 			DS	1		; RC pulse previous edge timer3 timestamp (hi byte)
0028                  2194     RCP_TIMEOUT_CNT: 			DS	1		; RC pulse timeout counter (decrementing) 
0029                  2195     RCP_SKIP_CNT: 				DS	1		; RC pulse skip counter (decrementing) 
002A                  2196     RCP_EDGE_CNT: 				DS	1		; RC pulse edge counter 
                      2197     
002B                  2198     FLAGS0: 					DS	1    	; State flags. Reset upon init_start
  0000                2199     T3_PENDING				EQU 	0		; Timer3 pending flag
  0001                2200     RCP_MEAS_PWM_FREQ			EQU	1		; Measure RC pulse pwm frequency
  0002                2201     PWM_ON					EQU	2		; Set in on part of pwm cycle
  0003                2202     DEMAG_DETECTED				EQU 	3		; Set when excessive demag time is detected
  0004                2203     DEMAG_CUT_POWER			EQU 	4		; Set when demag compensation cuts power
                      2204     ;						EQU 	5
                      2205     ;						EQU 	6
                      2206     ;						EQU 	7
                      2207     
002C                  2208     FLAGS1: 					DS	1    	; State flags. Reset upon init_start 
  0000                2209     MOTOR_SPINNING				EQU	0		; Set when in motor is spinning
  0001                2210     SETTLE_PHASE				EQU 	1		; Set when in motor start settling phase
  0002                2211     STEPPER_PHASE				EQU	2		; Set when in motor start stepper motor phase
  0003                2212     DIRECT_STARTUP_PHASE		EQU 	3		; Set when in direct startup phase
  0004                2213     INITIAL_RUN_PHASE			EQU	4		; Set when in initial run phase, before synchronized run is achieved
  0005                2214     CURR_PWMOFF_DAMPED			EQU	5		; Currently running pwm off cycle is damped
  0006                2215     CURR_PWMOFF_COMP_ABLE		EQU	6		; Currently running pwm off cycle is usable for comparator
                      2216     ;						EQU 	7
                      2217     
002D                  2218     FLAGS2: 					DS	1		; State flags. NOT reset upon init_start
  0000                2219     RCP_UPDATED				EQU 	0		; New RC pulse length value available
  0001                2220     RCP_EDGE_NO				EQU 	1		; RC pulse edge no. 0=rising, 1=falling
  0002                2221     PGM_PWMOFF_DAMPED			EQU	2		; Programmed pwm off damped mode. Set when fully damped or damped light mode is selected
  0003                2222     PGM_PWMOFF_DAMPED_FULL		EQU	3		; Programmed pwm off fully damped mode. Set when all pfets shall be on in pwm_off period
  0004                2223     PGM_PWMOFF_DAMPED_LIGHT		EQU	4		; Programmed pwm off damped light mode. Set when only 2 pfets shall be on in pwm_off period
  0005                2224     PGM_PWM_HIGH_FREQ			EQU	5		; Progremmed pwm high frequency
                      2225     ;						EQU 	6	
                      2226     ;						EQU 	7	
                      2227     
002E                  2228     FLAGS3: 					DS	1		; State flags. NOT reset upon init_start
  0000                2229     RCP_PWM_FREQ_1KHZ			EQU 	0		; RC pulse pwm frequency is 1kHz
  0001                2230     RCP_PWM_FREQ_2KHZ			EQU 	1		; RC pulse pwm frequency is 2kHz
  0002                2231     RCP_PWM_FREQ_4KHZ			EQU 	2		; RC pulse pwm frequency is 4kHz
  0003                2232     RCP_PWM_FREQ_8KHZ			EQU 	3		; RC pulse pwm frequency is 8kHz
  0004                2233     RCP_PWM_FREQ_12KHZ			EQU 	4		; RC pulse pwm frequency is 12kHz
  0005                2234     PGM_DIR_REV				EQU 	5		; Programmed direction. 0=normal, 1=reversed
  0006                2235     PGM_RCP_PWM_POL			EQU	6		; Programmed RC pulse pwm polarity. 0=positive, 1=negative
  0007                2236     FULL_THROTTLE_RANGE			EQU 	7		; When set full throttle range is used (1000-2000us) and stored calibration values are ignored
                      2237     
                      2238     ;**** **** **** **** ****
                      2239     ; RAM definitions
------                2240     DSEG AT 30H						; Ram data segment, direct addressing
                      2241     
0030                  2242     INITIAL_ARM: 				DS	1		; Variable that is set during the first arm sequence after power on
                      2243     
0031                  2244     POWER_ON_WAIT_CNT_L:  		DS	1		; Power on wait counter (lo byte)
0032                  2245     POWER_ON_WAIT_CNT_H:  		DS	1		; Power on wait counter (hi byte)
                      2246     
0033                  2247     STEPPER_STEP_BEG_L: 			DS	1		; Stepper phase step time at the beginning (lo byte)
0034                  2248     STEPPER_STEP_BEG_H: 			DS	1		; Stepper phase step time at the beginning (hi byte)
0035                  2249     STEPPER_STEP_END_L: 			DS	1		; Stepper phase step time at the end (lo byte)
0036                  2250     STEPPER_STEP_END_H: 			DS	1		; Stepper phase step time at the end (hi byte)
0037                  2251     STARTUP_ROT_CNT: 			DS	1		; Startup phase rotations counter
0038                  2252     DIRECT_STARTUP_OK_CNT: 		DS	1		; Direct startup phase ok comparator waits counter (incrementing)
0039                  2253     DEMAG_CONSECUTIVE_CNT: 		DS	1		; Counter used to count consecutive demag events
                      2254     
003A                  2255     PREV_COMM_L: 				DS	1		; Previous commutation timer3 timestamp (lo byte)
003B                  2256     PREV_COMM_H: 				DS	1		; Previous commutation timer3 timestamp (hi byte)
003C                  2257     COMM_PERIOD4X_L: 			DS	1		; Timer3 counts between the last 4 commutations (lo byte)
003D                  2258     COMM_PERIOD4X_H: 			DS	1		; Timer3 counts between the last 4 commutations (hi byte)
003E                  2259     COMM_PHASE: 				DS	1		; Current commutation phase
003F                  2260     COMP_WAIT_READS:  			DS	1		; Comparator wait comparator reads
                      2261     
0040                  2262     GOV_TARGET_L: 				DS	1		; Governor target (lo byte)
0041                  2263     GOV_TARGET_H: 				DS	1		; Governor target (hi byte)
0042                  2264     GOV_INTEGRAL_L: 			DS	1		; Governor integral error (lo byte)
0043                  2265     GOV_INTEGRAL_H: 			DS	1		; Governor integral error (hi byte)
0044                  2266     GOV_INTEGRAL_X: 			DS	1		; Governor integral error (ex byte)
0045                  2267     GOV_PROPORTIONAL_L: 			DS	1		; Governor proportional error (lo byte)
0046                  2268     GOV_PROPORTIONAL_H: 			DS	1		; Governor proportional error (hi byte)
0047                  2269     GOV_PROP_PWM: 				DS	1		; Governor calculated new pwm based upon proportional error
0048                  2270     GOV_ARM_TARGET: 			DS	1		; Governor arm target value
0049                  2271     GOV_ACTIVE: 				DS	1		; Governor active (enabled when speed is above minimum)
                      2272     
004A                  2273     WT_ADVANCE_L: 				DS	1		; Timer3 counts for commutation advance timing (lo byte)
004B                  2274     WT_ADVANCE_H: 				DS	1		; Timer3 counts for commutation advance timing (hi byte)
004C                  2275     WT_ZC_SCAN_L: 				DS	1		; Timer3 counts from commutation to zero cross scan (lo byte)
004D                  2276     WT_ZC_SCAN_H: 				DS	1		; Timer3 counts from commutation to zero cross scan (hi byte)
004E                  2277     WT_COMM_L: 				DS	1		; Timer3 counts from zero cross to commutation (lo byte)
004F                  2278     WT_COMM_H: 				DS	1		; Timer3 counts from zero cross to commutation (hi byte)
0050                  2279     WT_STEPPER_STEP_L: 			DS	1		; Timer3 counts for stepper step (lo byte)
0051                  2280     WT_STEPPER_STEP_H: 			DS	1		; Timer3 counts for stepper step (hi byte)
                      2281     
0052                  2282     RCP_PREPREV_EDGE_L: 			DS	1		; RC pulse pre previous edge pca timestamp (lo byte)
0053                  2283     RCP_PREPREV_EDGE_H: 			DS	1		; RC pulse pre previous edge pca timestamp (hi byte)
0054                  2284     RCP_EDGE_L: 				DS	1		; RC pulse edge pca timestamp (lo byte)
0055                  2285     RCP_EDGE_H: 				DS	1		; RC pulse edge pca timestamp (hi byte)
0056                  2286     RCP_PREV_PERIOD_L: 			DS	1		; RC pulse previous period (lo byte)
0057                  2287     RCP_PREV_PERIOD_H: 			DS	1		; RC pulse previous period (hi byte)
0058                  2288     RCP_PERIOD_DIFF_ACCEPTED: 	DS	1		; RC pulse period difference acceptable
0059                  2289     NEW_RCP: 					DS	1		; New RC pulse value in pca counts
005A                  2290     PREV_RCP_PWM_FREQ: 			DS	1		; Previous RC pulse pwm frequency (used during pwm frequency measurement)
005B                  2291     CURR_RCP_PWM_FREQ: 			DS	1		; Current RC pulse pwm frequency (used during pwm frequency measurement)
005C                  2292     RCP_STOP_CNT: 				DS	1		; Counter for RC pulses below stop value
005D                  2293     AUTO_BAILOUT_ARMED: 			DS	1		; Set when auto rotation bailout is armed 
                      2294     
005E                  2295     PWM_LIMIT: 				DS	1		; Maximum allowed pwm 
005F                  2296     PWM_LIMIT_SPOOLUP: 			DS	1		; Maximum allowed pwm during spoolup of main
0060                  2297     PWM_SPOOLUP_BEG: 			DS	1		; Pwm to begin main spoolup with
0061                  2298     PWM_MOTOR_IDLE: 			DS	1		; Motor idle speed pwm
0062                  2299     PWM_ON_CNT: 				DS	1		; Pwm on event counter (used to increase pwm off time for low pwm)
0063                  2300     PWM_OFF_CNT: 				DS	1		; Pwm off event counter (used to run some pwm cycles without damping)
                      2301     
0064                  2302     SPOOLUP_LIMIT_CNT: 			DS	1		; Interrupt count for spoolup limit
0065                  2303     SPOOLUP_LIMIT_SKIP: 			DS	1		; Interrupt skips for spoolup limit increment (1=no skips, 2=skip one etc)
                      2304     
0066                  2305     DAMPING_PERIOD: 			DS	1		; Damping on/off period
0067                  2306     DAMPING_ON: 				DS	1		; Damping on part of damping period
                      2307     
0068                  2308     LIPO_ADC_REFERENCE_L: 		DS	1		; Voltage reference adc value (lo byte)
0069                  2309     LIPO_ADC_REFERENCE_H: 		DS	1		; Voltage reference adc value (hi byte)
006A                  2310     LIPO_ADC_LIMIT_L: 			DS	1		; Low voltage limit adc value (lo byte)
006B                  2311     LIPO_ADC_LIMIT_H: 			DS	1		; Low voltage limit adc value (hi byte)
006C                  2312     ADC_CONVERSION_CNT: 			DS	1		; Adc conversion counter
                      2313     
006D                  2314     CURRENT_AVERAGE_TEMP: 		DS	1		; Current average temperature (lo byte ADC reading, assuming hi byte is 1)
                      2315     
006E                  2316     PPM_THROTTLE_GAIN: 			DS	1		; Gain to be applied to RCP value for PPM input
006F                  2317     BEEP_STRENGTH: 				DS	1		; Strength of beeps
                      2318     
0070                  2319     TX_PGM_FUNC_NO: 			DS	1		; Function number when doing programming by tx
0071                  2320     TX_PGM_PARAVAL_NO: 			DS	1		; Parameter value number when doing programming by tx
0072                  2321     TX_PGM_BEEP_NO: 			DS	1		; Beep number when doing programming by tx
                      2322     
                      2323     ; Skypup 2015.05.25
0073                  2324     PREV_RCP: 					DS	1		;  New_Rcp 
0074                  2325     RUN_COUNT_L: 				DS	1		; 
0075                  2326     RUN_COUNT_H: 				DS	1		; 
0076                  2327     TEMP_SKYPUP: 				DS	1		; 
                      2328     
                      2329     ; Indirect addressing data segment. The variables below must be in this sequence
------                2330     ISEG AT 080H					
0080                  2331     PGM_GOV_P_GAIN: 			DS	1		; Programmed governor P gain
0081                  2332     PGM_GOV_I_GAIN: 			DS	1		; Programmed governor I gain
0082                  2333     PGM_GOV_MODE: 				DS	1		; Programmed governor mode
0083                  2334     PGM_LOW_VOLTAGE_LIM: 		DS	1		; Programmed low voltage limit
0084                  2335     PGM_MOTOR_GAIN: 			DS	1		; Programmed motor gain
0085                  2336     PGM_MOTOR_IDLE: 			DS	1		; Programmed motor idle speed
0086                  2337     PGM_STARTUP_PWR: 			DS	1		; Programmed startup power
0087                  2338     PGM_PWM_FREQ: 				DS	1		; Programmed pwm frequency
0088                  2339     PGM_DIRECTION: 				DS	1		; Programmed rotation direction
0089                  2340     PGM_INPUT_POL: 				DS	1		; Programmed input pwm polarity
008A                  2341     INITIALIZED_L_DUMMY: 		DS	1		; Place holder
008B                  2342     INITIALIZED_H_DUMMY: 		DS	1		; Place holder
008C                  2343     PGM_ENABLE_TX_PROGRAM: 		DS 	1		; Programmed enable/disable value for TX programming
008D                  2344     PGM_MAIN_REARM_START: 		DS 	1		; Programmed enable/disable re-arming main every start 
008E                  2345     PGM_GOV_SETUP_TARGET: 		DS 	1		; Programmed main governor setup target
008F                  2346     PGM_STARTUP_RPM: 			DS	1		; Programmed startup rpm
0090                  2347     PGM_STARTUP_ACCEL: 			DS	1		; Programmed startup acceleration
0091                  2348     PGM_VOLT_COMP_DUMMY: 		DS	1		; Place holder
0092                  2349     PGM_COMM_TIMING: 			DS	1		; Programmed commutation timing
0093                  2350     PGM_DAMPING_FORCE: 			DS	1		; Programmed damping force
0094                  2351     PGM_GOV_RANGE: 				DS	1		; Programmed governor range
0095                  2352     PGM_STARTUP_METHOD: 			DS	1		; Programmed startup method
0096                  2353     PGM_PPM_MIN_THROTTLE: 		DS	1		; Programmed throttle minimum
0097                  2354     PGM_PPM_MAX_THROTTLE: 		DS	1		; Programmed throttle maximum
0098                  2355     PGM_BEEP_STRENGTH: 			DS	1		; Programmed beep strength
0099                  2356     PGM_BEACON_STRENGTH: 		DS	1		; Programmed beacon strength
009A                  2357     PGM_BEACON_DELAY: 			DS	1		; Programmed beacon delay
009B                  2358     PGM_THROTTLE_RATE: 			DS	1		; Programmed throttle rate
009C                  2359     PGM_DEMAG_COMP: 			DS	1		; Programmed demag compensation
009D                  2360     PGM_BEC_VOLTAGE_HIGH: 		DS	1		; Programmed BEC voltage
009E                  2361     PGM_PPM_CENTER_THROTTLE: 		DS	1		; Programmed throttle center (in bidirectional mode)
                      2362     
                      2363     ; The sequence of the variables below is no longer of importance
009F                  2364     PGM_GOV_P_GAIN_DECODED: 		DS	1		; Programmed governor decoded P gain
00A0                  2365     PGM_GOV_I_GAIN_DECODED: 		DS	1		; Programmed governor decoded I gain
00A1                  2366     PGM_THROTTLE_RATE_DECODED: 	DS	1		; Programmed throttle rate decoded
00A2                  2367     PGM_STARTUP_PWR_DECODED: 		DS	1		; Programmed startup power decoded
00A3                  2368     PGM_DEMAG_COMP_POWER_DECODED: 	DS	1		; Programmed demag compensation power cut decoded
                      2369     
                      2370     
                      2371     ; Indirect addressing data segment
------                2372     ISEG AT 0D0H					
00D0                  2373     TAG_TEMPORARY_STORAGE: 		DS	48		; Temporary storage for tags when updating "Eeprom"
                      2374     
                      2375     
                      2376     ;**** **** **** **** ****
------                2377     CSEG AT 1A00H            ; "Eeprom" segment
  000B                2378     EEPROM_FW_MAIN_REVISION		EQU	11		; Main revision of the firmware
  0002                2379     EEPROM_FW_SUB_REVISION		EQU	2		; Sub revision of the firmware
  0011                2380     EEPROM_LAYOUT_REVISION		EQU	17		; Revision of the EEPROM layout
                      2381     
1A00    0B            2382     EEP_FW_MAIN_REVISION:  DB 11 
1A01    02            2383     EEP_FW_SUB_REVISION:  DB 2 
1A02    11            2384     EEP_LAYOUT_REVISION:  DB 17 
                      2385     
                      2386     IF MODE == 0
                               EEP_PGM_GOV_P_GAIN:			DB	DEFAULT_PGM_MAIN_P_GAIN			; EEPROM copy of programmed governor P gain
                               EEP_PGM_GOV_I_GAIN:			DB	DEFAULT_PGM_MAIN_I_GAIN			; EEPROM copy of programmed governor I gain
                               EEP_PGM_GOV_MODE:			DB	DEFAULT_PGM_MAIN_GOVERNOR_MODE	; EEPROM copy of programmed governor mode
                               EEP_PGM_LOW_VOLTAGE_LIM:		DB	DEFAULT_PGM_MAIN_LOW_VOLTAGE_LIM	; EEPROM copy of programmed low voltage limit
                               _EEP_PGM_MOTOR_GAIN:		DB	0FFH							
                               _EEP_PGM_MOTOR_IDLE:		DB	0FFH							
                               EEP_PGM_STARTUP_PWR:		DB	DEFAULT_PGM_MAIN_STARTUP_PWR		; EEPROM copy of programmed startup power
                               EEP_PGM_PWM_FREQ:			DB	DEFAULT_PGM_MAIN_PWM_FREQ		; EEPROM copy of programmed pwm frequency
                               EEP_PGM_DIRECTION:			DB	DEFAULT_PGM_MAIN_DIRECTION		; EEPROM copy of programmed rotation direction
                               EEP_PGM_INPUT_POL:			DB	DEFAULT_PGM_MAIN_RCP_PWM_POL		; EEPROM copy of programmed input polarity
                               EEP_INITIALIZED_L:			DB	0A5H							; EEPROM initialized signature low byte
                               EEP_INITIALIZED_H:			DB	05AH							; EEPROM initialized signature high byte
                               EEP_ENABLE_TX_PROGRAM:		DB	DEFAULT_PGM_ENABLE_TX_PROGRAM		; EEPROM TX programming enable
                               EEP_MAIN_REARM_START:		DB	DEFAULT_PGM_MAIN_REARM_START		; EEPROM re-arming main enable
                               EEP_PGM_GOV_SETUP_TARGET:	DB	DEFAULT_PGM_MAIN_GOV_SETUP_TARGET	; EEPROM main governor setup target
                               EEP_PGM_STARTUP_RPM:		DB	DEFAULT_PGM_MAIN_STARTUP_RPM		; EEPROM copy of programmed startup rpm
                               EEP_PGM_STARTUP_ACCEL:		DB	DEFAULT_PGM_MAIN_STARTUP_ACCEL	; EEPROM copy of programmed startup acceleration
                               _EEP_PGM_VOLT_COMP:			DB	0FFH	
                               EEP_PGM_COMM_TIMING:		DB	DEFAULT_PGM_MAIN_COMM_TIMING		; EEPROM copy of programmed commutation timing
                               EEP_PGM_DAMPING_FORCE:		DB	DEFAULT_PGM_MAIN_DAMPING_FORCE	; EEPROM copy of programmed damping force
                               EEP_PGM_GOV_RANGE:			DB	DEFAULT_PGM_MAIN_GOVERNOR_RANGE	; EEPROM copy of programmed governor range
                               EEP_PGM_STARTUP_METHOD:		DB	DEFAULT_PGM_MAIN_STARTUP_METHOD	; EEPROM copy of programmed startup method
                               EEP_PGM_PPM_MIN_THROTTLE:	DB	DEFAULT_PGM_PPM_MIN_THROTTLE		; EEPROM copy of programmed minimum throttle (final value is 4x+1000=1148)
                               EEP_PGM_PPM_MAX_THROTTLE:	DB	DEFAULT_PGM_PPM_MAX_THROTTLE		; EEPROM copy of programmed minimum throttle (final value is 4x+1000=1832)
                               EEP_PGM_BEEP_STRENGTH:		DB	DEFAULT_PGM_MAIN_BEEP_STRENGTH	; EEPROM copy of programmed beep strength
                               EEP_PGM_BEACON_STRENGTH:		DB	DEFAULT_PGM_MAIN_BEACON_STRENGTH	; EEPROM copy of programmed beacon strength
                               EEP_PGM_BEACON_DELAY:		DB	DEFAULT_PGM_MAIN_BEACON_DELAY		; EEPROM copy of programmed beacon delay
                               EEP_PGM_THROTTLE_RATE:		DB	DEFAULT_PGM_MAIN_THROTTLE_RATE	; EEPROM copy of programmed throttle rate
                               EEP_PGM_DEMAG_COMP:			DB	DEFAULT_PGM_MAIN_DEMAG_COMP		; EEPROM copy of programmed demag compensation
                               EEP_PGM_BEC_VOLTAGE_HIGH:	DB	DEFAULT_PGM_BEC_VOLTAGE_HIGH		; EEPROM copy of programmed BEC voltage
                               _EEP_PGM_PPM_CENTER_THROTTLE:	DB	0FFH							; EEPROM copy of programmed center throttle (final value is 4x+1000=1488)
                               ENDIF
                      2419     
                      2420     IF MODE == 1
                               _EEP_PGM_GOV_P_GAIN:		DB	0FFH							
                               _EEP_PGM_GOV_I_GAIN:		DB	0FFH							
                               _EEP_PGM_GOV_MODE:			DB 	0FFH							
                               _EEP_PGM_LOW_VOLTAGE_LIM:	DB	0FFH							
                               EEP_PGM_MOTOR_GAIN:			DB	DEFAULT_PGM_TAIL_GAIN			; EEPROM copy of programmed tail gain
                               EEP_PGM_MOTOR_IDLE:			DB	DEFAULT_PGM_TAIL_IDLE_SPEED		; EEPROM copy of programmed tail idle speed
                               EEP_PGM_STARTUP_PWR:		DB	DEFAULT_PGM_TAIL_STARTUP_PWR		; EEPROM copy of programmed startup power
                               EEP_PGM_PWM_FREQ:			DB	DEFAULT_PGM_TAIL_PWM_FREQ		; EEPROM copy of programmed pwm frequency
                               EEP_PGM_DIRECTION:			DB	DEFAULT_PGM_TAIL_DIRECTION		; EEPROM copy of programmed rotation direction
                               EEP_PGM_INPUT_POL:			DB	DEFAULT_PGM_TAIL_RCP_PWM_POL		; EEPROM copy of programmed input polarity
                               EEP_INITIALIZED_L:			DB	05AH							; EEPROM initialized signature low byte
                               EEP_INITIALIZED_H:			DB	0A5H							; EEPROM initialized signature high byte
                               EEP_ENABLE_TX_PROGRAM:		DB	DEFAULT_PGM_ENABLE_TX_PROGRAM		; EEPROM TX programming enable
                               _EEP_MAIN_REARM_START:		DB	0FFH							
                               _EEP_PGM_GOV_SETUP_TARGET:	DB	0FFH							
                               EEP_PGM_STARTUP_RPM:		DB	DEFAULT_PGM_TAIL_STARTUP_RPM		; EEPROM copy of programmed startup rpm
                               EEP_PGM_STARTUP_ACCEL:		DB	DEFAULT_PGM_TAIL_STARTUP_ACCEL	; EEPROM copy of programmed startup acceleration
                               _EEP_PGM_VOLT_COMP:			DB	0FFH	
                               EEP_PGM_COMM_TIMING:		DB	DEFAULT_PGM_TAIL_COMM_TIMING		; EEPROM copy of programmed commutation timing
                               EEP_PGM_DAMPING_FORCE:		DB	DEFAULT_PGM_TAIL_DAMPING_FORCE	; EEPROM copy of programmed damping force
                               _EEP_PGM_GOV_RANGE:			DB	0FFH	
                               EEP_PGM_STARTUP_METHOD:		DB	DEFAULT_PGM_TAIL_STARTUP_METHOD	; EEPROM copy of programmed startup method
                               EEP_PGM_PPM_MIN_THROTTLE:	DB	DEFAULT_PGM_PPM_MIN_THROTTLE		; EEPROM copy of programmed minimum throttle (final value is 4x+1000=1148)
                               EEP_PGM_PPM_MAX_THROTTLE:	DB	DEFAULT_PGM_PPM_MAX_THROTTLE		; EEPROM copy of programmed minimum throttle (final value is 4x+1000=1832)
                               EEP_PGM_BEEP_STRENGTH:		DB	DEFAULT_PGM_TAIL_BEEP_STRENGTH	; EEPROM copy of programmed beep strength
                               EEP_PGM_BEACON_STRENGTH:		DB	DEFAULT_PGM_TAIL_BEACON_STRENGTH	; EEPROM copy of programmed beacon strength
                               EEP_PGM_BEACON_DELAY:		DB	DEFAULT_PGM_TAIL_BEACON_DELAY		; EEPROM copy of programmed beacon delay
                               EEP_PGM_THROTTLE_RATE:		DB	DEFAULT_PGM_TAIL_THROTTLE_RATE	; EEPROM copy of programmed throttle rate
                               EEP_PGM_DEMAG_COMP:			DB	DEFAULT_PGM_TAIL_DEMAG_COMP		; EEPROM copy of programmed demag compensation
                               EEP_PGM_BEC_VOLTAGE_HIGH:	DB	DEFAULT_PGM_BEC_VOLTAGE_HIGH		; EEPROM copy of programmed BEC voltage
                               EEP_PGM_PPM_CENTER_THROTTLE:	DB	DEFAULT_PGM_PPM_CENTER_THROTTLE	; EEPROM copy of programmed center throttle (final value is 4x+1000=1488)
                               ENDIF
                      2453     
                      2454     IF MODE == 2
1A03    09            2455     EEP_PGM_GOV_P_GAIN:  DB 9 
1A04    09            2456     EEP_PGM_GOV_I_GAIN:  DB 9 
1A05    04            2457     EEP_PGM_GOV_MODE:  DB 4 
1A06    01            2458     EEP_PGM_LOW_VOLTAGE_LIM:  DB 1 
1A07    03            2459     EEP_PGM_MOTOR_GAIN:  DB 3 
1A08    FF            2460     _EEP_PGM_MOTOR_IDLE: 		DB	0FFH							; EEPROM copy of programmed tail idle speed
1A09    09            2461     EEP_PGM_STARTUP_PWR:  DB 9 
1A0A    01            2462     EEP_PGM_PWM_FREQ:  DB 1 
1A0B    01            2463     EEP_PGM_DIRECTION:  DB 1 
1A0C    01            2464     EEP_PGM_INPUT_POL:  DB 1 
1A0D    55            2465     EEP_INITIALIZED_L: 			DB	055H							; EEPROM initialized signature low byte
1A0E    AA            2466     EEP_INITIALIZED_H: 			DB	0AAH							; EEPROM initialized signature high byte
1A0F    01            2467     EEP_ENABLE_TX_PROGRAM:  DB 1 
1A10    FF            2468     _EEP_MAIN_REARM_START: 		DB	0FFH							
1A11    FF            2469     _EEP_PGM_GOV_SETUP_TARGET: 	DB	0FFH							
1A12    01            2470     EEP_PGM_STARTUP_RPM:  DB 1 
1A13    05            2471     EEP_PGM_STARTUP_ACCEL:  DB 5 
1A14    FF            2472     _EEP_PGM_VOLT_COMP: 			DB	0FFH	
1A15    03            2473     EEP_PGM_COMM_TIMING:  DB 3 
1A16    06            2474     EEP_PGM_DAMPING_FORCE:  DB 6 
1A17    FF            2475     _EEP_PGM_GOV_RANGE: 			DB	0FFH	
1A18    02            2476     EEP_PGM_STARTUP_METHOD:  DB 2 
1A19    25            2477     EEP_PGM_PPM_MIN_THROTTLE:  DB 37 
1A1A    D0            2478     EEP_PGM_PPM_MAX_THROTTLE:  DB 208 
1A1B    28            2479     EEP_PGM_BEEP_STRENGTH:  DB 40 
1A1C    50            2480     EEP_PGM_BEACON_STRENGTH:  DB 80 
1A1D    04            2481     EEP_PGM_BEACON_DELAY:  DB 4 
1A1E    0D            2482     EEP_PGM_THROTTLE_RATE:  DB 13 
1A1F    02            2483     EEP_PGM_DEMAG_COMP:  DB 2 
1A20    00            2484     EEP_PGM_BEC_VOLTAGE_HIGH:  DB 0 
1A21    7A            2485     EEP_PGM_PPM_CENTER_THROTTLE:  DB 122 
                      2486     ENDIF
                      2487     
                      2488     
1A22    FF            2489     EEP_DUMMY: 				DB	0FFH							; EEPROM address for safety reason
                      2490     
------                2491     CSEG AT 1A60H
1A60    6F72672E      2492     EEP_NAME: 					DB	"org.skypup.esc.b"				; Name tag (16 Bytes)
1A64    736B7970
1A68    75702E65
1A6C    73632E62
                      2493     
                      2494     ;**** **** **** **** ****
                      2495             		INTERRUPT_TABLE_DEFINITION		; SiLabs interrupts
------                2495+1   CSEG AT 0  ; CODE SEGMENT START
0000    02126B        2495+1   JMP RESET 
------                2495+1   CSEG AT 0BH  ; TIMER0 INTERRUPT	
000B    0200BA        2495+1   JMP T0_INT 
------                2495+1   CSEG AT 2BH  ; TIMER2 INTERRUPT	
002B    0203E7        2495+1   JMP T2_INT 
------                2495+1   CSEG AT 5BH  ; PCA INTERRUPT	
005B    020546        2495+1   JMP PCA_INT 
------                2495+1   CSEG AT 73H  ; TIMER3 INTERRUPT	
0073    02053C        2495+1   JMP T3_INT 
------                2496     CSEG AT 80H			; Code segment after interrupt vectors 
                      2497     
                      2498     ;**** **** **** **** ****
                      2499     
                      2500     ; Table definitions
0080    02030406      2501     GOV_GAIN_TABLE:    		DB 	02H, 03H, 04H, 06H, 08H, 0CH, 10H, 18H, 20H, 30H, 40H, 60H, 80H
0084    080C1018
0088    20304060
008C    80
008D    02030406      2502     THROTTLE_RATE_TABLE:   	DB 	02H, 03H, 04H, 06H, 08H, 0CH, 10H, 18H, 20H, 30H, 40H, 80H, 0FFH
0091    080C1018
0095    20304080
0099    FF
009A    0406080C      2503     STARTUP_POWER_TABLE:   	DB 	04H, 06H, 08H, 0CH, 10H, 18H, 20H, 30H, 40H, 60H, 80H, 0A0H, 0C0H
009E    10182030
00A2    406080A0
00A6    C0
00A7    000201        2504     DEMAG_POWER_TABLE:   	DB 	0, 2, 1
                      2505     IF MODE == 0
                               TX_PGM_PARAMS_MAIN:  	DB 	13, 13, 4, 3, 6, 2, 13, 5, 5, 5, 13, 6, 3, 5, 2, 2
                               ENDIF
                      2508     IF MODE == 1
                                 IF DAMPED_MODE_ENABLE == 1
                               TX_PGM_PARAMS_TAIL:  	DB 	5, 5, 2, 13, 5, 5, 5, 13, 6, 4, 5, 3, 2
                                 ENDIF
                                 IF DAMPED_MODE_ENABLE == 0
                               TX_PGM_PARAMS_TAIL:  	DB 	5, 5, 2, 13, 5, 5, 5, 13, 6, 3, 5, 3, 2
                                 ENDIF
                               ENDIF
                      2516     IF MODE == 2
                      2517       IF DAMPED_MODE_ENABLE == 1
00AA    0D0D0405      2518     TX_PGM_PARAMS_MULTI:   	DB 	13, 13, 4, 5, 6, 2, 13, 5, 5, 5, 13, 6, 4, 5, 3, 2
00AE    06020D05
00B2    05050D06
00B6    04050302
                      2519       ENDIF
                      2520       IF DAMPED_MODE_ENABLE == 0
                               TX_PGM_PARAMS_MULTI:  	DB 	13, 13, 4, 5, 6, 2, 13, 5, 5, 5, 13, 6, 3, 5, 3, 2
                                 ENDIF
                      2523     ENDIF
                      2524     
                      2525     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      2526     ;
                      2527     ; Timer0 interrupt routine
                      2528     ;
                      2529     ; Assumptions: DPTR register must be set to desired pwm_nfet_on label
                      2530     ; Requirements: Temp variables can NOT be used since PSW.3 is not set
                      2531     ;
                      2532     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      2533     T0_INT: 	; Used for pwm control
00BA    C2AF          2534     	CLR 	EA			; Disable all interrupts
00BC    C0D0          2535     	PUSH	PSW			; Preserve registers through interrupt
00BE    C0E0          2536     	PUSH	ACC		
                      2537     	; Check if pwm is on
00C0    205A10        2538     JB FLAGS0 . 2 , T0_INT_PWM_OFF 
                      2539     
                      2540     	; Do not execute pwm when stopped
00C3    30600A        2541     JNB FLAGS1 . 0 , T0_INT_PWM_ON_STOPPED 
                      2542     	; Do not execute pwm on during demag recovery
00C6    205C07        2543     JB FLAGS0 . 4 , T0_INT_PWM_ON_STOPPED 
                      2544     	; Pwm on cycle. 
00C9    302F02        2545     	JNB	CURRENT_PWM_LIMITED.7, T0_INT_PWM_ON_LOW_PWM	; Jump for low pwm (<50%)
                      2546     
                      2547     T0_INT_PWM_ON_EXECUTE: 
00CC    E4            2548     	CLR	A					
00CD    73            2549     	JMP	@A+DPTR					; Jump to pwm on routines. DPTR should be set to one of the pwm_nfet_on labels
                      2550     
                      2551     T0_INT_PWM_ON_LOW_PWM: 
                      2552     
                      2553     IF MODE == 0 OR MODE == 2	; Main or multi
00CE    80FC          2554     	JMP	T0_INT_PWM_ON_EXECUTE
                      2555     ENDIF
                      2556     IF MODE == 1				; Tail
                               	; Skip pwm on cycles for very low pwm
                               	INC	PWM_ON_CNT				; Increment event counter
                               	CLR	C
                               	MOV	A, #5					; Only skip for very low pwm
                               	SUBB	A, CURRENT_PWM_LIMITED		; Check skipping shall be done (for low pwm only)
                               	JC	T0_INT_PWM_ON_EXECUTE
                               
                               	SUBB	A, PWM_ON_CNT				; Check if on cycle is to be skipped
                               	JC	T0_INT_PWM_ON_EXECUTE
                               
                               	MOV	TL0, #120					; Write start point for timer
                               	MOV	A, CURRENT_PWM_LIMITED
                               	JNZ	($+5)
                               	MOV	TL0, #0					; Write start point for timer (long time for zero pwm)
                               	JMP	T0_INT_PWM_ON_EXIT_NO_TIMER_UPDATE
                               ENDIF
                      2573     
                      2574     T0_INT_PWM_ON_STOPPED: 
00D0    0203D3        2575     	JMP	T0_INT_PWM_ON_EXIT
                      2576     
                      2577     
                      2578     T0_INT_PWM_OFF: 
00D3    306306        2579     JNB FLAGS1 . 3 , T0_INT_PWM_OFF_START_CHECKED 
                      2580     	ALL_NFETS_OFF 					; Switch off all nfets early during direct start, for a smooth start
00D6    C292          2580+1   CLR P1 . 2 
00D8    C296          2580+1   CLR P1 . 6 
00DA    C295          2580+1   CLR P1 . 5 
                      2581     T0_INT_PWM_OFF_START_CHECKED: 
                      2582     	; Pwm off cycle
00DC    85258A        2583     	MOV	TL0, CURRENT_PWM_LIMITED		; Load new timer setting
                      2584     	; Clear pwm on flag
00DF    C25A          2585     CLR FLAGS0 . 2 
                      2586     	; Set full PWM (on all the time) if current PWM near max. This will give full power, but at the cost of a small "jump" in power
00E1    E525          2587     	MOV	A, CURRENT_PWM_LIMITED		; Load current pwm
00E3    F4            2588     	CPL	A						; Full pwm?
00E4    7002          2589     	JNZ	($+4)					; No - branch
00E6    21C6          2590     	AJMP	T0_INT_PWM_OFF_FULLPOWER_EXIT	; Yes - exit
                      2591     
00E8    0563          2592     	INC	PWM_OFF_CNT				; Increment event counter
                      2593     	; Do not execute pwm when stopped
00EA    306013        2594     JNB FLAGS1 . 0 , T0_INT_PWM_OFF_STOPPED 
                      2595     
                      2596     	; If damped operation, set pFETs on in pwm_off
00ED    206A19        2597     JB FLAGS2 . 2 , T0_INT_PWM_OFF_DAMPED 
                      2598     
                      2599     	; Separate exit commands here for minimum delay
00F0    758B00        2600     	MOV	TL1, #0		; Reset timer1	
00F3    D0E0          2601     	POP	ACC			; Restore preserved registers
00F5    D0D0          2602     	POP	PSW
                      2603     	ALL_NFETS_OFF 		; Switch off all nfets
00F7    C292          2603+1   CLR P1 . 2 
00F9    C296          2603+1   CLR P1 . 6 
00FB    C295          2603+1   CLR P1 . 5 
00FD    D2AF          2604     	SETB	EA			; Enable all interrupts
00FF    32            2605     	RETI
                      2606     
                      2607     T0_INT_PWM_OFF_STOPPED: 
                      2608     	ALL_NFETS_OFF 					; Switch off all nfets
0100    C292          2608+1   CLR P1 . 2 
0102    C296          2608+1   CLR P1 . 6 
0104    C295          2608+1   CLR P1 . 5 
0106    0201B6        2609     	JMP	T0_INT_PWM_OFF_EXIT
                      2610     
                      2611     T0_INT_PWM_OFF_DAMPED: 
0109    D265          2612     SETB FLAGS1 . 5 
010B    C266          2613     CLR FLAGS1 . 6 
010D    E567          2614     	MOV	A, DAMPING_ON
010F    601C          2615     	JZ	T0_INT_PWM_OFF_DO_DAMPED		; Highest damping - apply damping always
                      2616     
0111    C3            2617     	CLR	C
0112    E563          2618     	MOV	A, PWM_OFF_CNT				; Is damped on number reached?
0114    14            2619     	DEC	A
0115    9567          2620     	SUBB	A, DAMPING_ON
0117    4014          2621     	JC	T0_INT_PWM_OFF_DO_DAMPED		; No - apply damping
                      2622     
0119    C265          2623     CLR FLAGS1 . 5 
011B    D266          2624     SETB FLAGS1 . 6 
011D    C3            2625     	CLR	C
011E    E563          2626     	MOV	A, PWM_OFF_CNT					
0120    9566          2627     	SUBB	A, DAMPING_PERIOD			; Is damped period number reached?
0122    5003          2628     	JNC	T0_INT_PWM_OFF_CLR_CNT		; Yes - Proceed
                      2629     
0124    0201B6        2630     	JMP	T0_INT_PWM_OFF_EXIT			; No - Branch
                      2631     
                      2632     T0_INT_PWM_OFF_CLR_CNT: 
0127    756300        2633     	MOV	PWM_OFF_CNT, #0			; Yes - clear counter
012A    0201B6        2634     	JMP	T0_INT_PWM_OFF_EXIT			; Not damped cycle - exit	
                      2635     
                      2636     T0_INT_PWM_OFF_DO_DAMPED: 
                      2637     	; Delay to allow nFETs to go off before pFETs are turned on (only in full damped mode)
012D    206C14        2638     JB FLAGS2 . 4 , T0_INT_PWM_OFF_DAMPED_LIGHT 
                      2639     
                      2640     	ALL_NFETS_OFF 					; Switch off all nfets
0130    C292          2640+1   CLR P1 . 2 
0132    C296          2640+1   CLR P1 . 6 
0134    C295          2640+1   CLR P1 . 5 
0136    7406          2641     MOV A , # 6 
0138    D5E0FD        2642     	DJNZ	ACC, $	
                      2643     	ALL_PFETS_ON 					; Switch on all pfets
013B    D293          2643+1   SETB P1 . 3 
013D    D297          2643+1   SETB P1 . 7 
013F    D294          2643+1   SETB P1 . 4 
0141    0201B6        2644     	JMP	T0_INT_PWM_OFF_EXIT
                      2645     
                      2646     T0_INT_PWM_OFF_DAMPED_LIGHT: 
                      2647     IF DAMPED_MODE_ENABLE == 1
0144    D266          2648     SETB FLAGS1 . 6 
                      2649     ENDIF
                      2650     	ALL_NFETS_OFF 					; Switch off all nfets
0146    C292          2650+1   CLR P1 . 2 
0148    C296          2650+1   CLR P1 . 6 
014A    C295          2650+1   CLR P1 . 5 
014C    E53E          2651     	MOV	A, COMM_PHASE				; Turn on pfets according to commutation phase
014E    20E234        2652     	JB	ACC.2, T0_INT_PWM_OFF_COMM_4_5_6
0151    20E112        2653     	JB	ACC.1, T0_INT_PWM_OFF_COMM_2_3
                      2654     
                      2655     IF DAMPED_MODE_ENABLE == 0
                               	APFET_ON			; Comm phase 1 - turn on A
                               ELSE
0154    7406          2658     MOV A , # 6 
0156    D5E0FD        2659     	DJNZ	ACC, $	
                      2660     	CPFET_ON			; Comm phase 1 - turn on C
0159    207502        2660+1   JB FLAGS3 . 5 , ( $+5 ) 
015C    D297          2660+1   SETB P1 . 7 
015E    307502        2660+1   JNB FLAGS3 . 5 , ( $+5 ) 
0161    D293          2660+1   SETB P1 . 3 
                      2661     ENDIF
0163    0201B6        2662     	JMP	T0_INT_PWM_OFF_EXIT
                      2663     
                      2664     T0_INT_PWM_OFF_COMM_2_3: 
0166    20E012        2665     	JB	ACC.0, T0_INT_PWM_OFF_COMM_3
                      2666     IF DAMPED_MODE_ENABLE == 0
                               	BPFET_ON			; Comm phase 2 - turn on B
                               ELSE
0169    7406          2669     MOV A , # 6 
016B    D5E0FD        2670     	DJNZ	ACC, $	
                      2671     	CPFET_ON			; Comm phase 2 - turn on C
016E    207502        2671+1   JB FLAGS3 . 5 , ( $+5 ) 
0171    D297          2671+1   SETB P1 . 7 
0173    307502        2671+1   JNB FLAGS3 . 5 , ( $+5 ) 
0176    D293          2671+1   SETB P1 . 3 
                      2672     ENDIF
0178    0201B6        2673     	JMP	T0_INT_PWM_OFF_EXIT
                      2674     
                      2675     T0_INT_PWM_OFF_COMM_3: 
                      2676     IF DAMPED_MODE_ENABLE == 0
                               	CPFET_ON			; Comm phase 3 - turn on C
                               ELSE
017B    7406          2679     MOV A , # 6 
017D    D5E0FD        2680     	DJNZ	ACC, $	
                      2681     	BPFET_ON			; Comm phase 3 - turn on B
0180    D294          2681+1   SETB P1 . 4 
                      2682     ENDIF
0182    0201B6        2683     	JMP	T0_INT_PWM_OFF_EXIT
                      2684     
                      2685     T0_INT_PWM_OFF_COMM_4_5_6: 
0185    20E11F        2686     	JB	ACC.1, T0_INT_PWM_OFF_COMM_6
0188    20E00A        2687     	JB	ACC.0, T0_INT_PWM_OFF_COMM_5
                      2688     
                      2689     IF DAMPED_MODE_ENABLE == 0
                               	APFET_ON			; Comm phase 4 - turn on A
                               ELSE
018B    7406          2692     MOV A , # 6 
018D    D5E0FD        2693     	DJNZ	ACC, $	
                      2694     	BPFET_ON			; Comm phase 4 - turn on B
0190    D294          2694+1   SETB P1 . 4 
                      2695     ENDIF
0192    0201B6        2696     	JMP	T0_INT_PWM_OFF_EXIT
                      2697     
                      2698     T0_INT_PWM_OFF_COMM_5: 
                      2699     IF DAMPED_MODE_ENABLE == 0
                               	BPFET_ON			; Comm phase 5 - turn on B
                               ELSE
0195    7406          2702     MOV A , # 6 
0197    D5E0FD        2703     	DJNZ	ACC, $	
                      2704     	APFET_ON			; Comm phase 5 - turn on A
019A    207502        2704+1   JB FLAGS3 . 5 , ( $+5 ) 
019D    D293          2704+1   SETB P1 . 3 
019F    307502        2704+1   JNB FLAGS3 . 5 , ( $+5 ) 
01A2    D297          2704+1   SETB P1 . 7 
                      2705     ENDIF
01A4    0201B6        2706     	JMP	T0_INT_PWM_OFF_EXIT
                      2707     
                      2708     T0_INT_PWM_OFF_COMM_6: 
                      2709     IF DAMPED_MODE_ENABLE == 0
                               	CPFET_ON			; Comm phase 6 - turn on C
                               ELSE
01A7    7406          2712     MOV A , # 6 
01A9    D5E0FD        2713     	DJNZ	ACC, $	
                      2714     	APFET_ON			; Comm phase 6 - turn on A
01AC    207502        2714+1   JB FLAGS3 . 5 , ( $+5 ) 
01AF    D293          2714+1   SETB P1 . 3 
01B1    307502        2714+1   JNB FLAGS3 . 5 , ( $+5 ) 
01B4    D297          2714+1   SETB P1 . 7 
                      2715     ENDIF
                      2716     
                      2717     T0_INT_PWM_OFF_EXIT: 	; Exit from pwm off cycle
01B6    758B00        2718     	MOV	TL1, #0		; Reset timer1	
01B9    D0E0          2719     	POP	ACC			; Restore preserved registers
01BB    D0D0          2720     	POP	PSW
                      2721     	ALL_NFETS_OFF 		; Switch off all nfets
01BD    C292          2721+1   CLR P1 . 2 
01BF    C296          2721+1   CLR P1 . 6 
01C1    C295          2721+1   CLR P1 . 5 
01C3    D2AF          2722     	SETB	EA			; Enable all interrupts
01C5    32            2723     	RETI
                      2724     
                      2725     T0_INT_PWM_OFF_FULLPOWER_EXIT: 	; Exit from pwm off cycle, leaving power on
01C6    D0E0          2726     	POP	ACC			; Restore preserved registers
01C8    D0D0          2727     	POP	PSW
01CA    D2AF          2728     	SETB	EA			; Enable all interrupts
01CC    32            2729     	RETI
                      2730     
                      2731     
                      2732     
                      2733     PWM_NOFET_ON: 	; Dummy pwm on cycle
01CD    61D3          2734     	AJMP	T0_INT_PWM_ON_EXIT
                      2735     
                      2736     PWM_AFET_ON: 	; Pwm on cycle afet on (bfet off)
                      2737     	ANFET_ON	
01CF    E525          2737+1   MOV A , CURRENT_PWM_LIMITED 
01D1    600A          2737+1   JZ ( $+12 ) 
01D3    207502        2737+1   JB FLAGS3 . 5 , ( $+5 ) 
01D6    D292          2737+1   SETB P1 . 2 
01D8    307502        2737+1   JNB FLAGS3 . 5 , ( $+5 ) 
01DB    D296          2737+1   SETB P1 . 6 
                      2738     	BNFET_OFF
01DD    C295          2738+1   CLR P1 . 5 
01DF    61D3          2739     	AJMP	T0_INT_PWM_ON_EXIT
                      2740     
                      2741     PWM_BFET_ON: 	; Pwm on cycle bfet on (cfet off)
                      2742     	BNFET_ON
01E1    E525          2742+1   MOV A , CURRENT_PWM_LIMITED 
01E3    6002          2742+1   JZ ( $+4 ) 
01E5    D295          2742+1   SETB P1 . 5 
                      2743     	CNFET_OFF
01E7    207502        2743+1   JB FLAGS3 . 5 , ( $+5 ) 
01EA    C296          2743+1   CLR P1 . 6 
01EC    307502        2743+1   JNB FLAGS3 . 5 , ( $+5 ) 
01EF    C292          2743+1   CLR P1 . 2 
01F1    61D3          2744     	AJMP	T0_INT_PWM_ON_EXIT
                      2745     
                      2746     PWM_CFET_ON: 	; Pwm on cycle cfet on (afet off)
                      2747     	CNFET_ON
01F3    E525          2747+1   MOV A , CURRENT_PWM_LIMITED 
01F5    600A          2747+1   JZ ( $+12 ) 
01F7    207502        2747+1   JB FLAGS3 . 5 , ( $+5 ) 
01FA    D296          2747+1   SETB P1 . 6 
01FC    307502        2747+1   JNB FLAGS3 . 5 , ( $+5 ) 
01FF    D292          2747+1   SETB P1 . 2 
                      2748     	ANFET_OFF
0201    207502        2748+1   JB FLAGS3 . 5 , ( $+5 ) 
0204    C292          2748+1   CLR P1 . 2 
0206    307502        2748+1   JNB FLAGS3 . 5 , ( $+5 ) 
0209    C296          2748+1   CLR P1 . 6 
020B    61D3          2749     	AJMP	T0_INT_PWM_ON_EXIT
                      2750     
                      2751     PWM_ANFET_BPFET_ON_FAST: 	; Pwm on cycle anfet on (bnfet off) and bpfet on (used in damped state 6)
                      2752     	APFET_OFF
020D    207502        2752+1   JB FLAGS3 . 5 , ( $+5 ) 
0210    C293          2752+1   CLR P1 . 3 
0212    307502        2752+1   JNB FLAGS3 . 5 , ( $+5 ) 
0215    C297          2752+1   CLR P1 . 7 
                      2753     	ANFET_ON								; Switch nFETs
0217    E525          2753+1   MOV A , CURRENT_PWM_LIMITED 
0219    600A          2753+1   JZ ( $+12 ) 
021B    207502        2753+1   JB FLAGS3 . 5 , ( $+5 ) 
021E    D292          2753+1   SETB P1 . 2 
0220    307502        2753+1   JNB FLAGS3 . 5 , ( $+5 ) 
0223    D296          2753+1   SETB P1 . 6 
                      2754     	CPFET_OFF
0225    207502        2754+1   JB FLAGS3 . 5 , ( $+5 ) 
0228    C297          2754+1   CLR P1 . 7 
022A    307502        2754+1   JNB FLAGS3 . 5 , ( $+5 ) 
022D    C293          2754+1   CLR P1 . 3 
                      2755     	BNFET_OFF 							
022F    C295          2755+1   CLR P1 . 5 
0231    61D3          2756     	AJMP	T0_INT_PWM_ON_EXIT
                      2757     PWM_ANFET_BPFET_ON_SAFE: 	; Pwm on cycle anfet on (bnfet off) and bpfet on (used in damped state 6)
                      2758     	; Delay from pFETs are turned off (only in damped mode) until nFET is turned on (pFETs are slow)
                      2759     	APFET_OFF
0233    207502        2759+1   JB FLAGS3 . 5 , ( $+5 ) 
0236    C293          2759+1   CLR P1 . 3 
0238    307502        2759+1   JNB FLAGS3 . 5 , ( $+5 ) 
023B    C297          2759+1   CLR P1 . 7 
                      2760     	CPFET_OFF
023D    207502        2760+1   JB FLAGS3 . 5 , ( $+5 ) 
0240    C297          2760+1   CLR P1 . 7 
0242    307502        2760+1   JNB FLAGS3 . 5 , ( $+5 ) 
0245    C293          2760+1   CLR P1 . 3 
0247    7406          2761     MOV A , # 6 
0249    D5E0FD        2762     	DJNZ ACC,	$
                      2763     	ANFET_ON								; Switch nFETs
024C    E525          2763+1   MOV A , CURRENT_PWM_LIMITED 
024E    600A          2763+1   JZ ( $+12 ) 
0250    207502        2763+1   JB FLAGS3 . 5 , ( $+5 ) 
0253    D292          2763+1   SETB P1 . 2 
0255    307502        2763+1   JNB FLAGS3 . 5 , ( $+5 ) 
0258    D296          2763+1   SETB P1 . 6 
                      2764     	BNFET_OFF 							
025A    C295          2764+1   CLR P1 . 5 
025C    61D3          2765     	AJMP	T0_INT_PWM_ON_EXIT
                      2766     
                      2767     PWM_ANFET_CPFET_ON_FAST: 	; Pwm on cycle anfet on (bnfet off) and cpfet on (used in damped state 5)
                      2768     	APFET_OFF
025E    207502        2768+1   JB FLAGS3 . 5 , ( $+5 ) 
0261    C293          2768+1   CLR P1 . 3 
0263    307502        2768+1   JNB FLAGS3 . 5 , ( $+5 ) 
0266    C297          2768+1   CLR P1 . 7 
                      2769     	ANFET_ON								; Switch nFETs
0268    E525          2769+1   MOV A , CURRENT_PWM_LIMITED 
026A    600A          2769+1   JZ ( $+12 ) 
026C    207502        2769+1   JB FLAGS3 . 5 , ( $+5 ) 
026F    D292          2769+1   SETB P1 . 2 
0271    307502        2769+1   JNB FLAGS3 . 5 , ( $+5 ) 
0274    D296          2769+1   SETB P1 . 6 
                      2770     	BPFET_OFF
0276    C294          2770+1   CLR P1 . 4 
                      2771     	BNFET_OFF								
0278    C295          2771+1   CLR P1 . 5 
027A    61D3          2772     	AJMP	T0_INT_PWM_ON_EXIT
                      2773     PWM_ANFET_CPFET_ON_SAFE: 	; Pwm on cycle anfet on (bnfet off) and cpfet on (used in damped state 5)
                      2774     	; Delay from pFETs are turned off (only in damped mode) until nFET is turned on (pFETs are slow)
                      2775     	APFET_OFF
027C    207502        2775+1   JB FLAGS3 . 5 , ( $+5 ) 
027F    C293          2775+1   CLR P1 . 3 
0281    307502        2775+1   JNB FLAGS3 . 5 , ( $+5 ) 
0284    C297          2775+1   CLR P1 . 7 
                      2776     	BPFET_OFF
0286    C294          2776+1   CLR P1 . 4 
0288    7406          2777     MOV A , # 6 
028A    D5E0FD        2778     	DJNZ ACC,	$
                      2779     	ANFET_ON								; Switch nFETs
028D    E525          2779+1   MOV A , CURRENT_PWM_LIMITED 
028F    600A          2779+1   JZ ( $+12 ) 
0291    207502        2779+1   JB FLAGS3 . 5 , ( $+5 ) 
0294    D292          2779+1   SETB P1 . 2 
0296    307502        2779+1   JNB FLAGS3 . 5 , ( $+5 ) 
0299    D296          2779+1   SETB P1 . 6 
                      2780     	BNFET_OFF								
029B    C295          2780+1   CLR P1 . 5 
029D    61D3          2781     	AJMP	T0_INT_PWM_ON_EXIT
                      2782     
                      2783     PWM_BNFET_CPFET_ON_FAST: 	; Pwm on cycle bnfet on (cnfet off) and cpfet on (used in damped state 4)
                      2784     	BPFET_OFF
029F    C294          2784+1   CLR P1 . 4 
                      2785     	BNFET_ON								; Switch nFETs
02A1    E525          2785+1   MOV A , CURRENT_PWM_LIMITED 
02A3    6002          2785+1   JZ ( $+4 ) 
02A5    D295          2785+1   SETB P1 . 5 
                      2786     	APFET_OFF
02A7    207502        2786+1   JB FLAGS3 . 5 , ( $+5 ) 
02AA    C293          2786+1   CLR P1 . 3 
02AC    307502        2786+1   JNB FLAGS3 . 5 , ( $+5 ) 
02AF    C297          2786+1   CLR P1 . 7 
                      2787     	CNFET_OFF								
02B1    207502        2787+1   JB FLAGS3 . 5 , ( $+5 ) 
02B4    C296          2787+1   CLR P1 . 6 
02B6    307502        2787+1   JNB FLAGS3 . 5 , ( $+5 ) 
02B9    C292          2787+1   CLR P1 . 2 
02BB    61D3          2788     	AJMP	T0_INT_PWM_ON_EXIT
                      2789     PWM_BNFET_CPFET_ON_SAFE: 	; Pwm on cycle bnfet on (cnfet off) and cpfet on (used in damped state 4)
                      2790     	; Delay from pFETs are turned off (only in damped mode) until nFET is turned on (pFETs are slow)
                      2791     	BPFET_OFF
02BD    C294          2791+1   CLR P1 . 4 
                      2792     	APFET_OFF
02BF    207502        2792+1   JB FLAGS3 . 5 , ( $+5 ) 
02C2    C293          2792+1   CLR P1 . 3 
02C4    307502        2792+1   JNB FLAGS3 . 5 , ( $+5 ) 
02C7    C297          2792+1   CLR P1 . 7 
02C9    7406          2793     MOV A , # 6 
02CB    D5E0FD        2794     	DJNZ ACC,	$
                      2795     	BNFET_ON								; Switch nFETs
02CE    E525          2795+1   MOV A , CURRENT_PWM_LIMITED 
02D0    6002          2795+1   JZ ( $+4 ) 
02D2    D295          2795+1   SETB P1 . 5 
                      2796     	CNFET_OFF								
02D4    207502        2796+1   JB FLAGS3 . 5 , ( $+5 ) 
02D7    C296          2796+1   CLR P1 . 6 
02D9    307502        2796+1   JNB FLAGS3 . 5 , ( $+5 ) 
02DC    C292          2796+1   CLR P1 . 2 
02DE    61D3          2797     	AJMP	T0_INT_PWM_ON_EXIT
                      2798     
                      2799     PWM_BNFET_APFET_ON_FAST: 	; Pwm on cycle bnfet on (cnfet off) and apfet on (used in damped state 3)
                      2800     	BPFET_OFF
02E0    C294          2800+1   CLR P1 . 4 
                      2801     	BNFET_ON								; Switch nFETs
02E2    E525          2801+1   MOV A , CURRENT_PWM_LIMITED 
02E4    6002          2801+1   JZ ( $+4 ) 
02E6    D295          2801+1   SETB P1 . 5 
                      2802     	CPFET_OFF
02E8    207502        2802+1   JB FLAGS3 . 5 , ( $+5 ) 
02EB    C297          2802+1   CLR P1 . 7 
02ED    307502        2802+1   JNB FLAGS3 . 5 , ( $+5 ) 
02F0    C293          2802+1   CLR P1 . 3 
                      2803     	CNFET_OFF								
02F2    207502        2803+1   JB FLAGS3 . 5 , ( $+5 ) 
02F5    C296          2803+1   CLR P1 . 6 
02F7    307502        2803+1   JNB FLAGS3 . 5 , ( $+5 ) 
02FA    C292          2803+1   CLR P1 . 2 
02FC    61D3          2804     	AJMP	T0_INT_PWM_ON_EXIT
                      2805     PWM_BNFET_APFET_ON_SAFE: 	; Pwm on cycle bnfet on (cnfet off) and apfet on (used in damped state 3)
                      2806     	; Delay from pFETs are turned off (only in damped mode) until nFET is turned on (pFETs are slow)
                      2807     	BPFET_OFF
02FE    C294          2807+1   CLR P1 . 4 
                      2808     	CPFET_OFF
0300    207502        2808+1   JB FLAGS3 . 5 , ( $+5 ) 
0303    C297          2808+1   CLR P1 . 7 
0305    307502        2808+1   JNB FLAGS3 . 5 , ( $+5 ) 
0308    C293          2808+1   CLR P1 . 3 
030A    7406          2809     MOV A , # 6 
030C    D5E0FD        2810     	DJNZ ACC,	$
                      2811     	BNFET_ON								; Switch nFETs
030F    E525          2811+1   MOV A , CURRENT_PWM_LIMITED 
0311    6002          2811+1   JZ ( $+4 ) 
0313    D295          2811+1   SETB P1 . 5 
                      2812     	CNFET_OFF								
0315    207502        2812+1   JB FLAGS3 . 5 , ( $+5 ) 
0318    C296          2812+1   CLR P1 . 6 
031A    307502        2812+1   JNB FLAGS3 . 5 , ( $+5 ) 
031D    C292          2812+1   CLR P1 . 2 
031F    61D3          2813     	AJMP	T0_INT_PWM_ON_EXIT
                      2814     
                      2815     PWM_CNFET_APFET_ON_FAST: 	; Pwm on cycle cnfet on (anfet off) and apfet on (used in damped state 2)
                      2816     	CPFET_OFF
0321    207502        2816+1   JB FLAGS3 . 5 , ( $+5 ) 
0324    C297          2816+1   CLR P1 . 7 
0326    307502        2816+1   JNB FLAGS3 . 5 , ( $+5 ) 
0329    C293          2816+1   CLR P1 . 3 
                      2817     	CNFET_ON								; Switch nFETs
032B    E525          2817+1   MOV A , CURRENT_PWM_LIMITED 
032D    600A          2817+1   JZ ( $+12 ) 
032F    207502        2817+1   JB FLAGS3 . 5 , ( $+5 ) 
0332    D296          2817+1   SETB P1 . 6 
0334    307502        2817+1   JNB FLAGS3 . 5 , ( $+5 ) 
0337    D292          2817+1   SETB P1 . 2 
                      2818     	BPFET_OFF
0339    C294          2818+1   CLR P1 . 4 
                      2819     	ANFET_OFF								
033B    207502        2819+1   JB FLAGS3 . 5 , ( $+5 ) 
033E    C292          2819+1   CLR P1 . 2 
0340    307502        2819+1   JNB FLAGS3 . 5 , ( $+5 ) 
0343    C296          2819+1   CLR P1 . 6 
0345    61D3          2820     	AJMP	T0_INT_PWM_ON_EXIT
                      2821     PWM_CNFET_APFET_ON_SAFE: 	; Pwm on cycle cnfet on (anfet off) and apfet on (used in damped state 2)
                      2822     	; Delay from pFETs are turned off (only in damped mode) until nFET is turned on (pFETs are slow)
                      2823     	CPFET_OFF
0347    207502        2823+1   JB FLAGS3 . 5 , ( $+5 ) 
034A    C297          2823+1   CLR P1 . 7 
034C    307502        2823+1   JNB FLAGS3 . 5 , ( $+5 ) 
034F    C293          2823+1   CLR P1 . 3 
                      2824     	BPFET_OFF
0351    C294          2824+1   CLR P1 . 4 
0353    7406          2825     MOV A , # 6 
0355    D5E0FD        2826     	DJNZ ACC,	$
                      2827     	CNFET_ON								; Switch nFETs
0358    E525          2827+1   MOV A , CURRENT_PWM_LIMITED 
035A    600A          2827+1   JZ ( $+12 ) 
035C    207502        2827+1   JB FLAGS3 . 5 , ( $+5 ) 
035F    D296          2827+1   SETB P1 . 6 
0361    307502        2827+1   JNB FLAGS3 . 5 , ( $+5 ) 
0364    D292          2827+1   SETB P1 . 2 
                      2828     	ANFET_OFF								
0366    207502        2828+1   JB FLAGS3 . 5 , ( $+5 ) 
0369    C292          2828+1   CLR P1 . 2 
036B    307502        2828+1   JNB FLAGS3 . 5 , ( $+5 ) 
036E    C296          2828+1   CLR P1 . 6 
0370    61D3          2829     	AJMP	T0_INT_PWM_ON_EXIT
                      2830     
                      2831     PWM_CNFET_BPFET_ON_FAST: 	; Pwm on cycle cnfet on (anfet off) and bpfet on (used in damped state 1)
                      2832     	CPFET_OFF
0372    207502        2832+1   JB FLAGS3 . 5 , ( $+5 ) 
0375    C297          2832+1   CLR P1 . 7 
0377    307502        2832+1   JNB FLAGS3 . 5 , ( $+5 ) 
037A    C293          2832+1   CLR P1 . 3 
                      2833     	CNFET_ON								; Switch nFETs
037C    E525          2833+1   MOV A , CURRENT_PWM_LIMITED 
037E    600A          2833+1   JZ ( $+12 ) 
0380    207502        2833+1   JB FLAGS3 . 5 , ( $+5 ) 
0383    D296          2833+1   SETB P1 . 6 
0385    307502        2833+1   JNB FLAGS3 . 5 , ( $+5 ) 
0388    D292          2833+1   SETB P1 . 2 
                      2834     	APFET_OFF
038A    207502        2834+1   JB FLAGS3 . 5 , ( $+5 ) 
038D    C293          2834+1   CLR P1 . 3 
038F    307502        2834+1   JNB FLAGS3 . 5 , ( $+5 ) 
0392    C297          2834+1   CLR P1 . 7 
                      2835     	ANFET_OFF								
0394    207502        2835+1   JB FLAGS3 . 5 , ( $+5 ) 
0397    C292          2835+1   CLR P1 . 2 
0399    307502        2835+1   JNB FLAGS3 . 5 , ( $+5 ) 
039C    C296          2835+1   CLR P1 . 6 
039E    61D3          2836     	AJMP	T0_INT_PWM_ON_EXIT
                      2837     PWM_CNFET_BPFET_ON_SAFE: 	; Pwm on cycle cnfet on (anfet off) and bpfet on (used in damped state 1)
                      2838     	; Delay from pFETs are turned off (only in damped mode) until nFET is turned on (pFETs are slow)
                      2839     	CPFET_OFF
03A0    207502        2839+1   JB FLAGS3 . 5 , ( $+5 ) 
03A3    C297          2839+1   CLR P1 . 7 
03A5    307502        2839+1   JNB FLAGS3 . 5 , ( $+5 ) 
03A8    C293          2839+1   CLR P1 . 3 
                      2840     	APFET_OFF
03AA    207502        2840+1   JB FLAGS3 . 5 , ( $+5 ) 
03AD    C293          2840+1   CLR P1 . 3 
03AF    307502        2840+1   JNB FLAGS3 . 5 , ( $+5 ) 
03B2    C297          2840+1   CLR P1 . 7 
03B4    7406          2841     MOV A , # 6 
03B6    D5E0FD        2842     	DJNZ ACC,	$
                      2843     	CNFET_ON								; Switch nFETs
03B9    E525          2843+1   MOV A , CURRENT_PWM_LIMITED 
03BB    600A          2843+1   JZ ( $+12 ) 
03BD    207502        2843+1   JB FLAGS3 . 5 , ( $+5 ) 
03C0    D296          2843+1   SETB P1 . 6 
03C2    307502        2843+1   JNB FLAGS3 . 5 , ( $+5 ) 
03C5    D292          2843+1   SETB P1 . 2 
                      2844     	ANFET_OFF								
03C7    207502        2844+1   JB FLAGS3 . 5 , ( $+5 ) 
03CA    C292          2844+1   CLR P1 . 2 
03CC    307502        2844+1   JNB FLAGS3 . 5 , ( $+5 ) 
03CF    C296          2844+1   CLR P1 . 6 
03D1    61D3          2845     	AJMP	T0_INT_PWM_ON_EXIT
                      2846     
                      2847     T0_INT_PWM_ON_EXIT: 
                      2848     	; Set timer for coming on cycle length
03D3    E525          2849     	MOV 	A, CURRENT_PWM_LIMITED		; Load current pwm
03D5    F4            2850     	CPL	A						; cpl is 255-x
03D6    F58A          2851     	MOV	TL0, A					; Write start point for timer
                      2852     	; Set other variables
03D8    758B00        2853     	MOV	TL1, #0					; Reset timer1	
03DB    756200        2854     	MOV	PWM_ON_CNT, #0				; Reset pwm on event counter
03DE    D25A          2855     SETB FLAGS0 . 2 
                      2856     T0_INT_PWM_ON_EXIT_NO_TIMER_UPDATE: 
                      2857     	; Exit interrupt
03E0    D0E0          2858     	POP	ACC			; Restore preserved registers
03E2    D0D0          2859     	POP	PSW
03E4    D2AF          2860     	SETB	EA			; Enable all interrupts
03E6    32            2861     	RETI
                      2862     
                      2863     
                      2864     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      2865     ;
                      2866     ; Timer2 interrupt routine
                      2867     ;
                      2868     ; No assumptions
                      2869     ;
                      2870     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      2871     T2_INT: 	; Happens every 128us for low byte and every 32ms for high byte
03E7    C2AF          2872     	CLR	EA
03E9    C2AD          2873     	CLR	ET2			; Disable timer2 interrupts
03EB    53E6EF        2874     	ANL	EIE1, #0EFH	; Disable PCA0 interrupts
03EE    C0D0          2875     	PUSH	PSW			; Preserve registers through interrupt
03F0    C0E0          2876     	PUSH	ACC
03F2    D2D3          2877     	SETB	PSW.3		; Select register bank 1 for interrupt routines
03F4    D2AF          2878     	SETB	EA
                      2879     	; Clear low byte interrupt flag
03F6    C2CE          2880     	CLR	TF2L						; Clear interrupt flag
                      2881     	; Check RC pulse timeout counter
03F8    E528          2882     	MOV	A, RCP_TIMEOUT_CNT			; RC pulse timeout count zero?
03FA    600A          2883     	JZ	T2_INT_PULSES_ABSENT		; Yes - pulses are absent
                      2884     
                      2885     	; Decrement timeout counter (if PWM)
03FC    741F          2886     	MOV	A, #((1 SHL RCP_PWM_FREQ_1KHZ)+(1 SHL RCP_PWM_FREQ_2KHZ)+(1 SHL RCP_PWM_FREQ_4KHZ)+(1 SHL RCP_PWM_FREQ_8KHZ)+(1 SHL RCP_PWM_FREQ_12KHZ))
03FE    552E          2887     	ANL	A, FLAGS3					; Check pwm frequency flags
0400    6049          2888     	JZ	T2_INT_SKIP_START			; If no flag is set (PPM) - branch
                      2889     
0402    1528          2890     	DEC	RCP_TIMEOUT_CNT			; No - decrement
0404    814B          2891     	AJMP	T2_INT_SKIP_START
                      2892     
                      2893     T2_INT_PULSES_ABSENT: 
                      2894     	; Timeout counter has reached zero, pulses are absent
0406    7800          2895     MOV R0 , # 0 
0408    7900          2896     MOV R1 , # 0 
                      2897     	READ_RCP_INT 					; Look at value of Rcp_In
040A    E580          2897+1   MOV A , P0 
040C    307601        2897+1   JNB FLAGS3 . 6 , ( $+4 )  ; IS PWM POLARITY NEGATIVE?
040F    F4            2897+1   CPL A  ; YES - INVERT
0410    30E502        2898     JNB ACC . 5 , ( $+5 ) 
0413    78FF          2899     MOV R0 , # 255 
                      2900     	RCP_INT_FIRST 					; Set interrupt trig to first again
0415    53DACF        2900+1   ANL PCA0CPM0 , # 0CFH 
0418    207603        2900+1   JB FLAGS3 . 6 , ( $+6 )  ; IS PWM POLARITY POSITIVE?
041B    43DA20        2900+1   ORL PCA0CPM0 , # 20H  ; CAPTURE RISING EDGE
041E    307603        2900+1   JNB FLAGS3 . 6 , ( $+6 )  ; IS PWM POLARITY NEGATIVE?
0421    43DA10        2900+1   ORL PCA0CPM0 , # 10H  ; CAPTURE FALLING EDGE
                      2901     	RCP_CLEAR_INT_FLAG 				; Clear interrupt flag
0424    C2D8          2901+1   CLR CCF0  ; CLEAR INTERRUPT FLAG
0426    C269          2902     CLR FLAGS2 . 1 
                      2903     	READ_RCP_INT 					; Look once more at value of Rcp_In
0428    E580          2903+1   MOV A , P0 
042A    307601        2903+1   JNB FLAGS3 . 6 , ( $+4 )  ; IS PWM POLARITY NEGATIVE?
042D    F4            2903+1   CPL A  ; YES - INVERT
042E    30E502        2904     JNB ACC . 5 , ( $+5 ) 
0431    79FF          2905     MOV R1 , # 255 
0433    C3            2906     	CLR	C
0434    E8            2907     MOV A , R0 
0435    99            2908     SUBB A , R1 
0436    70CE          2909     	JNZ 	T2_INT_PULSES_ABSENT		; Go back if they are not equal
                      2910     
0438    305903        2911     JNB FLAGS0 . 1 , ( $+6 ) 
                      2912     
043B    752818        2913     MOV RCP_TIMEOUT_CNT , # 24 
                      2914     
043E    741F          2915     	MOV	A, #((1 SHL RCP_PWM_FREQ_1KHZ)+(1 SHL RCP_PWM_FREQ_2KHZ)+(1 SHL RCP_PWM_FREQ_4KHZ)+(1 SHL RCP_PWM_FREQ_8KHZ)+(1 SHL RCP_PWM_FREQ_12KHZ))
0440    552E          2916     	ANL	A, FLAGS3					; Check pwm frequency flags
0442    6003          2917     	JZ	T2_INT_PPM_TIMEOUT_SET		; If no flag is set (PPM) - branch
                      2918     
0444    752818        2919     MOV RCP_TIMEOUT_CNT , # 24 
                      2920     
                      2921     
                      2922     T2_INT_PPM_TIMEOUT_SET: 
                      2923     
                      2924     ; **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** ****
                      2925     ; 
                      2926     ;  RCP 
                      2927     ; 1  1500us 
                      2928     ; 2  1500us 
                      2929     ; 
                      2930     ;	clr C
                      2931     ;	mov A, Temp1
                      2932     ;	subb A, #80h
                      2933     ;	jnc skypup_01
                      2934     ;	mov	Temp1, #RCP_MIN
                      2935     ; skypup_01:
                      2936     ; **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** ****
0447    8859          2937     MOV NEW_RCP , R0 
0449    D268          2938     SETB FLAGS2 . 0 
                      2939     
                      2940     T2_INT_SKIP_START: 
                      2941     	; Check RC pulse skip counter
044B    E529          2942     	MOV	A, RCP_SKIP_CNT			
044D    6004          2943     	JZ 	T2_INT_SKIP_END			; If RC pulse skip count is zero - end skipping RC pulse detection
                      2944     	
                      2945     	; Decrement skip counter (only if edge counter is zero)
044F    1529          2946     	DEC	RCP_SKIP_CNT				; Decrement
0451    815E          2947     	AJMP	T2_INT_RCP_UPDATE_START
                      2948     
                      2949     T2_INT_SKIP_END: 
0453    741F          2950     	MOV	A, #((1 SHL RCP_PWM_FREQ_1KHZ)+(1 SHL RCP_PWM_FREQ_2KHZ)+(1 SHL RCP_PWM_FREQ_4KHZ)+(1 SHL RCP_PWM_FREQ_8KHZ)+(1 SHL RCP_PWM_FREQ_12KHZ))
0455    552E          2951     	ANL	A, FLAGS3					; Check pwm frequency flags
0457    6005          2952     	JZ	T2_INT_RCP_UPDATE_START		; If no flag is set (PPM) - branch
                      2953     
                      2954     	; Skip counter has reached zero, start looking for RC pulses again
                      2955     	RCP_INT_ENABLE 				; Enable RC pulse interrupt
0459    43DA01        2955+1   ORL PCA0CPM0 , # 01H  ; INTERRUPT ENABLED
                      2956     	RCP_CLEAR_INT_FLAG 				; Clear interrupt flag
045C    C2D8          2956+1   CLR CCF0  ; CLEAR INTERRUPT FLAG
                      2957     	
                      2958     T2_INT_RCP_UPDATE_START: 
                      2959     	; Process updated RC pulse
045E    206802        2960     JB FLAGS2 . 0 , ( $+5 ) 
0461    81E7          2961     	AJMP	T2_INT_PWM_EXIT			; No - exit
                      2962     
0463    E559          2963     	MOV	A, NEW_RCP				; Load new pulse value
0465    F8            2964     MOV R0 , A 
0466    C268          2965     CLR FLAGS2 . 0 
                      2966     	; Use a gain of 1.0625x for pwm input if not governor mode
0468    741F          2967     	MOV	A, #((1 SHL RCP_PWM_FREQ_1KHZ)+(1 SHL RCP_PWM_FREQ_2KHZ)+(1 SHL RCP_PWM_FREQ_4KHZ)+(1 SHL RCP_PWM_FREQ_8KHZ)+(1 SHL RCP_PWM_FREQ_12KHZ))
046A    552E          2968     	ANL	A, FLAGS3					; Check pwm frequency flags
046C    6036          2969     	JZ	T2_INT_PWM_MIN_RUN			; If no flag is set (PPM) - branch
                      2970     
                      2971     IF MODE == 0	; Main - do not adjust gain
                               	AJMP	T2_INT_PWM_MIN_RUN
                               ENDIF
                      2974     
                      2975     IF MODE == 2	; Multi
046E    7982          2976     MOV R1 , # PGM_GOV_MODE 
0470    B70431        2977     CJNE @ R1 , # 4 , T2_INT_PWM_MIN_RUN 
                      2978     ENDIF
                      2979     
                      2980     	; Limit the maximum value to avoid wrap when scaled to pwm range
0473    C3            2981     	CLR	C
0474    E8            2982     MOV A , R0 
0475    94F0          2983     	SUBB	A, #240			; 240 = (255/1.0625) Needs to be updated according to multiplication factor below		
0477    4003          2984     	JC	T2_INT_RCP_UPDATE_MULT
                      2985     
0479    74F0          2986     	MOV	A, #240			; Set requested pwm to max
047B    F8            2987     MOV R0 , A 
                      2988     
                      2989     T2_INT_RCP_UPDATE_MULT: 	
                      2990     	; Multiply by 1.0625 (optional adjustment gyro gain)
047C    E8            2991     MOV A , R0 
047D    C4            2992     	SWAP	A			; After this "0.0625"
047E    540F          2993     	ANL	A, #0FH
0480    28            2994     ADD A , R0 
0481    F8            2995     MOV R0 , A 
                      2996     	; Adjust tail gain
0482    7984          2997     MOV R1 , # PGM_MOTOR_GAIN 
0484    B70302        2998     CJNE @ R1 , # 3 , ( $+5 ) 
0487    81A4          2999     	AJMP	T2_INT_PWM_MIN_RUN			; Yes - skip adjustment
                      3000     
0489    C3            3001     	CLR	C
048A    13            3002     	RRC	A			; After this "0.5"
048B    C3            3003     	CLR	C
048C    13            3004     	RRC	A			; After this "0.25"
048D    8721          3005     MOV BIT_ACCESS_INT , @ R1 
048F    200802        3006     	JB	BIT_ACCESS_INT.0, T2_INT_RCP_GAIN_CORR	; Branch if bit 0 in gain is set
                      3007     
0492    C3            3008     	CLR	C
0493    13            3009     	RRC	A			; After this "0.125"
                      3010     
                      3011     T2_INT_RCP_GAIN_CORR: 
0494    200A06        3012     	JB	BIT_ACCESS_INT.2, T2_INT_RCP_GAIN_POS	; Branch if bit 2 in gain is set
                      3013     
0497    C3            3014     	CLR	C
0498    C8            3015     XCH A , R0 
0499    98            3016     SUBB A , R0 
049A    F8            3017     MOV R0 , A 
049B    81A4          3018     	AJMP	T2_INT_PWM_MIN_RUN
                      3019     
                      3020     T2_INT_RCP_GAIN_POS: 
049D    28            3021     ADD A , R0 
049E    F8            3022     MOV R0 , A 
049F    5003          3023     	JNC	T2_INT_PWM_MIN_RUN			; Above max?
                      3024     
04A1    74FF          3025     	MOV	A, #0FFH					; Yes - limit
04A3    F8            3026     MOV R0 , A 
                      3027     
                      3028     T2_INT_PWM_MIN_RUN:  
                      3029     IF MODE == 1	; Tail - limit minimum pwm
                               	; Limit minimum pwm
                               	CLR	C
                               	MOV	A, TEMP1
                               	SUBB	A, PWM_MOTOR_IDLE			; Is requested pwm lower than minimum?
                               	JNC	T2_INT_PWM_UPDATE			; No - branch
                               
                               	MOV	A, PWM_MOTOR_IDLE			; Yes - limit pwm to Pwm_Motor_Idle	
                               	MOV	TEMP1, A
                               ENDIF
                      3039     
                      3040     T2_INT_PWM_UPDATE:  
                      3041     	; Check if any startup phase flags are set
04A4    E52C          3042     	MOV	A, FLAGS1
04A6    5406          3043     	ANL	A, #((1 SHL SETTLE_PHASE)+(1 SHL STEPPER_PHASE))
04A8    703D          3044     	JNZ	T2_INT_PWM_EXIT			; Exit if any startup phase set (pwm controlled by set_startup_pwm)
                      3045     
                      3046     	; Update requested_pwm
04AA    8822          3047     MOV REQUESTED_PWM , R0 
                      3048     	; Limit pwm during direct start
04AC    30630A        3049     JNB FLAGS1 . 3 , T2_INT_CURRENT_PWM_UPDATE 
                      3050     
04AF    C3            3051     	CLR	C
04B0    E522          3052     	MOV	A, REQUESTED_PWM			; Limit pwm during direct start
04B2    955E          3053     	SUBB	A, PWM_LIMIT
04B4    4003          3054     	JC	T2_INT_CURRENT_PWM_UPDATE
                      3055     
04B6    855E22        3056     	MOV	REQUESTED_PWM, PWM_LIMIT
                      3057     
                      3058     T2_INT_CURRENT_PWM_UPDATE:  
                      3059     IF MODE == 0 OR MODE == 2	; Main or multi
04B9    7882          3060     MOV R0 , # PGM_GOV_MODE 
04BB    B60429        3061     CJNE @ R0 , # 4 , T2_INT_PWM_EXIT 
                      3062     ENDIF
                      3063     
                      3064     	; Update current pwm, with limited throttle change rate
04BE    C3            3065     	CLR	C
04BF    E522          3066     	MOV	A, REQUESTED_PWM	 
04C1    9524          3067     	SUBB	A, CURRENT_PWM				; Is requested pwm larger than current pwm?
04C3    4012          3068     	JC	T2_INT_SET_CURRENT_PWM		; No - proceed
                      3069     
                      3070     	; 
04C5    78A1          3071     MOV R0 , # PGM_THROTTLE_RATE_DECODED 
                      3072     	;mov	Temp1, #1
04C7    96            3073     SUBB A , @ R0 
                      3074     	;subb	A, Temp1				; Is difference larger than throttle change rate?
04C8    400D          3075     	JC	T2_INT_SET_CURRENT_PWM		; No - proceed
                      3076     
04CA    E524          3077     	MOV	A, CURRENT_PWM				; Increase current pwm by throttle change rate
04CC    26            3078     ADD A , @ R0 
                      3079     	; add	A, Temp1
04CD    F524          3080     	MOV	CURRENT_PWM, A
04CF    5009          3081     	JNC	T2_INT_CURRENT_PWM_DONE		; Is result above max?
                      3082     
04D1    7524FF        3083     	MOV	CURRENT_PWM, #0FFH			; Yes - limit
04D4    0204DA        3084     	JMP	T2_INT_CURRENT_PWM_DONE
                      3085     
                      3086     T2_INT_SET_CURRENT_PWM: 
04D7    852224        3087     	MOV	CURRENT_PWM, REQUESTED_PWM	; Set equal as default
                      3088     T2_INT_CURRENT_PWM_DONE: 
                      3089     IF MODE >= 1	; Tail or multi
                      3090     	; Set current_pwm_limited
04DA    A824          3091     MOV R0 , CURRENT_PWM 
04DC    C3            3092     	CLR	C
04DD    E524          3093     	MOV	A, CURRENT_PWM				; Check against limit
04DF    955E          3094     	SUBB	A, PWM_LIMIT
04E1    4002          3095     	JC	($+4)					; If current pwm below limit - branch
                      3096     
04E3    A85E          3097     MOV R0 , PWM_LIMIT 
                      3098     
04E5    8825          3099     MOV CURRENT_PWM_LIMITED , R0 
                      3100     ENDIF
                      3101     T2_INT_PWM_EXIT: 	
                      3102     	; Check if high byte flag is set
04E7    20CF0C        3103     	JB	TF2H, T2H_INT		
04EA    D0E0          3104     	POP	ACC			; Restore preserved registers
04EC    D0D0          3105     	POP	PSW
04EE    C2D3          3106     	CLR	PSW.3		; Select register bank 0 for main program routines	
04F0    43E610        3107     	ORL	EIE1, #10H	; Enable PCA0 interrupts
04F3    D2AD          3108     	SETB	ET2			; Enable timer2 interrupts
04F5    32            3109     	RETI
                      3110     
                      3111     T2H_INT: 
                      3112     	; High byte interrupt (happens every 32ms)
04F6    C2CF          3113     	CLR	TF2H					; Clear interrupt flag
04F8    7801          3114     MOV R0 , # 1 
                      3115     	; Check RC pulse timeout counter (used here for PPM only)
04FA    E528          3116     	MOV	A, RCP_TIMEOUT_CNT			; RC pulse timeout count zero?
04FC    6008          3117     	JZ	T2H_INT_RCP_STOP_CHECK		; Yes - do not decrement
                      3118     
                      3119     	; Decrement timeout counter (if PPM)
04FE    741F          3120     	MOV	A, #((1 SHL RCP_PWM_FREQ_1KHZ)+(1 SHL RCP_PWM_FREQ_2KHZ)+(1 SHL RCP_PWM_FREQ_4KHZ)+(1 SHL RCP_PWM_FREQ_8KHZ)+(1 SHL RCP_PWM_FREQ_12KHZ))
0500    552E          3121     	ANL	A, FLAGS3					; Check pwm frequency flags
0502    7002          3122     	JNZ	T2H_INT_RCP_STOP_CHECK		; If a flag is set (PWM) - branch
                      3123     
0504    1528          3124     	DEC	RCP_TIMEOUT_CNT			; No flag set (PPM) - decrement
                      3125     
                      3126     T2H_INT_RCP_STOP_CHECK: 
                      3127     	; Check RC pulse against stop value
0506    C3            3128     	CLR	C
0507    E559          3129     	MOV	A, NEW_RCP				; Load new pulse value
0509    9401          3130     SUBB A , # 1 
050B    4005          3131     	JC	T2H_INT_RCP_STOP
                      3132     
                      3133     	; RC pulse higher than stop value, reset stop counter
050D    755C00        3134     	MOV	RCP_STOP_CNT, #0			; Reset rcp stop counter
0510    A123          3135     	AJMP	T2H_INT_RCP_GOV_PWM
                      3136     
                      3137     T2H_INT_RCP_STOP: 	
                      3138     	; RC pulse less than stop value
0512    755D00        3139     	MOV	AUTO_BAILOUT_ARMED, #0		; Disarm bailout		
0515    756400        3140     	MOV	SPOOLUP_LIMIT_CNT, #0
0518    E55C          3141     	MOV	A, RCP_STOP_CNT			; Increment stop counter
051A    2401          3142     	ADD	A, #1
051C    F55C          3143     	MOV	RCP_STOP_CNT, A
051E    5003          3144     	JNC	T2H_INT_RCP_GOV_PWM			; Branch if counter has not wrapped
                      3145     
0520    755CFF        3146     	MOV	RCP_STOP_CNT, #0FFH			; Set stop counter to max
                      3147     
                      3148     T2H_INT_RCP_GOV_PWM: 
                      3149     IF MODE == 0	; Main
                               	; Update governor variables
                               	MOV	TEMP2, #PGM_GOV_MODE			; Governor target by arm mode?
                               	CJNE	@TEMP2, #2, T2H_INT_RCP_GOV_BY_SETUP	; No - branch
                               
                               	MOV	A, GOV_ACTIVE					; Is governor active?
                               	JZ	T2H_INT_RCP_GOV_BY_TX			; No - branch (this ensures soft spoolup by tx)
                               
                               	CLR	C
                               	MOV	A, REQUESTED_PWM
                               	SUBB	A, #50						; Is requested pwm below 20%?
                               	JC	T2H_INT_RCP_GOV_BY_TX			; Yes - branch (this enables a soft spooldown)
                               
                               	MOV	REQUESTED_PWM, GOV_ARM_TARGET		; Yes - load arm target
                               
                               T2H_INT_RCP_GOV_BY_SETUP:
                               	MOV	TEMP2, #PGM_GOV_MODE			; Governor target by setup mode?
                               	CJNE	@TEMP2, #3, T2H_INT_RCP_GOV_BY_TX		; No - branch
                               
                               	MOV	A, GOV_ACTIVE					; Is governor active?
                               	JZ	T2H_INT_RCP_GOV_BY_TX			; No - branch (this ensures soft spoolup by tx)
                               
                               	CLR	C
                               	MOV	A, REQUESTED_PWM
                               	SUBB	A, #50						; Is requested pwm below 20%?
                               	JC	T2H_INT_RCP_GOV_BY_TX			; Yes - branch (this enables a soft spooldown)
                               
                               	MOV	TEMP2, #PGM_GOV_SETUP_TARGET		; Gov by setup - load setup target
                               	MOV	REQUESTED_PWM, @TEMP2
                               
                               T2H_INT_RCP_GOV_BY_TX:
                               	CLR	C
                               	MOV	A, GOVERNOR_REQ_PWM
                               	SUBB	A, REQUESTED_PWM				; Is governor requested pwm equal to requested pwm?
                               	JZ	T2H_INT_RCP_GOV_PWM_DONE			; Yes - branch
                               
                               	JC	T2H_INT_RCP_GOV_PWM_INC			; No - if lower, then increment
                               
                               	DEC	GOVERNOR_REQ_PWM				; No - if higher, then decrement
                               	AJMP	T2H_INT_RCP_GOV_PWM_DONE
                               
                               T2H_INT_RCP_GOV_PWM_INC:
                               	INC	GOVERNOR_REQ_PWM				; Increment
                               
                               T2H_INT_RCP_GOV_PWM_DONE:
                               	DJNZ	TEMP1, T2H_INT_RCP_GOV_PWM		; If not number of steps processed - go back
                               
                               	INC	SPOOLUP_LIMIT_CNT				; Increment spoolup count
                               	MOV	A, SPOOLUP_LIMIT_CNT
                               	JNZ	($+4)						; Wrapped?
                               
                               	DEC	SPOOLUP_LIMIT_CNT				; Yes - decrement
                               
                               	DJNZ	SPOOLUP_LIMIT_SKIP, T2H_INT_RCP_EXIT	; Jump if skip count is not reached
                               
                               	MOV	SPOOLUP_LIMIT_SKIP, #1			; Reset skip count. Default is fast spoolup
                               	MOV	TEMP1, #5						; Default fast increase
                               
                               	CLR	C
                               	MOV	A, SPOOLUP_LIMIT_CNT
                               	SUBB	A, #(3*MAIN_SPOOLUP_TIME)		; No spoolup until "30"*32ms
                               	JC	T2H_INT_RCP_EXIT
                               
                               	CLR	C
                               	MOV	A, SPOOLUP_LIMIT_CNT
                               	SUBB	A, #(10*MAIN_SPOOLUP_TIME)		; Slow spoolup until "100"*32ms
                               	JNC	T2H_INT_RCP_LIMIT_MIDDLE_RAMP
                               
                               	MOV	TEMP1, #1						; Slow initial spoolup
                               	MOV	SPOOLUP_LIMIT_SKIP, #3			
                               	JMP	T2H_INT_RCP_SET_LIMIT
                               
                               T2H_INT_RCP_LIMIT_MIDDLE_RAMP:
                               	CLR	C
                               	MOV	A, SPOOLUP_LIMIT_CNT
                               	SUBB	A, #(15*MAIN_SPOOLUP_TIME)		; Faster spoolup until "150"*32ms
                               	JNC	T2H_INT_RCP_SET_LIMIT
                               
                               	MOV	TEMP1, #1						; Faster middle spoolup
                               	MOV	SPOOLUP_LIMIT_SKIP, #1			
                               
                               T2H_INT_RCP_SET_LIMIT:
                               	; Do not increment spoolup limit if higher pwm is not requested, unless governor is active
                               	CLR	C
                               	MOV	A, PWM_LIMIT_SPOOLUP
                               	SUBB	A, CURRENT_PWM
                               	JC	T2H_INT_RCP_INC_LIMIT			; If Current_Pwm is larger than Pwm_Limit_Spoolup - branch
                               
                               	MOV	TEMP2, #PGM_GOV_MODE			; Governor mode?
                               	CJNE	@TEMP2, #4, ($+5)
                               	AJMP	T2H_INT_RCP_BAILOUT_ARM			; No - branch
                               
                               	MOV	A, GOV_ACTIVE					; Is governor active?
                               	JNZ	T2H_INT_RCP_INC_LIMIT			; Yes - branch
                               
                               	MOV	PWM_LIMIT_SPOOLUP, CURRENT_PWM	; Set limit to what current pwm is
                               	MOV	A, SPOOLUP_LIMIT_CNT			; Check if spoolup limit count is 255. If it is, then this is a "bailout" ramp
                               	INC	A
                               	JZ	($+5)
                               
                               	MOV	SPOOLUP_LIMIT_CNT, #(3*MAIN_SPOOLUP_TIME)	; Stay in an early part of the spoolup sequence (unless "bailout" ramp)
                               
                               	MOV	SPOOLUP_LIMIT_SKIP, #1			; Set skip count
                               	MOV	GOVERNOR_REQ_PWM, #60			; Set governor requested speed to ensure that it requests higher speed
                               									; 20=Fail on jerk when governor activates
                               									; 30=Ok
                               									; 100=Fail on small governor settling overshoot on low headspeeds
                               									; 200=Fail on governor settling overshoot
                               	JMP	T2H_INT_RCP_EXIT				; Exit
                               
                               T2H_INT_RCP_INC_LIMIT:
                               	MOV	A, PWM_LIMIT_SPOOLUP			; Increment spoolup pwm
                               	ADD	A, TEMP1
                               	JNC	T2H_INT_RCP_NO_LIMIT			; If below 255 - branch
                               
                               	MOV	PWM_LIMIT_SPOOLUP, #0FFH
                               	AJMP	T2H_INT_RCP_BAILOUT_ARM
                               
                               T2H_INT_RCP_NO_LIMIT:
                               	MOV	PWM_LIMIT_SPOOLUP, A
                               T2H_INT_RCP_BAILOUT_ARM:
                               	MOV	A, PWM_LIMIT_SPOOLUP
                               	INC	A
                               	JNZ	T2H_INT_RCP_EXIT
                               
                               	MOV	AUTO_BAILOUT_ARMED, #255			; Arm bailout
                               	MOV	SPOOLUP_LIMIT_CNT, #255			
                               
                               ENDIF
                      3278     IF MODE == 2	; Multi
0523    E55F          3279     	MOV	A, PWM_LIMIT_SPOOLUP			; Increment spoolup pwm, for a 0.8 seconds spoolup
0525    240A          3280     	ADD	A, #10
0527    5005          3281     	JNC	T2H_INT_RCP_NO_LIMIT			; If below 255 - branch
                      3282     
0529    755FFF        3283     	MOV	PWM_LIMIT_SPOOLUP, #0FFH
052C    A130          3284     	AJMP	T2H_INT_RCP_EXIT
                      3285     
                      3286     T2H_INT_RCP_NO_LIMIT: 
052E    F55F          3287     	MOV	PWM_LIMIT_SPOOLUP, A
                      3288     ENDIF
                      3289     
                      3290     T2H_INT_RCP_EXIT: 
0530    D0E0          3291     	POP	ACC			; Restore preserved registers
0532    D0D0          3292     	POP	PSW
0534    C2D3          3293     	CLR	PSW.3		; Select register bank 0 for main program routines	
0536    43E610        3294     	ORL	EIE1, #10H	; Enable PCA0 interrupts
0539    D2AD          3295     	SETB	ET2			; Enable timer2 interrupts
053B    32            3296     	RETI
                      3297     
                      3298     
                      3299     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      3300     ;
                      3301     ; Timer3 interrupt routine
                      3302     ;
                      3303     ; No assumptions
                      3304     ;
                      3305     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      3306     T3_INT: 	; Used for commutation timing
053C    C2AF          3307     	CLR 	EA			; Disable all interrupts
053E    53917F        3308     	ANL	TMR3CN, #07FH		; Clear interrupt flag
0541    C258          3309     CLR FLAGS0 . 0 
0543    D2AF          3310     	SETB	EA			; Enable all interrupts
0545    32            3311     	RETI
                      3312     
                      3313     
                      3314     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      3315     ;
                      3316     ; PCA interrupt routine
                      3317     ;
                      3318     ; No assumptions
                      3319     ;
                      3320     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      3321     PCA_INT: 	; Used for RC pulse timing
0546    C2AF          3322     	CLR	EA
0548    53E6EF        3323     	ANL	EIE1, #0EFH	; Disable PCA0 interrupts
054B    C2AD          3324     	CLR	ET2			; Disable timer2 interrupts
054D    C0D0          3325     	PUSH	PSW			; Preserve registers through interrupt
054F    C0E0          3326     	PUSH	ACC
0551    C0F0          3327     	PUSH	B
0553    D2D3          3328     	SETB	PSW.3		; Select register bank 1 for interrupt routines
0555    D2AF          3329     	SETB	EA
                      3330     	; Get the PCA counter values
                      3331     	GET_RCP_CAPTURE_VALUES
0557    A8FB          3331+1   MOV R0 , PCA0CPL0  ; GET PCA CAPTURE VALUES
0559    A9FC          3331+1   MOV R1 , PCA0CPH0 
                      3332     	; Clear interrupt flag
                      3333     	RCP_CLEAR_INT_FLAG 				
055B    C2D8          3333+1   CLR CCF0  ; CLEAR INTERRUPT FLAG
                      3334     	; Check which edge it is
055D    306902        3335     JNB FLAGS2 . 1 , ( $+5 ) 
0560    A1B1          3336     	AJMP PCA_INT_SECOND_MEAS_PWM_FREQ	; No - branch to second
                      3337     
                      3338     	RCP_INT_SECOND					; Yes - set second edge trig
0562    53DACF        3338+1   ANL PCA0CPM0 , # 0CFH 
0565    207603        3338+1   JB FLAGS3 . 6 , ( $+6 )  ; IS PWM POLARITY POSITIVE?
0568    43DA10        3338+1   ORL PCA0CPM0 , # 10H  ; CAPTURE FALLING EDGE
056B    307603        3338+1   JNB FLAGS3 . 6 , ( $+6 )  ; IS PWM POLARITY NEGATIVE?
056E    43DA20        3338+1   ORL PCA0CPM0 , # 20H  ; CAPTURE RISING EDGE
0571    D269          3339     SETB FLAGS2 . 1 
                      3340     	; Read RC signal level
                      3341     	READ_RCP_INT			
0573    E580          3341+1   MOV A , P0 
0575    307601        3341+1   JNB FLAGS3 . 6 , ( $+4 )  ; IS PWM POLARITY NEGATIVE?
0578    F4            3341+1   CPL A  ; YES - INVERT
                      3342     	; Test RC signal level
0579    20E502        3343     JB ACC . 5 , ( $+5 ) 
057C    A185          3344     	AJMP	PCA_INT_FAIL_MINIMUM		; No - jump to fail minimum
                      3345     
                      3346     	; RC pulse was high, store RC pulse start timestamp
057E    8826          3347     MOV RCP_PREV_EDGE_L , R0 
0580    8927          3348     MOV RCP_PREV_EDGE_H , R1 
0582    0207D1        3349     	LJMP	PCA_INT_EXIT				; Exit
                      3350     
                      3351     PCA_INT_FAIL_MINIMUM: 
                      3352     	; Prepare for next interrupt
                      3353     	RCP_INT_FIRST					; Set interrupt trig to first again
0585    53DACF        3353+1   ANL PCA0CPM0 , # 0CFH 
0588    207603        3353+1   JB FLAGS3 . 6 , ( $+6 )  ; IS PWM POLARITY POSITIVE?
058B    43DA20        3353+1   ORL PCA0CPM0 , # 20H  ; CAPTURE RISING EDGE
058E    307603        3353+1   JNB FLAGS3 . 6 , ( $+6 )  ; IS PWM POLARITY NEGATIVE?
0591    43DA10        3353+1   ORL PCA0CPM0 , # 10H  ; CAPTURE FALLING EDGE
                      3354     	RCP_CLEAR_INT_FLAG 				; Clear interrupt flag
0594    C2D8          3354+1   CLR CCF0  ; CLEAR INTERRUPT FLAG
0596    C269          3355     CLR FLAGS2 . 1 
0598    741F          3356     	MOV	A, #((1 SHL RCP_PWM_FREQ_1KHZ)+(1 SHL RCP_PWM_FREQ_2KHZ)+(1 SHL RCP_PWM_FREQ_4KHZ)+(1 SHL RCP_PWM_FREQ_8KHZ)+(1 SHL RCP_PWM_FREQ_12KHZ))
059A    552E          3357     	ANL	A, FLAGS3					; Check pwm frequency flags
059C    7002          3358     	JNZ	($+4)					; If a flag is set (PWM) - proceed
                      3359     
059E    E1B7          3360     	AJMP	PCA_INT_SET_TIMEOUT			; If PPM - ignore trig as noise
                      3361     
05A0    7800          3362     MOV R0 , # 0 
                      3363     	READ_RCP_INT 					; Test RC signal level again
05A2    E580          3363+1   MOV A , P0 
05A4    307601        3363+1   JNB FLAGS3 . 6 , ( $+4 )  ; IS PWM POLARITY NEGATIVE?
05A7    F4            3363+1   CPL A  ; YES - INVERT
05A8    30E502        3364     JNB ACC . 5 , ( $+5 ) 
05AB    E1B7          3365     	AJMP	PCA_INT_SET_TIMEOUT			; Yes - set new timeout and exit
                      3366     
                      3367     ; **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** ****
                      3368     ; 
                      3369     ;  RCP 
                      3370     ; 1  1500us 
                      3371     ; 2  1500us 
                      3372     ; 
                      3373     ;	clr C
                      3374     ;	mov A, Temp1
                      3375     ;	subb A, #80h
                      3376     ;	jnc skypup_02
                      3377     ;	mov	Temp1, #RCP_MIN
                      3378     ; skypup_02:
                      3379     ; **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** ****
                      3380     
05AD    8859          3381     MOV NEW_RCP , R0 
05AF    E186          3382     	AJMP	PCA_INT_LIMITED			; Set new RC pulse, new timeout and exit
                      3383     
                      3384     PCA_INT_SECOND_MEAS_PWM_FREQ: 
                      3385     	; Prepare for next interrupt
                      3386     	RCP_INT_FIRST 					; Set first edge trig
05B1    53DACF        3386+1   ANL PCA0CPM0 , # 0CFH 
05B4    207603        3386+1   JB FLAGS3 . 6 , ( $+6 )  ; IS PWM POLARITY POSITIVE?
05B7    43DA20        3386+1   ORL PCA0CPM0 , # 20H  ; CAPTURE RISING EDGE
05BA    307603        3386+1   JNB FLAGS3 . 6 , ( $+6 )  ; IS PWM POLARITY NEGATIVE?
05BD    43DA10        3386+1   ORL PCA0CPM0 , # 10H  ; CAPTURE FALLING EDGE
05C0    C269          3387     CLR FLAGS2 . 1 
                      3388     	; Check if pwm frequency shall be measured
05C2    205902        3389     JB FLAGS0 . 1 , ( $+5 ) 
05C5    C16B          3390     	AJMP	PCA_INT_FALL				; No - skip measurements
                      3391     
                      3392     	; Set second edge trig only during pwm frequency measurement
                      3393     	RCP_INT_SECOND 				; Set second edge trig
05C7    53DACF        3393+1   ANL PCA0CPM0 , # 0CFH 
05CA    207603        3393+1   JB FLAGS3 . 6 , ( $+6 )  ; IS PWM POLARITY POSITIVE?
05CD    43DA10        3393+1   ORL PCA0CPM0 , # 10H  ; CAPTURE FALLING EDGE
05D0    307603        3393+1   JNB FLAGS3 . 6 , ( $+6 )  ; IS PWM POLARITY NEGATIVE?
05D3    43DA20        3393+1   ORL PCA0CPM0 , # 20H  ; CAPTURE RISING EDGE
                      3394     	RCP_CLEAR_INT_FLAG 				; Clear interrupt flag
05D6    C2D8          3394+1   CLR CCF0  ; CLEAR INTERRUPT FLAG
05D8    D269          3395     SETB FLAGS2 . 1 
                      3396     	; Store edge data to RAM
05DA    8854          3397     MOV RCP_EDGE_L , R0 
05DC    8955          3398     MOV RCP_EDGE_H , R1 
                      3399     	; Calculate pwm frequency
05DE    C3            3400     	CLR	C
05DF    E8            3401     MOV A , R0 
05E0    9552          3402     	SUBB	A, RCP_PREPREV_EDGE_L	
05E2    F8            3403     MOV R0 , A 
05E3    E9            3404     MOV A , R1 
05E4    9553          3405     	SUBB	A, RCP_PREPREV_EDGE_H
05E6    F9            3406     MOV R1 , A 
05E7    E4            3407     	CLR	A
05E8    FB            3408     MOV R3 , A 
05E9    7AFA          3409     MOV R2 , # 250 
                      3410     	; Check if pwm frequency is 12kHz
05EB    C3            3411     	CLR	C
05EC    E8            3412     MOV A , R0 
05ED    94C8          3413     	SUBB	A, #LOW(200)				; If below 100us, 12kHz pwm is assumed
05EF    E9            3414     MOV A , R1 
05F0    9400          3415     	SUBB	A, #HIGH(200)
05F2    5008          3416     	JNC	PCA_INT_CHECK_8KHZ
                      3417     
05F4    E4            3418     	CLR	A
05F5    D2E4          3419     SETB ACC . 4 
05F7    FB            3420     MOV R3 , A 
05F8    7A0A          3421     MOV R2 , # 10 
05FA    C13E          3422     	AJMP	PCA_INT_RESTORE_EDGE
                      3423     
                      3424     PCA_INT_CHECK_8KHZ: 
                      3425     	; Check if pwm frequency is 8kHz
05FC    C3            3426     	CLR	C
05FD    E8            3427     MOV A , R0 
05FE    9468          3428     	SUBB	A, #LOW(360)				; If below 180us, 8kHz pwm is assumed
0600    E9            3429     MOV A , R1 
0601    9401          3430     	SUBB	A, #HIGH(360)
0603    5008          3431     	JNC	PCA_INT_CHECK_4KHZ
                      3432     
0605    E4            3433     	CLR	A
0606    D2E3          3434     SETB ACC . 3 
0608    FB            3435     MOV R3 , A 
0609    7A0F          3436     MOV R2 , # 15 
060B    C13E          3437     	AJMP	PCA_INT_RESTORE_EDGE
                      3438     
                      3439     PCA_INT_CHECK_4KHZ: 
                      3440     	; Check if pwm frequency is 4kHz
060D    C3            3441     	CLR	C
060E    E8            3442     MOV A , R0 
060F    94D0          3443     	SUBB	A, #LOW(720)				; If below 360us, 4kHz pwm is assumed
0611    E9            3444     MOV A , R1 
0612    9402          3445     	SUBB	A, #HIGH(720)
0614    5008          3446     	JNC	PCA_INT_CHECK_2KHZ
                      3447     
0616    E4            3448     	CLR	A
0617    D2E2          3449     SETB ACC . 2 
0619    FB            3450     MOV R3 , A 
061A    7A1E          3451     MOV R2 , # 30 
061C    C13E          3452     	AJMP	PCA_INT_RESTORE_EDGE
                      3453     
                      3454     PCA_INT_CHECK_2KHZ: 
                      3455     	; Check if pwm frequency is 2kHz
061E    C3            3456     	CLR	C
061F    E8            3457     MOV A , R0 
0620    94A0          3458     	SUBB	A, #LOW(1440)				; If below 720us, 2kHz pwm is assumed
0622    E9            3459     MOV A , R1 
0623    9405          3460     	SUBB	A, #HIGH(1440)
0625    5008          3461     	JNC	PCA_INT_CHECK_1KHZ
                      3462     
0627    E4            3463     	CLR	A
0628    D2E1          3464     SETB ACC . 1 
062A    FB            3465     MOV R3 , A 
062B    7A3C          3466     MOV R2 , # 60 
062D    C13E          3467     	AJMP	PCA_INT_RESTORE_EDGE
                      3468     
                      3469     PCA_INT_CHECK_1KHZ: 
                      3470     	; Check if pwm frequency is 1kHz
062F    C3            3471     	CLR	C
0630    E8            3472     MOV A , R0 
0631    9498          3473     	SUBB	A, #LOW(2200)				; If below 1100us, 1kHz pwm is assumed
0633    E9            3474     MOV A , R1 
0634    9408          3475     	SUBB	A, #HIGH(2200)
0636    5006          3476     	JNC	PCA_INT_RESTORE_EDGE
                      3477     
0638    E4            3478     	CLR	A
0639    D2E0          3479     SETB ACC . 0 
063B    FB            3480     MOV R3 , A 
063C    7A78          3481     MOV R2 , # 120 
                      3482     
                      3483     PCA_INT_RESTORE_EDGE: 
                      3484     	; Calculate difference between this period and previous period
063E    C3            3485     	CLR	C
063F    E8            3486     MOV A , R0 
0640    9556          3487     	SUBB	A, RCP_PREV_PERIOD_L
0642    FC            3488     MOV R4 , A 
0643    E9            3489     MOV A , R1 
0644    9557          3490     	SUBB	A, RCP_PREV_PERIOD_H
0646    FD            3491     MOV R5 , A 
                      3492     	; Make positive
0647    30E708        3493     	JNB	ACC.7, PCA_INT_CHECK_DIFF
064A    EC            3494     MOV A , R4 
064B    F4            3495     	CPL	A
064C    2401          3496     	ADD	A, #1
064E    FC            3497     MOV R4 , A 
064F    ED            3498     MOV A , R5 
0650    F4            3499     	CPL	A
0651    FD            3500     MOV R5 , A 
                      3501     
                      3502     PCA_INT_CHECK_DIFF: 
                      3503     	; Check difference
0652    755800        3504     	MOV	RCP_PERIOD_DIFF_ACCEPTED, #0		; Set not accepted as default
0655    7008          3505     	JNZ	PCA_INT_STORE_DATA				; Check if high byte is zero
                      3506     
0657    C3            3507     	CLR	C
0658    EC            3508     MOV A , R4 
0659    9A            3509     SUBB A , R2 
065A    5003          3510     	JNC	PCA_INT_STORE_DATA
                      3511     
065C    755801        3512     	MOV	RCP_PERIOD_DIFF_ACCEPTED, #1		; Set accepted
                      3513     
                      3514     PCA_INT_STORE_DATA: 
                      3515     	; Store previous period
065F    8856          3516     MOV RCP_PREV_PERIOD_L , R0 
0661    8957          3517     MOV RCP_PREV_PERIOD_H , R1 
                      3518     	; Restore edge data from RAM
0663    A854          3519     MOV R0 , RCP_EDGE_L 
0665    A955          3520     MOV R1 , RCP_EDGE_H 
                      3521     	; Store pre previous edge
0667    8852          3522     MOV RCP_PREPREV_EDGE_L , R0 
0669    8953          3523     MOV RCP_PREPREV_EDGE_H , R1 
                      3524     
                      3525     PCA_INT_FALL: 
                      3526     	; RC pulse edge was second, calculate new pulse length
066B    C3            3527     	CLR	C
066C    E8            3528     MOV A , R0 
066D    9526          3529     	SUBB	A, RCP_PREV_EDGE_L	
066F    F8            3530     MOV R0 , A 
0670    E9            3531     MOV A , R1 
0671    9527          3532     	SUBB	A, RCP_PREV_EDGE_H
0673    F9            3533     MOV R1 , A 
0674    307402        3534     JNB FLAGS3 . 4 , ( $+5 ) 
0677    E16A          3535     	AJMP	PCA_INT_PWM_DIVIDE_DONE			; Yes - branch forward
0679    307302        3536     JNB FLAGS3 . 3 , ( $+5 ) 
067C    E16A          3537     	AJMP	PCA_INT_PWM_DIVIDE_DONE			; Yes - branch forward
                      3538     
067E    307202        3539     JNB FLAGS3 . 2 , ( $+5 ) 
0681    E163          3540     	AJMP	PCA_INT_PWM_DIVIDE				; Yes - branch forward
                      3541     
0683    E9            3542     MOV A , R1 
0684    C3            3543     	CLR	C
0685    13            3544     	RRC	A
0686    F9            3545     MOV R1 , A 
0687    E8            3546     MOV A , R0 
0688    13            3547     	RRC	A
0689    F8            3548     MOV R0 , A 
                      3549     
068A    307102        3550     JNB FLAGS3 . 1 , ( $+5 ) 
068D    E163          3551     	AJMP	PCA_INT_PWM_DIVIDE				; Yes - branch forward
                      3552     
068F    E9            3553     MOV A , R1 
0690    C3            3554     	CLR	C
0691    13            3555     	RRC	A
0692    F9            3556     MOV R1 , A 
0693    E8            3557     MOV A , R0 
0694    13            3558     	RRC	A
0695    F8            3559     MOV R0 , A 
                      3560     
0696    307002        3561     JNB FLAGS3 . 0 , ( $+5 ) 
0699    E163          3562     	AJMP	PCA_INT_PWM_DIVIDE				; Yes - branch forward
                      3563     
069B    E9            3564     MOV A , R1 
069C    C3            3565     	CLR	C
069D    13            3566     	RRC	A
069E    FD            3567     MOV R5 , A 
069F    E8            3568     MOV A , R0 
06A0    13            3569     	RRC	A
06A1    FC            3570     MOV R4 , A 
                      3571     	; Skip range limitation if pwm frequency measurement
06A2    205918        3572     JB FLAGS0 . 1 , PCA_INT_PPM_CHECK_FULL_RANGE 
                      3573     
                      3574     	; Check if 2160us or above (in order to ignore false pulses)
06A5    C3            3575     	CLR	C
06A6    EC            3576     MOV A , R4 
06A7    941C          3577     	SUBB	A, #28
06A9    ED            3578     MOV A , R5 
06AA    9402          3579     	SUBB A, #2
06AC    4003          3580     	JC	($+5)						; No - proceed
                      3581     
06AE    0207B7        3582     	LJMP	PCA_INT_SET_TIMEOUT				; Yes - ignore pulse
                      3583     
                      3584     	; Check if below 800us (in order to ignore false pulses)
06B1    ED            3585     MOV A , R5 
06B2    7009          3586     	JNZ	PCA_INT_PPM_CHECK_FULL_RANGE
                      3587     
06B4    C3            3588     	CLR	C
06B5    EC            3589     MOV A , R4 
06B6    94C8          3590     	SUBB	A, #200
06B8    5003          3591     	JNC	PCA_INT_PPM_CHECK_FULL_RANGE		; No - proceed
                      3592     
06BA    0207B7        3593     	JMP	PCA_INT_SET_TIMEOUT				; Yes - ignore pulse
                      3594     
                      3595     PCA_INT_PPM_CHECK_FULL_RANGE: 
                      3596     	; Calculate "1000us" plus throttle minimum
06BD    7400          3597     	MOV	A, #0						; Set 1000us as default minimum
06BF    20770B        3598     JB FLAGS3 . 7 , PCA_INT_PPM_CALCULATE 
                      3599     
                      3600     IF MODE >= 1	; Tail or multi
06C2    7888          3601     MOV R0 , # PGM_DIRECTION 
06C4    E6            3602     MOV A , @ R0 
                      3603     ENDIF
06C5    7896          3604     MOV R0 , # PGM_PPM_MIN_THROTTLE 
                      3605     IF MODE >= 1	; Tail or multi
06C7    B40302        3606     	CJNE	A, #3, ($+5)
                      3607     
06CA    789E          3608     MOV R0 , # PGM_PPM_CENTER_THROTTLE 
                      3609     ENDIF
06CC    E6            3610     MOV A , @ R0 
                      3611     
                      3612     PCA_INT_PPM_CALCULATE: 
06CD    24FA          3613     	ADD	A, #250						; Add 1000us to minimum
06CF    FE            3614     MOV R6 , A 
06D0    E4            3615     	CLR	A
06D1    3400          3616     	ADDC	A, #0
06D3    FF            3617     MOV R7 , A 
                      3618     
06D4    C3            3619     	CLR	C
06D5    EC            3620     MOV A , R4 
06D6    9E            3621     SUBB A , R6 
06D7    FC            3622     MOV R4 , A 
06D8    ED            3623     MOV A , R5 
06D9    9F            3624     SUBB A , R7 
06DA    FD            3625     MOV R5 , A 
                      3626     IF MODE >= 1	; Tail or multi
06DB    9208          3627     	MOV	BIT_ACCESS_INT.0, C
06DD    7888          3628     MOV R0 , # PGM_DIRECTION 
06DF    E6            3629     MOV A , @ R0 
06E0    B40322        3630     	CJNE	A, #3, PCA_INT_PPM_BIDIR_DIR_SET	; No - branch
                      3631     
06E3    A208          3632     	MOV	C, BIT_ACCESS_INT.0
06E5    5009          3633     	JNC	PCA_INT_PPM_BIDIR_FWD			; If result is positive - branch				
                      3634     
                      3635     PCA_INT_PPM_BIDIR_REV: 
06E7    20751B        3636     JB FLAGS3 . 5 , PCA_INT_PPM_BIDIR_DIR_SET 
                      3637     
06EA    C2AF          3638     	CLR	EA							; Direction change, turn off all fets
06EC    D275          3639     SETB FLAGS3 . 5 
06EE    C1F7          3640     	AJMP	PCA_INT_PPM_BIDIR_DIR_CHANGE
                      3641     
                      3642     PCA_INT_PPM_BIDIR_FWD: 
06F0    307512        3643     JNB FLAGS3 . 5 , PCA_INT_PPM_BIDIR_DIR_SET 
                      3644     
06F3    C2AF          3645     	CLR	EA							; Direction change, turn off all fets
06F5    C275          3646     CLR FLAGS3 . 5 
                      3647     
                      3648     PCA_INT_PPM_BIDIR_DIR_CHANGE: 
                      3649     	ALL_NFETS_OFF
06F7    C292          3649+1   CLR P1 . 2 
06F9    C296          3649+1   CLR P1 . 6 
06FB    C295          3649+1   CLR P1 . 5 
                      3650     	ALL_PFETS_OFF
06FD    C293          3650+1   CLR P1 . 3 
06FF    C297          3650+1   CLR P1 . 7 
0701    C294          3650+1   CLR P1 . 4 
0703    D2AF          3651     	SETB	EA
                      3652     
                      3653     PCA_INT_PPM_BIDIR_DIR_SET: 
0705    A208          3654     	MOV	C, BIT_ACCESS_INT.0
                      3655     ENDIF
0707    5017          3656     	JNC	PCA_INT_PPM_NEG_CHECKED			; If result is positive - branch
                      3657     
                      3658     IF MODE >= 1	; Tail or multi
0709    E6            3659     MOV A , @ R0 
070A    B4030D        3660     	CJNE	A, #3, PCA_INT_PPM_UNIDIR_NEG 	; No - branch
                      3661     
070D    EC            3662     MOV A , R4 
070E    F4            3663     	CPL	A
070F    2401          3664     	ADD	A, #1
0711    FC            3665     MOV R4 , A 
0712    ED            3666     MOV A , R5 
0713    F4            3667     	CPL	A
0714    3400          3668     	ADDC	A, #0
0716    FD            3669     MOV R5 , A 
0717    020720        3670     	JMP	PCA_INT_PPM_NEG_CHECKED
                      3671     
                      3672     PCA_INT_PPM_UNIDIR_NEG: 
                      3673     ENDIF
071A    7800          3674     MOV R0 , # 0 
071C    7900          3675     MOV R1 , # 0 
071E    E16A          3676     	AJMP	PCA_INT_PWM_DIVIDE_DONE
                      3677     
                      3678     PCA_INT_PPM_NEG_CHECKED: 
                      3679     IF MODE >= 1	; Tail or multi
0720    7888          3680     MOV R0 , # PGM_DIRECTION 
0722    E6            3681     MOV A , @ R0 
0723    B40315        3682     	CJNE	A, #3, PCA_INT_PPM_BIDIR_DONE		; No - branch
                      3683     
0726    EC            3684     MOV A , R4 
0727    33            3685     	RLC	A
0728    FC            3686     MOV R4 A 
0729    ED            3687     MOV A , R5 
072A    33            3688     	RLC	A
072B    FD            3689     MOV R5 A 
072C    C3            3690     	CLR	C							; Subtract deadband
072D    EC            3691     MOV A , R4 
072E    9405          3692     	SUBB	A, #5		
0730    FC            3693     MOV R4 , A 
0731    ED            3694     MOV A , R5 
0732    9400          3695     	SUBB	A, #0
0734    FD            3696     MOV R5 , A 
0735    5004          3697     	JNC	PCA_INT_PPM_BIDIR_DONE
                      3698     
0737    7C00          3699     MOV R4 , # 0 
0739    7D00          3700     MOV R5 , # 0 
                      3701     
                      3702     PCA_INT_PPM_BIDIR_DONE: 
                      3703     ENDIF
073B    C3            3704     	CLR	C							; Check that RC pulse is within legal range (max 255)
073C    EC            3705     MOV A , R4 
073D    94FF          3706     SUBB A , # 255 
073F    ED            3707     MOV A , R5 
0740    9400          3708     	SUBB	A, #0
0742    4006          3709     	JC	PCA_INT_PPM_MAX_CHECKED
                      3710     
0744    78FF          3711     MOV R0 , # 255 
0746    7900          3712     MOV R1 , # 0 
0748    E16A          3713     	AJMP	PCA_INT_PWM_DIVIDE_DONE
                      3714     
                      3715     PCA_INT_PPM_MAX_CHECKED: 
074A    EC            3716     MOV A , R4 
074B    856EF0        3717     	MOV	B, PPM_THROTTLE_GAIN
074E    A4            3718     	MUL	AB
074F    C5F0          3719     	XCH	A, B
0751    A2F7          3720     	MOV	C, B.7						; Multiply result by 2 (unity gain is 128)
0753    33            3721     	RLC	A
0754    F8            3722     MOV R0 , A 
0755    7900          3723     MOV R1 , # 0 
0757    4003          3724     	JC	PCA_INT_PPM_LIMIT_AFTER_MULT
                      3725     	
0759    020786        3726     	JMP	PCA_INT_LIMITED			
                      3727     
                      3728     PCA_INT_PPM_LIMIT_AFTER_MULT: 
075C    78FF          3729     MOV R0 , # 255 
075E    7900          3730     MOV R1 , # 0 
0760    020786        3731     	JMP	PCA_INT_LIMITED			
                      3732     
                      3733     PCA_INT_PWM_DIVIDE: 
0763    E9            3734     MOV A , R1 
0764    C3            3735     	CLR	C
0765    13            3736     	RRC	A
0766    F9            3737     MOV R1 , A 
0767    E8            3738     MOV A , R0 
0768    13            3739     	RRC	A
0769    F8            3740     MOV R0 , A 
                      3741     
                      3742     PCA_INT_PWM_DIVIDE_DONE: 
076A    30740E        3743     JNB FLAGS3 . 4 , PCA_INT_CHECK_LEGAL_RANGE 
076D    E9            3744     MOV A , R1 
076E    6002          3745     	JZ	($+4)
                      3746     
0770    78FF          3747     MOV R0 , # 255 
                      3748     
0772    C3            3749     	CLR	C
0773    E8            3750     MOV A , R0 
0774    13            3751     	RRC	A
0775    38            3752     ADDC A , R0 
0776    F8            3753     MOV R0 , A 
0777    E4            3754     	CLR	A
0778    3400          3755     	ADDC	A, #0
077A    F9            3756     MOV R1 , A 
                      3757     
                      3758     PCA_INT_CHECK_LEGAL_RANGE: 
                      3759     	; Check that RC pulse is within legal range
077B    C3            3760     	CLR	C
077C    E8            3761     MOV A , R0 
077D    94FF          3762     SUBB A , # 255 
077F    E9            3763     MOV A , R1 
0780    9400          3764     	SUBB	A, #0
0782    4002          3765     	JC	PCA_INT_LIMITED
                      3766     
0784    78FF          3767     MOV R0 , # 255 
                      3768     
                      3769     PCA_INT_LIMITED: 
                      3770     ; **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** ****
                      3771     ; 
                      3772     ;  RCP 
                      3773     ; 1  1500us 
                      3774     ; 2  1500us 
                      3775     ; 
0786    C3            3776     	CLR C
0787    E8            3777     MOV A , R0 
0788    94A0          3778     SUBB A , # 160 
078A    5002          3779     	JNC SKYPUP_03					; No 
078C    7800          3780     MOV R0 , # 0 
                      3781     SKYPUP_03: 
                      3782     
078E    C3            3783     	CLR C
078F    E8            3784     MOV A , R0 
0790    9573          3785     	SUBB A, PREV_RCP				;  Rcp >  Rcp ?
0792    400E          3786     	JC SKYPUP_04					; No
                      3787     
0794    9402          3788     SUBB A , # 2 
0796    400A          3789     	JC SKYPUP_04					; No
                      3790     
0798    C3            3791     	CLR C						; ? Skypup 2015.05.25
0799    E573          3792     	MOV A, PREV_RCP
079B    2402          3793     ADD A , # 2 
079D    F8            3794     MOV R0 , A 
079E    5002          3795     	JNC SKYPUP_04					; 
                      3796     
07A0    78FF          3797     MOV R0 , # 0FFH 
                      3798     	
                      3799     SKYPUP_04: 
07A2    E559          3800     	MOV A, NEW_RCP
07A4    F573          3801     	MOV PREV_RCP, A
                      3802     
                      3803     ; **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** **** ****
                      3804     	; RC pulse value accepted
07A6    8859          3805     MOV NEW_RCP , R0 
07A8    D268          3806     SETB FLAGS2 . 0 
07AA    205902        3807     JB FLAGS0 . 1 , ( $+5 ) 
07AD    E1B7          3808     	AJMP	PCA_INT_SET_TIMEOUT			; No - skip measurements
                      3809     
07AF    741F          3810     	MOV	A, #((1 SHL RCP_PWM_FREQ_1KHZ)+(1 SHL RCP_PWM_FREQ_2KHZ)+(1 SHL RCP_PWM_FREQ_4KHZ)+(1 SHL RCP_PWM_FREQ_8KHZ)+(1 SHL RCP_PWM_FREQ_12KHZ))
07B1    F4            3811     	CPL	A
07B2    552E          3812     	ANL	A, FLAGS3					; Clear all pwm frequency flags
07B4    4B            3813     ORL A , R3 
07B5    F52E          3814     	MOV	FLAGS3, A
                      3815     
                      3816     PCA_INT_SET_TIMEOUT: 
07B7    752818        3817     MOV RCP_TIMEOUT_CNT , # 24 
07BA    741F          3818     	MOV	A, #((1 SHL RCP_PWM_FREQ_1KHZ)+(1 SHL RCP_PWM_FREQ_2KHZ)+(1 SHL RCP_PWM_FREQ_4KHZ)+(1 SHL RCP_PWM_FREQ_8KHZ)+(1 SHL RCP_PWM_FREQ_12KHZ))
07BC    552E          3819     	ANL	A, FLAGS3					; Check pwm frequency flags
07BE    7003          3820     	JNZ	PCA_INT_PPM_TIMEOUT_SET		; If a flag is set - branch
                      3821     
07C0    75280A        3822     MOV RCP_TIMEOUT_CNT , # 10 
                      3823     
                      3824     PCA_INT_PPM_TIMEOUT_SET: 
07C3    305902        3825     JNB FLAGS0 . 1 , ( $+5 ) 
07C6    E1D1          3826     	AJMP PCA_INT_EXIT				; Yes - exit
                      3827     
07C8    741F          3828     	MOV	A, #((1 SHL RCP_PWM_FREQ_1KHZ)+(1 SHL RCP_PWM_FREQ_2KHZ)+(1 SHL RCP_PWM_FREQ_4KHZ)+(1 SHL RCP_PWM_FREQ_8KHZ)+(1 SHL RCP_PWM_FREQ_12KHZ))
07CA    552E          3829     	ANL	A, FLAGS3					; Check pwm frequency flags
07CC    6003          3830     	JZ	PCA_INT_EXIT				; If no flag is set (PPM) - branch
                      3831     
                      3832     	RCP_INT_DISABLE 				; Disable RC pulse interrupt
07CE    53DAFE        3832+1   ANL PCA0CPM0 , # 0FEH  ; INTERRUPT DISABLED
                      3833     
                      3834     PCA_INT_EXIT: 	; Exit interrupt routine	
07D1    752906        3835     MOV RCP_SKIP_CNT , # 6 
07D4    741F          3836     	MOV	A, #((1 SHL RCP_PWM_FREQ_1KHZ)+(1 SHL RCP_PWM_FREQ_2KHZ)+(1 SHL RCP_PWM_FREQ_4KHZ)+(1 SHL RCP_PWM_FREQ_8KHZ)+(1 SHL RCP_PWM_FREQ_12KHZ))
07D6    552E          3837     	ANL	A, FLAGS3					; Check pwm frequency flags
07D8    7003          3838     	JNZ	($+5)					; If a flag is set (PWM) - branch
                      3839     
07DA    75290A        3840     	MOV	RCP_SKIP_CNT, #10			; Load number of skips
                      3841     
07DD    D0F0          3842     	POP	B			; Restore preserved registers
07DF    D0E0          3843     	POP	ACC			
07E1    D0D0          3844     	POP	PSW
07E3    C2D3          3845     	CLR	PSW.3		; Select register bank 0 for main program routines	
07E5    D2AD          3846     	SETB	ET2			; Enable timer2 interrupts
07E7    43E610        3847     	ORL	EIE1, #10H	; Enable PCA0 interrupts
07EA    32            3848     	RETI
                      3849     
                      3850     
                      3851     
                      3852     
                      3853     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      3854     ;
                      3855     ; Wait xms ~(x*4*250)  (Different entry points)	
                      3856     ;
                      3857     ; No assumptions
                      3858     ;
                      3859     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      3860     WAIT1MS: 	
07EB    7901          3861     MOV R1 , # 1 
07ED    020809        3862     	JMP	WAITXMS_O
                      3863     
                      3864     WAIT3MS: 	
07F0    7903          3865     MOV R1 , # 3 
07F2    020809        3866     	JMP	WAITXMS_O
                      3867     
                      3868     WAIT10MS: 	
07F5    790A          3869     MOV R1 , # 10 
07F7    020809        3870     	JMP	WAITXMS_O
                      3871     
                      3872     WAIT30MS: 	
07FA    791E          3873     MOV R1 , # 30 
07FC    020809        3874     	JMP	WAITXMS_O
                      3875     
                      3876     WAIT100MS: 	
07FF    7964          3877     MOV R1 , # 100 
0801    020809        3878     	JMP	WAITXMS_O
                      3879     
                      3880     WAIT200MS: 	
0804    79C8          3881     MOV R1 , # 200 
0806    020809        3882     	JMP	WAITXMS_O
                      3883     
                      3884     WAITXMS_O: 	; Outer loop
0809    7817          3885     MOV R0 , # 23 
                      3886     WAITXMS_M: 	; Middle loop
080B    E4            3887     	CLR	A
080C    D5E0FD        3888      	DJNZ	ACC, $	; Inner loop (42.7us - 1024 cycles)
080F    D8FA          3889     DJNZ R0 , WAITXMS_M 
0811    D9F6          3890     DJNZ R1 , WAITXMS_O 
0813    22            3891     	RET
                      3892     
                      3893     
                      3894     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      3895     ;
                      3896     ; Beeper routines (4 different entry points) 
                      3897     ;
                      3898     ; No assumptions
                      3899     ;
                      3900     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      3901     BEEP_F1: 	; Entry point 1, load beeper frequency 1 settings
0814    7A14          3902     MOV R2 , # 20 
0816    7B78          3903     MOV R3 , # 120 
0818    020830        3904     	JMP	BEEP
                      3905     
                      3906     BEEP_F2: 	; Entry point 2, load beeper frequency 2 settings
081B    7A10          3907     MOV R2 , # 16 
081D    7B8C          3908     MOV R3 , # 140 
081F    020830        3909     	JMP	BEEP
                      3910     
                      3911     BEEP_F3: 	; Entry point 3, load beeper frequency 3 settings
0822    7A0D          3912     MOV R2 , # 13 
0824    7BB4          3913     MOV R3 , # 180 
0826    020830        3914     	JMP	BEEP
                      3915     
                      3916     BEEP_F4: 	; Entry point 4, load beeper frequency 4 settings
0829    7A0B          3917     MOV R2 , # 11 
082B    7BC8          3918     MOV R3 , # 200 
082D    020830        3919     	JMP	BEEP
                      3920     
                      3921     BEEP: 	; Beep loop start
0830    AC25          3922     MOV R4 , CURRENT_PWM_LIMITED 
0832    752501        3923     	MOV	CURRENT_PWM_LIMITED, #1		; Set to a nonzero value
0835    7902          3924     MOV R1 , # 2 
                      3925     BEEP_ONOFF: 
0837    B275          3926     CPL FLAGS3 . 5 
0839    E4            3927     	CLR	A
                      3928     	BPFET_OFF			; BpFET off
083A    C294          3928+1   CLR P1 . 4 
083C    D5E0FD        3929     	DJNZ	ACC, $		; Allow some time after pfet is turned off
                      3930     	BNFET_ON			; BnFET on (in order to charge the driver of the BpFET)
083F    E525          3930+1   MOV A , CURRENT_PWM_LIMITED 
0841    6002          3930+1   JZ ( $+4 ) 
0843    D295          3930+1   SETB P1 . 5 
0845    D5E0FD        3931     	DJNZ	ACC, $		; Let the nfet be turned on a while
                      3932     	BNFET_OFF			; BnFET off again
0848    C295          3932+1   CLR P1 . 5 
084A    D5E0FD        3933     	DJNZ	ACC, $		; Allow some time after nfet is turned off
                      3934     	BPFET_ON			; BpFET on
084D    D294          3934+1   SETB P1 . 4 
084F    D5E0FD        3935     	DJNZ	ACC, $		; Allow some time after pfet is turned on
                      3936     	; Turn on nfet
                      3937     	ANFET_ON			; AnFET on
0852    E525          3937+1   MOV A , CURRENT_PWM_LIMITED 
0854    600A          3937+1   JZ ( $+12 ) 
0856    207502        3937+1   JB FLAGS3 . 5 , ( $+5 ) 
0859    D292          3937+1   SETB P1 . 2 
085B    307502        3937+1   JNB FLAGS3 . 5 , ( $+5 ) 
085E    D296          3937+1   SETB P1 . 6 
0860    E56F          3938     	MOV	A, BEEP_STRENGTH
0862    D5E0FD        3939     	DJNZ	ACC, $		
                      3940     	; Turn off nfet
                      3941     	ANFET_OFF			; AnFET off
0865    207502        3941+1   JB FLAGS3 . 5 , ( $+5 ) 
0868    C292          3941+1   CLR P1 . 2 
086A    307502        3941+1   JNB FLAGS3 . 5 , ( $+5 ) 
086D    C296          3941+1   CLR P1 . 6 
086F    7496          3942     	MOV	A, #150		; 25s off
0871    D5E0FD        3943     	DJNZ	ACC, $		
0874    D9C1          3944     DJNZ R1 , BEEP_ONOFF 
                      3945     	; Copy variable
0876    EA            3946     MOV A , R2 
0877    F8            3947     MOV R0 , A 
                      3948     BEEP_OFF: 		; Fets off loop
0878    D5E0FD        3949     	DJNZ	ACC, $
087B    D8FB          3950     DJNZ R0 , BEEP_OFF 
087D    DBB1          3951     DJNZ R3 , BEEP 
                      3952     	BPFET_OFF			; BpFET off
087F    C294          3952+1   CLR P1 . 4 
0881    8C25          3953     MOV CURRENT_PWM_LIMITED , R4 
0883    22            3954     	RET
                      3955     
                      3956     
                      3957     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      3958     ;
                      3959     ; Division 16bit unsigned by 16bit unsigned
                      3960     ;
                      3961     ; Dividend shall be in Temp2/Temp1, divisor in Temp4/Temp3
                      3962     ; Result will be in Temp2/Temp1
                      3963     ;
                      3964     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      3965     DIV_U16_BY_U16: 	
0884    C3            3966     	CLR	C       
0885    7C00          3967     MOV R4 , # 0 
0887    7D00          3968     MOV R5 , # 0 
0889    75F000        3969     	MOV	B, #0
                      3970     DIV_U16_BY_U16_DIV1: 
088C    05F0          3971     	INC	B      			; Increment counter for each left shift
088E    EA            3972     MOV A , R2 
088F    33            3973     	RLC	A      		
0890    FA            3974     MOV R2 , A 
0891    EB            3975     MOV A , R3 
0892    33            3976     	RLC	A      	  	
0893    FB            3977     MOV R3 , A 
0894    50F6          3978     	JNC	DIV_U16_BY_U16_DIV1	; Repeat until carry flag is set from high-byte
                      3979     DIV_U16_BY_U16_DIV2:         
0896    EB            3980     MOV A , R3 
0897    13            3981     	RRC	A      
0898    FB            3982     MOV R3 , A 
0899    EA            3983     MOV A , R2 
089A    13            3984     	RRC	A      
089B    FA            3985     MOV R2 , A 
089C    C3            3986     	CLR	C      
089D    E9            3987     MOV A , R1 
089E    FF            3988     MOV R7 , A 
089F    E8            3989     MOV A , R0 
08A0    FE            3990     MOV R6 , A 
08A1    E8            3991     MOV A , R0 
08A2    9A            3992     SUBB A , R2 
08A3    F8            3993     MOV R0 , A 
08A4    E9            3994     MOV A , R1 
08A5    9B            3995     SUBB A , R3 
08A6    F9            3996     MOV R1 , A 
08A7    5004          3997     	JNC	DIV_U16_BY_U16_DIV3	; If carry flag is NOT set, result is 1
08A9    EF            3998     MOV A , R7 
08AA    F9            3999     MOV R1 , A 
08AB    EE            4000     MOV A , R6 
08AC    F8            4001     MOV R0 , A 
                      4002     DIV_U16_BY_U16_DIV3: 
08AD    B3            4003     	CPL	C      			; Invert carry, so it can be directly copied into result
08AE    EC            4004     MOV A , R4 
08AF    33            4005     	RLC	A      			; Shift carry flag into temporary result
08B0    FC            4006     MOV R4 , A 
08B1    ED            4007     MOV A , R5 
08B2    33            4008     	RLC	A
08B3    FD            4009     MOV R5 , A 
08B4    D5F0DF        4010     	DJNZ	B, DIV_U16_BY_U16_DIV2 	;Now count backwards and repeat until "B" is zero
08B7    ED            4011     MOV A , R5 
08B8    F9            4012     MOV R1 , A 
08B9    EC            4013     MOV A , R4 
08BA    F8            4014     MOV R0 , A 
08BB    22            4015     	RET
                      4016     
                      4017     
                      4018     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      4019     ;
                      4020     ; Multiplication 16bit signed by 8bit unsigned
                      4021     ;
                      4022     ; Multiplicand shall be in Temp2/Temp1, multiplicator in Temp3
                      4023     ; Result will be in Temp2/Temp1. Result will divided by 16
                      4024     ;
                      4025     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      4026     MULT_S16_BY_U8_DIV_16: 
08BC    E8            4027     MOV A , R0 
08BD    89F0          4028     MOV B , R1 
08BF    8A20          4029     MOV BIT_ACCESS , R2 
08C1    D2D4          4030     	SETB	PSW.4		; Select register bank 2 for math routines
08C3    F8            4031     MOV R0 , A 
08C4    A9F0          4032     MOV R1 , B 
08C6    7B00          4033     MOV R3 , # 0 
08C8    30F70B        4034     	JNB	B.7, MULT_S16_BY_U8_POSITIVE	
                      4035     
08CB    7BFF          4036     MOV R3 , # 0FFH 
08CD    F4            4037     	CPL	A
08CE    2401          4038     	ADD	A, #1
08D0    F8            4039     MOV R0 , A 
08D1    E9            4040     MOV A , R1 
08D2    F4            4041     	CPL	A
08D3    3400          4042     	ADDC	A, #0
08D5    F9            4043     MOV R1 , A 
                      4044     MULT_S16_BY_U8_POSITIVE: 
08D6    E8            4045     MOV A , R0 
08D7    8520F0        4046     	MOV	B, BIT_ACCESS
08DA    A4            4047     	MUL	AB
08DB    ADF0          4048     MOV R5 , B 
08DD    F8            4049     MOV R0 , A 
08DE    E9            4050     MOV A , R1 
08DF    8520F0        4051     	MOV	B, BIT_ACCESS
08E2    A4            4052     	MUL	AB
08E3    AFF0          4053     MOV R7 , B 
08E5    FE            4054     MOV R6 , A 
08E6    ED            4055     MOV A , R5 
08E7    2E            4056     ADD A , R6 
08E8    F9            4057     MOV R1 , A 
08E9    7400          4058     	MOV	A, #0
08EB    3F            4059     ADDC A , R7 
08EC    FA            4060     MOV R2 , A 
08ED    7C04          4061     MOV R4 , # 4 
                      4062     MULT_S16_BY_U8_DIV_LOOP: 
08EF    C3            4063     	CLR	C			; Rotate right 
08F0    EA            4064     MOV A , R2 
08F1    13            4065     	RRC	A
08F2    FA            4066     MOV R2 , A 
08F3    E9            4067     MOV A , R1 
08F4    13            4068     	RRC	A
08F5    F9            4069     MOV R1 , A 
08F6    E8            4070     MOV A , R0 
08F7    13            4071     	RRC	A
08F8    F8            4072     MOV R0 , A 
08F9    DCF4          4073     DJNZ R4 , MULT_S16_BY_U8_DIV_LOOP 
                      4074     
08FB    8BF0          4075     MOV B , R3 
08FD    30F70A        4076     	JNB	B.7, MULT_S16_BY_U8_EXIT	
                      4077     
0900    E8            4078     MOV A , R0 
0901    F4            4079     	CPL	A
0902    2401          4080     	ADD	A, #1
0904    F8            4081     MOV R0 , A 
0905    E9            4082     MOV A , R1 
0906    F4            4083     	CPL	A
0907    3400          4084     	ADDC	A, #0
0909    F9            4085     MOV R1 , A 
                      4086     
                      4087     MULT_S16_BY_U8_EXIT: 
090A    E8            4088     MOV A , R0 
090B    89F0          4089     MOV B , R1 
090D    C2D4          4090     	CLR	PSW.4		; Select normal register bank
090F    F8            4091     MOV R0 , A 
0910    A9F0          4092     MOV R1 , B 
0912    22            4093     	RET
                      4094     
                      4095     
                      4096     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      4097     ;
                      4098     ; Calculate governor routines
                      4099     ;
                      4100     ; No assumptions
                      4101     ;
                      4102     ; Governs headspeed based upon the Comm_Period4x variable and pwm
                      4103     ; The governor task is split into several routines in order to distribute processing time
                      4104     ;
                      4105     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      4106     ; First governor routine - calculate governor target
                      4107     IF MODE <= 1	; Main or tail
                               CALC_GOVERNOR_TARGET:
                               	MOV	TEMP1, #PGM_GOV_MODE			; Governor mode?
                               	CJNE	@TEMP1, #4, GOVERNOR_SPEED_CHECK	; Yes
                               	JMP	CALC_GOVERNOR_TARGET_EXIT		; No
                               
                               GOVERNOR_SPEED_CHECK:
                               	; Stop governor for stop RC pulse	
                               	CLR	C
                               	MOV	A, NEW_RCP				; Check RC pulse against stop value
                               	SUBB	A, #(RCP_MAX/10)			; Is pulse below stop value?
                               	JC	GOVERNOR_DEACTIVATE			; Yes - deactivate
                               
                               	MOV	A, FLAGS1
                               	ANL	A, #((1 SHL DIRECT_STARTUP_PHASE)+(1 SHL INITIAL_RUN_PHASE))
                               	JNZ	GOVERNOR_DEACTIVATE			; Deactivate if any startup phase set
                               
                               	; Skip speed check if governor is already active
                               	MOV	A, GOV_ACTIVE
                               	JNZ	GOVERNOR_TARGET_CALC
                               
                               	; Check speed (do not run governor for low speeds)
                               	MOV	TEMP1, #05H				; Default high range activation limit value (~62500 eRPM)
                               	MOV	TEMP2, #PGM_GOV_RANGE
                               	MOV	A, @TEMP2					; Check if high range (Temp2 has #Pgm_Gov_Range)
                               	DEC	A
                               	JZ	GOVERNOR_ACT_LIM_SET		; If high range - branch
                               
                               	MOV	TEMP1, #0AH				; Middle range activation limit value (~31250 eRPM)
                               	DEC	A
                               	JZ	GOVERNOR_ACT_LIM_SET		; If middle range - branch
                               	
                               	MOV	TEMP1, #12H				; Low range activation limit value (~17400 eRPM)
                               
                               GOVERNOR_ACT_LIM_SET:
                               	CLR	C
                               	MOV	A, COMM_PERIOD4X_H
                               	SUBB	A, TEMP1
                               	JC	GOVERNOR_ACTIVATE			; If speed above min limit  - run governor
                               
                               GOVERNOR_DEACTIVATE:
                               	MOV	A, GOV_ACTIVE
                               	JZ	GOVERNOR_FIRST_DEACTIVATE_DONE; This code is executed continuously. Only execute the code below the first time
                               
                               	MOV	PWM_LIMIT_SPOOLUP, PWM_SPOOLUP_BEG
                               	MOV	SPOOLUP_LIMIT_CNT, #255
                               	MOV	SPOOLUP_LIMIT_SKIP, #1			
                               
                               GOVERNOR_FIRST_DEACTIVATE_DONE:
                               	MOV	CURRENT_PWM, REQUESTED_PWM	; Set current pwm to requested
                               	CLR	A
                               	MOV	GOV_TARGET_L, A			; Set target to zero
                               	MOV	GOV_TARGET_H, A
                               	MOV	GOV_INTEGRAL_L, A			; Set integral to zero
                               	MOV	GOV_INTEGRAL_H, A
                               	MOV	GOV_INTEGRAL_X, A
                               	MOV	GOV_ACTIVE, A
                               	JMP	CALC_GOVERNOR_TARGET_EXIT
                               
                               GOVERNOR_ACTIVATE:
                               	MOV	GOV_ACTIVE, #1
                               
                               GOVERNOR_TARGET_CALC:
                               	; Governor calculations
                               	MOV	TEMP2, #PGM_GOV_RANGE
                               	MOV	A, @TEMP2				; Check high, middle or low range
                               	DEC	A
                               	JNZ	CALC_GOVERNOR_TARGET_MIDDLE
                               
                               	MOV	A, GOVERNOR_REQ_PWM		; Load governor requested pwm
                               	CPL	A					; Calculate 255-pwm (invert pwm) 
                               	; Calculate comm period target (1 + 2*((255-Requested_Pwm)/256) - 0.25)
                               	RLC	A					; Msb to carry
                               	RLC	A					; To bit0
                               	MOV	TEMP2, A				; Now 1 lsb is valid for H
                               	RRC	A					
                               	MOV	TEMP1, A				; Now 7 msbs are valid for L
                               	MOV	A, TEMP2
                               	ANL	A, #01H				; Calculate H byte
                               	INC	A					; Add 1
                               	MOV	TEMP2, A
                               	MOV	A, TEMP1
                               	ANL	A, #0FEH				; Calculate L byte
                               	JMP	CALC_GOVERNOR_SUBTRACT_025
                               
                               CALC_GOVERNOR_TARGET_MIDDLE:
                               	MOV	A, @TEMP2				; Check middle or low range (Temp2 has #Pgm_Gov_Range)
                               	DEC	A
                               	DEC	A
                               	JNZ	CALC_GOVERNOR_TARGET_LOW
                               
                               	MOV	A, GOVERNOR_REQ_PWM		; Load governor requested pwm
                               	CPL	A					; Calculate 255-pwm (invert pwm) 
                               	; Calculate comm period target (1 + 4*((255-Requested_Pwm)/256))
                               	RLC	A					; Msb to carry
                               	RLC	A					; To bit0
                               	RLC	A					; To bit1
                               	MOV	TEMP2, A				; Now 2 lsbs are valid for H
                               	RRC	A					
                               	MOV	TEMP1, A				; Now 6 msbs are valid for L
                               	MOV	A, TEMP2
                               	ANL	A, #03H				; Calculate H byte
                               	INC	A					; Add 1
                               	MOV	TEMP2, A
                               	MOV	A, TEMP1
                               	ANL	A, #0FCH				; Calculate L byte
                               	JMP	CALC_GOVERNOR_STORE_TARGET
                               
                               CALC_GOVERNOR_TARGET_LOW:
                               	MOV	A, GOVERNOR_REQ_PWM		; Load governor requested pwm
                               	CPL	A					; Calculate 255-pwm (invert pwm) 
                               	; Calculate comm period target (2 + 8*((255-Requested_Pwm)/256) - 0.25)
                               	RLC	A					; Msb to carry
                               	RLC	A					; To bit0
                               	RLC	A					; To bit1
                               	RLC	A					; To bit2
                               	MOV	TEMP2, A				; Now 3 lsbs are valid for H
                               	RRC	A					
                               	MOV	TEMP1, A				; Now 5 msbs are valid for L
                               	MOV	A, TEMP2
                               	ANL	A, #07H				; Calculate H byte
                               	INC	A					; Add 1
                               	INC	A					; Add 1 more
                               	MOV	TEMP2, A
                               	MOV	A, TEMP1
                               	ANL	A, #0F8H				; Calculate L byte
                               CALC_GOVERNOR_SUBTRACT_025:
                               	CLR	C
                               	SUBB	A, #40H				; Subtract 0.25
                               	MOV	TEMP1, A
                               	MOV	A, TEMP2
                               	SUBB	A, #0
                               	MOV	TEMP2, A
                               CALC_GOVERNOR_STORE_TARGET:
                               	; Store governor target
                               	MOV	GOV_TARGET_L, TEMP1
                               	MOV	GOV_TARGET_H, TEMP2
                               CALC_GOVERNOR_TARGET_EXIT:
                               	RET						
                               ENDIF
                      4247     IF MODE == 2	; Multi
                      4248     CALC_GOVERNOR_TARGET: 
0913    7882          4249     MOV R0 , # PGM_GOV_MODE 
0915    B60403        4250     CJNE @ R0 , # 4 , GOVERNOR_TARGET_CALC 
0918    02096F        4251     	JMP	CALC_GOVERNOR_TARGET_EXIT		; No
                      4252     
                      4253     GOVERNOR_TARGET_CALC: 
                      4254     	; Stop governor for stop RC pulse	
091B    C3            4255     	CLR	C
091C    E559          4256     	MOV	A, NEW_RCP				; Check RC pulse against stop value
091E    9401          4257     SUBB A , # 1 
0920    4003          4258     	JC	GOVERNOR_DEACTIVATE			; Yes - deactivate
                      4259     
0922    020938        4260     	JMP	GOVERNOR_ACTIVATE			; No - activate
                      4261     
                      4262     GOVERNOR_DEACTIVATE: 
0925    852224        4263     	MOV	CURRENT_PWM, REQUESTED_PWM	; Set current pwm to requested
0928    E4            4264     	CLR	A
0929    F540          4265     	MOV	GOV_TARGET_L, A			; Set target to zero
092B    F541          4266     	MOV	GOV_TARGET_H, A
092D    F542          4267     	MOV	GOV_INTEGRAL_L, A			; Set integral to zero
092F    F543          4268     	MOV	GOV_INTEGRAL_H, A
0931    F544          4269     	MOV	GOV_INTEGRAL_X, A
0933    F549          4270     	MOV	GOV_ACTIVE, A
0935    02096F        4271     	JMP	CALC_GOVERNOR_TARGET_EXIT
                      4272     
                      4273     GOVERNOR_ACTIVATE: 
0938    7882          4274     MOV R0 , # PGM_GOV_MODE 
093A    E6            4275     MOV A , @ R0 
093B    FC            4276     MOV R4 , A 
093C    754901        4277     	MOV	GOV_ACTIVE, #1
093F    E522          4278     	MOV	A, REQUESTED_PWM			; Load requested pwm
0941    F523          4279     	MOV	GOVERNOR_REQ_PWM, A			; Set governor requested pwm
                      4280     	; Calculate comm period target 2*(51000/Requested_Pwm)
0943    7838          4281     MOV R0 , # 38H 
0945    79C7          4282     MOV R1 , # 0C7H 
0947    AA3C          4283     MOV R2 , COMM_PERIOD4X_L 
0949    AB3D          4284     MOV R3 , COMM_PERIOD4X_H 
                      4285     	; Set speed range. Bare Comm_Period4x corresponds to 400k rpm, because it is 500n units
094B    C3            4286     	CLR	C
094C    EB            4287     MOV A , R3 
094D    13            4288     	RRC	A
094E    FB            4289     MOV R3 , A 
094F    EA            4290     MOV A , R2 
0950    13            4291     	RRC	A
0951    FA            4292     MOV R2 , A 
                      4293     	; Check range
0952    EC            4294     MOV A , R4 
0953    14            4295     	DEC	A
0954    6013          4296     	JZ	GOVERNOR_ACTIVATE_RANGE_SET	; 200k eRPM? - branch
                      4297     GOVERNOR_ACTIVATE_100K: 
0956    C3            4298     	CLR	C
0957    EB            4299     MOV A , R3 
0958    13            4300     	RRC	A
0959    FB            4301     MOV R3 , A 
095A    EA            4302     MOV A , R2 
095B    13            4303     	RRC	A
095C    FA            4304     MOV R2 , A 
095D    EC            4305     MOV A , R4 
095E    14            4306     	DEC	A
095F    14            4307     	DEC	A
0960    6007          4308     	JZ	GOVERNOR_ACTIVATE_RANGE_SET	; 100k eRPM? - branch
                      4309     GOVERNOR_ACTIVATE_50K: 
0962    C3            4310     	CLR	C
0963    EB            4311     MOV A , R3 
0964    13            4312     	RRC	A
0965    FB            4313     MOV R3 , A 
0966    EA            4314     MOV A , R2 
0967    13            4315     	RRC	A
0968    FA            4316     MOV R2 , A 
                      4317     GOVERNOR_ACTIVATE_RANGE_SET: 
0969    1184          4318     	CALL	DIV_U16_BY_U16
                      4319     	; Store governor target
096B    8840          4320     MOV GOV_TARGET_L , R0 
096D    8941          4321     MOV GOV_TARGET_H , R1 
                      4322     CALC_GOVERNOR_TARGET_EXIT: 
096F    22            4323     	RET						
                      4324     ENDIF
                      4325     
                      4326     
                      4327     ; Second governor routine - calculate governor proportional error
                      4328     CALC_GOVERNOR_PROP_ERROR: 
                      4329     	; Exit if governor is inactive
0970    E549          4330     	MOV	A, GOV_ACTIVE
0972    6034          4331     	JZ	CALC_GOVERNOR_PROP_ERROR_EXIT
                      4332     
                      4333     IF MODE <= 1	; Main or tail
                               	; Load comm period and divide by 2
                               	CLR	C
                               	MOV	A, COMM_PERIOD4X_H
                               	RRC	A
                               	MOV	TEMP2, A
                               	MOV	A, COMM_PERIOD4X_L
                               	RRC	A
                               	MOV	TEMP1, A
                               	; Calculate error
                               	CLR	C
                               	MOV	A, GOV_TARGET_L
                               	SUBB	A, TEMP1
                               	MOV	TEMP1, A
                               	MOV	A, GOV_TARGET_H
                               	SUBB	A, TEMP2
                               	MOV	TEMP2, A
                               ENDIF
                      4351     IF MODE == 2	; Multi
                      4352     	; Calculate error
0974    C3            4353     	CLR	C
0975    E540          4354     	MOV	A, GOV_TARGET_L
0977    9523          4355     	SUBB	A, GOVERNOR_REQ_PWM
0979    F8            4356     MOV R0 , A 
097A    E541          4357     	MOV	A, GOV_TARGET_H
097C    9400          4358     	SUBB	A, #0
097E    F9            4359     MOV R1 , A 
                      4360     ENDIF
                      4361     	; Check error and limit
097F    500C          4362     	JNC	GOVERNOR_CHECK_PROP_LIMIT_POS	; Check carry
                      4363     
0981    C3            4364     	CLR	C
0982    E8            4365     MOV A , R0 
0983    9480          4366     	SUBB	A, #80H					; Is error too negative?
0985    E9            4367     MOV A , R1 
0986    94FF          4368     	SUBB	A, #0FFH
0988    4016          4369     	JC	GOVERNOR_LIMIT_PROP_ERROR_NEG	; Yes - limit
098A    0209A4        4370     	JMP	GOVERNOR_STORE_PROP_ERROR
                      4371     
                      4372     GOVERNOR_CHECK_PROP_LIMIT_POS: 
098D    C3            4373     	CLR	C
098E    E8            4374     MOV A , R0 
098F    947F          4375     	SUBB	A, #7FH					; Is error too positive?
0991    E9            4376     MOV A , R1 
0992    9400          4377     	SUBB	A, #00H
0994    5003          4378     	JNC	GOVERNOR_LIMIT_PROP_ERROR_POS	; Yes - limit
0996    0209A4        4379     	JMP	GOVERNOR_STORE_PROP_ERROR
                      4380     
                      4381     GOVERNOR_LIMIT_PROP_ERROR_POS: 
0999    787F          4382     MOV R0 , # 7FH 
099B    7900          4383     MOV R1 , # 00H 
099D    0209A4        4384     	JMP	GOVERNOR_STORE_PROP_ERROR
                      4385     
                      4386     GOVERNOR_LIMIT_PROP_ERROR_NEG: 
09A0    7880          4387     MOV R0 , # 80H 
09A2    79FF          4388     MOV R1 , # 0FFH 
                      4389     
                      4390     GOVERNOR_STORE_PROP_ERROR: 
                      4391     	; Store proportional
09A4    8845          4392     MOV GOV_PROPORTIONAL_L , R0 
09A6    8946          4393     MOV GOV_PROPORTIONAL_H , R1 
                      4394     CALC_GOVERNOR_PROP_ERROR_EXIT: 
09A8    22            4395     	RET						
                      4396     
                      4397     
                      4398     ; Third governor routine - calculate governor integral error
                      4399     CALC_GOVERNOR_INT_ERROR: 
                      4400     	; Exit if governor is inactive
09A9    E549          4401     	MOV	A, GOV_ACTIVE
09AB    6058          4402     	JZ	CALC_GOVERNOR_INT_ERROR_EXIT
                      4403     
                      4404     	; Add proportional to integral
09AD    E545          4405     	MOV	A, GOV_PROPORTIONAL_L
09AF    2542          4406     	ADD	A, GOV_INTEGRAL_L
09B1    F8            4407     MOV R0 , A 
09B2    E546          4408     	MOV	A, GOV_PROPORTIONAL_H
09B4    3543          4409     	ADDC	A, GOV_INTEGRAL_H
09B6    F9            4410     MOV R1 , A 
09B7    854620        4411     	MOV	BIT_ACCESS, GOV_PROPORTIONAL_H		; Sign extend high byte
09BA    E4            4412     	CLR	A
09BB    300701        4413     	JNB	BIT_ACCESS.7, ($+4)			
09BE    F4            4414     	CPL	A
09BF    3544          4415     	ADDC	A, GOV_INTEGRAL_X
09C1    FA            4416     MOV R2 , A 
                      4417     	; Check integral and limit
09C2    30E709        4418     	JNB	ACC.7, GOVERNOR_CHECK_INT_LIMIT_POS	; Check sign bit
                      4419     
09C5    C3            4420     	CLR	C
09C6    EA            4421     MOV A , R2 
09C7    94F0          4422     	SUBB	A, #0F0H					; Is error too negative?
09C9    4015          4423     	JC	GOVERNOR_LIMIT_INT_ERROR_NEG	; Yes - limit
09CB    0209E6        4424     	JMP	GOVERNOR_CHECK_PWM
                      4425     
                      4426     GOVERNOR_CHECK_INT_LIMIT_POS: 
09CE    C3            4427     	CLR	C
09CF    EA            4428     MOV A , R2 
09D0    940F          4429     	SUBB	A, #0FH					; Is error too positive?
09D2    5003          4430     	JNC	GOVERNOR_LIMIT_INT_ERROR_POS	; Yes - limit
09D4    0209E6        4431     	JMP	GOVERNOR_CHECK_PWM
                      4432     
                      4433     GOVERNOR_LIMIT_INT_ERROR_POS: 
09D7    78FF          4434     MOV R0 , # 0FFH 
09D9    79FF          4435     MOV R1 , # 0FFH 
09DB    7A0F          4436     MOV R2 , # 0FH 
09DD    0209E6        4437     	JMP	GOVERNOR_CHECK_PWM
                      4438     
                      4439     GOVERNOR_LIMIT_INT_ERROR_NEG: 
09E0    7800          4440     MOV R0 , # 00H 
09E2    7900          4441     MOV R1 , # 00H 
09E4    7AF0          4442     MOV R2 , # 0F0H 
                      4443     
                      4444     GOVERNOR_CHECK_PWM: 
                      4445     	; Check current pwm
09E6    C3            4446     	CLR	C
09E7    E524          4447     	MOV	A, CURRENT_PWM
09E9    955E          4448     	SUBB	A, PWM_LIMIT				; Is current pwm at or above pwm limit?
09EB    5006          4449     	JNC	GOVERNOR_INT_MAX_PWM		; Yes - branch
                      4450     
09ED    E524          4451     	MOV	A, CURRENT_PWM				; Is current pwm at zero?
09EF    6009          4452     	JZ	GOVERNOR_INT_MIN_PWM		; Yes - branch
                      4453     
09F1    21FF          4454     	AJMP	GOVERNOR_STORE_INT_ERROR		; No - store integral error
                      4455     
                      4456     GOVERNOR_INT_MAX_PWM: 
09F3    E546          4457     	MOV	A, GOV_PROPORTIONAL_H
09F5    20E70D        4458     	JB	ACC.7, CALC_GOVERNOR_INT_ERROR_EXIT	; Is proportional error negative - branch (high byte is always zero)
                      4459     
09F8    21FF          4460     	AJMP	GOVERNOR_STORE_INT_ERROR		; Positive - store integral error
                      4461     
                      4462     GOVERNOR_INT_MIN_PWM: 
09FA    E546          4463     	MOV	A, GOV_PROPORTIONAL_H
09FC    30E706        4464     	JNB	ACC.7, CALC_GOVERNOR_INT_ERROR_EXIT	; Is proportional error positive - branch (high byte is always zero)
                      4465     
                      4466     GOVERNOR_STORE_INT_ERROR: 
                      4467     	; Store integral
09FF    8842          4468     MOV GOV_INTEGRAL_L , R0 
0A01    8943          4469     MOV GOV_INTEGRAL_H , R1 
0A03    8A44          4470     MOV GOV_INTEGRAL_X , R2 
                      4471     CALC_GOVERNOR_INT_ERROR_EXIT: 
0A05    22            4472     	RET						
                      4473     
                      4474     
                      4475     ; Fourth governor routine - calculate governor proportional correction
                      4476     CALC_GOVERNOR_PROP_CORRECTION: 
                      4477     	; Exit if governor is inactive
0A06    E549          4478     	MOV	A, GOV_ACTIVE
0A08    7003          4479     	JNZ	CALC_GOVERNOR_PROP_CORR
0A0A    020A69        4480     	JMP	CALC_GOVERNOR_PROP_CORR_EXIT
                      4481     
                      4482     CALC_GOVERNOR_PROP_CORR: 
                      4483     	; Load proportional gain
0A0D    789F          4484     MOV R0 , # PGM_GOV_P_GAIN_DECODED 
0A0F    E6            4485     MOV A , @ R0 
0A10    FA            4486     MOV R2 , A 
                      4487     	; Load proportional
0A11    C3            4488     	CLR	C
0A12    E545          4489     	MOV	A, GOV_PROPORTIONAL_L		; Nominal multiply by 2
0A14    33            4490     	RLC	A
0A15    F8            4491     MOV R0 , A 
0A16    E546          4492     	MOV	A, GOV_PROPORTIONAL_H
0A18    33            4493     	RLC	A
0A19    F9            4494     MOV R1 , A 
                      4495     	; Apply gain
0A1A    11BC          4496     	CALL	MULT_S16_BY_U8_DIV_16
                      4497     	; Check error and limit (to low byte)
0A1C    E9            4498     MOV A , R1 
0A1D    30E70B        4499     	JNB	ACC.7, GOVERNOR_CHECK_PROP_CORR_LIMIT_POS	; Check sign bit
                      4500     
0A20    C3            4501     	CLR	C
0A21    E8            4502     MOV A , R0 
0A22    9480          4503     	SUBB	A, #80H					; Is error too negative?
0A24    E9            4504     MOV A , R1 
0A25    94FF          4505     	SUBB	A, #0FFH
0A27    4013          4506     	JC	GOVERNOR_LIMIT_PROP_CORR_NEG	; Yes - limit
0A29    4140          4507     	AJMP	GOVERNOR_APPLY_PROP_CORR
                      4508     
                      4509     GOVERNOR_CHECK_PROP_CORR_LIMIT_POS: 
0A2B    C3            4510     	CLR	C
0A2C    E8            4511     MOV A , R0 
0A2D    947F          4512     	SUBB	A, #7FH					; Is error too positive?
0A2F    E9            4513     MOV A , R1 
0A30    9400          4514     	SUBB	A, #00H
0A32    5002          4515     	JNC	GOVERNOR_LIMIT_PROP_CORR_POS	; Yes - limit
0A34    4140          4516     	AJMP	GOVERNOR_APPLY_PROP_CORR
                      4517     
                      4518     GOVERNOR_LIMIT_PROP_CORR_POS: 
0A36    787F          4519     MOV R0 , # 7FH 
0A38    7900          4520     MOV R1 , # 00H 
0A3A    4140          4521     	AJMP	GOVERNOR_APPLY_PROP_CORR
                      4522     
                      4523     GOVERNOR_LIMIT_PROP_CORR_NEG: 
0A3C    7880          4524     MOV R0 , # 80H 
0A3E    79FF          4525     MOV R1 , # 0FFH 
                      4526     
                      4527     GOVERNOR_APPLY_PROP_CORR: 
                      4528     	; Test proportional sign
0A40    E8            4529     MOV A , R0 
0A41    20E715        4530     	JB	ACC.7, GOVERNOR_CORR_NEG_PROP	; If proportional negative - go to correct negative
                      4531     
                      4532     	; Subtract positive proportional
0A44    C3            4533     	CLR	C
0A45    E523          4534     	MOV	A, GOVERNOR_REQ_PWM
0A47    98            4535     SUBB A , R0 
0A48    F8            4536     MOV R0 , A 
                      4537     	; Check result
0A49    4009          4538     	JC	GOVERNOR_CORR_PROP_MIN_PWM	; Is result negative?
                      4539     
0A4B    C3            4540     	CLR	C
0A4C    E8            4541     MOV A , R0 
0A4D    9401          4542     	SUBB	A, #1
0A4F    4003          4543     	JC	GOVERNOR_CORR_PROP_MIN_PWM	; Yes
0A51    020A67        4544     	JMP	GOVERNOR_STORE_PROP_CORR		; No - store proportional correction
                      4545     
                      4546     GOVERNOR_CORR_PROP_MIN_PWM: 
0A54    7801          4547     MOV R0 , # 1 
0A56    020A67        4548     	JMP	GOVERNOR_STORE_PROP_CORR
                      4549     
                      4550     GOVERNOR_CORR_NEG_PROP: 
                      4551     	; Add negative proportional
0A59    E8            4552     MOV A , R0 
0A5A    F4            4553     	CPL	A
0A5B    2401          4554     	ADD	A, #1
0A5D    2523          4555     	ADD	A, GOVERNOR_REQ_PWM
0A5F    F8            4556     MOV R0 , A 
                      4557     	; Check result
0A60    4003          4558     	JC	GOVERNOR_CORR_PROP_MAX_PWM	; Is result above max?
0A62    020A67        4559     	JMP	GOVERNOR_STORE_PROP_CORR		; No - store proportional correction
                      4560     
                      4561     GOVERNOR_CORR_PROP_MAX_PWM: 
0A65    78FF          4562     MOV R0 , # 255 
                      4563     GOVERNOR_STORE_PROP_CORR: 
                      4564     	; Store proportional pwm
0A67    8847          4565     MOV GOV_PROP_PWM , R0 
                      4566     CALC_GOVERNOR_PROP_CORR_EXIT: 
0A69    22            4567     	RET
                      4568     
                      4569     
                      4570     ; Fifth governor routine - calculate governor integral correction
                      4571     CALC_GOVERNOR_INT_CORRECTION: 
                      4572     	; Exit if governor is inactive
0A6A    E549          4573     	MOV	A, GOV_ACTIVE
0A6C    7003          4574     	JNZ	CALC_GOVERNOR_INT_CORR
0A6E    020ACB        4575     	JMP	CALC_GOVERNOR_INT_CORR_EXIT
                      4576     
                      4577     CALC_GOVERNOR_INT_CORR: 
                      4578     	; Load integral gain
0A71    78A0          4579     MOV R0 , # PGM_GOV_I_GAIN_DECODED 
0A73    E6            4580     MOV A , @ R0 
0A74    FA            4581     MOV R2 , A 
                      4582     	; Load integral
0A75    A843          4583     MOV R0 , GOV_INTEGRAL_H 
0A77    A944          4584     MOV R1 , GOV_INTEGRAL_X 
                      4585     	; Apply gain
0A79    11BC          4586     	CALL	MULT_S16_BY_U8_DIV_16
                      4587     	; Check integral and limit
0A7B    E9            4588     MOV A , R1 
0A7C    30E70C        4589     	JNB	ACC.7, GOVERNOR_CHECK_INT_CORR_LIMIT_POS	; Check sign bit
                      4590     
0A7F    C3            4591     	CLR	C
0A80    E8            4592     MOV A , R0 
0A81    9401          4593     	SUBB	A, #01H					; Is integral too negative?
0A83    E9            4594     MOV A , R1 
0A84    94FF          4595     	SUBB	A, #0FFH
0A86    4016          4596     	JC	GOVERNOR_LIMIT_INT_CORR_NEG	; Yes - limit
0A88    020AA2        4597     	JMP	GOVERNOR_APPLY_INT_CORR
                      4598     
                      4599     GOVERNOR_CHECK_INT_CORR_LIMIT_POS: 
0A8B    C3            4600     	CLR	C
0A8C    E8            4601     MOV A , R0 
0A8D    94FF          4602     	SUBB	A, #0FFH					; Is integral too positive?
0A8F    E9            4603     MOV A , R1 
0A90    9400          4604     	SUBB	A, #00H
0A92    5003          4605     	JNC	GOVERNOR_LIMIT_INT_CORR_POS	; Yes - limit
0A94    020AA2        4606     	JMP	GOVERNOR_APPLY_INT_CORR
                      4607     
                      4608     GOVERNOR_LIMIT_INT_CORR_POS: 
0A97    78FF          4609     MOV R0 , # 0FFH 
0A99    7900          4610     MOV R1 , # 00H 
0A9B    020AA2        4611     	JMP	GOVERNOR_APPLY_INT_CORR
                      4612     
                      4613     GOVERNOR_LIMIT_INT_CORR_NEG: 
0A9E    7801          4614     MOV R0 , # 01H 
0AA0    79FF          4615     MOV R1 , # 0FFH 
                      4616     
                      4617     GOVERNOR_APPLY_INT_CORR: 
                      4618     	; Test integral sign
0AA2    E9            4619     MOV A , R1 
0AA3    20E715        4620     	JB	ACC.7, GOVERNOR_CORR_NEG_INT	; If integral negative - go to correct negative
                      4621     
                      4622     	; Subtract positive integral
0AA6    C3            4623     	CLR	C
0AA7    E547          4624     	MOV	A, GOV_PROP_PWM
0AA9    98            4625     SUBB A , R0 
0AAA    F8            4626     MOV R0 , A 
                      4627     	; Check result
0AAB    4009          4628     	JC	GOVERNOR_CORR_INT_MIN_PWM	; Is result negative?
                      4629     
0AAD    C3            4630     	CLR	C
0AAE    E8            4631     MOV A , R0 
0AAF    9401          4632     	SUBB	A, #1
0AB1    4003          4633     	JC	GOVERNOR_CORR_INT_MIN_PWM	; Yes
0AB3    020AC9        4634     	JMP	GOVERNOR_STORE_INT_CORR		; No - store correction
                      4635     
                      4636     GOVERNOR_CORR_INT_MIN_PWM: 
0AB6    7800          4637     MOV R0 , # 0 
0AB8    020AC9        4638     	JMP	GOVERNOR_STORE_INT_CORR
                      4639     
                      4640     GOVERNOR_CORR_NEG_INT: 
                      4641     	; Add negative integral
0ABB    E8            4642     MOV A , R0 
0ABC    F4            4643     	CPL	A
0ABD    2401          4644     	ADD	A, #1
0ABF    2547          4645     	ADD	A, GOV_PROP_PWM
0AC1    F8            4646     MOV R0 , A 
                      4647     	; Check result
0AC2    4003          4648     	JC	GOVERNOR_CORR_INT_MAX_PWM	; Is result above max?
0AC4    020AC9        4649     	JMP	GOVERNOR_STORE_INT_CORR		; No - store correction
                      4650     
                      4651     GOVERNOR_CORR_INT_MAX_PWM: 
0AC7    78FF          4652     MOV R0 , # 255 
                      4653     GOVERNOR_STORE_INT_CORR: 
                      4654     	; Store current pwm
0AC9    8824          4655     MOV CURRENT_PWM , R0 
                      4656     CALC_GOVERNOR_INT_CORR_EXIT: 
0ACB    22            4657     	RET
                      4658     
                      4659     
                      4660     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      4661     ;
                      4662     ; Measure lipo cells
                      4663     ;
                      4664     ; No assumptions
                      4665     ;
                      4666     ; Measure voltage and calculate lipo cells
                      4667     ;
                      4668     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      4669     MEASURE_LIPO_CELLS: 
                      4670     IF MODE == 1	; Tail
                               	; If tail, then exit
                               	JMP	MEASURE_LIPO_EXIT
                               ENDIF
                      4674     MEASURE_LIPO_START: 
                      4675     	; Load programmed low voltage limit
0ACC    7883          4676     MOV R0 , # PGM_LOW_VOLTAGE_LIM 
0ACE    E6            4677     MOV A , @ R0 
0ACF    F520          4678     	MOV	BIT_ACCESS, A				; Store in Bit_Access
                      4679     	; Set commutation to BpFET on
0AD1    120FEA        4680     	CALL	COMM5COMM6			
                      4681     	; Start adc
                      4682     	START_ADC 
0AD4    75E890        4682+1   MOV ADC0CN , # 90H  ; ADC START
                      4683     	; Wait for ADC reference to settle, and then start again
0AD7    1207EB        4684     	CALL	WAIT1MS
                      4685     	START_ADC
0ADA    75E890        4685+1   MOV ADC0CN , # 90H  ; ADC START
                      4686     	; Wait for ADC conversion to complete
                      4687     MEASURE_LIPO_WAIT_ADC: 
                      4688     	GET_ADC_STATUS 
0ADD    E5E8          4688+1   MOV A , ADC0CN 
0ADF    20ECFB        4689     	JB	AD0BUSY, MEASURE_LIPO_WAIT_ADC
                      4690     	; Read ADC result
                      4691     	READ_ADC_RESULT
0AE2    A8BD          4691+1   MOV R0 , ADC0L 
0AE4    A9BE          4691+1   MOV R1 , ADC0H 
                      4692     	; Stop ADC
                      4693     	STOP_ADC
                      4694     	; Switch power off
0AE6    121090        4695     	CALL	SWITCH_POWER_OFF		
                      4696     	; Set limit step
0AE9    756A55        4697     MOV LIPO_ADC_LIMIT_L , # 85 
0AEC    756B00        4698     MOV LIPO_ADC_LIMIT_H , # 0 
0AEF    C3            4699     	CLR	C
0AF0    7400          4700     MOV A , # 0 
0AF2    13            4701     	RRC	A
0AF3    FD            4702     MOV R5 , A 
0AF4    7455          4703     MOV A , # 85 
0AF6    13            4704     	RRC	A
0AF7    FC            4705     MOV R4 , A 
0AF8    7455          4706     MOV A , # 85 
0AFA    2C            4707     ADD A , R4 
0AFB    FC            4708     MOV R4 , A 
0AFC    7400          4709     MOV A , # 0 
0AFE    3D            4710     ADDC A , R5 
0AFF    FD            4711     MOV R5 , A 
0B00    EC            4712     MOV A , R4 
0B01    FA            4713     MOV R2 , A 
0B02    ED            4714     MOV A , R5 
0B03    FB            4715     MOV R3 , A 
                      4716     MEASURE_LIPO_CELL_LOOP: 
                      4717     	; Check voltage against xS lower limit
0B04    C3            4718     	CLR	C
0B05    E8            4719     MOV A , R0 
0B06    9A            4720     SUBB A , R2 
0B07    E9            4721     MOV A , R1 
0B08    9B            4722     SUBB A , R3 
0B09    4014          4723     	JC	MEASURE_LIPO_ADJUST		; No - branch
                      4724     
                      4725     	; Set xS voltage limit
0B0B    E56A          4726     	MOV	A, LIPO_ADC_LIMIT_L		
0B0D    2455          4727     ADD A , # 85 
0B0F    F56A          4728     	MOV	LIPO_ADC_LIMIT_L, A
0B11    E56B          4729     	MOV	A, LIPO_ADC_LIMIT_H		
0B13    3400          4730     ADDC A , # 0 
0B15    F56B          4731     	MOV	LIPO_ADC_LIMIT_H, A
                      4732     	; Set (x+1)S lower limit
0B17    EA            4733     MOV A , R2 
0B18    2C            4734     ADD A , R4 
0B19    FA            4735     MOV R2 , A 
0B1A    EB            4736     MOV A , R3 
0B1B    3D            4737     ADDC A , R5 
0B1C    FB            4738     MOV R3 , A 
0B1D    80E5          4739     	JMP	MEASURE_LIPO_CELL_LOOP	; Check for one more battery cell
                      4740     
                      4741     MEASURE_LIPO_ADJUST: 
0B1F    AE6A          4742     MOV R6 , LIPO_ADC_LIMIT_L 
0B21    AF6B          4743     MOV R7 , LIPO_ADC_LIMIT_H 
                      4744     	; Calculate 3.125%
0B23    C3            4745     	CLR	C
0B24    E56B          4746     	MOV	A, LIPO_ADC_LIMIT_H
0B26    13            4747     	RRC	A
0B27    F9            4748     MOV R1 , A 
0B28    E56A          4749     	MOV	A, LIPO_ADC_LIMIT_L	
0B2A    13            4750     	RRC	A
0B2B    F8            4751     MOV R0 , A 
0B2C    C3            4752     	CLR	C
0B2D    E9            4753     MOV A , R1 
0B2E    13            4754     	RRC	A
0B2F    F9            4755     MOV R1 , A 
0B30    E8            4756     MOV A , R0 
0B31    13            4757     	RRC	A
0B32    F8            4758     MOV R0 , A 
0B33    E56A          4759     	MOV	A, LIPO_ADC_LIMIT_L		; Set adc reference for voltage compensation
0B35    28            4760     ADD A , R0 
0B36    F568          4761     	MOV	LIPO_ADC_REFERENCE_L, A
0B38    E56B          4762     	MOV	A, LIPO_ADC_LIMIT_H
0B3A    39            4763     ADDC A , R1 
0B3B    F569          4764     	MOV	LIPO_ADC_REFERENCE_H, A
                      4765     	; Divide three times to get to 3.125%
0B3D    7A03          4766     MOV R2 , # 3 
                      4767     MEASURE_LIPO_DIVIDE_LOOP: 
0B3F    C3            4768     	CLR	C
0B40    E9            4769     MOV A , R1 
0B41    13            4770     	RRC	A
0B42    F9            4771     MOV R1 , A 
0B43    E8            4772     MOV A , R0 
0B44    13            4773     	RRC	A
0B45    F8            4774     MOV R0 , A 
0B46    DAF7          4775     DJNZ R2 , MEASURE_LIPO_DIVIDE_LOOP 
                      4776     
                      4777     	; Add the programmed number of 0.1V (or 3.125% increments)
0B48    AA20          4778     MOV R2 , BIT_ACCESS 
0B4A    1A            4779     DEC R2 
0B4B    7009          4780     	JNZ	MEASURE_LIPO_LIMIT_ON	; Is low voltage limiting on?
                      4781     
0B4D    756A00        4782     	MOV	LIPO_ADC_LIMIT_L, #0	; No - set limit to zero
0B50    756B00        4783     	MOV	LIPO_ADC_LIMIT_H, #0
0B53    020B66        4784     	JMP	MEASURE_LIPO_EXIT	
                      4785     
                      4786     MEASURE_LIPO_LIMIT_ON: 
0B56    1A            4787     DEC R2 
0B57    EA            4788     MOV A , R2 
0B58    6008          4789     	JZ	MEASURE_LIPO_UPDATE
                      4790     
                      4791     MEASURE_LIPO_ADD_LOOP: 
0B5A    EE            4792     MOV A , R6 
0B5B    28            4793     ADD A , R0 
0B5C    FE            4794     MOV R6 , A 
0B5D    EF            4795     MOV A , R7 
0B5E    39            4796     ADDC A , R1 
0B5F    FF            4797     MOV R7 , A 
0B60    DAF8          4798     DJNZ R2 , MEASURE_LIPO_ADD_LOOP 
                      4799     
                      4800     MEASURE_LIPO_UPDATE: 
                      4801     	; Set ADC limit
0B62    8E6A          4802     MOV LIPO_ADC_LIMIT_L , R6 
0B64    8F6B          4803     MOV LIPO_ADC_LIMIT_H , R7 
                      4804     MEASURE_LIPO_EXIT: 
0B66    22            4805     	RET
                      4806     
                      4807     
                      4808     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      4809     ;
                      4810     ; Start ADC conversion
                      4811     ;
                      4812     ; No assumptions
                      4813     ;
                      4814     ; Start conversion used for measuring power supply voltage
                      4815     ;
                      4816     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      4817     START_ADC_CONVERSION: 
                      4818     	; Start adc
                      4819     	START_ADC 
0B67    75E890        4819+1   MOV ADC0CN , # 90H  ; ADC START
0B6A    22            4820     	RET
                      4821     
                      4822     
                      4823     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      4824     ;
                      4825     ; Check temperature, power supply voltage and limit power
                      4826     ;
                      4827     ; No assumptions
                      4828     ;
                      4829     ; Used to limit main motor power in order to maintain the required voltage
                      4830     ;
                      4831     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      4832     CHECK_TEMP_VOLTAGE_AND_LIMIT_POWER: 
                      4833     	; Load programmed low voltage limit
0B6B    7883          4834     MOV R0 , # PGM_LOW_VOLTAGE_LIM 
0B6D    E6            4835     MOV A , @ R0 
0B6E    FF            4836     MOV R7 , A 
                      4837     	; Wait for ADC conversion to complete
                      4838     	GET_ADC_STATUS 
0B6F    E5E8          4838+1   MOV A , ADC0CN 
0B71    20ECF7        4839     	JB	AD0BUSY, CHECK_TEMP_VOLTAGE_AND_LIMIT_POWER
                      4840     	; Read ADC result
                      4841     	READ_ADC_RESULT
0B74    A8BD          4841+1   MOV R0 , ADC0L 
0B76    A9BE          4841+1   MOV R1 , ADC0H 
                      4842     	; Stop ADC
                      4843     	STOP_ADC
                      4844     
0B78    056C          4845     	INC	ADC_CONVERSION_CNT			; Increment conversion counter
0B7A    C3            4846     	CLR	C
0B7B    E56C          4847     	MOV	A, ADC_CONVERSION_CNT		; Is conversion count equal to temp rate?
0B7D    9408          4848     SUBB A , # 8 
0B7F    404B          4849     	JC	CHECK_VOLTAGE_START			; No - check voltage
                      4850     
0B81    756C00        4851     	MOV	ADC_CONVERSION_CNT, #0		; Yes - temperature check. Reset counter
0B84    E9            4852     MOV A , R1 
0B85    7007          4853     	JNZ	TEMP_AVERAGE_INC_DEC		; No - proceed
                      4854     
0B87    E56D          4855     	MOV	A, CURRENT_AVERAGE_TEMP		; Yes -  decrement average
0B89    601B          4856     	JZ	TEMP_AVERAGE_UPDATED		; Already zero - no change
0B8B    020B9A        4857     	JMP	TEMP_AVERAGE_DEC			; Decrement 
                      4858     
                      4859     TEMP_AVERAGE_INC_DEC: 
0B8E    C3            4860     	CLR	C
0B8F    E8            4861     MOV A , R0 
0B90    956D          4862     	SUBB	A, CURRENT_AVERAGE_TEMP
0B92    6010          4863     	JZ	TEMP_AVERAGE_UPDATED_LOAD_ACC	; Equal - no change
                      4864     
0B94    E56D          4865     	MOV	A, CURRENT_AVERAGE_TEMP		; Above - increment average
0B96    5006          4866     	JNC	TEMP_AVERAGE_INC				
                      4867     
0B98    600C          4868     	JZ	TEMP_AVERAGE_UPDATED		; Below - decrement average if average is not already zero
                      4869     TEMP_AVERAGE_DEC: 
0B9A    14            4870     	DEC	A						; Decrement average
0B9B    020BA6        4871     	JMP	TEMP_AVERAGE_UPDATED
                      4872     
                      4873     TEMP_AVERAGE_INC: 
0B9E    04            4874     	INC	A						; Increment average
0B9F    60F9          4875     	JZ	TEMP_AVERAGE_DEC
0BA1    020BA6        4876     	JMP	TEMP_AVERAGE_UPDATED
                      4877     
                      4878     TEMP_AVERAGE_UPDATED_LOAD_ACC: 
0BA4    E56D          4879     	MOV	A, CURRENT_AVERAGE_TEMP
                      4880     TEMP_AVERAGE_UPDATED: 
0BA6    F56D          4881     	MOV	CURRENT_AVERAGE_TEMP, A
0BA8    C3            4882     	CLR	C
0BA9    9472          4883     SUBB A , # 114 
0BAB    401B          4884     	JC	TEMP_CHECK_EXIT			; Yes - exit
                      4885     
0BAD    755EC0        4886     	MOV  PWM_LIMIT, #192			; No - limit pwm
                      4887     
0BB0    C3            4888     	CLR	C
0BB1    9404          4889     SUBB A , # 4 
0BB3    4013          4890     	JC	TEMP_CHECK_EXIT			; Yes - exit
                      4891     
0BB5    755E80        4892     	MOV  PWM_LIMIT, #128			; No - limit pwm
                      4893     
0BB8    C3            4894     	CLR	C
0BB9    9404          4895     SUBB A , # 4 
0BBB    400B          4896     	JC	TEMP_CHECK_EXIT			; Yes - exit
                      4897     
0BBD    755E40        4898     	MOV  PWM_LIMIT, #64				; No - limit pwm
                      4899     
0BC0    C3            4900     	CLR	C
0BC1    9404          4901     SUBB A , # 4 
0BC3    4003          4902     	JC	TEMP_CHECK_EXIT			; Yes - exit
                      4903     
0BC5    755E00        4904     	MOV  PWM_LIMIT, #0				; No - limit pwm
                      4905     
                      4906     TEMP_CHECK_EXIT: 
                      4907     	SET_ADC_IP_VOLT				; Select adc input for next conversion
0BC8    75BB09        4907+1   MOV AMX0P , # ( 8+ADC_IP )  ; SELECT POSITIVE INPUT
0BCB    22            4908     	RET
                      4909     
                      4910     CHECK_VOLTAGE_START: 
                      4911     IF MODE == 0 OR MODE == 2	; Main or multi
                      4912     	; Check if low voltage limiting is enabled
0BCC    EF            4913     MOV A , R7 
0BCD    C3            4914     	CLR	C
0BCE    9401          4915     	SUBB	A, #1					; Is low voltage limit disabled?
0BD0    601B          4916     	JZ	CHECK_VOLTAGE_GOOD			; Yes - voltage declared good
                      4917     
                      4918     	; Check if ADC is saturated
0BD2    C3            4919     	CLR	C
0BD3    E8            4920     MOV A , R0 
0BD4    94FF          4921     	SUBB	A, #0FFH
0BD6    E9            4922     MOV A , R1 
0BD7    9403          4923     	SUBB	A, #03H
0BD9    5012          4924     	JNC	CHECK_VOLTAGE_GOOD			; ADC saturated, can not make judgement
                      4925     
                      4926     	; Check voltage against limit
0BDB    C3            4927     	CLR	C
0BDC    E8            4928     MOV A , R0 
0BDD    956A          4929     	SUBB	A, LIPO_ADC_LIMIT_L
0BDF    E9            4930     MOV A , R1 
0BE0    956B          4931     	SUBB	A, LIPO_ADC_LIMIT_H
0BE2    5009          4932     	JNC	CHECK_VOLTAGE_GOOD			; If voltage above limit - branch
                      4933     
                      4934     	; Decrease pwm limit
0BE4    E55E          4935     	MOV  A, PWM_LIMIT
0BE6    600C          4936     	JZ	CHECK_VOLTAGE_LIM			; If limit zero - branch
                      4937     
0BE8    155E          4938     	DEC	PWM_LIMIT					; Decrement limit
0BEA    020BF4        4939     	JMP	CHECK_VOLTAGE_LIM
                      4940     
                      4941     CHECK_VOLTAGE_GOOD: 
                      4942     	; Increase pwm limit
0BED    E55E          4943     	MOV  A, PWM_LIMIT
0BEF    F4            4944     	CPL	A			
0BF0    6002          4945     	JZ	CHECK_VOLTAGE_LIM			; If limit max - branch
                      4946     
0BF2    055E          4947     	INC	PWM_LIMIT					; Increment limit
                      4948     
                      4949     CHECK_VOLTAGE_LIM: 
0BF4    A85E          4950     MOV R0 , PWM_LIMIT 
0BF6    C3            4951     	CLR	C
0BF7    E524          4952     	MOV	A, CURRENT_PWM
0BF9    98            4953     SUBB A , R0 
0BFA    5002          4954     	JNC	CHECK_VOLTAGE_SPOOLUP_LIM	; If current pwm above limit - branch and limit	
                      4955     
0BFC    A824          4956     MOV R0 , CURRENT_PWM 
                      4957     
                      4958     CHECK_VOLTAGE_SPOOLUP_LIM: 
                      4959     	; Slow spoolup
0BFE    C3            4960     	CLR	C
0BFF    E8            4961     MOV A , R0 
0C00    955F          4962     	SUBB	A, PWM_LIMIT_SPOOLUP
0C02    400A          4963     	JC	CHECK_VOLTAGE_EXIT			; If current pwm below limit - branch	
                      4964     
0C04    A85F          4965     MOV R0 , PWM_LIMIT_SPOOLUP 
0C06    E55F          4966     	MOV	A, PWM_LIMIT_SPOOLUP		; Check if spoolup limit is max
0C08    F4            4967     	CPL	A
0C09    6003          4968     	JZ	CHECK_VOLTAGE_EXIT			; If max - branch
                      4969      
0C0B    855F5E        4970     	MOV	PWM_LIMIT, PWM_LIMIT_SPOOLUP	; Set pwm limit to spoolup limit during ramp (to avoid governor integral buildup)
                      4971     
                      4972     CHECK_VOLTAGE_EXIT: 
0C0E    8825          4973     MOV CURRENT_PWM_LIMITED , R0 
                      4974     ENDIF
                      4975     	; Set adc mux for next conversion
0C10    C3            4976     	CLR	C
0C11    E56C          4977     	MOV	A, ADC_CONVERSION_CNT		; Is next conversion for temperature?
0C13    B40703        4978     	CJNE	A, #(TEMP_CHECK_RATE-1), CHECK_VOLTAGE_RET
                      4979     
                      4980     	SET_ADC_IP_TEMP				; Select temp sensor for next conversion
0C16    75BB10        4980+1   MOV AMX0P , # 10H  ; SELECT TEMP SENSOR INPUT
                      4981     
                      4982     CHECK_VOLTAGE_RET: 
0C19    22            4983     	RET
                      4984     
                      4985     
                      4986     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      4987     ;
                      4988     ; Set startup PWM routine
                      4989     ;
                      4990     ; Either the SETTLE_PHASE or the STEPPER_PHASE flag must be set
                      4991     ;
                      4992     ; Used for pwm control during startup
                      4993     ;
                      4994     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      4995     SET_STARTUP_PWM: 	
                      4996     	; Set pwm values according to startup phase flags
0C1A    306102        4997     JNB FLAGS1 . 1 , ( $+5 ) 
0C1D    7832          4998     MOV R0 , # 50 
0C1F    306202        4999     JNB FLAGS1 . 2 , ( $+5 ) 
0C22    7878          5000     MOV R0 , # 120 
                      5001     
                      5002     	; Update pwm variables if any startup phase flag is set
0C24    E52C          5003     	MOV	A, FLAGS1
0C26    5406          5004     	ANL	A, #((1 SHL SETTLE_PHASE)+(1 SHL STEPPER_PHASE))
0C28    601F          5005     	JZ	STARTUP_PWM_EXIT				; If no startup phase set - exit
                      5006     
                      5007     	; Adjust startup power
0C2A    E8            5008     MOV A , R0 
0C2B    79A2          5009     MOV R1 , # PGM_STARTUP_PWR_DECODED 
0C2D    87F0          5010     MOV B , @ R1 
0C2F    A4            5011     	MUL	AB
0C30    C5F0          5012     	XCH	A, B
0C32    A2F7          5013     	MOV	C, B.7						; Multiply result by 2 (unity gain is 128)
0C34    33            5014     	RLC	A
0C35    F8            5015     MOV R0 , A 
0C36    C3            5016     	CLR	C
0C37    E8            5017     MOV A , R0 
0C38    955E          5018     	SUBB	A, PWM_LIMIT	
0C3A    4002          5019     	JC	STARTUP_PWM_SET_PWM				; If pwm below limit - branch
                      5020     
0C3C    A85E          5021     MOV R0 , PWM_LIMIT 
                      5022     
                      5023     STARTUP_PWM_SET_PWM: 
                      5024     	; Set pwm variables
0C3E    8822          5025     MOV REQUESTED_PWM , R0 
0C40    8824          5026     MOV CURRENT_PWM , R0 
0C42    8825          5027     MOV CURRENT_PWM_LIMITED , R0 
0C44    306102        5028     JNB FLAGS1 . 1 , STARTUP_PWM_EXIT 
                      5029     
0C47    8860          5030     MOV PWM_SPOOLUP_BEG , R0 
                      5031     
                      5032     STARTUP_PWM_EXIT: 
0C49    22            5033     	RET
                      5034     
                      5035     
                      5036     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      5037     ;
                      5038     ; Initialize all timings routine
                      5039     ;
                      5040     ; No assumptions
                      5041     ;
                      5042     ; Part of initialization before motor start
                      5043     ;
                      5044     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      5045     INITIALIZE_ALL_TIMINGS:  
                      5046     	; Load programmed startup rpm
0C4A    788F          5047     MOV R0 , # PGM_STARTUP_RPM 
0C4C    E6            5048     MOV A , @ R0 
0C4D    FF            5049     MOV R7 , A 
                      5050     	; Check startup rpm setting and set step accordingly
0C4E    C3            5051     	CLR	C
0C4F    EF            5052     MOV A , R7 
0C50    9405          5053     	SUBB	A, #5
0C52    5018          5054     	JNC	STEPPER_STEP_HIGH
0C54    C3            5055     	CLR	C
0C55    EF            5056     MOV A , R7 
0C56    9404          5057     	SUBB	A, #4
0C58    5020          5058     	JNC	STEPPER_STEP_MED_HIGH
0C5A    C3            5059     	CLR	C
0C5B    EF            5060     MOV A , R7 
0C5C    9403          5061     	SUBB	A, #3
0C5E    5028          5062     	JNC	STEPPER_STEP_MED
0C60    C3            5063     	CLR	C
0C61    EF            5064     MOV A , R7 
0C62    9402          5065     	SUBB	A, #2
0C64    5030          5066     	JNC	STEPPER_STEP_MED_LOW
0C66    C3            5067     	CLR	C
0C67    EF            5068     MOV A , R7 
0C68    9401          5069     	SUBB	A, #1
0C6A    5038          5070     	JNC	STEPPER_STEP_LOW
                      5071     
                      5072     STEPPER_STEP_HIGH: 
0C6C    7533A0        5073     	MOV	STEPPER_STEP_BEG_L, #LOW(2000 SHL 1)
0C6F    75340F        5074     	MOV	STEPPER_STEP_BEG_H, #HIGH(2000 SHL 1)
0C72    75353C        5075     	MOV	STEPPER_STEP_END_L, #LOW(670 SHL 1)
0C75    753605        5076     	MOV	STEPPER_STEP_END_H, #HIGH(670 SHL 1)
0C78    81B0          5077     	AJMP	STEPPER_STEP_SET
                      5078     STEPPER_STEP_MED_HIGH: 
0C7A    7533C0        5079     	MOV	STEPPER_STEP_BEG_L, #LOW(2400 SHL 1)
0C7D    753412        5080     	MOV	STEPPER_STEP_BEG_H, #HIGH(2400 SHL 1)
0C80    753540        5081     	MOV	STEPPER_STEP_END_L, #LOW(800 SHL 1)
0C83    753606        5082     	MOV	STEPPER_STEP_END_H, #HIGH(800 SHL 1)
0C86    81B0          5083     	AJMP	STEPPER_STEP_SET
                      5084     STEPPER_STEP_MED: 
0C88    753370        5085     	MOV	STEPPER_STEP_BEG_L, #LOW(3000 SHL 1)	; ~3300 eRPM 
0C8B    753417        5086     	MOV	STEPPER_STEP_BEG_H, #HIGH(3000 SHL 1)
0C8E    7535D0        5087     	MOV	STEPPER_STEP_END_L, #LOW(1000 SHL 1)	; ~10000 eRPM
0C91    753607        5088     	MOV	STEPPER_STEP_END_H, #HIGH(1000 SHL 1)
0C94    81B0          5089     	AJMP	STEPPER_STEP_SET
                      5090     STEPPER_STEP_MED_LOW: 
0C96    75334C        5091     	MOV	STEPPER_STEP_BEG_L, #LOW(3750 SHL 1)
0C99    75341D        5092     	MOV	STEPPER_STEP_BEG_H, #HIGH(3750 SHL 1)
0C9C    7535C4        5093     	MOV	STEPPER_STEP_END_L, #LOW(1250 SHL 1)
0C9F    753609        5094     	MOV	STEPPER_STEP_END_H, #HIGH(1250 SHL 1)
0CA2    81B0          5095     	AJMP	STEPPER_STEP_SET
                      5096     STEPPER_STEP_LOW: 
0CA4    753328        5097     	MOV	STEPPER_STEP_BEG_L, #LOW(4500 SHL 1)
0CA7    753423        5098     	MOV	STEPPER_STEP_BEG_H, #HIGH(4500 SHL 1)
0CAA    7535B8        5099     	MOV	STEPPER_STEP_END_L, #LOW(1500 SHL 1)
0CAD    75360B        5100     	MOV	STEPPER_STEP_END_H, #HIGH(1500 SHL 1)
                      5101     
                      5102     STEPPER_STEP_SET: 
0CB0    853350        5103     	MOV	WT_STEPPER_STEP_L, STEPPER_STEP_BEG_L	; Initialize stepper step time 
0CB3    853451        5104     	MOV	WT_STEPPER_STEP_H, STEPPER_STEP_BEG_H
0CB6    753C00        5105     	MOV	COMM_PERIOD4X_L, #00H				; Set commutation period registers
0CB9    753D08        5106     	MOV	COMM_PERIOD4X_H, #08H
0CBC    22            5107     	RET
                      5108     
                      5109     
                      5110     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      5111     ;
                      5112     ; Calculate next commutation timing routine
                      5113     ;
                      5114     ; No assumptions
                      5115     ;
                      5116     ; Called immediately after each commutation
                      5117     ; Also sets up timer 3 to wait advance timing
                      5118     ; Two entry points are used
                      5119     ;
                      5120     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      5121     CALC_NEXT_COMM_TIMING_START: 	; Entry point for startup
0CBD    A850          5122     MOV R0 , WT_STEPPER_STEP_L 
0CBF    A951          5123     MOV R1 , WT_STEPPER_STEP_H 
0CC1    020CC8        5124     	JMP	READ_TIMER
                      5125     
                      5126     CALC_NEXT_COMM_TIMING: 		; Entry point for run phase
0CC4    A84A          5127     MOV R0 , WT_ADVANCE_L 
0CC6    A94B          5128     MOV R1 , WT_ADVANCE_H 
                      5129     READ_TIMER: 
                      5130     	; Set up next wait
0CC8    759100        5131     	MOV	TMR3CN, #00H		; Timer3 disabled
0CCB    C3            5132     	CLR	C
0CCC    E4            5133     	CLR	A
0CCD    98            5134     SUBB A , R0 
0CCE    F594          5135     	MOV	TMR3L, A
0CD0    E4            5136     	CLR	A
0CD1    99            5137     SUBB A , R1 
0CD2    F595          5138     	MOV	TMR3H, A
0CD4    759104        5139     	MOV	TMR3CN, #04H		; Timer3 enabled
0CD7    D258          5140     SETB FLAGS0 . 0 
                      5141     	; Read commutation time
0CD9    75C820        5142     	MOV	TMR2CN, #20H		; Timer2 disabled
0CDC    A8CC          5143     MOV R0 , TMR2L 
0CDE    A9CD          5144     MOV R1 , TMR2H 
0CE0    75C824        5145     	MOV	TMR2CN, #24H		; Timer2 enabled
                      5146     	; Calculate this commutation time
0CE3    AA3A          5147     MOV R2 , PREV_COMM_L 
0CE5    AB3B          5148     MOV R3 , PREV_COMM_H 
0CE7    883A          5149     MOV PREV_COMM_L , R0 
0CE9    893B          5150     MOV PREV_COMM_H , R1 
0CEB    C3            5151     	CLR	C
0CEC    E8            5152     MOV A , R0 
0CED    9A            5153     SUBB A , R2 
0CEE    F8            5154     MOV R0 , A 
0CEF    E9            5155     MOV A , R1 
0CF0    9B            5156     SUBB A , R3 
0CF1    F9            5157     MOV R1 , A 
                      5158     	; Calculate next zero cross scan timeout 
0CF2    AA3C          5159     MOV R2 , COMM_PERIOD4X_L 
0CF4    AB3D          5160     MOV R3 , COMM_PERIOD4X_H 
0CF6    C3            5161     	CLR	C
0CF7    EB            5162     MOV A , R3 
0CF8    13            5163     	RRC	A					; Divide by 2
0CF9    FD            5164     MOV R5 , A 
0CFA    EA            5165     MOV A , R2 
0CFB    13            5166     	RRC	A
0CFC    FC            5167     MOV R4 , A 
0CFD    C3            5168     	CLR	C
0CFE    ED            5169     MOV A , R5 
0CFF    13            5170     	RRC	A					; Divide by 2 again
0D00    FD            5171     MOV R5 , A 
0D01    EC            5172     MOV A , R4 
0D02    13            5173     	RRC	A
0D03    FC            5174     MOV R4 , A 
0D04    C3            5175     	CLR	C
0D05    EA            5176     MOV A , R2 
0D06    9C            5177     SUBB A , R4 
0D07    FA            5178     MOV R2 , A 
0D08    EB            5179     MOV A , R3 
0D09    9D            5180     SUBB A , R5 
0D0A    FB            5181     MOV R3 , A 
                      5182     
0D0B    EA            5183     MOV A , R2 
0D0C    28            5184     ADD A , R0 
0D0D    FA            5185     MOV R2 , A 
0D0E    EB            5186     MOV A , R3 
0D0F    39            5187     ADDC A , R1 
0D10    FB            5188     MOV R3 , A 
0D11    8A3C          5189     MOV COMM_PERIOD4X_L , R2 
0D13    8B3D          5190     MOV COMM_PERIOD4X_H , R3 
0D15    4001          5191     	JC	CALC_NEXT_COMM_SLOW		; If period larger than 0xffff - go to slow case
                      5192     
0D17    22            5193     	RET
                      5194     
                      5195     CALC_NEXT_COMM_SLOW: 
0D18    753CFF        5196     	MOV	COMM_PERIOD4X_L, #0FFH	; Set commutation period registers to very slow timing (0xffff)
0D1B    753DFF        5197     	MOV	COMM_PERIOD4X_H, #0FFH
0D1E    22            5198     	RET
                      5199     
                      5200     
                      5201     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      5202     ;
                      5203     ; Setup zero cross scan wait
                      5204     ;
                      5205     ; No assumptions
                      5206     ;
                      5207     ; Sets up timer 3 to wait the zero cross scan wait time
                      5208     ;
                      5209     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      5210     SETUP_ZC_SCAN_WAIT: 
0D1F    759100        5211     	MOV	TMR3CN, #00H		; Timer3 disabled
0D22    C3            5212     	CLR	C
0D23    E4            5213     	CLR	A
0D24    954C          5214     	SUBB	A, WT_ZC_SCAN_L	; Set wait to zero cross scan value
0D26    F594          5215     	MOV	TMR3L, A
0D28    E4            5216     	CLR	A
0D29    954D          5217     	SUBB	A, WT_ZC_SCAN_H		
0D2B    F595          5218     	MOV	TMR3H, A
0D2D    759104        5219     	MOV	TMR3CN, #04H		; Timer3 enabled
0D30    D258          5220     SETB FLAGS0 . 0 
0D32    22            5221     	RET
                      5222     
                      5223     
                      5224     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      5225     ;
                      5226     ; Wait advance timing routine
                      5227     ;
                      5228     ; No assumptions
                      5229     ;
                      5230     ; Waits for the advance timing to elapse, waits one zero cross
                      5231     ; wait and sets up the next zero cross wait
                      5232     ;
                      5233     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      5234     WAIT_ADVANCE_TIMING: 	
0D33    7F01          5235     MOV R7 , # 1 
0D35    789C          5236     MOV R0 , # PGM_DEMAG_COMP 
0D37    E6            5237     MOV A , @ R0 
0D38    14            5238     	DEC	A
0D39    6002          5239     	JZ	WAIT_ADVANCE_TIMING_WAIT
                      5240     
0D3B    7F02          5241     MOV R7 , # 2 
                      5242     
                      5243     WAIT_ADVANCE_TIMING_WAIT: 
0D3D    305802        5244     JNB FLAGS0 . 0 , ( $+5 ) 
0D40    A13D          5245     	AJMP	WAIT_ADVANCE_TIMING_WAIT
                      5246     
0D42    B11F          5247     	CALL	SETUP_ZC_SCAN_WAIT					; Setup wait time
0D44    DFF7          5248     DJNZ R7 , WAIT_ADVANCE_TIMING_WAIT 
                      5249     
0D46    22            5250     	RET
                      5251     
                      5252     
                      5253     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      5254     ;
                      5255     ; Calculate new wait times routine
                      5256     ;
                      5257     ; No assumptions
                      5258     ;
                      5259     ; Calculates new wait times
                      5260     ;
                      5261     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      5262     CALC_NEW_WAIT_TIMES: 	
                      5263     	; Load programmed commutation timing
0D47    7892          5264     MOV R0 , # PGM_COMM_TIMING 
0D49    E6            5265     MOV A , @ R0 
0D4A    FF            5266     MOV R7 , A 
0D4B    7E14          5267     MOV R6 , # ( COMM_TIME_RED SHL 1 ) 
                      5268     IF MODE == 2
0D4D    A83D          5269     MOV R0 , COMM_PERIOD4X_H 
0D4F    C3            5270     	CLR	C					; A COMM_TIME_RED of 6 gives good acceleration performance on pancake motor at high voltage
0D50    E8            5271     MOV A , R0 
0D51    9404          5272     	SUBB	A, #4
0D53    4002          5273     	JC	CALC_NEW_WAIT_RED_SET
                      5274     
0D55    7804          5275     MOV R0 , # 4 
                      5276     
                      5277     CALC_NEW_WAIT_RED_SET: 
0D57    C3            5278     	CLR	C
0D58    E8            5279     MOV A , R0 
0D59    33            5280     	RLC	A
0D5A    F8            5281     MOV R0 , A 
0D5B    C3            5282     	CLR	C
0D5C    EE            5283     MOV A , R6 
0D5D    98            5284     SUBB A , R0 
0D5E    FE            5285     MOV R6 , A 
                      5286     ENDIF
0D5F    306304        5287     JNB FLAGS1 . 3 , CALC_NEW_WAIT_DIR_START_SET 
                      5288     
0D62    7F03          5289     MOV R7 , # 3 
0D64    7E00          5290     MOV R6 , # 0 
                      5291     
                      5292     CALC_NEW_WAIT_DIR_START_SET: 
                      5293     	; Load current commutation timing
0D66    A93D          5294     MOV R1 , COMM_PERIOD4X_H 
0D68    A83C          5295     MOV R0 , COMM_PERIOD4X_L 
0D6A    7A04          5296     MOV R2 , # 4 
                      5297     DIVIDE_WAIT_TIMES: 
0D6C    C3            5298     	CLR	C
0D6D    E9            5299     MOV A , R1 
0D6E    13            5300     	RRC	A					; Divide by 2
0D6F    F9            5301     MOV R1 , A 
0D70    E8            5302     MOV A , R0 
0D71    13            5303     	RRC	A
0D72    F8            5304     MOV R0 , A 
0D73    DAF7          5305     DJNZ R2 , DIVIDE_WAIT_TIMES 
                      5306     
0D75    C3            5307     	CLR	C
0D76    E8            5308     MOV A , R0 
0D77    9E            5309     SUBB A , R6 
0D78    F8            5310     MOV R0 , A 
0D79    E9            5311     MOV A , R1 
0D7A    9400          5312     	SUBB	A, #0
0D7C    F9            5313     MOV R1 , A 
0D7D    4009          5314     	JC	LOAD_MIN_TIME			; Check that result is still positive
                      5315     
0D7F    C3            5316     	CLR	C
0D80    E8            5317     MOV A , R0 
0D81    9402          5318     	SUBB	A, #(COMM_TIME_MIN SHL 1)
0D83    E9            5319     MOV A , R1 
0D84    9400          5320     	SUBB	A, #0
0D86    5004          5321     	JNC	ADJUST_TIMING			; Check that result is still above minumum
                      5322     
                      5323     LOAD_MIN_TIME: 
0D88    7802          5324     MOV R0 , # ( COMM_TIME_MIN SHL 1 ) 
0D8A    E4            5325     	CLR	A
0D8B    F9            5326     MOV R1 , A 
                      5327     
                      5328     ADJUST_TIMING: 
0D8C    E9            5329     MOV A , R1 
0D8D    FB            5330     MOV R3 , A 
0D8E    E8            5331     MOV A , R0 
0D8F    FA            5332     MOV R2 , A 
0D90    C3            5333     	CLR	C
0D91    E9            5334     MOV A , R1 
0D92    13            5335     	RRC	A					; Divide by 2
0D93    FD            5336     MOV R5 , A 
0D94    E8            5337     MOV A , R0 
0D95    13            5338     	RRC	A
0D96    FC            5339     MOV R4 , A 
0D97    C3            5340     	CLR	C
0D98    EF            5341     MOV A , R7 
0D99    9403          5342     	SUBB	A, #3				; Is timing normal?
0D9B    602E          5343     	JZ	STORE_TIMES_DECREASE	; Yes - branch
                      5344     
0D9D    EF            5345     MOV A , R7 
0D9E    20E00D        5346     	JB	ACC.0, ADJUST_TIMING_TWO_STEPS	; If an odd number - branch
                      5347     
0DA1    E8            5348     MOV A , R0 
0DA2    2C            5349     ADD A , R4 
0DA3    F8            5350     MOV R0 , A 
0DA4    E9            5351     MOV A , R1 
0DA5    3D            5352     ADDC A , R5 
0DA6    F9            5353     MOV R1 , A 
0DA7    EC            5354     MOV A , R4 
0DA8    FA            5355     MOV R2 , A 
0DA9    ED            5356     MOV A , R5 
0DAA    FB            5357     MOV R3 , A 
0DAB    020DB8        5358     	JMP	STORE_TIMES_UP_OR_DOWN
                      5359     
                      5360     ADJUST_TIMING_TWO_STEPS: 
0DAE    E8            5361     MOV A , R0 
0DAF    28            5362     ADD A , R0 
0DB0    F8            5363     MOV R0 , A 
0DB1    E9            5364     MOV A , R1 
0DB2    39            5365     ADDC A , R1 
0DB3    F9            5366     MOV R1 , A 
0DB4    7A02          5367     MOV R2 , # ( COMM_TIME_MIN SHL 1 ) 
0DB6    E4            5368     	CLR	A
0DB7    FB            5369     MOV R3 , A 
                      5370     
                      5371     STORE_TIMES_UP_OR_DOWN: 
0DB8    C3            5372     	CLR	C
0DB9    EF            5373     MOV A , R7 
0DBA    9403          5374     	SUBB	A, #3				; Is timing higher than normal?
0DBC    400D          5375     	JC	STORE_TIMES_DECREASE	; No - branch
                      5376     
                      5377     STORE_TIMES_INCREASE: 
0DBE    8A4E          5378     MOV WT_COMM_L , R2 
0DC0    8B4F          5379     MOV WT_COMM_H , R3 
0DC2    884A          5380     MOV WT_ADVANCE_L , R0 
0DC4    894B          5381     MOV WT_ADVANCE_H , R1 
0DC6    8C4C          5382     MOV WT_ZC_SCAN_L , R4 
0DC8    8D4D          5383     MOV WT_ZC_SCAN_H , R5 
0DCA    22            5384     	RET
                      5385     
                      5386     STORE_TIMES_DECREASE: 
0DCB    884E          5387     MOV WT_COMM_L , R0 
0DCD    894F          5388     MOV WT_COMM_H , R1 
0DCF    8A4A          5389     MOV WT_ADVANCE_L , R2 
0DD1    8B4B          5390     MOV WT_ADVANCE_H , R3 
0DD3    8C4C          5391     MOV WT_ZC_SCAN_L , R4 
0DD5    8D4D          5392     MOV WT_ZC_SCAN_H , R5 
0DD7    22            5393     	RET
                      5394     
                      5395     
                      5396     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      5397     ;
                      5398     ; Wait before zero cross scan routine
                      5399     ;
                      5400     ; No assumptions
                      5401     ;
                      5402     ; Waits for the zero cross scan wait time to elapse
                      5403     ; Also sets up timer 3 to wait the zero cross scan timeout time
                      5404     ;
                      5405     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      5406     WAIT_BEFORE_ZC_SCAN: 	
0DD8    305802        5407     JNB FLAGS0 . 0 , ( $+5 ) 
0DDB    A1D8          5408     	AJMP	WAIT_BEFORE_ZC_SCAN
                      5409     
0DDD    759100        5410     	MOV	TMR3CN, #00H		; Timer3 disabled
0DE0    C3            5411     	CLR	C
0DE1    E4            5412     	CLR	A
0DE2    953C          5413     	SUBB	A, COMM_PERIOD4X_L	; Set wait to zero comm period 4x value
0DE4    F594          5414     	MOV	TMR3L, A
0DE6    E4            5415     	CLR	A
0DE7    953D          5416     	SUBB	A, COMM_PERIOD4X_H		
0DE9    F595          5417     	MOV	TMR3H, A
0DEB    759104        5418     	MOV	TMR3CN, #04H		; Timer3 enabled
0DEE    D258          5419     SETB FLAGS0 . 0 
0DF0    22            5420     	RET
                      5421     
                      5422     
                      5423     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      5424     ;
                      5425     ; Wait for comparator to go low/high routines
                      5426     ;
                      5427     ; No assumptions
                      5428     ;
                      5429     ; Waits for the zero cross scan wait time to elapse
                      5430     ; Then scans for comparator going low/high
                      5431     ;
                      5432     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      5433     WAIT_FOR_COMP_OUT_LOW: 
0DF1    753F00        5434     	MOV	COMP_WAIT_READS, #0
0DF4    752000        5435     	MOV	BIT_ACCESS, #00H			; Desired comparator output
0DF7    020E00        5436     	JMP	WAIT_FOR_COMP_OUT_START
                      5437     
                      5438     WAIT_FOR_COMP_OUT_HIGH: 
0DFA    753F00        5439     	MOV	COMP_WAIT_READS, #0
0DFD    752040        5440     	MOV	BIT_ACCESS, #40H			; Desired comparator output
                      5441     
                      5442     WAIT_FOR_COMP_OUT_START: 
0E00    D2AF          5443     	SETB	EA						; Enable interrupts
0E02    053F          5444     	INC	COMP_WAIT_READS
0E04    205801        5445     JB FLAGS0 . 0 , ( $+4 ) 
0E07    22            5446     	RET							; Yes - return
                      5447     
                      5448     	; Set default comparator response times
0E08    759D00        5449     	MOV	CPT0MD, #0				; Set fast response (100ns) as default		
                      5450     IF COMP1_USED==1			
                               	MOV	CPT1MD, #0				; Set fast response (100ns) as default		
                               ENDIF
                      5453     	; Select number of comparator readings based upon current rotation speed
0E0B    E53D          5454     	MOV 	A, COMM_PERIOD4X_H			; Load rotation period
0E0D    C3            5455     	CLR	C
0E0E    13            5456     	RRC	A						; Divide by 4
0E0F    C3            5457     	CLR	C
0E10    13            5458     	RRC	A
0E11    F8            5459     MOV R0 , A 
0E12    08            5460     INC R0 
0E13    6030          5461     	JZ	COMP_WAIT_ON_COMP_ABLE		; If minimum number of readings - jump directly to reading
                      5462     	; For damped mode, do fewer comparator readings (since comparator info is primarily only available in the pwm on period)
0E15    306A06        5463     JNB FLAGS2 . 2 , COMP_WAIT_SET_MAX_READINGS 
                      5464     
0E18    C3            5465     	CLR	C
0E19    13            5466     	RRC	A						; Divide by 4 again
0E1A    C3            5467     	CLR	C
0E1B    13            5468     	RRC	A
0E1C    F8            5469     MOV R0 , A 
0E1D    08            5470     INC R0 
                      5471     
                      5472     COMP_WAIT_SET_MAX_READINGS: 
0E1E    C3            5473     	CLR	C
0E1F    E8            5474     MOV A , R0 
0E20    940A          5475     	SUBB	A, #10
0E22    4002          5476     	JC	($+4)
                      5477     
0E24    780A          5478     MOV R0 , # 10 
                      5479     
0E26    306D08        5480     JNB FLAGS2 . 5 , COMP_WAIT_SET_RESPONSE_TIME 
                      5481     
0E29    C3            5482     	CLR	C
0E2A    E8            5483     MOV A , R0 
0E2B    9404          5484     	SUBB	A, #4
0E2D    4002          5485     	JC	($+4)
                      5486     
0E2F    7804          5487     MOV R0 , # 4 
                      5488     
                      5489     COMP_WAIT_SET_RESPONSE_TIME: 
0E31    C3            5490     	CLR	C
0E32    E53D          5491     	MOV	A, COMM_PERIOD4X_H			; Is Comm_Period4x_H less than 1ms?
0E34    9408          5492     	SUBB	A, #8
0E36    400D          5493     	JC	COMP_WAIT_ON_COMP_ABLE		; Yes - jump
                      5494     
0E38    759D02        5495     	MOV	CPT0MD, #2				; Set medium response (300ns)
                      5496     IF COMP1_USED==1			
                               	MOV	CPT1MD, #2				; Set medium response (300ns)
                               ENDIF
0E3B    C3            5499     	CLR	C
0E3C    E53D          5500     	MOV	A, COMM_PERIOD4X_H			; Is Comm_Period4x_H less than 2ms?
0E3E    9410          5501     	SUBB	A, #16
0E40    4003          5502     	JC	COMP_WAIT_ON_COMP_ABLE		; Yes - jump
                      5503     
0E42    759D03        5504     	MOV	CPT0MD, #3				; Set slow response (1000ns) 	
                      5505     IF COMP1_USED==1			
                               	MOV	CPT1MD, #3				; Set slow response (1000ns) 	
                               ENDIF
                      5508     
                      5509     COMP_WAIT_ON_COMP_ABLE: 
0E45    205803        5510     JB FLAGS0 . 0 , ( $+6 ) 
0E48    D2AF          5511     	SETB	EA							; Enable interrupts
0E4A    22            5512     	RET								; Yes - return
                      5513     
0E4B    791E          5514     MOV R1 , # 30 
0E4D    206D02        5515     JB FLAGS2 . 5 , ( $+5 ) 
0E50    790A          5516     MOV R1 , # 10 
0E52    D2AF          5517     	SETB	EA							; Enable interrupts
0E54    00            5518     	NOP								; Allocate only just enough time to capture interrupt
0E55    00            5519     	NOP
0E56    C2AF          5520     	CLR	EA							; Disable interrupts
0E58    205A0A        5521     JB FLAGS0 . 2 , PWM_WAIT_STARTUP 
                      5522     
0E5B    793C          5523     MOV R1 , # 60 
0E5D    206D02        5524     JB FLAGS2 . 5 , ( $+5 ) 
0E60    7914          5525     MOV R1 , # 20 
0E62    3066E0        5526     JNB FLAGS1 . 6 , COMP_WAIT_ON_COMP_ABLE 
                      5527     
                      5528     PWM_WAIT_STARTUP: 						
0E65    306302        5529     JNB FLAGS1 . 3 , PWM_WAIT 
                      5530     
0E68    7978          5531     MOV R1 , # 120 
                      5532     PWM_WAIT: 						
0E6A    C3            5533     	CLR	C
0E6B    E58B          5534     	MOV	A, TL1
0E6D    99            5535     SUBB A , R1 
                      5536     IF MODE == 1 AND DAMPED_MODE_ENABLE == 1; Assume same pwm cycle for fast tail escs
                               	JB	FLAGS1.DIRECT_STARTUP_PHASE, ($+5)
                               	JC	PWM_WAIT
                               	JC	COMP_WAIT_ON_COMP_ABLE		; Re-evaluate pwm cycle during direct start
                               ELSE
0E6E    40D5          5541     	JC	COMP_WAIT_ON_COMP_ABLE		; Re-evaluate pwm cycle for slower escs
                      5542     ENDIF
                      5543     
                      5544     COMP_READ: 
                      5545     	READ_COMP_OUT 					; Read comparator output
0E70    E59B          5545+1   MOV A , CPT0CN  ; READ COMPARATOR OUTPUT
0E72    F4            5546     	CPL	A
0E73    5440          5547     	ANL	A, #40H
0E75    B52002        5548     	CJNE	A, BIT_ACCESS, ($+5)		; If comparator output is correct - proceed
                      5549     
0E78    C100          5550     	AJMP	WAIT_FOR_COMP_OUT_START		; If comparator output is not correct - go back and restart
                      5551     
0E7A    D8C9          5552     DJNZ R0 , COMP_WAIT_ON_COMP_ABLE 
                      5553     
0E7C    D2AF          5554     	SETB	EA						; Enable interrupts
0E7E    22            5555     	RET							
                      5556     
                      5557     
                      5558     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      5559     ;
                      5560     ; Evaluate comparator integrity
                      5561     ;
                      5562     ; No assumptions
                      5563     ;
                      5564     ; Checks comparator signal behaviour versus expected behaviour
                      5565     ;
                      5566     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      5567     EVALUATE_COMPARATOR_INTEGRITY: 
0E7F    C25B          5568     CLR FLAGS0 . 3 
                      5569     	; Check if demag compensation is enabled
0E81    789C          5570     MOV R0 , # PGM_DEMAG_COMP 
0E83    E6            5571     MOV A , @ R0 
0E84    14            5572     	DEC	A
0E85    600A          5573     	JZ	EVAL_COMP_NO_DEMAG
                      5574     
                      5575     	; Check if a demag situation has occurred
0E87    E53F          5576     	MOV	A, COMP_WAIT_READS				; Check if there were no waits (there shall be some). If none a demag situation has occurred
0E89    14            5577     	DEC	A
0E8A    7005          5578     	JNZ	EVAL_COMP_NO_DEMAG
                      5579     
0E8C    206302        5580     JB FLAGS1 . 3 , EVAL_COMP_NO_DEMAG 
                      5581     
0E8F    D25B          5582     SETB FLAGS0 . 3 
                      5583     
                      5584     EVAL_COMP_NO_DEMAG: 
0E91    30630B        5585     JNB FLAGS1 . 3 , EVAL_COMP_CHECK_TIMEOUT 
                      5586     
0E94    0538          5587     	INC	DIRECT_STARTUP_OK_CNT			; Increment ok counter
0E96    205810        5588     JB FLAGS0 . 0 , EVAL_COMP_EXIT 
                      5589     
0E99    753800        5590     	MOV	DIRECT_STARTUP_OK_CNT, #0		; Reset ok counter
0E9C    020EA9        5591     	JMP	EVAL_COMP_EXIT
                      5592     
                      5593     EVAL_COMP_CHECK_TIMEOUT: 
0E9F    205807        5594     JB FLAGS0 . 0 , EVAL_COMP_EXIT 
0EA2    1581          5595     	DEC	SP							; Routine exit without "ret" command
0EA4    1581          5596     	DEC	SP
0EA6    021830        5597     	LJMP	RUN_TO_WAIT_FOR_POWER_ON			; Yes - exit run mode
                      5598     
                      5599     EVAL_COMP_EXIT: 
0EA9    22            5600     	RET
                      5601     
                      5602     
                      5603     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      5604     ;
                      5605     ; Setup commutation timing routine
                      5606     ;
                      5607     ; No assumptions
                      5608     ;
                      5609     ; Sets up and starts wait from commutation to zero cross
                      5610     ;
                      5611     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      5612     SETUP_COMM_WAIT:  
0EAA    759100        5613     	MOV	TMR3CN, #00H		; Timer3 disabled
0EAD    C3            5614     	CLR	C
0EAE    E4            5615     	CLR	A
0EAF    954E          5616     	SUBB	A, WT_COMM_L		; Set wait commutation value
0EB1    F594          5617     	MOV	TMR3L, A
0EB3    E4            5618     	CLR	A
0EB4    954F          5619     	SUBB	A, WT_COMM_H		
0EB6    F595          5620     	MOV	TMR3H, A
0EB8    759104        5621     	MOV	TMR3CN, #04H		; Timer3 enabled
0EBB    D258          5622     SETB FLAGS0 . 0 
0EBD    22            5623     	RET
                      5624     
                      5625     
                      5626     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      5627     ;
                      5628     ; Wait for commutation routine
                      5629     ;
                      5630     ; No assumptions
                      5631     ;
                      5632     ; Waits from zero cross to commutation 
                      5633     ;
                      5634     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      5635     WAIT_FOR_COMM:  
                      5636     	; Increment or reset consecutive count
0EBE    0539          5637     	INC	DEMAG_CONSECUTIVE_CNT
0EC0    205B03        5638     JB FLAGS0 . 3 , ( $+6 ) 
                      5639     
0EC3    753900        5640     	MOV	DEMAG_CONSECUTIVE_CNT, #0
                      5641     
                      5642     	; Check if a demag situation has occurred
0EC6    305B23        5643     JNB FLAGS0 . 3 , WAIT_FOR_COMM_WAIT 
                      5644     
                      5645     	; Load programmed demag compensation
0EC9    78A3          5646     MOV R0 , # PGM_DEMAG_COMP_POWER_DECODED 
0ECB    E6            5647     MOV A , @ R0 
0ECC    FF            5648     MOV R7 , A 
                      5649     
                      5650     	; Check for power off
0ECD    BF0108        5651     CJNE R7 , # 1 , WAIT_FOR_COMM_BLIND 
                      5652     
0ED0    D25C          5653     SETB FLAGS0 . 4 
                      5654     	ALL_NFETS_OFF
0ED2    C292          5654+1   CLR P1 . 2 
0ED4    C296          5654+1   CLR P1 . 6 
0ED6    C295          5654+1   CLR P1 . 5 
                      5655     
                      5656     	; Wait a blind wait
                      5657     WAIT_FOR_COMM_BLIND: 
0ED8    B11F          5658     	CALL	SETUP_ZC_SCAN_WAIT					; Setup a zero cross scan wait (7.5 deg)
                      5659     WAIT_DEMAG_DEFAULT_ZC: 	
0EDA    305802        5660     JNB FLAGS0 . 0 , ( $+5 ) 
0EDD    C1DA          5661     	AJMP	WAIT_DEMAG_DEFAULT_ZC
                      5662     
                      5663     	; Check for power off
0EDF    BF0208        5664     CJNE R7 , # 2 , WAIT_FOR_COMM_SETUP 
                      5665     
0EE2    D25C          5666     SETB FLAGS0 . 4 
                      5667     	ALL_NFETS_OFF
0EE4    C292          5667+1   CLR P1 . 2 
0EE6    C296          5667+1   CLR P1 . 6 
0EE8    C295          5667+1   CLR P1 . 5 
                      5668     
                      5669     WAIT_FOR_COMM_SETUP: 
0EEA    D1AA          5670     	CALL	SETUP_COMM_WAIT					; Setup commutation wait
                      5671     WAIT_FOR_COMM_WAIT: 
0EEC    305802        5672     JNB FLAGS0 . 0 , ( $+5 ) 
0EEF    C1EC          5673     	AJMP	WAIT_FOR_COMM_WAIT					
                      5674     
0EF1    22            5675     	RET
                      5676     
                      5677     
                      5678     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      5679     ;
                      5680     ; Commutation routines
                      5681     ;
                      5682     ; No assumptions
                      5683     ;
                      5684     ; Performs commutation switching 
                      5685     ; Damped routines uses all pfets on when in pwm off to dampen the motor
                      5686     ;
                      5687     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      5688     COMM1COMM2: 	
0EF2    C2AF          5689     	CLR 	EA					; Disable all interrupts
                      5690     	BPFET_OFF					; Bp off
0EF4    C294          5690+1   CLR P1 . 4 
0EF6    206A03        5691     JB FLAGS2 . 2 , COMM12_DAMP 
0EF9    020F11        5692     	JMP	COMM12_NONDAMP
                      5693     COMM12_DAMP: 
                      5694     IF DAMPED_MODE_ENABLE == 0
                               	MOV	DPTR, #PWM_CNFET_APFET_ON_FAST
                               	JB	FLAGS2.PGM_PWMOFF_DAMPED_LIGHT, COMM12_NONDAMP
                               ENDIF
                      5698     IF DAMPED_MODE_ENABLE == 1
0EFC    900347        5699     	MOV	DPTR, #PWM_CNFET_APFET_ON_SAFE	
                      5700     ENDIF
0EFF    30650F        5701     JNB FLAGS1 . 5 , COMM12_NONDAMP 
                      5702     	CPFET_OFF				
0F02    207502        5702+1   JB FLAGS3 . 5 , ( $+5 ) 
0F05    C297          5702+1   CLR P1 . 7 
0F07    307502        5702+1   JNB FLAGS3 . 5 , ( $+5 ) 
0F0A    C293          5702+1   CLR P1 . 3 
0F0C    7406          5703     MOV A , # 6 
0F0E    D5E0FD        5704     	DJNZ ACC,	$
                      5705     COMM12_NONDAMP: 
                      5706     IF HIGH_DRIVER_PRECHG_TIME NE 0	; Precharge high side gate driver
                               	ANFET_ON				
                               	MOV	A, #HIGH_DRIVER_PRECHG_TIME
                               	DJNZ ACC,	$
                               	ANFET_OFF				
                               	MOV	A, #PFETON_DELAY
                               	DJNZ ACC,	$
                               ENDIF
                      5714     	APFET_ON					; Ap on
0F11    207502        5714+1   JB FLAGS3 . 5 , ( $+5 ) 
0F14    D293          5714+1   SETB P1 . 3 
0F16    307502        5714+1   JNB FLAGS3 . 5 , ( $+5 ) 
0F19    D297          5714+1   SETB P1 . 7 
                      5715     	SET_COMP_PHASE_B 			; Set comparator to phase B
0F1B    759F80        5715+1   MOV CPT0MX , # 80H  ; SET COMPARATOR MULTIPLEXER TO PHASE B
0F1E    753E02        5716     	MOV	COMM_PHASE, #2
0F21    02107C        5717     	JMP	COMM_EXIT
                      5718     
                      5719     COMM2COMM3: 	
0F24    C2AF          5720     	CLR 	EA					; Disable all interrupts
0F26    206A03        5721     JB FLAGS2 . 2 , COMM23_DAMP 
0F29    020F46        5722     	JMP	COMM23_NONDAMP
                      5723     COMM23_DAMP: 
                      5724     IF DAMPED_MODE_ENABLE == 0
                               	MOV	DPTR, #PWM_BNFET_APFET_ON_FAST
                               ENDIF
                      5727     IF DAMPED_MODE_ENABLE == 1
0F2C    9002FE        5728     	MOV	DPTR, #PWM_BNFET_APFET_ON_SAFE	
                      5729     ENDIF
0F2F    306517        5730     JNB FLAGS1 . 5 , COMM23_NFET 
                      5731     	BPFET_OFF				
0F32    C294          5731+1   CLR P1 . 4 
                      5732     	CPFET_OFF				
0F34    207502        5732+1   JB FLAGS3 . 5 , ( $+5 ) 
0F37    C297          5732+1   CLR P1 . 7 
0F39    307502        5732+1   JNB FLAGS3 . 5 , ( $+5 ) 
0F3C    C293          5732+1   CLR P1 . 3 
0F3E    7406          5733     MOV A , # 6 
0F40    D5E0FD        5734     	DJNZ ACC,	$
0F43    020F49        5735     	JMP	COMM23_NFET
                      5736     COMM23_NONDAMP: 
0F46    9001E1        5737     	MOV	DPTR, #PWM_BFET_ON	
                      5738     COMM23_NFET: 
                      5739     	CNFET_OFF					; Cn off
0F49    207502        5739+1   JB FLAGS3 . 5 , ( $+5 ) 
0F4C    C296          5739+1   CLR P1 . 6 
0F4E    307502        5739+1   JNB FLAGS3 . 5 , ( $+5 ) 
0F51    C292          5739+1   CLR P1 . 2 
0F53    305A06        5740     JNB FLAGS0 . 2 , COMM23_CP 
                      5741     	BNFET_ON					; Yes - Bn on
0F56    E525          5741+1   MOV A , CURRENT_PWM_LIMITED 
0F58    6002          5741+1   JZ ( $+4 ) 
0F5A    D295          5741+1   SETB P1 . 5 
                      5742     COMM23_CP: 
                      5743     	SET_COMP_PHASE_C 			; Set comparator to phase C
0F5C    207503        5743+1   JB FLAGS3 . 5 , ( $+6 ) 
0F5F    759F89        5743+1   MOV CPT0MX , # 89H  ; SET COMPARATOR MULTIPLEXER TO PHASE C
0F62    307503        5743+1   JNB FLAGS3 . 5 , ( $+6 ) 
0F65    759F81        5743+1   MOV CPT0MX , # 81H 
0F68    753E03        5744     	MOV	COMM_PHASE, #3
0F6B    02107C        5745     	JMP	COMM_EXIT
                      5746     
                      5747     COMM3COMM4: 	
0F6E    C2AF          5748     	CLR 	EA					; Disable all interrupts
                      5749     	APFET_OFF					; Ap off
0F70    207502        5749+1   JB FLAGS3 . 5 , ( $+5 ) 
0F73    C293          5749+1   CLR P1 . 3 
0F75    307502        5749+1   JNB FLAGS3 . 5 , ( $+5 ) 
0F78    C297          5749+1   CLR P1 . 7 
0F7A    206A03        5750     JB FLAGS2 . 2 , COMM34_DAMP 
0F7D    020F8D        5751     	JMP	COMM34_NONDAMP
                      5752     COMM34_DAMP: 
                      5753     IF DAMPED_MODE_ENABLE == 0
                               	MOV	DPTR, #PWM_BNFET_CPFET_ON_FAST
                               	JB	FLAGS2.PGM_PWMOFF_DAMPED_LIGHT, COMM34_NONDAMP
                               ENDIF
                      5757     IF DAMPED_MODE_ENABLE == 1
0F80    9002BD        5758     	MOV	DPTR, #PWM_BNFET_CPFET_ON_SAFE
                      5759     ENDIF
0F83    306507        5760     JNB FLAGS1 . 5 , COMM34_NONDAMP 
                      5761     	BPFET_OFF				
0F86    C294          5761+1   CLR P1 . 4 
0F88    7406          5762     MOV A , # 6 
0F8A    D5E0FD        5763     	DJNZ ACC,	$
                      5764     COMM34_NONDAMP: 
                      5765     IF HIGH_DRIVER_PRECHG_TIME NE 0	; Precharge high side gate driver
                               	CNFET_ON				
                               	MOV	A, #HIGH_DRIVER_PRECHG_TIME
                               	DJNZ ACC,	$
                               	CNFET_OFF				
                               	MOV	A, #PFETON_DELAY
                               	DJNZ ACC,	$
                               ENDIF
                      5773     	CPFET_ON					; Cp on
0F8D    207502        5773+1   JB FLAGS3 . 5 , ( $+5 ) 
0F90    D297          5773+1   SETB P1 . 7 
0F92    307502        5773+1   JNB FLAGS3 . 5 , ( $+5 ) 
0F95    D293          5773+1   SETB P1 . 3 
                      5774     	SET_COMP_PHASE_A 			; Set comparator to phase A
0F97    207503        5774+1   JB FLAGS3 . 5 , ( $+6 ) 
0F9A    759F81        5774+1   MOV CPT0MX , # 81H  ; SET COMPARATOR MULTIPLEXER TO PHASE A
0F9D    307503        5774+1   JNB FLAGS3 . 5 , ( $+6 ) 
0FA0    759F89        5774+1   MOV CPT0MX , # 89H 
0FA3    753E04        5775     	MOV	COMM_PHASE, #4
0FA6    02107C        5776     	JMP	COMM_EXIT
                      5777     
                      5778     COMM4COMM5: 	
0FA9    C2AF          5779     	CLR 	EA					; Disable all interrupts
0FAB    206A03        5780     JB FLAGS2 . 2 , COMM45_DAMP 
0FAE    020FCB        5781     	JMP	COMM45_NONDAMP
                      5782     COMM45_DAMP: 
                      5783     IF DAMPED_MODE_ENABLE == 0
                               	MOV	DPTR, #PWM_ANFET_CPFET_ON_FAST
                               ENDIF
                      5786     IF DAMPED_MODE_ENABLE == 1
0FB1    90027C        5787     	MOV	DPTR, #PWM_ANFET_CPFET_ON_SAFE
                      5788     ENDIF
0FB4    306517        5789     JNB FLAGS1 . 5 , COMM45_NFET 
                      5790     	APFET_OFF				
0FB7    207502        5790+1   JB FLAGS3 . 5 , ( $+5 ) 
0FBA    C293          5790+1   CLR P1 . 3 
0FBC    307502        5790+1   JNB FLAGS3 . 5 , ( $+5 ) 
0FBF    C297          5790+1   CLR P1 . 7 
                      5791     	BPFET_OFF				
0FC1    C294          5791+1   CLR P1 . 4 
0FC3    7406          5792     MOV A , # 6 
0FC5    D5E0FD        5793     	DJNZ ACC,	$
0FC8    020FCE        5794     	JMP	COMM45_NFET
                      5795     COMM45_NONDAMP: 
0FCB    9001CF        5796     	MOV	DPTR, #PWM_AFET_ON
                      5797     COMM45_NFET: 
                      5798     	BNFET_OFF					; Bn off
0FCE    C295          5798+1   CLR P1 . 5 
0FD0    305A0E        5799     JNB FLAGS0 . 2 , COMM45_CP 
                      5800     	ANFET_ON					; Yes - An on
0FD3    E525          5800+1   MOV A , CURRENT_PWM_LIMITED 
0FD5    600A          5800+1   JZ ( $+12 ) 
0FD7    207502        5800+1   JB FLAGS3 . 5 , ( $+5 ) 
0FDA    D292          5800+1   SETB P1 . 2 
0FDC    307502        5800+1   JNB FLAGS3 . 5 , ( $+5 ) 
0FDF    D296          5800+1   SETB P1 . 6 
                      5801     COMM45_CP: 
                      5802     	SET_COMP_PHASE_B 			; Set comparator to phase B
0FE1    759F80        5802+1   MOV CPT0MX , # 80H  ; SET COMPARATOR MULTIPLEXER TO PHASE B
0FE4    753E05        5803     	MOV	COMM_PHASE, #5
0FE7    02107C        5804     	JMP	COMM_EXIT
                      5805     
                      5806     COMM5COMM6: 	
0FEA    C2AF          5807     	CLR 	EA					; Disable all interrupts
                      5808     	CPFET_OFF					; Cp off
0FEC    207502        5808+1   JB FLAGS3 . 5 , ( $+5 ) 
0FEF    C297          5808+1   CLR P1 . 7 
0FF1    307502        5808+1   JNB FLAGS3 . 5 , ( $+5 ) 
0FF4    C293          5808+1   CLR P1 . 3 
0FF6    206A03        5809     JB FLAGS2 . 2 , COMM56_DAMP 
0FF9    021011        5810     	JMP	COMM56_NONDAMP
                      5811     COMM56_DAMP: 
                      5812     IF DAMPED_MODE_ENABLE == 0
                               	MOV	DPTR, #PWM_ANFET_BPFET_ON_FAST
                               	JB	FLAGS2.PGM_PWMOFF_DAMPED_LIGHT, COMM56_NONDAMP
                               ENDIF
                      5816     IF DAMPED_MODE_ENABLE == 1
0FFC    900233        5817     	MOV	DPTR, #PWM_ANFET_BPFET_ON_SAFE
                      5818     ENDIF
0FFF    30650F        5819     JNB FLAGS1 . 5 , COMM56_NONDAMP 
                      5820     	APFET_OFF				
1002    207502        5820+1   JB FLAGS3 . 5 , ( $+5 ) 
1005    C293          5820+1   CLR P1 . 3 
1007    307502        5820+1   JNB FLAGS3 . 5 , ( $+5 ) 
100A    C297          5820+1   CLR P1 . 7 
100C    7406          5821     MOV A , # 6 
100E    D5E0FD        5822     	DJNZ ACC,	$
                      5823     COMM56_NONDAMP: 
                      5824     IF HIGH_DRIVER_PRECHG_TIME NE 0	; Precharge high side gate driver
                               	BNFET_ON				
                               	MOV	A, #HIGH_DRIVER_PRECHG_TIME
                               	DJNZ ACC,	$
                               	BNFET_OFF				
                               	MOV	A, #PFETON_DELAY
                               	DJNZ ACC,	$
                               ENDIF
                      5832     	BPFET_ON					; Bp on
1011    D294          5832+1   SETB P1 . 4 
                      5833     	SET_COMP_PHASE_C 			; Set comparator to phase C
1013    207503        5833+1   JB FLAGS3 . 5 , ( $+6 ) 
1016    759F89        5833+1   MOV CPT0MX , # 89H  ; SET COMPARATOR MULTIPLEXER TO PHASE C
1019    307503        5833+1   JNB FLAGS3 . 5 , ( $+6 ) 
101C    759F81        5833+1   MOV CPT0MX , # 81H 
101F    753E06        5834     	MOV	COMM_PHASE, #6
1022    02107C        5835     	JMP	COMM_EXIT
                      5836     
                      5837     COMM6COMM1: 	
1025    C2AF          5838     	CLR 	EA					; Disable all interrupts
1027    206A03        5839     JB FLAGS2 . 2 , COMM61_DAMP 
102A    02104F        5840     	JMP	COMM61_NONDAMP
                      5841     COMM61_DAMP: 
                      5842     IF DAMPED_MODE_ENABLE == 0
                               	MOV	DPTR, #PWM_CNFET_BPFET_ON_FAST
                               ENDIF
                      5845     IF DAMPED_MODE_ENABLE == 1
102D    9003A0        5846     	MOV	DPTR, #PWM_CNFET_BPFET_ON_SAFE
                      5847     ENDIF
1030    30651F        5848     JNB FLAGS1 . 5 , COMM61_NFET 
                      5849     	APFET_OFF				
1033    207502        5849+1   JB FLAGS3 . 5 , ( $+5 ) 
1036    C293          5849+1   CLR P1 . 3 
1038    307502        5849+1   JNB FLAGS3 . 5 , ( $+5 ) 
103B    C297          5849+1   CLR P1 . 7 
                      5850     	CPFET_OFF				
103D    207502        5850+1   JB FLAGS3 . 5 , ( $+5 ) 
1040    C297          5850+1   CLR P1 . 7 
1042    307502        5850+1   JNB FLAGS3 . 5 , ( $+5 ) 
1045    C293          5850+1   CLR P1 . 3 
1047    7406          5851     MOV A , # 6 
1049    D5E0FD        5852     	DJNZ ACC,	$
104C    021052        5853     	JMP	COMM61_NFET
                      5854     COMM61_NONDAMP: 
104F    9001F3        5855     	MOV	DPTR, #PWM_CFET_ON
                      5856     COMM61_NFET: 
                      5857     	ANFET_OFF					; An off
1052    207502        5857+1   JB FLAGS3 . 5 , ( $+5 ) 
1055    C292          5857+1   CLR P1 . 2 
1057    307502        5857+1   JNB FLAGS3 . 5 , ( $+5 ) 
105A    C296          5857+1   CLR P1 . 6 
105C    305A0E        5858     JNB FLAGS0 . 2 , COMM61_CP 
                      5859     	CNFET_ON					; Yes - Cn on
105F    E525          5859+1   MOV A , CURRENT_PWM_LIMITED 
1061    600A          5859+1   JZ ( $+12 ) 
1063    207502        5859+1   JB FLAGS3 . 5 , ( $+5 ) 
1066    D296          5859+1   SETB P1 . 6 
1068    307502        5859+1   JNB FLAGS3 . 5 , ( $+5 ) 
106B    D292          5859+1   SETB P1 . 2 
                      5860     COMM61_CP: 
                      5861     	SET_COMP_PHASE_A 			; Set comparator to phase A
106D    207503        5861+1   JB FLAGS3 . 5 , ( $+6 ) 
1070    759F81        5861+1   MOV CPT0MX , # 81H  ; SET COMPARATOR MULTIPLEXER TO PHASE A
1073    307503        5861+1   JNB FLAGS3 . 5 , ( $+6 ) 
1076    759F89        5861+1   MOV CPT0MX , # 89H 
1079    753E01        5862     	MOV	COMM_PHASE, #1
                      5863     
                      5864     COMM_EXIT: 
107C    D2AF          5865     	SETB	EA					; Enable all interrupts
107E    789C          5866     MOV R0 , # PGM_DEMAG_COMP 
1080    E6            5867     MOV A , @ R0 
1081    C3            5868     	CLR	C
1082    9402          5869     	SUBB	A, #2				; Check whether power shall be kept off upon consecutive demgs			
1084    4007          5870     	JC	COMM_RESTORE_POWER		; Less than value - branch
                      5871     
1086    C3            5872     	CLR	C
1087    E539          5873     	MOV	A, DEMAG_CONSECUTIVE_CNT	; Check consecutive demags
1089    9403          5874     	SUBB	A, #3
108B    5002          5875     	JNC	COMM_RETURN			; Do not reapply power if many consecutive demags. This will help retain sync during hard accelerations
                      5876     
                      5877     COMM_RESTORE_POWER: 
108D    C25C          5878     CLR FLAGS0 . 4 
                      5879     
                      5880     COMM_RETURN: 
108F    22            5881     	RET
                      5882     
                      5883     
                      5884     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      5885     ;
                      5886     ; Switch power off routine
                      5887     ;
                      5888     ; No assumptions
                      5889     ;
                      5890     ; Switches all fets off 
                      5891     ;
                      5892     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      5893     SWITCH_POWER_OFF: 
1090    9001CD        5894     	MOV	DPTR, #PWM_NOFET_ON	; Set DPTR register to pwm_nofet_on label		
                      5895     	ALL_NFETS_OFF			; Turn off all nfets
1093    C292          5895+1   CLR P1 . 2 
1095    C296          5895+1   CLR P1 . 6 
1097    C295          5895+1   CLR P1 . 5 
                      5896     	ALL_PFETS_OFF			; Turn off all pfets
1099    C293          5896+1   CLR P1 . 3 
109B    C297          5896+1   CLR P1 . 7 
109D    C294          5896+1   CLR P1 . 4 
109F    C25A          5897     CLR FLAGS0 . 2 
10A1    22            5898     	RET			
                      5899     
                      5900     
                      5901     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      5902     ;
                      5903     ; Decrement stepper step routine
                      5904     ;
                      5905     ; No assumptions
                      5906     ;
                      5907     ; Decrements the stepper step 
                      5908     ;
                      5909     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      5910     DECREMENT_STEPPER_STEP: 
10A2    C3            5911     	CLR	C
10A3    E550          5912     	MOV	A, WT_STEPPER_STEP_L
10A5    9535          5913     	SUBB	A, STEPPER_STEP_END_L		; Minimum Stepper_Step_End
10A7    E551          5914     	MOV	A, WT_STEPPER_STEP_H
10A9    9536          5915     	SUBB	A, STEPPER_STEP_END_H	
10AB    5001          5916     	JNC	DECREMENT_STEP				; Branch if same or higher than minimum
10AD    22            5917     	RET
                      5918     
                      5919     DECREMENT_STEP: 
                      5920     	; Load programmed startup acceleration
10AE    7890          5921     MOV R0 , # PGM_STARTUP_ACCEL 
10B0    E6            5922     MOV A , @ R0 
10B1    FF            5923     MOV R7 , A 
                      5924     	; Check acceleration setting and set step size accordingly
10B2    C3            5925     	CLR	C
10B3    EF            5926     MOV A , R7 
10B4    9405          5927     	SUBB	A, #5
10B6    5018          5928     	JNC	DEC_STEP_HIGH
10B8    C3            5929     	CLR	C
10B9    EF            5930     MOV A , R7 
10BA    9404          5931     	SUBB	A, #4
10BC    501B          5932     	JNC	DEC_STEP_MED_HIGH
10BE    C3            5933     	CLR	C
10BF    EF            5934     MOV A , R7 
10C0    9403          5935     	SUBB	A, #3
10C2    501E          5936     	JNC	DEC_STEP_MED
10C4    C3            5937     	CLR	C
10C5    EF            5938     MOV A , R7 
10C6    9402          5939     	SUBB	A, #2
10C8    5021          5940     	JNC	DEC_STEP_MED_LOW
10CA    C3            5941     	CLR	C
10CB    EF            5942     MOV A , R7 
10CC    9401          5943     	SUBB	A, #1
10CE    5024          5944     	JNC	DEC_STEP_LOW
                      5945     
                      5946     DEC_STEP_HIGH: 
10D0    C3            5947     	CLR	C
10D1    E550          5948     	MOV	A, WT_STEPPER_STEP_L
10D3    943C          5949     	SUBB	A, #LOW(30 SHL 1)		
10D5    F8            5950     MOV R0 , A 
10D6    0210FD        5951     	JMP	DECREMENT_STEP_EXIT
                      5952     DEC_STEP_MED_HIGH: 
10D9    C3            5953     	CLR	C
10DA    E550          5954     	MOV	A, WT_STEPPER_STEP_L
10DC    9428          5955     	SUBB	A, #LOW(20 SHL 1)		
10DE    F8            5956     MOV R0 , A 
10DF    0210FD        5957     	JMP	DECREMENT_STEP_EXIT
                      5958     DEC_STEP_MED: 
10E2    C3            5959     	CLR	C
10E3    E550          5960     	MOV	A, WT_STEPPER_STEP_L
10E5    941A          5961     	SUBB	A, #LOW(13 SHL 1)		
10E7    F8            5962     MOV R0 , A 
10E8    0210FD        5963     	JMP	DECREMENT_STEP_EXIT
                      5964     DEC_STEP_MED_LOW: 
10EB    C3            5965     	CLR	C
10EC    E550          5966     	MOV	A, WT_STEPPER_STEP_L
10EE    9412          5967     	SUBB	A, #LOW(9 SHL 1)		
10F0    F8            5968     MOV R0 , A 
10F1    0210FD        5969     	JMP	DECREMENT_STEP_EXIT
                      5970     DEC_STEP_LOW: 
10F4    C3            5971     	CLR	C
10F5    E550          5972     	MOV	A, WT_STEPPER_STEP_L
10F7    940A          5973     	SUBB	A, #LOW(5 SHL 1)		
10F9    F8            5974     MOV R0 , A 
10FA    0210FD        5975     	JMP	DECREMENT_STEP_EXIT
                      5976     
                      5977     DECREMENT_STEP_EXIT: 
10FD    E551          5978     	MOV	A, WT_STEPPER_STEP_H
10FF    9400          5979     	SUBB	A, #0		
1101    F9            5980     MOV R1 , A 
1102    8850          5981     MOV WT_STEPPER_STEP_L , R0 
1104    8951          5982     MOV WT_STEPPER_STEP_H , R1 
1106    22            5983     	RET
                      5984     
                      5985     
                      5986     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      5987     ;
                      5988     ; Stepper timer wait
                      5989     ;
                      5990     ; No assumptions
                      5991     ;
                      5992     ; Waits for the stepper step timer to elapse
                      5993     ;
                      5994     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      5995     STEPPER_TIMER_WAIT: 
1107    305802        5996     JNB FLAGS0 . 0 , ( $+5 ) 
110A    2107          5997     	AJMP	STEPPER_TIMER_WAIT		; Yes, go back
110C    22            5998     	RET
                      5999     
                      6000     
                      6001     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      6002     ;
                      6003     ; Set default parameters
                      6004     ;
                      6005     ; No assumptions
                      6006     ;
                      6007     ; Sets default programming parameters
                      6008     ;
                      6009     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      6010     SET_DEFAULT_PARAMETERS: 
                      6011     IF MODE == 0	; Main
                               	MOV	TEMP1, #PGM_GOV_P_GAIN
                               	MOV	@TEMP1, #DEFAULT_PGM_MAIN_P_GAIN
                               	INC	TEMP1
                               	MOV	@TEMP1, #DEFAULT_PGM_MAIN_I_GAIN
                               	INC	TEMP1
                               	MOV	@TEMP1, #DEFAULT_PGM_MAIN_GOVERNOR_MODE
                               	INC	TEMP1
                               	MOV	@TEMP1, #DEFAULT_PGM_MAIN_LOW_VOLTAGE_LIM
                               	INC	TEMP1
                               	MOV	@TEMP1, #0XFF	; Motor gain
                               	INC	TEMP1
                               	MOV	@TEMP1, #0XFF	; Motor idle
                               	INC	TEMP1
                               	MOV	@TEMP1, #DEFAULT_PGM_MAIN_STARTUP_PWR
                               	INC	TEMP1
                               	MOV	@TEMP1, #DEFAULT_PGM_MAIN_PWM_FREQ
                               	INC	TEMP1
                               	MOV	@TEMP1, #DEFAULT_PGM_MAIN_DIRECTION
                               	INC	TEMP1
                               	MOV	@TEMP1, #DEFAULT_PGM_MAIN_RCP_PWM_POL
                               
                               	MOV	TEMP1, #PGM_ENABLE_TX_PROGRAM
                               	MOV	@TEMP1, #DEFAULT_PGM_ENABLE_TX_PROGRAM
                               	INC	TEMP1
                               	MOV	@TEMP1, #DEFAULT_PGM_MAIN_REARM_START
                               	INC	TEMP1
                               	MOV	@TEMP1, #DEFAULT_PGM_MAIN_GOV_SETUP_TARGET
                               	INC	TEMP1
                               	MOV	@TEMP1, #DEFAULT_PGM_MAIN_STARTUP_RPM
                               	INC	TEMP1
                               	MOV	@TEMP1, #DEFAULT_PGM_MAIN_STARTUP_ACCEL
                               	INC	TEMP1
                               	MOV	@TEMP1, #0XFF	; Voltage comp
                               	INC	TEMP1
                               	MOV	@TEMP1, #DEFAULT_PGM_MAIN_COMM_TIMING
                               	INC	TEMP1
                               	MOV	@TEMP1, #DEFAULT_PGM_MAIN_DAMPING_FORCE
                               	INC	TEMP1
                               	MOV	@TEMP1, #DEFAULT_PGM_MAIN_GOVERNOR_RANGE
                               	INC	TEMP1
                               	MOV	@TEMP1, #DEFAULT_PGM_MAIN_STARTUP_METHOD
                               	INC	TEMP1
                               	MOV	@TEMP1, #DEFAULT_PGM_PPM_MIN_THROTTLE
                               	INC	TEMP1
                               	MOV	@TEMP1, #DEFAULT_PGM_PPM_MAX_THROTTLE
                               	INC	TEMP1
                               	MOV	@TEMP1, #DEFAULT_PGM_MAIN_BEEP_STRENGTH
                               	INC	TEMP1
                               	MOV	@TEMP1, #DEFAULT_PGM_MAIN_BEACON_STRENGTH
                               	INC	TEMP1
                               	MOV	@TEMP1, #DEFAULT_PGM_MAIN_BEACON_DELAY
                               	INC	TEMP1
                               	MOV	@TEMP1, #DEFAULT_PGM_MAIN_THROTTLE_RATE
                               	INC	TEMP1
                               	MOV	@TEMP1, #DEFAULT_PGM_MAIN_DEMAG_COMP
                               	INC	TEMP1
                               	MOV	@TEMP1, #DEFAULT_PGM_BEC_VOLTAGE_HIGH
                               	INC	TEMP1
                               	MOV	@TEMP1, #DEFAULT_PGM_PPM_CENTER_THROTTLE
                               ENDIF
                      6072     IF MODE == 1	; Tail
                               	MOV	TEMP1, #PGM_GOV_P_GAIN
                               	MOV	@TEMP1, #0XFF	; Governor P gain
                               	INC	TEMP1
                               	MOV	@TEMP1, #0XFF	; Governor I gain
                               	INC	TEMP1
                               	MOV	@TEMP1, #0XFF	; Governor mode
                               	INC	TEMP1
                               	MOV	@TEMP1, #0XFF	; Low voltage limit
                               	INC	TEMP1
                               	MOV	@TEMP1, #DEFAULT_PGM_TAIL_GAIN
                               	INC	TEMP1
                               	MOV	@TEMP1, #DEFAULT_PGM_TAIL_IDLE_SPEED
                               	INC	TEMP1
                               	MOV	@TEMP1, #DEFAULT_PGM_TAIL_STARTUP_PWR
                               	INC	TEMP1
                               	MOV	@TEMP1, #DEFAULT_PGM_TAIL_PWM_FREQ
                               	INC	TEMP1
                               	MOV	@TEMP1, #DEFAULT_PGM_TAIL_DIRECTION
                               	INC	TEMP1
                               	MOV	@TEMP1, #DEFAULT_PGM_TAIL_RCP_PWM_POL
                               
                               	MOV	TEMP1, #PGM_ENABLE_TX_PROGRAM
                               	MOV	@TEMP1, #DEFAULT_PGM_ENABLE_TX_PROGRAM
                               	INC	TEMP1
                               	MOV	@TEMP1, #0XFF	; Main rearm start
                               	INC	TEMP1
                               	MOV	@TEMP1, #0XFF	; Governor setup target
                               	INC	TEMP1
                               	MOV	@TEMP1, #DEFAULT_PGM_TAIL_STARTUP_RPM
                               	INC	TEMP1
                               	MOV	@TEMP1, #DEFAULT_PGM_TAIL_STARTUP_ACCEL
                               	INC	TEMP1
                               	MOV	@TEMP1, #0XFF	; Voltage comp
                               	INC	TEMP1
                               	MOV	@TEMP1, #DEFAULT_PGM_TAIL_COMM_TIMING
                               	INC	TEMP1
                               	MOV	@TEMP1, #DEFAULT_PGM_TAIL_DAMPING_FORCE
                               	INC	TEMP1
                               	MOV	@TEMP1, #0XFF	; Governor range
                               	INC	TEMP1
                               	MOV	@TEMP1, #DEFAULT_PGM_TAIL_STARTUP_METHOD
                               	INC	TEMP1
                               	MOV	@TEMP1, #DEFAULT_PGM_PPM_MIN_THROTTLE
                               	INC	TEMP1
                               	MOV	@TEMP1, #DEFAULT_PGM_PPM_MAX_THROTTLE
                               	INC	TEMP1
                               	MOV	@TEMP1, #DEFAULT_PGM_TAIL_BEEP_STRENGTH
                               	INC	TEMP1
                               	MOV	@TEMP1, #DEFAULT_PGM_TAIL_BEACON_STRENGTH
                               	INC	TEMP1
                               	MOV	@TEMP1, #DEFAULT_PGM_TAIL_BEACON_DELAY
                               	INC	TEMP1
                               	MOV	@TEMP1, #DEFAULT_PGM_TAIL_THROTTLE_RATE
                               	INC	TEMP1
                               	MOV	@TEMP1, #DEFAULT_PGM_TAIL_DEMAG_COMP
                               	INC	TEMP1
                               	MOV	@TEMP1, #DEFAULT_PGM_BEC_VOLTAGE_HIGH
                               	INC	TEMP1
                               	MOV	@TEMP1, #DEFAULT_PGM_PPM_CENTER_THROTTLE
                               ENDIF
                      6133     IF MODE == 2	; Multi
110D    7880          6134     MOV R0 , # PGM_GOV_P_GAIN 
110F    7609          6135     MOV @ R0 , # 9 
1111    08            6136     INC R0 
1112    7609          6137     MOV @ R0 , # 9 
1114    08            6138     INC R0 
1115    7604          6139     MOV @ R0 , # 4 
1117    08            6140     INC R0 
1118    7601          6141     MOV @ R0 , # 1 
111A    08            6142     INC R0 
111B    7603          6143     MOV @ R0 , # 3 
111D    08            6144     INC R0 
111E    76FF          6145     MOV @ R0 , # 0XFF 
1120    08            6146     INC R0 
1121    7609          6147     MOV @ R0 , # 9 
1123    08            6148     INC R0 
1124    7601          6149     MOV @ R0 , # 1 
1126    08            6150     INC R0 
1127    7601          6151     MOV @ R0 , # 1 
1129    08            6152     INC R0 
112A    7601          6153     MOV @ R0 , # 1 
                      6154     
112C    788C          6155     MOV R0 , # PGM_ENABLE_TX_PROGRAM 
112E    7601          6156     MOV @ R0 , # 1 
1130    08            6157     INC R0 
1131    76FF          6158     MOV @ R0 , # 0XFF 
1133    08            6159     INC R0 
1134    76FF          6160     MOV @ R0 , # 0XFF 
1136    08            6161     INC R0 
1137    7601          6162     MOV @ R0 , # 1 
1139    08            6163     INC R0 
113A    7605          6164     MOV @ R0 , # 5 
113C    08            6165     INC R0 
113D    76FF          6166     MOV @ R0 , # 0XFF 
113F    08            6167     INC R0 
1140    7603          6168     MOV @ R0 , # 3 
1142    08            6169     INC R0 
1143    7606          6170     MOV @ R0 , # 6 
1145    08            6171     INC R0 
1146    76FF          6172     MOV @ R0 , # 0XFF 
1148    08            6173     INC R0 
1149    7602          6174     MOV @ R0 , # 2 
114B    08            6175     INC R0 
114C    7625          6176     MOV @ R0 , # 37 
114E    08            6177     INC R0 
114F    76D0          6178     MOV @ R0 , # 208 
1151    08            6179     INC R0 
1152    7628          6180     MOV @ R0 , # 40 
1154    08            6181     INC R0 
1155    7650          6182     MOV @ R0 , # 80 
1157    08            6183     INC R0 
1158    7604          6184     MOV @ R0 , # 4 
115A    08            6185     INC R0 
115B    760D          6186     MOV @ R0 , # 13 
115D    08            6187     INC R0 
115E    7602          6188     MOV @ R0 , # 2 
1160    08            6189     INC R0 
1161    7600          6190     MOV @ R0 , # 0 
1163    08            6191     INC R0 
1164    767A          6192     MOV @ R0 , # 122 
                      6193     ENDIF
1166    22            6194     	RET
                      6195     
                      6196     
                      6197     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      6198     ;
                      6199     ; Decode parameters
                      6200     ;
                      6201     ; No assumptions
                      6202     ;
                      6203     ; Decodes programming parameters
                      6204     ;
                      6205     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      6206     DECODE_PARAMETERS: 
                      6207     	; Load programmed damping force
1167    7893          6208     MOV R0 , # PGM_DAMPING_FORCE 
1169    E6            6209     MOV A , @ R0 
116A    FF            6210     MOV R7 , A 
                      6211     	; Decode damping
116B    756609        6212     	MOV	DAMPING_PERIOD, #9		; Set default
116E    756701        6213     	MOV	DAMPING_ON, #1
1171    C3            6214     	CLR	C
1172    BF0206        6215     CJNE R7 , # 2 , DECODE_DAMPING_3 
                      6216     
1175    756605        6217     	MOV	DAMPING_PERIOD, #5
1178    756701        6218     	MOV	DAMPING_ON, #1
                      6219     
                      6220     DECODE_DAMPING_3: 
117B    C3            6221     	CLR	C
117C    BF0306        6222     CJNE R7 , # 3 , DECODE_DAMPING_4 
                      6223     
117F    756605        6224     	MOV	DAMPING_PERIOD, #5
1182    756702        6225     	MOV	DAMPING_ON, #2
                      6226     
                      6227     DECODE_DAMPING_4: 
1185    C3            6228     	CLR	C
1186    BF0406        6229     CJNE R7 , # 4 , DECODE_DAMPING_5 
                      6230     
1189    756605        6231     	MOV	DAMPING_PERIOD, #5
118C    756703        6232     	MOV	DAMPING_ON, #3
                      6233     
                      6234     DECODE_DAMPING_5: 
118F    C3            6235     	CLR	C
1190    BF0506        6236     CJNE R7 , # 5 , DECODE_DAMPING_6 
                      6237     
1193    756609        6238     	MOV	DAMPING_PERIOD, #9
1196    756707        6239     	MOV	DAMPING_ON, #7
                      6240     
                      6241     DECODE_DAMPING_6: 
1199    C3            6242     	CLR	C
119A    BF0606        6243     CJNE R7 , # 6 , DECODE_DAMPING_DONE 
                      6244     
119D    756600        6245     	MOV	DAMPING_PERIOD, #0
11A0    756700        6246     	MOV	DAMPING_ON, #0
                      6247     
                      6248     DECODE_DAMPING_DONE: 
                      6249     	; Load programmed pwm frequency
11A3    7887          6250     MOV R0 , # PGM_PWM_FREQ 
11A5    E6            6251     MOV A , @ R0 
11A6    FF            6252     MOV R7 , A 
                      6253     IF MODE == 0	; Main
                               	CLR	FLAGS2.PGM_PWMOFF_DAMPED_LIGHT
                               	CLR	C
                               	CJNE	TEMP8, #3, ($+5)
                               	SETB	FLAGS2.PGM_PWMOFF_DAMPED_LIGHT
                               	CLR	FLAGS2.PGM_PWMOFF_DAMPED_FULL
                               ENDIF
                      6260     IF MODE >= 1	; Tail or multi
11A7    C26C          6261     CLR FLAGS2 . 4 
11A9    C3            6262     	CLR	C
11AA    BF0302        6263     CJNE R7 , # 3 , ( $+5 ) 
11AD    D26C          6264     SETB FLAGS2 . 4 
11AF    C26B          6265     CLR FLAGS2 . 3 
11B1    C3            6266     	CLR	C
11B2    BF0402        6267     CJNE R7 , # 4 , ( $+5 ) 
11B5    D26B          6268     SETB FLAGS2 . 3 
                      6269     ENDIF
11B7    C26A          6270     CLR FLAGS2 . 2 
11B9    7418          6271     	MOV	A, #((1 SHL PGM_PWMOFF_DAMPED_FULL)+(1 SHL PGM_PWMOFF_DAMPED_LIGHT))
11BB    552D          6272     	ANL	A, FLAGS2					; Check if any damped mode is set
11BD    6002          6273     	JZ	($+4)
11BF    D26A          6274     SETB FLAGS2 . 2 
11C1    C265          6275     CLR FLAGS1 . 5 
11C3    6002          6276     	JZ	($+4)
11C5    D265          6277     SETB FLAGS1 . 5 
11C7    D266          6278     SETB FLAGS1 . 6 
11C9    6002          6279     	JZ	($+4)
11CB    C266          6280     CLR FLAGS1 . 6 
                      6281     	; Load programmed direction
11CD    7888          6282     MOV R0 , # PGM_DIRECTION 
                      6283     IF MODE >= 1	; Tail or multi
11CF    E6            6284     MOV A , @ R0 
11D0    C3            6285     	CLR	C
11D1    9403          6286     	SUBB	A, #3
11D3    6008          6287     	JZ	DECODE_PARAMS_DIR_SET
                      6288     ENDIF
                      6289     
11D5    C275          6290     CLR FLAGS3 . 5 
11D7    E6            6291     MOV A , @ R0 
11D8    30E102        6292     	JNB	ACC.1, ($+5)
11DB    D275          6293     SETB FLAGS3 . 5 
                      6294     DECODE_PARAMS_DIR_SET: 
11DD    C276          6295     CLR FLAGS3 . 6 
11DF    7889          6296     MOV R0 , # PGM_INPUT_POL 
11E1    E6            6297     MOV A , @ R0 
11E2    30E102        6298     	JNB	ACC.1, ($+5)
11E5    D276          6299     SETB FLAGS3 . 6 
11E7    C3            6300     	CLR	C
11E8    EF            6301     MOV A , R7 
11E9    9402          6302     	SUBB	A, #2
11EB    6008          6303     	JZ	DECODE_PWM_FREQ_LOW
                      6304     
11ED    758E01        6305     	MOV	CKCON, #01H		; Timer0 set for clk/4 (22kHz pwm)
11F0    D26D          6306     SETB FLAGS2 . 5 
11F2    0211FA        6307     	JMP	DECODE_PWM_FREQ_END
                      6308     
                      6309     DECODE_PWM_FREQ_LOW: 
11F5    758E00        6310     	MOV	CKCON, #00H		; Timer0 set for clk/12 (8kHz pwm)
11F8    C26D          6311     CLR FLAGS2 . 5 
                      6312     
                      6313     DECODE_PWM_FREQ_END: 
11FA    22            6314     	RET
                      6315     
                      6316     
                      6317     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      6318     ;
                      6319     ; Decode governor gain
                      6320     ;
                      6321     ; No assumptions
                      6322     ;
                      6323     ; Decodes governor gains
                      6324     ;
                      6325     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      6326     DECODE_GOVERNOR_GAINS: 
                      6327     	; Decode governor gains
11FB    7880          6328     MOV R0 , # PGM_GOV_P_GAIN 
11FD    E6            6329     MOV A , @ R0 
11FE    14            6330     	DEC	A	
11FF    900080        6331     	MOV	DPTR, #GOV_GAIN_TABLE
1202    93            6332     	MOVC A, @A+DPTR	
1203    789F          6333     MOV R0 , # PGM_GOV_P_GAIN_DECODED 
1205    F6            6334     MOV @ R0 , A 
1206    7881          6335     MOV R0 , # PGM_GOV_I_GAIN 
1208    E6            6336     MOV A , @ R0 
1209    14            6337     	DEC	A	
120A    900080        6338     	MOV	DPTR, #GOV_GAIN_TABLE
120D    93            6339     	MOVC A, @A+DPTR	
120E    78A0          6340     MOV R0 , # PGM_GOV_I_GAIN_DECODED 
1210    F6            6341     MOV @ R0 , A 
1211    1190          6342     	CALL	SWITCH_POWER_OFF		; Reset DPTR
1213    22            6343     	RET
                      6344     
                      6345     
                      6346     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      6347     ;
                      6348     ; Decode throttle rate
                      6349     ;
                      6350     ; No assumptions
                      6351     ;
                      6352     ; Decodes throttle rate
                      6353     ;
                      6354     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      6355     DECODE_THROTTLE_RATE: 
                      6356     	; Decode throttle rate
1214    789B          6357     MOV R0 , # PGM_THROTTLE_RATE 
1216    E6            6358     MOV A , @ R0 
1217    14            6359     	DEC	A	
1218    90008D        6360     	MOV	DPTR, #THROTTLE_RATE_TABLE
121B    93            6361     	MOVC A, @A+DPTR	
121C    78A1          6362     MOV R0 , # PGM_THROTTLE_RATE_DECODED 
121E    F6            6363     MOV @ R0 , A 
121F    1190          6364     	CALL	SWITCH_POWER_OFF			; Reset DPTR
1221    22            6365     	RET
                      6366     
                      6367     
                      6368     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      6369     ;
                      6370     ; Decode startup power
                      6371     ;
                      6372     ; No assumptions
                      6373     ;
                      6374     ; Decodes startup power
                      6375     ;
                      6376     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      6377     DECODE_STARTUP_POWER: 
                      6378     	; Decode startup power
1222    7886          6379     MOV R0 , # PGM_STARTUP_PWR 
1224    E6            6380     MOV A , @ R0 
1225    14            6381     	DEC	A	
1226    90009A        6382     	MOV	DPTR, #STARTUP_POWER_TABLE
1229    93            6383     	MOVC A, @A+DPTR	
122A    78A2          6384     MOV R0 , # PGM_STARTUP_PWR_DECODED 
122C    F6            6385     MOV @ R0 , A 
122D    1190          6386     	CALL	SWITCH_POWER_OFF			; Reset DPTR
122F    22            6387     	RET
                      6388     
                      6389     
                      6390     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      6391     ;
                      6392     ; Decode demag compensation
                      6393     ;
                      6394     ; No assumptions
                      6395     ;
                      6396     ; Decodes throttle rate
                      6397     ;
                      6398     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      6399     DECODE_DEMAG_COMP: 
                      6400     	; Decode demag compensation
1230    789C          6401     MOV R0 , # PGM_DEMAG_COMP 
1232    E6            6402     MOV A , @ R0 
1233    14            6403     	DEC	A	
1234    9000A7        6404     	MOV	DPTR, #DEMAG_POWER_TABLE
1237    93            6405     	MOVC A, @A+DPTR	
1238    78A3          6406     MOV R0 , # PGM_DEMAG_COMP_POWER_DECODED 
123A    F6            6407     MOV @ R0 , A 
123B    1190          6408     	CALL	SWITCH_POWER_OFF			; Reset DPTR
123D    22            6409     	RET
                      6410     
                      6411     
                      6412     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      6413     ;
                      6414     ; Set BEC voltage
                      6415     ;
                      6416     ; No assumptions
                      6417     ;
                      6418     ; Sets the BEC output voltage low or high
                      6419     ;
                      6420     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      6421     SET_BEC_VOLTAGE: 
                      6422     	; Set bec voltage
                      6423     IF DUAL_BEC_VOLTAGE == 1
                               	SET_BEC_LO			; Set default to low
                               	MOV	TEMP1, #PGM_BEC_VOLTAGE_HIGH		
                               	MOV	A, @TEMP1				
                               	JZ	SET_BEC_VOLTAGE_EXIT	
                               
                               	SET_BEC_HI			; Set to high
                               
                               SET_BEC_VOLTAGE_EXIT:
                               ENDIF
123E    22            6433     	RET
                      6434     
                      6435     
                      6436     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      6437     ;
                      6438     ; Find throttle gain
                      6439     ;
                      6440     ; The difference between max and min throttle must be more than 520us (a Pgm_Ppm_xxx_Throttle difference of 130)
                      6441     ;
                      6442     ; Finds throttle gain from throttle calibration values
                      6443     ;
                      6444     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      6445     FIND_THROTTLE_GAIN: 
                      6446     	; Load programmed minimum and maximum throttle
123F    7896          6447     MOV R0 , # PGM_PPM_MIN_THROTTLE 
1241    E6            6448     MOV A , @ R0 
1242    FA            6449     MOV R2 , A 
1243    7897          6450     MOV R0 , # PGM_PPM_MAX_THROTTLE 
1245    E6            6451     MOV A , @ R0 
1246    FB            6452     MOV R3 , A 
                      6453     	; Check if full range is chosen
1247    307704        6454     JNB FLAGS3 . 7 , FIND_THROTTLE_GAIN_CALCULATE 
                      6455     
124A    7A00          6456     MOV R2 , # 0 
124C    7BFF          6457     MOV R3 , # 255 
                      6458     
                      6459     FIND_THROTTLE_GAIN_CALCULATE: 
                      6460     	; Calculate difference
124E    C3            6461     	CLR	C
124F    EB            6462     MOV A , R3 
1250    9A            6463     SUBB A , R2 
1251    FC            6464     MOV R4 , A 
                      6465     	; Check that difference is minimum 130
1252    C3            6466     	CLR	C
1253    9482          6467     	SUBB	A, #130
1255    5002          6468     	JNC	($+4)
                      6469     
1257    7C82          6470     MOV R4 , # 130 
                      6471     
                      6472     	; Find gain
1259    756E00        6473     	MOV	PPM_THROTTLE_GAIN, #0
                      6474     TEST_THROTTLE_GAIN: 
125C    056E          6475     	INC	PPM_THROTTLE_GAIN
125E    EC            6476     MOV A , R4 
125F    856EF0        6477     	MOV	B, PPM_THROTTLE_GAIN	; A has difference, B has gain
1262    A4            6478     	MUL	AB
1263    C3            6479     	CLR	C
1264    E5F0          6480     	MOV	A, B
1266    9480          6481     	SUBB	A, #128
1268    40F2          6482     	JC	TEST_THROTTLE_GAIN
126A    22            6483     	RET
                      6484     
                      6485     
                      6486     
                      6487     
                      6488     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      6489     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      6490     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      6491     ;
                      6492     ; Main program start
                      6493     ;
                      6494     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      6495     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      6496     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      6497     
                      6498     RESET: 
                      6499     	; Check flash lock byte
126B    E5EF          6500     	MOV	A, RSTSRC			
126D    20E603        6501     	JB	ACC.6, ($+6)		; Check if flash access error was reset source 
                      6502     
1270    752000        6503     	MOV	BIT_ACCESS, #0		; No - then this is the first try
                      6504     
1273    0520          6505     	INC	BIT_ACCESS
1275    903FFF        6506     MOV DPTR , # 16383 
1278    E520          6507     	MOV	A, BIT_ACCESS
127A    14            6508     	DEC	A
127B    6006          6509     	JZ	LOCK_BYTE_TEST
                      6510     
127D    901FFF        6511     MOV DPTR , # 8191 
1280    14            6512     	DEC	A
1281    6000          6513     	JZ	LOCK_BYTE_TEST
                      6514     
                      6515     LOCK_BYTE_TEST: 
1283    93            6516     	MOVC A, @A+DPTR		; Read lock byte
1284    04            6517     	INC	A				
1285    6003          6518     	JZ	LOCK_BYTE_OK		; If lock byte is 0xFF, then start code execution
                      6519     
                      6520     IF ONE_S_CAPABLE == 0		
1287    75EF12        6521     	MOV	RSTSRC, #12H		; Generate hardware reset and set VDD monitor
                      6522     ELSE
                               	MOV	RSTSRC, #10H		; Generate hardware reset and disable VDD monitor
                               ENDIF
                      6525     
                      6526     LOCK_BYTE_OK: 
                      6527     	; Select register bank 0 for main program routines
128A    C2D3          6528     	CLR	PSW.3			; Select register bank 0 for main program routines	
                      6529     	; Disable the WDT.
128C    53D9BF        6530     	ANL	PCA0MD, #NOT(40H)	; Clear watchdog enable bit
                      6531     	; Initialize stack
128F    7581C0        6532     	MOV	SP, #0C0H			; Stack = 64 upper bytes of RAM
                      6533     	; Initialize VDD monitor
1292    43FF80        6534     	ORL	VDM0CN, #080H    	; Enable the VDD monitor
1295    1207EB        6535     	CALL	WAIT1MS			; Wait at least 100us
                      6536     IF ONE_S_CAPABLE == 0		
1298    75EF02        6537     	MOV 	RSTSRC, #02H   	; Set VDD monitor as a reset source (PORSF) if not 1S capable                                
                      6538     ELSE
                               	MOV 	RSTSRC, #00H   	; Do not set VDD monitor as a reset source for 1S ESCSs, in order to avoid resets due to it                              
                               ENDIF
                      6541     	; Set clock frequency
129B    43B203        6542     	ORL	OSCICN, #03H		; Set clock divider to 1
129E    E5B3          6543     	MOV	A, OSCICL				
12A0    2404          6544     	ADD	A, #04H			; 24.5MHz to 24MHz (~0.5% per step)
12A2    4002          6545     	JC	RESET_CAL_DONE		; Is carry set? - skip next instruction
                      6546     
12A4    F5B3          6547     	MOV	OSCICL, A
                      6548     
                      6549     RESET_CAL_DONE: 
                      6550     	; Switch power off
12A6    1190          6551     	CALL	SWITCH_POWER_OFF
                      6552     	; Ports initialization
12A8    7580FF        6553     MOV P0 , # 255 
12AB    75A400        6554     MOV P0MDOUT , # 0 
12AE    75F1F0        6555     MOV P0MDIN , # -16 
12B1    75D4DF        6556     MOV P0SKIP , # -33 
12B4    759002        6557     MOV P1 , # 2 
12B7    75A5FC        6558     MOV P1MDOUT , # 252 
12BA    75F2FD        6559     MOV P1MDIN , # -3 
12BD    75D502        6560     MOV P1SKIP , # 2 
                      6561     IF PORT3_EXIST == 1
                               	MOV	P2, #P2_INIT				
                               ENDIF
12C0    75A610        6564     MOV P2MDOUT , # 16 
                      6565     IF PORT3_EXIST == 1
                               	MOV	P2MDIN, #P2_DIGITAL				
                               	MOV	P2SKIP, #P2_SKIP				
                               	MOV	P3, #P3_INIT				
                               	MOV	P3MDOUT, #P3_PUSHPULL				
                               	MOV	P3MDIN, #P3_DIGITAL				
                               ENDIF
                      6572     	; Initialize the XBAR and related functionality
                      6573     	INITIALIZE_XBAR		
12C3    75A0FF        6573+1   MOV P2 , # 255  ; DO PORT 2 INITIALIZATION HERE			
12C6    75F3F1        6573+1   MOV P2MDIN , # -15 
12C9    75E241        6573+1   MOV XBR1 , # 41H  ; XBAR ENABLED, CEX0 ROUTED TO PIN RCP_IN			
                      6574     	; Clear RAM
12CC    E4            6575     	CLR	A				; Clear accumulator
12CD    F8            6576     MOV R0 , A 
                      6577     CLEAR_RAM: 	
12CE    F6            6578     MOV @ R0 , A 
12CF    D8FD          6579     DJNZ R0 , CLEAR_RAM 
                      6580     	; Set default programmed parameters
12D1    310D          6581     	CALL	SET_DEFAULT_PARAMETERS
                      6582     	; EEPROM 
12D3    1218A9        6583     	CALL ERASE_AND_STORE_ALL_IN_EEPROM
                      6584     	; Decode parameters
12D6    3167          6585     	CALL	DECODE_PARAMETERS
                      6586     	; Decode governor gains
12D8    31FB          6587     	CALL	DECODE_GOVERNOR_GAINS
                      6588     	; Decode throttle rate
12DA    5114          6589     	CALL	DECODE_THROTTLE_RATE
                      6590     	; Decode startup power
12DC    5122          6591     	CALL	DECODE_STARTUP_POWER
                      6592     	; Decode demag compensation
12DE    5130          6593     	CALL	DECODE_DEMAG_COMP
                      6594     	; Set BEC voltage
12E0    513E          6595     	CALL	SET_BEC_VOLTAGE
                      6596     	; Find throttle gain from stored min and max settings
12E2    513F          6597     	CALL	FIND_THROTTLE_GAIN
                      6598     	; Set beep strength
12E4    7898          6599     MOV R0 , # PGM_BEEP_STRENGTH 
12E6    866F          6600     MOV BEEP_STRENGTH , @ R0 
                      6601     	; Switch power off
12E8    1190          6602     	CALL	SWITCH_POWER_OFF
                      6603     	; Timer control
12EA    758850        6604     	MOV	TCON, #50H		; Timer0 and timer1 enabled
                      6605     	; Timer mode
12ED    758902        6606     	MOV	TMOD, #02H		; Timer0 as 8bit
                      6607     	; Timer2: clk/12 for 128us and 32ms interrupts
12F0    75C824        6608     	MOV	TMR2CN, #24H		; Timer2 enabled, low counter interrups enabled 
                      6609     	; Timer3: clk/12 for commutation timing
12F3    759104        6610     	MOV	TMR3CN, #04H		; Timer3 enabled
                      6611     	; PCA
12F6    75D840        6612     	MOV	PCA0CN, #40H		; PCA enabled
                      6613     	; Initializing beep
12F9    C2AF          6614     	CLR	EA				; Disable interrupts explicitly
12FB    120804        6615     	CALL WAIT200MS	
12FE    120814        6616     	CALL BEEP_F1
1301    1207FA        6617     	CALL WAIT30MS
1304    12081B        6618     	CALL BEEP_F2
1307    1207FA        6619     	CALL WAIT30MS
130A    120822        6620     	CALL BEEP_F3
130D    1207FA        6621     	CALL WAIT30MS
                      6622     
                      6623     	; Wait for receiver to initialize
1310    121CB8        6624     	CALL	WAIT1S
1313    120804        6625     	CALL	WAIT200MS
1316    120804        6626     	CALL	WAIT200MS
1319    1207FF        6627     	CALL	WAIT100MS
                      6628     
                      6629     	; Enable interrupts
131C    75A822        6630     	MOV	IE, #22H			; Enable timer0 and timer2 interrupts
131F    75B802        6631     	MOV	IP, #02H			; High priority to timer0 interrupts
1322    75E690        6632     	MOV	EIE1, #90H		; Enable timer3 and PCA0 interrupts
                      6633     	; Initialize comparator
1325    759B80        6634     	MOV	CPT0CN, #80H		; Comparator enabled, no hysteresis
1328    759D03        6635     	MOV	CPT0MD, #03H		; Comparator response time 1us
                      6636     IF COMP1_USED == 1			
                               	MOV	CPT1CN, #80H		; Comparator enabled, no hysteresis
                               	MOV	CPT1MD, #03H		; Comparator response time 1us
                               ENDIF
                      6640     	; Initialize ADC
                      6641     	INITIALIZE_ADC			; Initialize ADC operation
132B    75D10E        6641+1   MOV REF0CN , # 0EH  ; SET VDD (3.3V) AS REFERENCE. ENABLE TEMP SENSOR AND BIAS
132E    75BC58        6641+1   MOV ADC0CF , # 58H  ; ADC CLOCK 2MHZ
1331    75BB09        6641+1   MOV AMX0P , # ( 8+ADC_IP )  ; SELECT POSITIVE INPUT
1334    75BA11        6641+1   MOV AMX0N , # 11H  ; SELECT NEGATIVE INPUT AS GROUND
1337    75E880        6641+1   MOV ADC0CN , # 80H  ; ADC ENABLED
133A    1207EB        6642     	CALL	WAIT1MS
133D    D2AF          6643     	SETB	EA				; Enable all interrupts
                      6644     	; Measure number of lipo cells
133F    120ACC        6645     	CALL MEASURE_LIPO_CELLS			; Measure number of lipo cells
                      6646     	; Initialize rc pulse
                      6647     	RCP_INT_ENABLE		 			; Enable interrupt
1342    43DA01        6647+1   ORL PCA0CPM0 , # 01H  ; INTERRUPT ENABLED
                      6648     	RCP_CLEAR_INT_FLAG 				; Clear interrupt flag
1345    C2D8          6648+1   CLR CCF0  ; CLEAR INTERRUPT FLAG
1347    C269          6649     CLR FLAGS2 . 1 
1349    120804        6650     	CALL WAIT200MS
                      6651     	; Set initial arm variable
134C    753001        6652     	MOV	INITIAL_ARM, #1
                      6653     
                      6654     	; Measure PWM frequency
                      6655     MEASURE_PWM_FREQ_INIT: 	
134F    D259          6656     SETB FLAGS0 . 1 
                      6657     MEASURE_PWM_FREQ_START: 	
1351    7A05          6658     MOV R2 , # 5 
                      6659     MEASURE_PWM_FREQ_LOOP: 	
                      6660     	; Check if period diff was accepted
1353    E558          6661     	MOV	A, RCP_PERIOD_DIFF_ACCEPTED
1355    7002          6662     	JNZ	($+4)
                      6663     
1357    7A05          6664     MOV R2 , # 5 
                      6665     
1359    1207F0        6666     	CALL WAIT3MS						; Wait for next pulse (NB: Uses Temp1/2!) 
135C    E559          6667     	MOV	A, NEW_RCP					; Load value
135E    C3            6668     	CLR	C
135F    9402          6669     SUBB A , # 2 
1361    40EE          6670     	JC	MEASURE_PWM_FREQ_START			; No - start over
                      6671     
1363    E52E          6672     	MOV	A, FLAGS3						; Check pwm frequency flags
1365    541F          6673     	ANL	A, #((1 SHL RCP_PWM_FREQ_1KHZ)+(1 SHL RCP_PWM_FREQ_2KHZ)+(1 SHL RCP_PWM_FREQ_4KHZ)+(1 SHL RCP_PWM_FREQ_8KHZ)+(1 SHL RCP_PWM_FREQ_12KHZ))
1367    855B5A        6674     	MOV	PREV_RCP_PWM_FREQ, CURR_RCP_PWM_FREQ		; Store as previous flags for next pulse 
136A    F55B          6675     	MOV	CURR_RCP_PWM_FREQ, A					; Store current flags for next pulse 
136C    B55AE2        6676     	CJNE	A, PREV_RCP_PWM_FREQ, MEASURE_PWM_FREQ_START	; Go back if new flags not same as previous
                      6677     
136F    DAE2          6678     DJNZ R2 , MEASURE_PWM_FREQ_LOOP 
                      6679     
                      6680     	; Clear measure pwm frequency flag
1371    C259          6681     CLR FLAGS0 . 1 
                      6682     	; Set up RC pulse interrupts after pwm frequency measurement
                      6683     	RCP_INT_FIRST 						; Enable interrupt and set to first edge
1373    53DACF        6683+1   ANL PCA0CPM0 , # 0CFH 
1376    207603        6683+1   JB FLAGS3 . 6 , ( $+6 )  ; IS PWM POLARITY POSITIVE?
1379    43DA20        6683+1   ORL PCA0CPM0 , # 20H  ; CAPTURE RISING EDGE
137C    307603        6683+1   JNB FLAGS3 . 6 , ( $+6 )  ; IS PWM POLARITY NEGATIVE?
137F    43DA10        6683+1   ORL PCA0CPM0 , # 10H  ; CAPTURE FALLING EDGE
                      6684     	RCP_CLEAR_INT_FLAG 					; Clear interrupt flag
1382    C2D8          6684+1   CLR CCF0  ; CLEAR INTERRUPT FLAG
1384    C269          6685     CLR FLAGS2 . 1 
1386    1207FF        6686     	CALL WAIT100MS						; Wait for new RC pulse
                      6687     
                      6688     	; Validate RC pulse
                      6689     VALIDATE_RCP_START: 	
1389    1207F0        6690     	CALL WAIT3MS						; Wait for next pulse (NB: Uses Temp1/2!) 
138C    7802          6691     MOV R0 , # 2 
138E    741F          6692     	MOV	A, #((1 SHL RCP_PWM_FREQ_1KHZ)+(1 SHL RCP_PWM_FREQ_2KHZ)+(1 SHL RCP_PWM_FREQ_4KHZ)+(1 SHL RCP_PWM_FREQ_8KHZ)+(1 SHL RCP_PWM_FREQ_12KHZ))
1390    552E          6693     	ANL	A, FLAGS3						; Check pwm frequency flags
1392    7002          6694     	JNZ	($+4)						; If a flag is set (PWM) - branch
                      6695     
1394    7800          6696     MOV R0 , # 0 
                      6697     
1396    C3            6698     	CLR	C
1397    E559          6699     	MOV	A, NEW_RCP					; Load value
1399    98            6700     SUBB A , R0 
139A    40ED          6701     	JC	VALIDATE_RCP_START				; No - start over
                      6702     
                      6703     	; Beep arm sequence start signal
139C    C2AF          6704     	CLR 	EA							; Disable all interrupts
139E    120814        6705     	CALL BEEP_F1
13A1    1207FA        6706     	CALL WAIT30MS
13A4    120814        6707     	CALL BEEP_F1
13A7    1207FA        6708     	CALL WAIT30MS
13AA    12081B        6709     	CALL BEEP_F2
13AD    1207FA        6710     	CALL WAIT30MS
13B0    12081B        6711     	CALL BEEP_F2
13B3    1207FA        6712     	CALL WAIT30MS
13B6    D2AF          6713     	SETB	EA							; Enable all interrupts
13B8    120804        6714     	CALL WAIT200MS	
                      6715     
                      6716     	; Arming sequence start
13BB    754800        6717     	MOV	GOV_ARM_TARGET, #0		; Clear governor arm target
                      6718     ARMING_START: 
                      6719     IF MODE >= 1	; Tail or multi
13BE    7888          6720     MOV R0 , # PGM_DIRECTION 
13C0    E6            6721     MOV A , @ R0 
13C1    B40302        6722     	CJNE	A, #3, ($+5)
                      6723     
13C4    8199          6724     	AJMP	PROGRAM_BY_TX_CHECKED	; Disable tx programming if bidirectional operation
                      6725     ENDIF
                      6726     
13C6    1207F0        6727     	CALL WAIT3MS
13C9    788C          6728     MOV R0 , # PGM_ENABLE_TX_PROGRAM 
13CB    E6            6729     MOV A , @ R0 
13CC    C3            6730     	CLR	C
13CD    9401          6731     	SUBB	A, #1				; Is TX programming enabled?
13CF    5003          6732     	JNC 	ARMING_INITIAL_ARM_CHECK	; Yes - proceed
                      6733     
13D1    021499        6734     	JMP	PROGRAM_BY_TX_CHECKED	; No - branch
                      6735     
                      6736     ARMING_INITIAL_ARM_CHECK: 
13D4    E530          6737     	MOV	A, INITIAL_ARM			; Yes - check if it is initial arm sequence
13D6    C3            6738     	CLR	C
13D7    9401          6739     	SUBB	A, #1				; Is it the initial arm sequence?
13D9    5003          6740     	JNC 	ARMING_PPM_CHECK		; Yes - proceed
                      6741     
13DB    021499        6742     	JMP 	PROGRAM_BY_TX_CHECKED	; No - branch
                      6743     
                      6744     ARMING_PPM_CHECK: 
13DE    741F          6745     	MOV	A, #((1 SHL RCP_PWM_FREQ_1KHZ)+(1 SHL RCP_PWM_FREQ_2KHZ)+(1 SHL RCP_PWM_FREQ_4KHZ)+(1 SHL RCP_PWM_FREQ_8KHZ)+(1 SHL RCP_PWM_FREQ_12KHZ))
13E0    552E          6746     	ANL	A, FLAGS3				; Check pwm frequency flags
13E2    6035          6747     	JZ	THROTTLE_HIGH_CAL_START	; If no flag is set (PPM) - branch
                      6748     
                      6749     	; PWM tx program entry
13E4    C3            6750     	CLR	C
13E5    E559          6751     	MOV	A, NEW_RCP			; Load new RC pulse value
13E7    94FF          6752     SUBB A , # 255 
13E9    5003          6753     	JNC	PROGRAM_BY_TX_ENTRY_PWM	; Yes - proceed
                      6754     
13EB    021499        6755     	JMP	PROGRAM_BY_TX_CHECKED	; No - branch
                      6756     
                      6757     PROGRAM_BY_TX_ENTRY_PWM: 	
13EE    C2AF          6758     	CLR	EA					; Disable all interrupts
13F0    120829        6759     	CALL BEEP_F4
13F3    D2AF          6760     	SETB	EA					; Enable all interrupts
13F5    1207FF        6761     	CALL WAIT100MS
13F8    C3            6762     	CLR	C
13F9    E559          6763     	MOV	A, NEW_RCP			; Load new RC pulse value
13FB    9401          6764     SUBB A , # 1 
13FD    50EF          6765     	JNC	PROGRAM_BY_TX_ENTRY_PWM	; No - start over
                      6766     
                      6767     PROGRAM_BY_TX_ENTRY_WAIT_PWM: 	
13FF    C2AF          6768     	CLR	EA					; Disable all interrupts
1401    120814        6769     	CALL BEEP_F1
1404    1207F5        6770     	CALL WAIT10MS
1407    120814        6771     	CALL BEEP_F1
140A    D2AF          6772     	SETB	EA					; Enable all interrupts
140C    1207FF        6773     	CALL WAIT100MS
140F    C3            6774     	CLR	C
1410    E559          6775     	MOV	A, NEW_RCP			; Load new RC pulse value
1412    94FF          6776     SUBB A , # 255 
1414    40E9          6777     	JC	PROGRAM_BY_TX_ENTRY_WAIT_PWM	; No - start over
                      6778     
1416    021D1F        6779     	JMP	PROGRAM_BY_TX			; Yes - enter programming mode
                      6780     
                      6781     	; PPM throttle calibration and tx program entry
                      6782     THROTTLE_HIGH_CAL_START: 
1419    7F05          6783     MOV R7 , # 5 
                      6784     THROTTLE_HIGH_CAL: 			
141B    D277          6785     SETB FLAGS3 . 7 
141D    513F          6786     	CALL	FIND_THROTTLE_GAIN		; Set throttle gain
141F    1207FF        6787     	CALL WAIT100MS				; Wait for new throttle value
1422    C2AF          6788     	CLR	EA					; Disable interrupts (freeze New_Rcp value)
1424    C277          6789     CLR FLAGS3 . 7 
1426    513F          6790     	CALL	FIND_THROTTLE_GAIN		; Set throttle gain
1428    AE59          6791     MOV R6 , NEW_RCP 
142A    C3            6792     	CLR	C
142B    E559          6793     	MOV	A, NEW_RCP			; Load new RC pulse value
142D    947F          6794     	SUBB	A, #(RCP_MAX/2)		; Is RC pulse above midstick?
142F    D2AF          6795     	SETB	EA					; Enable interrupts
1431    4070          6796     	JC	ARM_TARGET_UPDATED		; No - branch
                      6797     
1433    1207EB        6798     	CALL WAIT1MS		
1436    C2AF          6799     	CLR	EA					; Disable all interrupts
1438    120829        6800     	CALL BEEP_F4
143B    D2AF          6801     	SETB	EA					; Enable all interrupts
143D    DFDC          6802     DJNZ R7 , THROTTLE_HIGH_CAL 
                      6803     
143F    C3            6804     	CLR	C
1440    EE            6805     MOV A , R6 
1441    9405          6806     	SUBB	A, #5				; Subtract about 2% and ensure that it is 250 or lower
1443    7897          6807     MOV R0 , # PGM_PPM_MAX_THROTTLE 
1445    F6            6808     MOV @ R0 , A 
1446    120804        6809     	CALL WAIT200MS				
1449    1218A9        6810     	CALL ERASE_AND_STORE_ALL_IN_EEPROM	
144C    121CC0        6811     	CALL	SUCCESS_BEEP
                      6812     
                      6813     THROTTLE_LOW_CAL_START: 
144F    7F0A          6814     MOV R7 , # 10 
                      6815     THROTTLE_LOW_CAL: 			
1451    D277          6816     SETB FLAGS3 . 7 
1453    513F          6817     	CALL	FIND_THROTTLE_GAIN		; Set throttle gain
1455    1207FF        6818     	CALL WAIT100MS
1458    C2AF          6819     	CLR	EA					; Disable interrupts (freeze New_Rcp value)
145A    C277          6820     CLR FLAGS3 . 7 
145C    513F          6821     	CALL	FIND_THROTTLE_GAIN		; Set throttle gain
145E    AE59          6822     MOV R6 , NEW_RCP 
1460    C3            6823     	CLR	C
1461    E559          6824     	MOV	A, NEW_RCP			; Load new RC pulse value
1463    947F          6825     	SUBB	A, #(RCP_MAX/2)		; Below midstick?
1465    D2AF          6826     	SETB	EA					; Enable interrupts
1467    50E6          6827     	JNC	THROTTLE_LOW_CAL_START	; No - start over
                      6828     
1469    1207EB        6829     	CALL WAIT1MS		
146C    C2AF          6830     	CLR	EA					; Disable all interrupts
146E    120814        6831     	CALL BEEP_F1
1471    1207F5        6832     	CALL WAIT10MS
1474    120814        6833     	CALL BEEP_F1
1477    D2AF          6834     	SETB	EA					; Enable all interrupts
1479    DFD6          6835     DJNZ R7 , THROTTLE_LOW_CAL 
                      6836     
147B    EE            6837     MOV A , R6 
147C    2405          6838     	ADD	A, #5				; Add about 2%
147E    7896          6839     MOV R0 , # PGM_PPM_MIN_THROTTLE 
1480    F6            6840     MOV @ R0 , A 
1481    120804        6841     	CALL WAIT200MS				
1484    1218A9        6842     	CALL ERASE_AND_STORE_ALL_IN_EEPROM	
1487    121CE0        6843     	CALL	SUCCESS_BEEP_INVERTED
                      6844     
                      6845     PROGRAM_BY_TX_ENTRY_WAIT_PPM: 	
148A    1207FF        6846     	CALL WAIT100MS
148D    513F          6847     	CALL	FIND_THROTTLE_GAIN		; Set throttle gain
148F    C3            6848     	CLR	C
1490    E559          6849     	MOV	A, NEW_RCP			; Load new RC pulse value
1492    94FF          6850     SUBB A , # 255 
1494    40F4          6851     	JC	PROGRAM_BY_TX_ENTRY_WAIT_PPM	; No - start over
                      6852     
1496    021D1F        6853     	JMP	PROGRAM_BY_TX			; Yes - enter programming mode
                      6854     
                      6855     PROGRAM_BY_TX_CHECKED: 
1499    C3            6856     	CLR	C
149A    E559          6857     	MOV	A, NEW_RCP			; Load new RC pulse value
149C    9548          6858     	SUBB	A, GOV_ARM_TARGET		; Is RC pulse larger than arm target?
149E    4003          6859     	JC	ARM_TARGET_UPDATED		; No - do not update
                      6860     
14A0    855948        6861     	MOV	GOV_ARM_TARGET, NEW_RCP	; Yes - update arm target
                      6862     
                      6863     ARM_TARGET_UPDATED: 
14A3    1207FF        6864     	CALL WAIT100MS				; Wait for new throttle value
14A6    C3            6865     	CLR	C
14A7    E559          6866     	MOV	A, NEW_RCP			; Load new RC pulse value
14A9    9401          6867     SUBB A , # 1 
14AB    4002          6868     	JC	ARM_END_BEEP			; Yes - proceed
                      6869     
14AD    61BE          6870     	JMP	ARMING_START			; No - start over
                      6871     
                      6872     ARM_END_BEEP: 
                      6873     	; Beep arm sequence end signal
14AF    C2AF          6874     	CLR 	EA					; Disable all interrupts
14B1    120829        6875     	CALL BEEP_F4
14B4    1207FA        6876     	CALL WAIT30MS
14B7    120829        6877     	CALL BEEP_F4
14BA    1207FA        6878     	CALL WAIT30MS
14BD    120822        6879     	CALL BEEP_F3
14C0    1207FA        6880     	CALL WAIT30MS
14C3    120822        6881     	CALL BEEP_F3
14C6    1207FA        6882     	CALL WAIT30MS
14C9    D2AF          6883     	SETB	EA					; Enable all interrupts
14CB    120804        6884     	CALL WAIT200MS
                      6885     
                      6886     	; Clear initial arm variable
14CE    753000        6887     	MOV	INITIAL_ARM, #0
                      6888     
                      6889     	; Armed and waiting for power on
                      6890     WAIT_FOR_POWER_ON: 
14D1    E4            6891     	CLR	A
14D2    F531          6892     	MOV	POWER_ON_WAIT_CNT_L, A	; Clear wait counter
14D4    F532          6893     	MOV	POWER_ON_WAIT_CNT_H, A	
                      6894     WAIT_FOR_POWER_ON_LOOP: 
14D6    0531          6895     	INC	POWER_ON_WAIT_CNT_L		; Increment low wait counter
14D8    E531          6896     	MOV	A, POWER_ON_WAIT_CNT_L
14DA    F4            6897     	CPL	A
14DB    7039          6898     	JNZ	WAIT_FOR_POWER_ON_NO_BEEP; Counter wrapping (about 1 sec)?
                      6899     
14DD    0532          6900     	INC	POWER_ON_WAIT_CNT_H		; Increment high wait counter
14DF    789A          6901     MOV R0 , # PGM_BEACON_DELAY 
14E1    E6            6902     MOV A , @ R0 
14E2    7819          6903     MOV R0 , # 25 
14E4    14            6904     	DEC	A
14E5    6012          6905     	JZ	BEEP_DELAY_SET
                      6906     
14E7    7832          6907     MOV R0 , # 50 
14E9    14            6908     	DEC	A
14EA    600D          6909     	JZ	BEEP_DELAY_SET
                      6910     
14EC    787D          6911     MOV R0 , # 125 
14EE    14            6912     	DEC	A
14EF    6008          6913     	JZ	BEEP_DELAY_SET
                      6914     
14F1    78FA          6915     MOV R0 , # 250 
14F3    14            6916     	DEC	A
14F4    6003          6917     	JZ	BEEP_DELAY_SET
                      6918     
14F6    753200        6919     	MOV	POWER_ON_WAIT_CNT_H, #0		; Reset counter for infinite delay
                      6920     
                      6921     BEEP_DELAY_SET: 
14F9    C3            6922     	CLR	C
14FA    E532          6923     	MOV	A, POWER_ON_WAIT_CNT_H
14FC    98            6924     SUBB A , R0 
14FD    4017          6925     	JC	WAIT_FOR_POWER_ON_NO_BEEP; Has delay elapsed?
                      6926     
14FF    1532          6927     	DEC	POWER_ON_WAIT_CNT_H		; Decrement high wait counter
1501    7531B4        6928     	MOV	POWER_ON_WAIT_CNT_L, #180; Set low wait counter
1504    7899          6929     MOV R0 , # PGM_BEACON_STRENGTH 
1506    866F          6930     MOV BEEP_STRENGTH , @ R0 
1508    C2AF          6931     	CLR 	EA					; Disable all interrupts
150A    120829        6932     	CALL BEEP_F4				; Signal that there is no signal
150D    D2AF          6933     	SETB	EA					; Enable all interrupts
150F    7898          6934     MOV R0 , # PGM_BEEP_STRENGTH 
1511    866F          6935     MOV BEEP_STRENGTH , @ R0 
1513    1207FF        6936     	CALL WAIT100MS				; Wait for new RC pulse to be measured
                      6937     
                      6938     WAIT_FOR_POWER_ON_NO_BEEP: 
1516    1207F5        6939     	CALL WAIT10MS
1519    E528          6940     	MOV	A, RCP_TIMEOUT_CNT				; Load RC pulse timeout counter value
151B    7008          6941     	JNZ	WAIT_FOR_POWER_ON_PPM_NOT_MISSING	; If it is not zero - proceed
                      6942     
151D    741F          6943     	MOV	A, #((1 SHL RCP_PWM_FREQ_1KHZ)+(1 SHL RCP_PWM_FREQ_2KHZ)+(1 SHL RCP_PWM_FREQ_4KHZ)+(1 SHL RCP_PWM_FREQ_8KHZ)+(1 SHL RCP_PWM_FREQ_12KHZ))
151F    552E          6944     	ANL	A, FLAGS3						; Check pwm frequency flags
1521    7002          6945     	JNZ	WAIT_FOR_POWER_ON_PPM_NOT_MISSING	; If a flag is set (PWM) - branch
                      6946     
1523    614F          6947     	JMP	MEASURE_PWM_FREQ_INIT			; If ppm and pulses missing - go back to measure pwm frequency
                      6948     
                      6949     WAIT_FOR_POWER_ON_PPM_NOT_MISSING: 
1525    C3            6950     	CLR	C
1526    E559          6951     	MOV	A, NEW_RCP			; Load new RC pulse value
1528    9406          6952     	SUBB	A, #(RCP_STOP+5) 		; Higher than stop (plus some hysteresis)?
152A    40AA          6953     	JC	WAIT_FOR_POWER_ON_LOOP	; No - start over
                      6954     
                      6955     IF MODE >= 1	; Tail or multi
152C    7888          6956     MOV R0 , # PGM_DIRECTION 
152E    E6            6957     MOV A , @ R0 
152F    C3            6958     	CLR	C
1530    9403          6959     	SUBB	A, #3
1532    6003          6960     	JZ 	($+5)				; Do not wait if bidirectional operation
                      6961     ENDIF
                      6962     
1534    1207FF        6963     	LCALL WAIT100MS			; Wait to see if start pulse was only a glitch
                      6964     
1537    E528          6965     	MOV	A, RCP_TIMEOUT_CNT		; Load RC pulse timeout counter value
1539    7003          6966     	JNZ	($+5)				; If it is not zero - proceed
                      6967     
153B    02134F        6968     	LJMP	MEASURE_PWM_FREQ_INIT	; If it is zero (pulses missing) - go back to measure pwm frequency
                      6969     
                      6970     
                      6971     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      6972     ;
                      6973     ; Start entry point
                      6974     ;
                      6975     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      6976     INIT_START: 
153E    C2AF          6977     	CLR	EA
1540    1190          6978     	CALL SWITCH_POWER_OFF
1542    E4            6979     	CLR	A
1543    F522          6980     	MOV	REQUESTED_PWM, A		; Set requested pwm to zero
1545    F523          6981     	MOV	GOVERNOR_REQ_PWM, A		; Set governor requested pwm to zero
1547    F524          6982     	MOV	CURRENT_PWM, A			; Set current pwm to zero
1549    F525          6983     	MOV	CURRENT_PWM_LIMITED, A	; Set limited current pwm to zero
154B    D2AF          6984     	SETB	EA
154D    7885          6985     MOV R0 , # PGM_MOTOR_IDLE 
154F    8661          6986     MOV PWM_MOTOR_IDLE , @ R0 
1551    F540          6987     	MOV	GOV_TARGET_L, A		; Set target to zero
1553    F541          6988     	MOV	GOV_TARGET_H, A
1555    F542          6989     	MOV	GOV_INTEGRAL_L, A		; Set integral to zero
1557    F543          6990     	MOV	GOV_INTEGRAL_H, A
1559    F544          6991     	MOV	GOV_INTEGRAL_X, A
155B    F56C          6992     	MOV	ADC_CONVERSION_CNT, A
155D    F549          6993     	MOV	GOV_ACTIVE, A
155F    F52B          6994     	MOV	FLAGS0, A				; Clear flags0
1561    F52C          6995     	MOV	FLAGS1, A				; Clear flags1
1563    F539          6996     	MOV	DEMAG_CONSECUTIVE_CNT, A
1565    120C4A        6997     	CALL INITIALIZE_ALL_TIMINGS	; Initialize timing
                      6998     	;**** **** **** **** ****
                      6999     	; Motor start beginning
                      7000     	;**** **** **** **** **** 
1568    756C08        7001     MOV ADC_CONVERSION_CNT , # 8 
                      7002     	SET_ADC_IP_TEMP
156B    75BB10        7002+1   MOV AMX0P , # 10H  ; SELECT TEMP SENSOR INPUT
156E    1207EB        7003     	CALL WAIT1MS
1571    120B67        7004     	CALL START_ADC_CONVERSION
                      7005     READ_INITIAL_TEMP: 
                      7006     	GET_ADC_STATUS 
1574    E5E8          7006+1   MOV A , ADC0CN 
1576    20ECFB        7007     	JB	AD0BUSY, READ_INITIAL_TEMP
                      7008     	READ_ADC_RESULT						; Read initial temperature
1579    A8BD          7008+1   MOV R0 , ADC0L 
157B    A9BE          7008+1   MOV R1 , ADC0H 
157D    E9            7009     MOV A , R1 
157E    7001          7010     	JNZ	($+3)							; Is reading below 256?
                      7011     
1580    F8            7012     MOV R0 , A 
                      7013     
1581    886D          7014     MOV CURRENT_AVERAGE_TEMP , R0 
1583    120B6B        7015     	CALL CHECK_TEMP_VOLTAGE_AND_LIMIT_POWER
1586    756C08        7016     MOV ADC_CONVERSION_CNT , # 8 
                      7017     	SET_ADC_IP_TEMP
1589    75BB10        7017+1   MOV AMX0P , # 10H  ; SELECT TEMP SENSOR INPUT
                      7018     
                      7019     	; Go to the desired startup mode
158C    7895          7020     MOV R0 , # PGM_STARTUP_METHOD 
158E    E6            7021     MOV A , @ R0 
158F    30E003        7022     	JNB	ACC.0, DIRECT_METHOD_START
                      7023     
1592    0215D6        7024     	JMP	STEPPER_METHOD_START
                      7025     
                      7026     DIRECT_METHOD_START: 
                      7027     	; Set up start operating conditions
1595    7887          7028     MOV R0 , # PGM_PWM_FREQ 
1597    E6            7029     MOV A , @ R0 
1598    FE            7030     MOV R6 , A 
1599    7602          7031     MOV @ R0 , # 2 
159B    3167          7032     	CALL	DECODE_PARAMETERS		; (Decode_parameters uses Temp1 and Temp8)
159D    7887          7033     MOV R0 , # PGM_PWM_FREQ 
159F    EE            7034     MOV A , R6 
15A0    F6            7035     MOV @ R0 , A 
                      7036     	; Set max allowed power
15A1    D261          7037     SETB FLAGS1 . 1 
15A3    C2AF          7038     	CLR	EA					; Disable interrupts to avoid that Requested_Pwm is overwritten
15A5    755EFF        7039     	MOV	PWM_LIMIT, #0FFH		; Set pwm limit to max
15A8    120C1A        7040     	CALL SET_STARTUP_PWM
15AB    85225E        7041     	MOV	PWM_LIMIT, REQUESTED_PWM
15AE    85225F        7042     	MOV	PWM_LIMIT_SPOOLUP, REQUESTED_PWM
15B1    D2AF          7043     	SETB	EA
15B3    C261          7044     CLR FLAGS1 . 1 
15B5    752501        7045     	MOV	CURRENT_PWM_LIMITED, #1		; Set low pwm again after calling set_startup_pwm
15B8    855D64        7046     	MOV	SPOOLUP_LIMIT_CNT, AUTO_BAILOUT_ARMED
15BB    756501        7047     	MOV	SPOOLUP_LIMIT_SKIP, #1			
                      7048     	; Begin startup sequence
15BE    D260          7049     SETB FLAGS1 . 0 
15C0    D263          7050     SETB FLAGS1 . 3 
15C2    753800        7051     	MOV	DIRECT_STARTUP_OK_CNT, #0	; Reset ok counter
15C5    120FEA        7052     	CALL COMM5COMM6				; Initialize commutation
15C8    1125          7053     	CALL COMM6COMM1				
15CA    120CC4        7054     	CALL	CALC_NEXT_COMM_TIMING		; Set virtual commutation point
15CD    120C4A        7055     	CALL INITIALIZE_ALL_TIMINGS		; Initialize timing
15D0    120D47        7056     	CALL CALC_NEW_WAIT_TIMES			; Calculate new wait times
15D3    0216FE        7057     	JMP	RUN1
                      7058     
                      7059     
                      7060     STEPPER_METHOD_START: 
                      7061     	; Set up start operating conditions
15D6    7887          7062     MOV R0 , # PGM_PWM_FREQ 
15D8    E6            7063     MOV A , @ R0 
15D9    FE            7064     MOV R6 , A 
15DA    7603          7065     MOV @ R0 , # 3 
15DC    7893          7066     MOV R0 , # PGM_DAMPING_FORCE 
15DE    E6            7067     MOV A , @ R0 
15DF    FD            7068     MOV R5 , A 
15E0    7605          7069     MOV @ R0 , # 5 
15E2    3167          7070     	CALL	DECODE_PARAMETERS		; (Decode_parameters uses Temp1 and Temp8)
15E4    7887          7071     MOV R0 , # PGM_PWM_FREQ 
15E6    EE            7072     MOV A , R6 
15E7    F6            7073     MOV @ R0 , A 
15E8    7893          7074     MOV R0 , # PGM_DAMPING_FORCE 
15EA    ED            7075     MOV A , R5 
15EB    F6            7076     MOV @ R0 , A 
                      7077     	; Begin startup sequence
15EC    D260          7078     SETB FLAGS1 . 0 
15EE    D261          7079     SETB FLAGS1 . 1 
15F0    D265          7080     SETB FLAGS1 . 5 
15F2    120FEA        7081     	CALL COMM5COMM6			; Initialize commutation
15F5    1125          7082     	CALL COMM6COMM1			
15F7    755EFF        7083     	MOV	PWM_LIMIT, #0FFH		; Set pwm limit to max
15FA    120C1A        7084     	CALL SET_STARTUP_PWM
15FD    1207EB        7085     	CALL WAIT1MS
1600    120EF2        7086     	CALL COMM1COMM2
1603    1207EB        7087     	CALL WAIT1MS
1606    1207EB        7088     	CALL WAIT1MS
1609    120F24        7089     	CALL COMM2COMM3
160C    1207F0        7090     	CALL WAIT3MS			
160F    120F6E        7091     	CALL COMM3COMM4
1612    1207F0        7092     	CALL WAIT3MS			
1615    1207F0        7093     	CALL WAIT3MS			
1618    120FA9        7094     	CALL COMM4COMM5
161B    1207F5        7095     	CALL WAIT10MS				; Settle rotor
161E    120FEA        7096     	CALL COMM5COMM6
1621    1207F0        7097     	CALL WAIT3MS				
1624    1207EB        7098     	CALL WAIT1MS			
1627    C261          7099     CLR FLAGS1 . 1 
1629    D262          7100     SETB FLAGS1 . 2 
                      7101     
                      7102     	;**** **** **** **** ****
                      7103     	; Stepper phase beginning
                      7104     	;**** **** **** **** **** 
                      7105     STEPPER_ROT_BEG: 
162B    120B67        7106     	CALL START_ADC_CONVERSION
162E    120B6B        7107     	CALL CHECK_TEMP_VOLTAGE_AND_LIMIT_POWER
1631    120C1A        7108     	CALL SET_STARTUP_PWM
1634    756C08        7109     MOV ADC_CONVERSION_CNT , # 8 
                      7110     	SET_ADC_IP_TEMP
1637    75BB10        7110+1   MOV AMX0P , # 10H  ; SELECT TEMP SENSOR INPUT
                      7111     
163A    1125          7112     	CALL COMM6COMM1				; Commutate
163C    120CBD        7113     	CALL CALC_NEXT_COMM_TIMING_START	; Update timing and set timer
163F    120D47        7114     	CALL CALC_NEW_WAIT_TIMES
1642    11A2          7115     	CALL DECREMENT_STEPPER_STEP
1644    3107          7116     	CALL STEPPER_TIMER_WAIT
                      7117     
1646    120EF2        7118     	CALL COMM1COMM2			
1649    120CBD        7119     	CALL CALC_NEXT_COMM_TIMING_START	
164C    120D47        7120     	CALL CALC_NEW_WAIT_TIMES
164F    11A2          7121     	CALL DECREMENT_STEPPER_STEP
1651    3107          7122     	CALL STEPPER_TIMER_WAIT
                      7123     
1653    120F24        7124     	CALL COMM2COMM3			
1656    120CBD        7125     	CALL CALC_NEXT_COMM_TIMING_START	
1659    120D47        7126     	CALL CALC_NEW_WAIT_TIMES
165C    11A2          7127     	CALL DECREMENT_STEPPER_STEP
165E    3107          7128     	CALL STEPPER_TIMER_WAIT
                      7129     
1660    120F6E        7130     	CALL COMM3COMM4			
1663    120CBD        7131     	CALL CALC_NEXT_COMM_TIMING_START	
1666    120D47        7132     	CALL CALC_NEW_WAIT_TIMES
1669    11A2          7133     	CALL DECREMENT_STEPPER_STEP
166B    3107          7134     	CALL STEPPER_TIMER_WAIT
                      7135     
166D    120FA9        7136     	CALL COMM4COMM5			
1670    120CBD        7137     	CALL CALC_NEXT_COMM_TIMING_START	
1673    120D47        7138     	CALL CALC_NEW_WAIT_TIMES
1676    11A2          7139     	CALL DECREMENT_STEPPER_STEP
1678    3107          7140     	CALL STEPPER_TIMER_WAIT
                      7141     
167A    120FEA        7142     	CALL COMM5COMM6			
167D    120CBD        7143     	CALL CALC_NEXT_COMM_TIMING_START	
1680    120D47        7144     	CALL CALC_NEW_WAIT_TIMES
1683    11A2          7145     	CALL DECREMENT_STEPPER_STEP	
                      7146     	; Check stepper step versus end criteria
1685    C3            7147     	CLR	C
1686    E550          7148     	MOV	A, WT_STEPPER_STEP_L
1688    9535          7149     	SUBB	A, STEPPER_STEP_END_L		; Minimum Stepper_Step_End
168A    E551          7150     	MOV	A, WT_STEPPER_STEP_H
168C    9536          7151     	SUBB	A, STEPPER_STEP_END_H
168E    400C          7152     	JC	STEPPER_ROT_EXIT			; Branch if lower than minimum
                      7153     
                      7154     	; Wait for step
1690    3107          7155     	CALL STEPPER_TIMER_WAIT
1692    C3            7156     	CLR	C
1693    E559          7157     	MOV	A, NEW_RCP				; Load new pulse value
1695    9401          7158     SUBB A , # 1 
1697    5092          7159     	JNC	STEPPER_ROT_BEG
                      7160     
1699    021830        7161     	JMP	RUN_TO_WAIT_FOR_POWER_ON
                      7162     
                      7163     STEPPER_ROT_EXIT: 
                      7164     	; Wait for step
169C    3107          7165     	CALL STEPPER_TIMER_WAIT
                      7166     	; Clear stepper phase
169E    C262          7167     CLR FLAGS1 . 2 
                      7168     	; Set dondamped low pwm frequency
16A0    7887          7169     MOV R0 , # PGM_PWM_FREQ 
16A2    E6            7170     MOV A , @ R0 
16A3    FE            7171     MOV R6 , A 
16A4    7602          7172     MOV @ R0 , # 2 
16A6    3167          7173     	CALL	DECODE_PARAMETERS			; (Decode_parameters uses Temp1 and Temp8)
16A8    7887          7174     MOV R0 , # PGM_PWM_FREQ 
16AA    EE            7175     MOV A , R6 
16AB    F6            7176     MOV @ R0 , A 
                      7177     	; Set spoolup power variables (power is now controlled from RCP)
16AC    85225E        7178     	MOV	PWM_LIMIT, REQUESTED_PWM
16AF    85605F        7179     	MOV	PWM_LIMIT_SPOOLUP, PWM_SPOOLUP_BEG
16B2    856025        7180     	MOV	CURRENT_PWM_LIMITED, PWM_SPOOLUP_BEG
16B5    855D64        7181     	MOV	SPOOLUP_LIMIT_CNT, AUTO_BAILOUT_ARMED
16B8    756501        7182     	MOV	SPOOLUP_LIMIT_SKIP, #1			
                      7183     	; Set direct startup phase to acquire sync quickly
16BB    D263          7184     SETB FLAGS1 . 3 
16BD    753800        7185     	MOV	DIRECT_STARTUP_OK_CNT, #0	; Reset ok counter
16C0    C2AF          7186     	CLR	EA						; Disable interrupts
                      7187     	APFET_OFF						; Ap off. Turn off unused pfets (to turn off damping fets that might be on)
16C2    207502        7187+1   JB FLAGS3 . 5 , ( $+5 ) 
16C5    C293          7187+1   CLR P1 . 3 
16C7    307502        7187+1   JNB FLAGS3 . 5 , ( $+5 ) 
16CA    C297          7187+1   CLR P1 . 7 
                      7188     	CPFET_OFF						; Cp off
16CC    207502        7188+1   JB FLAGS3 . 5 , ( $+5 ) 
16CF    C297          7188+1   CLR P1 . 7 
16D1    307502        7188+1   JNB FLAGS3 . 5 , ( $+5 ) 
16D4    C293          7188+1   CLR P1 . 3 
16D6    742D          7189     	MOV	A, #45					; 8us delay for pfets to go off
16D8    D5E0FD        7190     	DJNZ	ACC, $
16DB    D2AF          7191     	SETB	EA						; Enable interrupts
16DD    1125          7192     	CALL COMM6COMM1				
16DF    120CC4        7193     	CALL CALC_NEXT_COMM_TIMING		; Calculate next timing and start advance timing wait
16E2    120D33        7194     	CALL WAIT_ADVANCE_TIMING			; Wait advance timing and start zero cross wait
16E5    120D47        7195     	CALL CALC_NEW_WAIT_TIMES
16E8    120DD8        7196     	CALL WAIT_BEFORE_ZC_SCAN			; Wait zero cross wait and start zero cross timeout
16EB    756C00        7197     	MOV	ADC_CONVERSION_CNT, #0		; Make sure a voltage reading is done next time
                      7198     	SET_ADC_IP_VOLT				; Set adc measurement to voltage
16EE    75BB09        7198+1   MOV AMX0P , # ( 8+ADC_IP )  ; SELECT POSITIVE INPUT
16F1    0216FE        7199     	JMP	RUN1
                      7200     
                      7201     
                      7202     
                      7203     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      7204     ;
                      7205     ; Run entry point
                      7206     ;
                      7207     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      7208     DAMPED_TRANSITION: 
                      7209     	; Transition from nondamped to damped if applicable
16F4    3167          7210     	CALL	DECODE_PARAMETERS		; Set programmed parameters
16F6    1125          7211     	CALL	COMM6COMM1
16F8    756C00        7212     	MOV	ADC_CONVERSION_CNT, #0	; Make sure a voltage reading is done next time
                      7213     	SET_ADC_IP_VOLT			; Set adc measurement to voltage
16FB    75BB09        7213+1   MOV AMX0P , # ( 8+ADC_IP )  ; SELECT POSITIVE INPUT
                      7214     
                      7215     ; Run 1 = B(p-on) + C(n-pwm) - comparator A evaluated
                      7216     ; Out_cA changes from low to high
                      7217     RUN1: 
16FE    120DFA        7218     	CALL WAIT_FOR_COMP_OUT_HIGH	; Wait zero cross wait and wait for high
1701    120E7F        7219     	CALL	EVALUATE_COMPARATOR_INTEGRITY	; Check whether comparator reading has been normal
1704    120EAA        7220     	CALL SETUP_COMM_WAIT		; Setup wait time from zero cross to commutation
1707    120913        7221     	CALL CALC_GOVERNOR_TARGET	; Calculate governor target
170A    120EBE        7222     	CALL WAIT_FOR_COMM			; Wait from zero cross to commutation
170D    120EF2        7223     	CALL COMM1COMM2			; Commutate
1710    120CC4        7224     	CALL CALC_NEXT_COMM_TIMING	; Calculate next timing and start advance timing wait
1713    120D33        7225     	CALL WAIT_ADVANCE_TIMING		; Wait advance timing and start zero cross wait
1716    120D47        7226     	CALL CALC_NEW_WAIT_TIMES
1719    120DD8        7227     	CALL WAIT_BEFORE_ZC_SCAN		; Wait zero cross wait and start zero cross timeout
                      7228     
                      7229     ; Run 2 = A(p-on) + C(n-pwm) - comparator B evaluated
                      7230     ; Out_cB changes from high to low
                      7231     RUN2: 
171C    120DF1        7232     	CALL WAIT_FOR_COMP_OUT_LOW
171F    120E7F        7233     	CALL	EVALUATE_COMPARATOR_INTEGRITY
1722    120EAA        7234     	CALL SETUP_COMM_WAIT	
1725    120970        7235     	CALL CALC_GOVERNOR_PROP_ERROR
1728    120EBE        7236     	CALL WAIT_FOR_COMM
172B    120F24        7237     	CALL COMM2COMM3
172E    120CC4        7238     	CALL CALC_NEXT_COMM_TIMING
1731    120D33        7239     	CALL WAIT_ADVANCE_TIMING
1734    120D47        7240     	CALL CALC_NEW_WAIT_TIMES
1737    120DD8        7241     	CALL WAIT_BEFORE_ZC_SCAN	
                      7242     
                      7243     ; Run 3 = A(p-on) + B(n-pwm) - comparator C evaluated
                      7244     ; Out_cC changes from low to high
                      7245     RUN3: 
173A    120DFA        7246     	CALL WAIT_FOR_COMP_OUT_HIGH
173D    120E7F        7247     	CALL	EVALUATE_COMPARATOR_INTEGRITY
1740    120EAA        7248     	CALL SETUP_COMM_WAIT	
1743    1209A9        7249     	CALL CALC_GOVERNOR_INT_ERROR
1746    120EBE        7250     	CALL WAIT_FOR_COMM
1749    120F6E        7251     	CALL COMM3COMM4
174C    120CC4        7252     	CALL CALC_NEXT_COMM_TIMING
174F    120D33        7253     	CALL WAIT_ADVANCE_TIMING
1752    120D47        7254     	CALL CALC_NEW_WAIT_TIMES
1755    120DD8        7255     	CALL WAIT_BEFORE_ZC_SCAN	
                      7256     
                      7257     ; Run 4 = C(p-on) + B(n-pwm) - comparator A evaluated
                      7258     ; Out_cA changes from high to low
                      7259     RUN4: 
1758    120DF1        7260     	CALL WAIT_FOR_COMP_OUT_LOW
175B    120E7F        7261     	CALL	EVALUATE_COMPARATOR_INTEGRITY
175E    120EAA        7262     	CALL SETUP_COMM_WAIT	
1761    120A06        7263     	CALL CALC_GOVERNOR_PROP_CORRECTION
1764    120EBE        7264     	CALL WAIT_FOR_COMM
1767    120FA9        7265     	CALL COMM4COMM5
176A    120CC4        7266     	CALL CALC_NEXT_COMM_TIMING
176D    120D33        7267     	CALL WAIT_ADVANCE_TIMING
1770    120D47        7268     	CALL CALC_NEW_WAIT_TIMES
1773    120DD8        7269     	CALL WAIT_BEFORE_ZC_SCAN	
                      7270     
                      7271     ; Run 5 = C(p-on) + A(n-pwm) - comparator B evaluated
                      7272     ; Out_cB changes from low to high
                      7273     RUN5: 
1776    120DFA        7274     	CALL WAIT_FOR_COMP_OUT_HIGH
1779    120E7F        7275     	CALL	EVALUATE_COMPARATOR_INTEGRITY
177C    120EAA        7276     	CALL SETUP_COMM_WAIT	
177F    120A6A        7277     	CALL CALC_GOVERNOR_INT_CORRECTION
1782    120EBE        7278     	CALL WAIT_FOR_COMM
1785    120FEA        7279     	CALL COMM5COMM6
1788    120CC4        7280     	CALL CALC_NEXT_COMM_TIMING
178B    120D33        7281     	CALL WAIT_ADVANCE_TIMING
178E    120D47        7282     	CALL CALC_NEW_WAIT_TIMES
1791    120DD8        7283     	CALL WAIT_BEFORE_ZC_SCAN	
                      7284     
                      7285     ; Run 6 = B(p-on) + A(n-pwm) - comparator C evaluated
                      7286     ; Out_cC changes from high to low
                      7287     RUN6: 
1794    120DF1        7288     	CALL WAIT_FOR_COMP_OUT_LOW
1797    120B67        7289     	CALL START_ADC_CONVERSION
179A    120E7F        7290     	CALL	EVALUATE_COMPARATOR_INTEGRITY
179D    120EAA        7291     	CALL SETUP_COMM_WAIT	
17A0    120B6B        7292     	CALL CHECK_TEMP_VOLTAGE_AND_LIMIT_POWER
17A3    120EBE        7293     	CALL WAIT_FOR_COMM
17A6    1125          7294     	CALL COMM6COMM1
17A8    120CC4        7295     	CALL CALC_NEXT_COMM_TIMING
17AB    120D33        7296     	CALL WAIT_ADVANCE_TIMING
17AE    120D47        7297     	CALL CALC_NEW_WAIT_TIMES
17B1    120DD8        7298     	CALL WAIT_BEFORE_ZC_SCAN	
                      7299     
                      7300     	; Check if it is direct startup
17B4    306342        7301     JNB FLAGS1 . 3 , NORMAL_RUN_CHECKS 
                      7302     
                      7303     	; Set spoolup power variables
17B7    85605E        7304     	MOV	PWM_LIMIT, PWM_SPOOLUP_BEG		; Set initial max power
17BA    85605F        7305     	MOV	PWM_LIMIT_SPOOLUP, PWM_SPOOLUP_BEG	; Set initial slow spoolup power
17BD    855D64        7306     	MOV	SPOOLUP_LIMIT_CNT, AUTO_BAILOUT_ARMED
17C0    756501        7307     	MOV	SPOOLUP_LIMIT_SKIP, #1			
                      7308     	; Check startup ok counter
17C3    7964          7309     MOV R1 , # 100 
17C5    7A14          7310     MOV R2 , # 20 
                      7311     IF MODE >= 1	; Tail or multi
17C7    7888          7312     MOV R0 , # PGM_DIRECTION 
17C9    E6            7313     MOV A , @ R0 
17CA    B40304        7314     	CJNE	A, #3, DIRECT_START_PARAMS_SET; No - branch
                      7315     
17CD    791E          7316     MOV R1 , # 30 
17CF    7A05          7317     MOV R2 , # 5 
                      7318     
                      7319     DIRECT_START_PARAMS_SET: 
                      7320     ENDIF
17D1    C3            7321     	CLR	C
17D2    E538          7322     	MOV	A, DIRECT_STARTUP_OK_CNT		; Load ok counter
17D4    99            7323     SUBB A , R1 
17D5    4015          7324     	JC	DIRECT_START_CHECK_RCP		; No - proceed
                      7325     
17D7    C263          7326     CLR FLAGS1 . 3 
17D9    D264          7327     SETB FLAGS1 . 4 
17DB    8A37          7328     MOV STARTUP_ROT_CNT , R2 
                      7329     IF MODE == 1	; Tail
                               	MOV	PWM_LIMIT, #0FFH			; Allow full power
                               	MOV	PWM_LIMIT_SPOOLUP, #0FFH	
                               ENDIF
                      7333     IF MODE == 2	; Multi
17DD    7888          7334     MOV R0 , # PGM_DIRECTION 
17DF    E6            7335     MOV A , @ R0 
17E0    B40306        7336     	CJNE	A, #3, DIRECT_START_PWM_LIM_SET
                      7337     
17E3    755EFF        7338     	MOV	PWM_LIMIT, #0FFH			; Allow full power in bidirectional operation
17E6    755FFF        7339     	MOV	PWM_LIMIT_SPOOLUP, #0FFH	
                      7340     
                      7341     DIRECT_START_PWM_LIM_SET: 
                      7342     ENDIF
17E9    0217F9        7343     	JMP	NORMAL_RUN_CHECKS
                      7344     
                      7345     DIRECT_START_CHECK_RCP: 
17EC    C3            7346     	CLR	C
17ED    E559          7347     	MOV	A, NEW_RCP				; Load new pulse value
17EF    9401          7348     SUBB A , # 1 
17F1    4003          7349     	JC	($+5)
                      7350     
17F3    0216FE        7351     	LJMP	RUN1						; Continue to run 
                      7352     
17F6    021830        7353     	JMP	RUN_TO_WAIT_FOR_POWER_ON
                      7354     
                      7355     
                      7356     NORMAL_RUN_CHECKS: 
                      7357     	; Check if it is initial run phase
17F9    306419        7358     JNB FLAGS1 . 4 , INITIAL_RUN_PHASE_DONE 
                      7359     
                      7360     	; Decrement startup rotaton count
17FC    E537          7361     	MOV	A, STARTUP_ROT_CNT
17FE    14            7362     	DEC	A
                      7363     	; Check number of nondamped rotations
17FF    7005          7364     	JNZ 	NORMAL_RUN_CHECK_STARTUP_ROT	; Branch if counter is not zero
                      7365     
1801    C264          7366     CLR FLAGS1 . 4 
1803    0216F4        7367     	LJMP DAMPED_TRANSITION			; Do damped transition if counter is zero
                      7368     
                      7369     NORMAL_RUN_CHECK_STARTUP_ROT: 
1806    F537          7370     	MOV	STARTUP_ROT_CNT, A			; Not zero - store counter
                      7371     
1808    C3            7372     	CLR	C
1809    E559          7373     	MOV	A, NEW_RCP				; Load new pulse value
180B    9401          7374     SUBB A , # 1 
180D    4003          7375     	JC	($+5)
                      7376     
180F    0216FE        7377     	LJMP	RUN1						; Continue to run 
                      7378     
1812    021830        7379     	JMP	RUN_TO_WAIT_FOR_POWER_ON
                      7380     
                      7381     
                      7382     INITIAL_RUN_PHASE_DONE: 
                      7383     IF MODE == 0	; Main
                               	; Check if throttle is zeroed
                               	CLR	C
                               	MOV	A, RCP_STOP_CNT			; Load stop RC pulse counter value
                               	SUBB	A, #1					; Is number of stop RC pulses above limit?
                               	JC	RUN6_CHECK_RCP_STOP_COUNT	; If no - branch
                               
                               	MOV	PWM_LIMIT_SPOOLUP, PWM_SPOOLUP_BEG		; If yes - set initial max powers
                               	MOV	SPOOLUP_LIMIT_CNT, AUTO_BAILOUT_ARMED	; And set spoolup parameters
                               	MOV	SPOOLUP_LIMIT_SKIP, #1			
                               
                               RUN6_CHECK_RCP_STOP_COUNT:
                               ENDIF
                      7396     	; Exit run loop after a given time
1815    C3            7397     	CLR	C
1816    E55C          7398     	MOV	A, RCP_STOP_CNT			; Load stop RC pulse counter low byte value
1818    94FA          7399     SUBB A , # 250 
181A    5014          7400     	JNC	RUN_TO_WAIT_FOR_POWER_ON		; Yes, go back to wait for poweron
                      7401     
                      7402     RUN6_CHECK_RCP_TIMEOUT: 
181C    741F          7403     	MOV	A, #((1 SHL RCP_PWM_FREQ_1KHZ)+(1 SHL RCP_PWM_FREQ_2KHZ)+(1 SHL RCP_PWM_FREQ_4KHZ)+(1 SHL RCP_PWM_FREQ_8KHZ)+(1 SHL RCP_PWM_FREQ_12KHZ))
181E    552E          7404     	ANL	A, FLAGS3					; Check pwm frequency flags
1820    7004          7405     	JNZ	RUN6_CHECK_SPEED			; If a flag is set (PWM) - branch
                      7406     
1822    E528          7407     	MOV	A, RCP_TIMEOUT_CNT			; Load RC pulse timeout counter value
1824    600A          7408     	JZ	RUN_TO_WAIT_FOR_POWER_ON		; If it is zero - go back to wait for poweron
                      7409     
                      7410     RUN6_CHECK_SPEED: 
1826    C3            7411     	CLR	C
1827    E53D          7412     	MOV	A, COMM_PERIOD4X_H			; Is Comm_Period4x more than 32ms (~1220 eRPM)?
1829    94F0          7413     	SUBB	A, #0F0H
182B    5003          7414     	JNC	RUN_TO_WAIT_FOR_POWER_ON		; Yes - go back to motor start
182D    0216FE        7415     	JMP	RUN1						; Go back to run 1
                      7416     
                      7417     
                      7418     RUN_TO_WAIT_FOR_POWER_ON: 	
1830    C2AF          7419     	CLR	EA
1832    121090        7420     	CALL SWITCH_POWER_OFF
1835    7887          7421     MOV R0 , # PGM_PWM_FREQ 
1837    E6            7422     MOV A , @ R0 
1838    FE            7423     MOV R6 , A 
1839    7602          7424     MOV @ R0 , # 2 
183B    121167        7425     	CALL	DECODE_PARAMETERS			; (Decode_parameters uses Temp1 and Temp8)
183E    7887          7426     MOV R0 , # PGM_PWM_FREQ 
1840    EE            7427     MOV A , R6 
1841    F6            7428     MOV @ R0 , A 
1842    E4            7429     	CLR	A
1843    F522          7430     	MOV	REQUESTED_PWM, A			; Set requested pwm to zero
1845    F523          7431     	MOV	GOVERNOR_REQ_PWM, A			; Set governor requested pwm to zero
1847    F524          7432     	MOV	CURRENT_PWM, A				; Set current pwm to zero
1849    F525          7433     	MOV	CURRENT_PWM_LIMITED, A		; Set limited current pwm to zero
184B    F561          7434     	MOV	PWM_MOTOR_IDLE, A			; Set motor idle to zero
184D    C260          7435     CLR FLAGS1 . 0 
184F    D2AF          7436     	SETB	EA
1851    1207EB        7437     	CALL	WAIT1MS					; Wait for pwm to be stopped
1854    121090        7438     	CALL SWITCH_POWER_OFF
                      7439     IF MODE == 0	; Main
                               	MOV	A, #((1 SHL RCP_PWM_FREQ_1KHZ)+(1 SHL RCP_PWM_FREQ_2KHZ)+(1 SHL RCP_PWM_FREQ_4KHZ)+(1 SHL RCP_PWM_FREQ_8KHZ)+(1 SHL RCP_PWM_FREQ_12KHZ))
                               	ANL	A, FLAGS3					; Check pwm frequency flags
                               	JNZ	RUN_TO_NEXT_STATE_MAIN		; If a flag is set (PWM) - branch
                               
                               	MOV	A, RCP_TIMEOUT_CNT			; Load RC pulse timeout counter value
                               	JNZ	RUN_TO_NEXT_STATE_MAIN		; If it is not zero - branch
                               
                               	JMP	MEASURE_PWM_FREQ_INIT		; If it is zero (pulses missing) - go back to measure pwm frequency
                               
                               RUN_TO_NEXT_STATE_MAIN:
                               	MOV	TEMP1, #PGM_STARTUP_METHOD	; Check if it is stepped startup
                               	MOV	A, @TEMP1
                               	JNB	ACC.0, RUN_TO_NEXT_STATE_MAIN_WAIT_DONE	; If direct startup - jump
                               
                               	CALL	WAIT1S					; 3 second delay before new startup (in stepped mode)
                               	CALL	WAIT1S
                               	CALL	WAIT1S
                               
                               RUN_TO_NEXT_STATE_MAIN_WAIT_DONE:
                               	MOV	TEMP1, #PGM_MAIN_REARM_START
                               	MOV	A, @TEMP1	
                               	CLR	C
                               	SUBB	A, #1					; Is re-armed start enabled?
                               	JC 	JMP_WAIT_FOR_POWER_ON		; No - do like tail and start immediately
                               
                               	JMP	VALIDATE_RCP_START			; Yes - go back to validate RC pulse
                               
                               JMP_WAIT_FOR_POWER_ON:
                               	JMP	WAIT_FOR_POWER_ON			; Go back to wait for power on
                               ENDIF
                      7470     IF MODE >= 1	; Tail or multi
1857    741F          7471     	MOV	A, #((1 SHL RCP_PWM_FREQ_1KHZ)+(1 SHL RCP_PWM_FREQ_2KHZ)+(1 SHL RCP_PWM_FREQ_4KHZ)+(1 SHL RCP_PWM_FREQ_8KHZ)+(1 SHL RCP_PWM_FREQ_12KHZ))
1859    552E          7472     	ANL	A, FLAGS3					; Check pwm frequency flags
185B    7007          7473     	JNZ	JMP_WAIT_FOR_POWER_ON		; If a flag is set (PWM) - branch
                      7474     
185D    E528          7475     	MOV	A, RCP_TIMEOUT_CNT			; Load RC pulse timeout counter value
185F    7003          7476     	JNZ	JMP_WAIT_FOR_POWER_ON		; If it is not zero - go back to wait for poweron
                      7477     
1861    02134F        7478     	JMP	MEASURE_PWM_FREQ_INIT		; If it is zero (pulses missing) - go back to measure pwm frequency
                      7479     
                      7480     JMP_WAIT_FOR_POWER_ON: 
1864    0214D1        7481     	JMP	WAIT_FOR_POWER_ON			; Go back to wait for power on
                      7482     ENDIF
                      7483     
                      7484     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      7485     
                      7486     $INCLUDE (BLHELITXPGM.INC)			; Include source code for programming the ESC with the TX
                      8196     
                      8197     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      8198     
                      8199     
                      8200     
                      8201     
                      8202     END
MACRO ASSEMBLER BLHELI                                      05/25/15 19:28:27 PAGE     0


SYMBOL TABLE LISTING
------ ----- -------


N A M E             T Y P E  V A L U E   ATTRIBUTES

NORMAL_RUN_CHECK_~  C ADDR   1806H   A 
COMP_WAIT_ON_COMP~  C ADDR   0E45H   A 
CALC_NEXT_COMM_SL~  C ADDR   0D18H   A 
CHECK_TEMP_VOLTAG~  C ADDR   0B6BH   A 
MEASURE_LIPO_WAIT~  C ADDR   0ADDH   A 
GOVERNOR_LIMIT_IN~  C ADDR   0A97H   A 
GOVERNOR_CORR_NEG~  C ADDR   0A59H   A 
_EEP_MAIN_REARM_S~  C ADDR   1A10H   A 
EEP_PGM_LOW_VOLTA~  C ADDR   1A06H   A 
PPM_THROTTLE_GAIN.  D ADDR   006EH   A 
LIPO_ADC_LIMIT_H .  D ADDR   006BH   A 
CURR_RCP_PWM_FREQ.  D ADDR   005BH   A 
RCP_EDGE_H . . . .  D ADDR   0055H   A 
FLAGS3 . . . . . .  D ADDR   002EH   A 
RCP_PREV_EDGE_L. .  D ADDR   0026H   A 
ADC_IP . . . . . .  N NUMB   0001h            
DUAL_BEC_VOLTAGE .  N NUMB   0000h            
AD0INT . . . . . .  B ADDR   00E8H.5 A 
ACK1 . . . . . . .  B ADDR   00C0H.1 A 
SBUF0. . . . . . .  D ADDR   0099H   A 
P0 . . . . . . . .  D ADDR   0080H   A 
DPL. . . . . . . .  D ADDR   0082H   A 
ADC0LTH. . . . . .  D ADDR   00C6H   A 
ADC0H. . . . . . .  D ADDR   00BEH   A 
POLARIS_THUNDER_4~  N NUMB   0092h            
POLARIS_THUNDER_3~  N NUMB   0090h            
POLARIS_THUNDER_1~  N NUMB   008Ah            
FUNCTION_BEEP. . .  C ADDR   1D06H   A 
INIT_START . . . .  C ADDR   153EH   A 
PROGRAM_BY_TX_ENT~  C ADDR   13EEH   A 
FIND_THROTTLE_GAI~  C ADDR   124EH   A 
COMM45_NFET. . . .  C ADDR   0FCEH   A 
COMM45_NONDAMP . .  C ADDR   0FCBH   A 
COMM4COMM5 . . . .  C ADDR   0FA9H   A 
WAIT_ADVANCE_TIMI~  C ADDR   0D3DH   A 
CHECK_VOLTAGE_SPO~  C ADDR   0BFEH   A 
T2H_INT_RCP_STOP .  C ADDR   0512H   A 
T0_INT_PWM_ON_LOW~  C ADDR   00CEH   A 
EEP_PGM_PPM_MIN_T~  C ADDR   1A19H   A 
PGM_VOLT_COMP_DUM~  I ADDR   0091H   A 
TEMP_SKYPUP. . . .  D ADDR   0076H   A 
PREV_RCP . . . . .  D ADDR   0073H   A 
PWM_MOTOR_IDLE . .  D ADDR   0061H   A 
PREV_RCP_PWM_FREQ.  D ADDR   005AH   A 
WT_COMM_L. . . . .  D ADDR   004EH   A 
COMM_PERIOD4X_H. .  D ADDR   003DH   A 
SETTLE_PHASE . . .  N NUMB   0001h            
DEFAULT_PGM_BEC_V~  N NUMB   0000h            
DEFAULT_PGM_MAIN_~  N NUMB   0004h            
DEFAULT_PGM_MAIN_~  N NUMB   00C8h            
DEFAULT_PGM_MAIN_~  N NUMB   0001h            
TXMODE0. . . . . .  B ADDR   00C0H.6 A 
ESPI0. . . . . . .  B ADDR   00A8H.6 A 
SFRSTACK . . . . .  D ADDR   00D3H   A 
RSTSRC . . . . . .  D ADDR   00EFH   A 
P1 . . . . . . . .  D ADDR   0090H   A 
IPH. . . . . . . .  D ADDR   0084H   A 
CRC0DAT. . . . . .  D ADDR   009EH   A 
CRC0AUTO . . . . .  D ADDR   00DDH   A 
ADC0CF . . . . . .  D ADDR   00BCH   A 
PLATINUM_PRO_30A_~  N NUMB   009Dh            
POLARIS_THUNDER_4~  N NUMB   0093h            
H_KING_35A_TAIL. .  N NUMB   0083h            
PARAVAL_BEEP . . .  C ADDR   1D14H   A 
STORE_MULTI_FUNC_~  C ADDR   1C92H   A 
DECODE_STARTUP_PO~  C ADDR   1222H   A 
GOVERNOR_CHECK_PWM  C ADDR   09E6H   A 
GOVERNOR_ACTIVATE.  C ADDR   0938H   A 
T0_INT_PWM_OFF_CO~  C ADDR   0185H   A 
EEP_ENABLE_TX_PRO~  C ADDR   1A0FH   A 
PGM_DEMAG_COMP_PO~  I ADDR   00A3H   A 
DAMPING_PERIOD . .  D ADDR   0066H   A 
RCP_PWM_FREQ_1KHZ.  N NUMB   0000h            
TF2CEN . . . . . .  B ADDR   00C8H.4 A 
TXMODE1. . . . . .  B ADDR   00C0H.6 A 
ACKRQ0 . . . . . .  B ADDR   00C0H.3 A 
P2 . . . . . . . .  D ADDR   00A0H   A 
P0MAT. . . . . . .  D ADDR   00FDH   A 
OSCLCN . . . . . .  D ADDR   00E3H   A 
B. . . . . . . . .  D ADDR   00F0H   A 
POLARIS_THUNDER_6~  N NUMB   0095h            
H_KING_35A_MULTI .  N NUMB   0084h            
TURNIGY_AE_25A_MA~  N NUMB   0043h            
TURNIGY_AE_20A_TA~  N NUMB   0041h            
TURNIGY_PLUSH_10A~  N NUMB   001Fh            
XP_35A_SW_TAIL . .  N NUMB   0014h            
STORE_MULTI_FUNC_~  C ADDR   1C97H   A 
WRITE_EEPROM_SIGN~  C ADDR   1C30H   A 
WAIT_FOR_POWER_ON.  C ADDR   14D1H   A 
THROTTLE_LOW_CAL_~  C ADDR   144FH   A 
ARMING_INITIAL_AR~  C ADDR   13D4H   A 
PROGRAM_BY_TX_CHE~  C ADDR   1499H   A 
ERASE_AND_STORE_A~  C ADDR   18A9H   A 
SET_DEFAULT_PARAM~  C ADDR   110DH   A 
COMM56_NONDAMP . .  C ADDR   1011H   A 
COMM23_CP. . . . .  C ADDR   0F5CH   A 
CALC_NEXT_COMM_TI~  C ADDR   0CC4H   A 
COMM5COMM6 . . . .  C ADDR   0FEAH   A 
CALC_GOVERNOR_INT~  C ADDR   0A71H   A 
CALC_GOVERNOR_TAR~  C ADDR   096FH   A 
PCA_INT_STORE_DATA  C ADDR   065FH   A 
T2_INT_RCP_GAIN_P~  C ADDR   049DH   A 
T2_INT_RCP_UPDATE~  C ADDR   045EH   A 
RESET. . . . . . .  C ADDR   126BH   A 
EEP_PGM_PPM_MAX_T~  C ADDR   1A1AH   A 
PGM_GOV_P_GAIN_DE~  I ADDR   009FH   A 
PWM_LIMIT_SPOOLUP.  D ADDR   005FH   A 
RCP_PREPREV_EDGE_H  D ADDR   0053H   A 
WT_ADVANCE_H . . .  D ADDR   004BH   A 
RCP_PWM_FREQ_2KHZ.  N NUMB   0001h            
PGM_PWM_HIGH_FREQ.  N NUMB   0005h            
DEFAULT_PGM_TAIL_~  N NUMB   0003h            
DEFAULT_PGM_TAIL_~  N NUMB   0002h            
LOCK_BYTE_ADDRESS~  N NUMB   1FFFh            
ACKRQ1 . . . . . .  B ADDR   00C0H.3 A 
SP . . . . . . . .  D ADDR   0081H   A 
SMB0CN . . . . . .  D ADDR   00C0H   A 
SCON0. . . . . . .  D ADDR   0098H   A 
P1MAT. . . . . . .  D ADDR   00EDH   A 
POLARIS_THUNDER_6~  N NUMB   0096h            
SKYWALKER_20A_MAIN  N NUMB   005Bh            
TURNIGY_AE_30A_TA~  N NUMB   0047h            
TURNIGY_AE_20A_MU~  N NUMB   0042h            
XP_35A_SW_MULTI. .  N NUMB   0015h            
XP_7A_MAIN . . . .  N NUMB   0004h            
FUNCTION_NEXT. . .  C ADDR   1D7DH   A 
STORE_MULTI_FUNC_~  C ADDR   1C9CH   A 
STEPPER_ROT_BEG. .  C ADDR   162BH   A 
THROTTLE_HIGH_CAL.  C ADDR   141BH   A 
DECODE_THROTTLE_R~  C ADDR   1214H   A 
STEPPER_STEP_MED_~  C ADDR   0C96H   A 
INITIALIZE_ALL_TI~  C ADDR   0C4AH   A 
STARTUP_PWM_SET_P~  C ADDR   0C3EH   A 
PGM_THROTTLE_RATE.  I ADDR   009BH   A 
PGM_STARTUP_RPM. .  I ADDR   008FH   A 
PGM_DIRECTION. . .  I ADDR   0088H   A 
PGM_PWM_FREQ . . .  I ADDR   0087H   A 
RUN_COUNT_H. . . .  D ADDR   0075H   A 
LIPO_ADC_LIMIT_L .  D ADDR   006AH   A 
RCP_EDGE_L . . . .  D ADDR   0054H   A 
PWM_SETTLE . . . .  N NUMB   0032h            
GOV_SPOOLRATE. . .  N NUMB   0001h            
DEFAULT_PGM_MULTI~  N NUMB   0003h            
DEFAULT_PGM_MULTI~  N NUMB   0002h            
MAIN_SPOOLUP_TIME.  N NUMB   000Ah            
PORT3_EXIST. . . .  N NUMB   0000h            
AC . . . . . . . .  B ADDR   00D0H.6 A 
SMB1CN . . . . . .  D ADDR   00C0H   A 
SMB0ADM. . . . . .  D ADDR   00E7H   A 
EIE1 . . . . . . .  D ADDR   00E6H   A 
AMX0N. . . . . . .  D ADDR   00BAH   A 
ADC0LTL. . . . . .  D ADDR   00C5H   A 
ADC0L. . . . . . .  D ADDR   00BDH   A 
POLARIS_THUNDER_8~  N NUMB   0098h            
SKYWALKER_12A_MAIN  N NUMB   0058h            
TURNIGY_KFORCE_12~  N NUMB   0053h            
TURNIGY_AE_45A_MA~  N NUMB   0049h            
TURNIGY_AE_30A_MU~  N NUMB   0048h            
TURNIGY_PLUSH_30A~  N NUMB   002Bh            
TURNIGY_PLUSH_12A~  N NUMB   0022h            
XP_3A_TAIL . . . .  N NUMB   0002h            
PARAVAL_NEXT . . .  C ADDR   1D68H   A 
STORE_MULTI_FUNC_~  C ADDR   1CA1H   A 
WRITE_EEPROM_BYTE.  C ADDR   1C04H   A 
MEASURE_PWM_FREQ_~  C ADDR   134FH   A 
COMM61_CP. . . . .  C ADDR   106DH   A 
COMM_EXIT. . . . .  C ADDR   107CH   A 
SETUP_ZC_SCAN_WAIT  C ADDR   0D1FH   A 
CALC_GOVERNOR_INT~  C ADDR   0A6AH   A 
PCA_INT_PPM_CHECK~  C ADDR   06BDH   A 
PCA_INT_PWM_DIVIDE  C ADDR   0763H   A 
PCA_INT_LIMITED. .  C ADDR   0786H   A 
T2_INT_PWM_UPDATE.  C ADDR   04A4H   A 
T0_INT_PWM_OFF_DA~  C ADDR   0109H   A 
EEP_DUMMY. . . . .  C ADDR   1A22H   A 
EEP_LAYOUT_REVISI~  C ADDR   1A02H   A 
PGM_PPM_CENTER_TH~  I ADDR   009EH   A 
PGM_GOV_SETUP_TAR~  I ADDR   008EH   A 
COMM_PERIOD4X_L. .  D ADDR   003CH   A 
PGM_RCP_PWM_POL. .  N NUMB   0006h            
RCP_PWM_FREQ_4KHZ.  N NUMB   0002h            
REQUESTED_PWM. . .  D ADDR   0022H   A 
OV . . . . . . . .  B ADDR   00D0H.2 A 
MCE0 . . . . . . .  B ADDR   0098H.5 A 
SMB1ADM. . . . . .  D ADDR   00E7H   A 
PCA0CLR. . . . . .  D ADDR   00CEH   A 
EIE2 . . . . . . .  D ADDR   00AFH   A 
MODE . . . . . . .  N NUMB   0002h            
POLARIS_THUNDER_8~  N NUMB   0099h            
SKYWALKER_40A_MAIN  N NUMB   005Eh            
TURNIGY_KFORCE_12~  N NUMB   0054h            
TURNIGY_PLUSH_40A~  N NUMB   002Eh            
SUPERMICRO_3P5A_M~  N NUMB   0019h            
XP_3A_MULTI. . . .  N NUMB   0003h            
FUNC_PARAVAL_WAIT.  C ADDR   1D32H   A 
STORE_MULTI_FUNC_~  C ADDR   1CA6H   A 
WRITE_TAG. . . . .  C ADDR   1C59H   A 
READ_EEPROM_STORE~  C ADDR   1880H   A 
RUN1 . . . . . . .  C ADDR   16FEH   A 
CLEAR_RAM. . . . .  C ADDR   12CEH   A 
SET_BEC_VOLTAGE. .  C ADDR   123EH   A 
DECODE_GOVERNOR_G~  C ADDR   11FBH   A 
DEC_STEP_HIGH. . .  C ADDR   10D0H   A 
WAIT_FOR_COMM. . .  C ADDR   0EBEH   A 
CALC_NEW_WAIT_DIR~  C ADDR   0D66H   A 
MEASURE_LIPO_ADD_~  C ADDR   0B5AH   A 
CALC_GOVERNOR_PRO~  C ADDR   09A8H   A 
DIV_U16_BY_U16_DI~  C ADDR   088CH   A 
WAIT100MS. . . . .  C ADDR   07FFH   A 
WAIT1MS. . . . . .  C ADDR   07EBH   A 
STARTUP_POWER_TAB~  C ADDR   009AH   A 
EEP_PGM_BEEP_STRE~  C ADDR   1A1BH   A 
EEP_PGM_STARTUP_A~  C ADDR   1A13H   A 
TX_PGM_BEEP_NO . .  D ADDR   0072H   A 
SPOOLUP_LIMIT_SKIP  D ADDR   0065H   A 
RCP_SKIP_RATE. . .  N NUMB   0006h            
DEFAULT_PGM_TAIL_~  N NUMB   0004h            
DEFAULT_PGM_TAIL_~  N NUMB   00FAh            
MODF . . . . . . .  B ADDR   00F8H.5 A 
STO0 . . . . . . .  B ADDR   00C0H.4 A 
EA . . . . . . . .  B ADDR   00A8H.7 A 
PSCTL. . . . . . .  D ADDR   008FH   A 
IDA0H. . . . . . .  D ADDR   0097H   A 
AMX0P. . . . . . .  D ADDR   00BBH   A 
PLATINUM_PRO_30A_~  N NUMB   009Eh            
TURNIGY_KFORCE_12~  N NUMB   0055h            
FUNCTION_PARAVAL_~  C ADDR   1D00H   A 
STORE_MULTI_FUNC_~  C ADDR   1CABH   A 
STORE_NEW_VALUE_I~  C ADDR   1C61H   A 
DIRECT_START_PWM_~  C ADDR   17E9H   A 
RUN2 . . . . . . .  C ADDR   171CH   A 
ARMING_PPM_CHECK .  C ADDR   13DEH   A 
COMM45_CP. . . . .  C ADDR   0FE1H   A 
WAIT_BEFORE_ZC_SC~  C ADDR   0DD8H   A 
MEASURE_LIPO_UPDA~  C ADDR   0B62H   A 
GOVERNOR_CORR_INT~  C ADDR   0AB6H   A 
GOVERNOR_STORE_PR~  C ADDR   09A4H   A 
DIV_U16_BY_U16_DI~  C ADDR   0896H   A 
WAIT200MS. . . . .  C ADDR   0804H   A 
T2_INT_CURRENT_PW~  C ADDR   04B9H   A 
T2_INT_RCP_GAIN_C~  C ADDR   0494H   A 
T2_INT_PULSES_ABS~  C ADDR   0406H   A 
EEP_PGM_STARTUP_P~  C ADDR   1A09H   A 
PGM_LOW_VOLTAGE_L~  I ADDR   0083H   A 
RCP_PREPREV_EDGE_L  D ADDR   0052H   A 
WT_ADVANCE_L . . .  D ADDR   004AH   A 
GOV_ACTIVE . . . .  D ADDR   0049H   A 
TEMP1. . . . . . .    REG    R0             
DEFAULT_PGM_MULTI~  N NUMB   0004h            
DEFAULT_PGM_MULTI~  N NUMB   0050h            
DEFAULT_PGM_MULTI~  N NUMB   0004h            
STO1 . . . . . . .  B ADDR   00C0H.4 A 
ARBLOST0 . . . . .  B ADDR   00C0H.2 A 
IT01CF . . . . . .  D ADDR   00E4H   A 
IDA1H. . . . . . .  D ADDR   0097H   A 
DERIVID. . . . . .  D ADDR   00ABH   A 
ACC. . . . . . . .  D ADDR   00E0H   A 
PLATINUM_PRO_30A_~  N NUMB   009Fh            
TURNIGY_AE_25A_TA~  N NUMB   0044h            
TURNIGY_PLUSH_60A~  N NUMB   0031h            
TURNIGY_PLUSH_10A~  N NUMB   0020h            
STORE_MULTI_FUNC_~  C ADDR   1CB0H   A 
RUN3 . . . . . . .  C ADDR   173AH   A 
DIRECT_METHOD_STA~  C ADDR   1595H   A 
DECODE_DAMPING_DO~  C ADDR   11A3H   A 
PWM_WAIT . . . . .  C ADDR   0E6AH   A 
CHECK_VOLTAGE_EXIT  C ADDR   0C0EH   A 
GOVERNOR_LIMIT_IN~  C ADDR   0A9EH   A 
GOVERNOR_CHECK_IN~  C ADDR   09CEH   A 
DIV_U16_BY_U16_DI~  C ADDR   08ADH   A 
WAIT3MS. . . . . .  C ADDR   07F0H   A 
THROTTLE_RATE_TAB~  C ADDR   008DH   A 
EEP_PGM_DEMAG_COMP  C ADDR   1A1FH   A 
EEP_FW_MAIN_REVIS~  C ADDR   1A00H   A 
PGM_PPM_MIN_THROT~  I ADDR   0096H   A 
INITIALIZED_H_DUM~  I ADDR   008BH   A 
RUN_COUNT_L. . . .  D ADDR   0074H   A 
GOV_INTEGRAL_H . .  D ADDR   0043H   A 
POWER_ON_WAIT_CNT~  D ADDR   0032H   A 
TEMP2. . . . . . .    REG    R1             
RCP_STOP_LIMIT . .  N NUMB   00FAh            
RCP_MIN. . . . . .  N NUMB   0000h            
AD0EN. . . . . . .  B ADDR   00E8H.7 A 
ARBLOST1 . . . . .  B ADDR   00C0H.2 A 
ES0. . . . . . . .  B ADDR   00A8H.4 A 
S0MODE . . . . . .  B ADDR   0098H.7 A 
VDM0CN . . . . . .  D ADDR   00FFH   A 
TS0CN. . . . . . .  D ADDR   00D2H   A 
SFRPAGE. . . . . .  D ADDR   00A7H   A 
P0MDIN . . . . . .  D ADDR   00F1H   A 
CPT0MD . . . . . .  D ADDR   009DH   A 
CPT0CN . . . . . .  D ADDR   009BH   A 
POLARIS_THUNDER_1~  N NUMB   009Ah            
SKYWALKER_20A_TAIL  N NUMB   005Ch            
TURNIGY_AE_25A_MU~  N NUMB   0045h            
TURNIGY_PLUSH_25A~  N NUMB   0028h            
TURNIGY_PLUSH_10A~  N NUMB   0021h            
XP_7A_TAIL . . . .  N NUMB   0005h            
BEEP_NO_ENTRY. . .  C ADDR   1D2BH   A 
JMP_WAIT_FOR_POWE~  C ADDR   1864H   A 
DIRECT_START_CHEC~  C ADDR   17ECH   A 
RUN4 . . . . . . .  C ADDR   1758H   A 
STORE_TIMES_UP_OR~  C ADDR   0DB8H   A 
STORE_TIMES_DECRE~  C ADDR   0DCBH   A 
STEPPER_STEP_SET .  C ADDR   0CB0H   A 
TEMP_AVERAGE_INC .  C ADDR   0B9EH   A 
GOVERNOR_CORR_INT~  C ADDR   0AC7H   A 
MULT_S16_BY_U8_DI~  C ADDR   08BCH   A 
PCA_INT_PPM_NEG_C~  C ADDR   0720H   A 
T0_INT_PWM_OFF_CO~  C ADDR   0166H   A 
_EEP_PGM_MOTOR_ID~  C ADDR   1A08H   A 
DEMAG_CONSECUTIVE~  D ADDR   0039H   A 
INITIAL_ARM. . . .  D ADDR   0030H   A 
RCP_PWM_FREQ_8KHZ.  N NUMB   0003h            
TEMP3. . . . . . .    REG    R2             
DEFAULT_PGM_PPM_C~  N NUMB   007Ah            
DEFAULT_PGM_MAIN_~  N NUMB   0001h            
COMP_PWM_HIGH_OFF~  N NUMB   003Ch            
CF . . . . . . . .  B ADDR   00D8H.7 A 
ET0. . . . . . . .  B ADDR   00A8H.1 A 
SMB0ADR. . . . . .  D ADDR   00D7H   A 
P1MDIN . . . . . .  D ADDR   00F2H   A 
P0MDOUT. . . . . .  D ADDR   00A4H   A 
ADC0CN . . . . . .  D ADDR   00E8H   A 
SKYWALKER_20A_MUL~  N NUMB   005Dh            
SKYWALKER_12A_TAIL  N NUMB   0059h            
TURNIGY_AE_45A_TA~  N NUMB   004Ah            
TURNIGY_PLUSH_80A~  N NUMB   0034h            
TURNIGY_PLUSH_30A~  N NUMB   002Ch            
TURNIGY_PLUSH_12A~  N NUMB   0023h            
XP_7A_MULTI. . . .  N NUMB   0006h            
READ_TAGS. . . . .  C ADDR   1C3FH   A 
RUN5 . . . . . . .  C ADDR   1776H   A 
COMP_READ. . . . .  C ADDR   0E70H   A 
COMP_WAIT_SET_RES~  C ADDR   0E31H   A 
DIVIDE_WAIT_TIMES.  C ADDR   0D6CH   A 
GOVERNOR_CORR_NEG~  C ADDR   0ABBH   A 
GOVERNOR_LIMIT_PR~  C ADDR   0999H   A 
GOVERNOR_TARGET_C~  C ADDR   091BH   A 
CALC_GOVERNOR_TAR~  C ADDR   0913H   A 
PCA_INT_PWM_DIVID~  C ADDR   076AH   A 
T2_INT_CURRENT_PW~  C ADDR   04DAH   A 
EEP_PGM_DAMPING_F~  C ADDR   1A16H   A 
PGM_PPM_MAX_THROT~  I ADDR   0097H   A 
BEEP_STRENGTH. . .  D ADDR   006FH   A 
RCP_PREV_PERIOD_H.  D ADDR   0057H   A 
DIRECT_STARTUP_OK~  D ADDR   0038H   A 
RCP_MEAS_PWM_FREQ.  N NUMB   0001h            
TEMP4. . . . . . .    REG    R3             
RCP_STOP . . . . .  N NUMB   0001h            
RCP_MAX. . . . . .  N NUMB   00FFh            
ET1. . . . . . . .  B ADDR   00A8H.3 A 
TF0. . . . . . . .  B ADDR   0088H.5 A 
SMB1ADR. . . . . .  D ADDR   00D7H   A 
P2MDIN . . . . . .  D ADDR   00F3H   A 
P1MDOUT. . . . . .  D ADDR   00A5H   A 
IDA0L. . . . . . .  D ADDR   0096H   A 
SKYWALKER_40A_TAIL  N NUMB   005Fh            
SKYWALKER_12A_MUL~  N NUMB   005Ah            
TURNIGY_AE_45A_MU~  N NUMB   004Bh            
TURNIGY_PLUSH_40A~  N NUMB   002Fh            
TURNIGY_PLUSH_30A~  N NUMB   002Dh            
TURNIGY_PLUSH_18A~  N NUMB   0025h            
TURNIGY_PLUSH_12A~  N NUMB   0024h            
SUPERMICRO_3P5A_T~  N NUMB   001Ah            
RUN6 . . . . . . .  C ADDR   1794H   A 
ARMING_START . . .  C ADDR   13BEH   A 
MEASURE_PWM_FREQ_~  C ADDR   1353H   A 
DECREMENT_STEP_EX~  C ADDR   10FDH   A 
COMM_RETURN. . . .  C ADDR   108FH   A 
GOVERNOR_DEACTIVA~  C ADDR   0925H   A 
PCA_INT_CHECK_LEG~  C ADDR   077BH   A 
PWM_BNFET_APFET_O~  C ADDR   02FEH   A 
PWM_ANFET_BPFET_O~  C ADDR   0233H   A 
PWM_NOFET_ON . . .  C ADDR   01CDH   A 
EEP_PGM_MOTOR_GAIN  C ADDR   1A07H   A 
PGM_THROTTLE_RATE~  I ADDR   00A1H   A 
PGM_MAIN_REARM_ST~  I ADDR   008DH   A 
STARTUP_ROT_CNT. .  D ADDR   0037H   A 
RCP_UPDATED. . . .  N NUMB   0000h            
CURR_PWMOFF_COMP_~  N NUMB   0006h            
T3_PENDING . . . .  N NUMB   0000h            
TEMP5. . . . . . .    REG    R4             
RCP_TIMEOUT. . . .  N NUMB   0018h            
MUX_A1 . . . . . .  N NUMB   0002h            
COMP_PWM_HIGH_ON_~  N NUMB   001Eh            
TF2LEN . . . . . .  B ADDR   00C8H.5 A 
ET2. . . . . . . .  B ADDR   00A8H.5 A 
RI0. . . . . . . .  B ADDR   0098H.0 A 
TF1. . . . . . . .  B ADDR   0088H.7 A 
TMR2RLH. . . . . .  D ADDR   00CBH   A 
SMB0DAT. . . . . .  D ADDR   00C2H   A 
P2MDOUT. . . . . .  D ADDR   00A6H   A 
IDA1L. . . . . . .  D ADDR   0096H   A 
ALIGN_RCE_BL15P_M~  N NUMB   0070h            
SKYWALKER_40A_MUL~  N NUMB   0060h            
TURNIGY_KFORCE_12~  N NUMB   0056h            
TURNIGY_PLUSH_40A~  N NUMB   0030h            
SUPERMICRO_3P5A_M~  N NUMB   001Bh            
DP_3A_MAIN . . . .  N NUMB   0016h            
ARM_TARGET_UPDATED  C ADDR   14A3H   A 
EVALUATE_COMPARAT~  C ADDR   0E7FH   A 
TEMP_CHECK_EXIT. .  C ADDR   0BC8H   A 
GOVERNOR_APPLY_PR~  C ADDR   0A40H   A 
PWM_CNFET_APFET_O~  C ADDR   0347H   A 
PWM_ANFET_CPFET_O~  C ADDR   027CH   A 
EEP_PGM_GOV_MODE .  C ADDR   1A05H   A 
PGM_ENABLE_TX_PRO~  I ADDR   008CH   A 
INITIALIZED_L_DUM~  I ADDR   008AH   A 
GOV_INTEGRAL_L . .  D ADDR   0042H   A 
POWER_ON_WAIT_CNT~  D ADDR   0031H   A 
GOVERNOR_REQ_PWM .  D ADDR   0023H   A 
TEMP6. . . . . . .    REG    R5             
DEFAULT_PGM_PPM_M~  N NUMB   0025h            
DEFAULT_PGM_MAIN_~  N NUMB   0001h            
DEFAULT_PGM_MAIN_~  N NUMB   0002h            
DEFAULT_PGM_MAIN_~  N NUMB   000Dh            
DEFAULT_PGM_MAIN_~  N NUMB   0003h            
MUX_B1 . . . . . .  N NUMB   0000h            
MUX_A2 . . . . . .  N NUMB   0003h            
SI0. . . . . . . .  B ADDR   00C0H.0 A 
PSPI0. . . . . . .  B ADDR   00B8H.6 A 
TMR3RLH. . . . . .  D ADDR   0093H   A 
TH0. . . . . . . .  D ADDR   008CH   A 
SPI0CFG. . . . . .  D ADDR   00A1H   A 
SMB1DAT. . . . . .  D ADDR   00C2H   A 
PCA0H. . . . . . .  D ADDR   00FAH   A 
P0MASK . . . . . .  D ADDR   00FEH   A 
TURNIGY_KFORCE_12~  N NUMB   0057h            
TURNIGY_PLUSH_60A~  N NUMB   0032h            
WRITE_EEPROM_BLOC~  C ADDR   18CCH   A 
NORMAL_RUN_CHECKS.  C ADDR   17F9H   A 
DEC_STEP_MED_LOW .  C ADDR   10EBH   A 
WAIT_FOR_COMP_OUT~  C ADDR   0E00H   A 
WAIT_ADVANCE_TIMI~  C ADDR   0D33H   A 
CALC_GOVERNOR_PRO~  C ADDR   0970H   A 
PCA_INT_PPM_UNIDI~  C ADDR   071AH   A 
T2_INT_PPM_TIMEOU~  C ADDR   0447H   A 
PWM_CNFET_BPFET_O~  C ADDR   03A0H   A 
PWM_BNFET_CPFET_O~  C ADDR   02BDH   A 
EEP_FW_SUB_REVISI~  C ADDR   1A01H   A 
PGM_BEEP_STRENGTH.  I ADDR   0098H   A 
PGM_STARTUP_ACCEL.  I ADDR   0090H   A 
TEMP7. . . . . . .    REG    R6             
DEFAULT_PGM_MAIN_~  N NUMB   00B4h            
DEFAULT_PGM_MAIN_~  N NUMB   0001h            
MUX_C1 . . . . . .  N NUMB   0002h            
MUX_B2 . . . . . .  N NUMB   0001h            
ADC_LIMIT_H. . . .  N NUMB   0000h            
SI1. . . . . . . .  B ADDR   00C0H.0 A 
EX0. . . . . . . .  B ADDR   00A8H.0 A 
TI0. . . . . . . .  B ADDR   0098H.1 A 
IT0. . . . . . . .  B ADDR   0088H.0 A 
TMR4RLH. . . . . .  D ADDR   0093H   A 
TMR2H. . . . . . .  D ADDR   00CDH   A 
TH1. . . . . . . .  D ADDR   008DH   A 
SPI0CN . . . . . .  D ADDR   00F8H   A 
P1MASK . . . . . .  D ADDR   00EEH   A 
CRC0CNT. . . . . .  D ADDR   00DEH   A 
POLARIS_THUNDER_1~  N NUMB   009Bh            
ALIGN_RCE_BL35P_M~  N NUMB   0076h            
TURNIGY_PLUSH_60A~  N NUMB   0033h            
TURNIGY_PLUSH_25A~  N NUMB   0029h            
WRITE_EEPROM_BLOC~  C ADDR   18DAH   A 
READ_ALL_EEPROM_P~  C ADDR   1867H   A 
PROGRAM_BY_TX_ENT~  C ADDR   148AH   A 
WAIT_FOR_COMM_BLI~  C ADDR   0ED8H   A 
SKYPUP_03. . . . .  C ADDR   078EH   A 
T0_INT_PWM_OFF_ST~  C ADDR   00DCH   A 
T0_INT . . . . . .  C ADDR   00BAH   A 
_EEP_PGM_VOLT_COMP  C ADDR   1A14H   A 
EEP_PGM_GOV_I_GAIN  C ADDR   1A04H   A 
PGM_STARTUP_PWR. .  I ADDR   0086H   A 
RCP_STOP_CNT . . .  D ADDR   005CH   A 
NEW_RCP. . . . . .  D ADDR   0059H   A 
RCP_PREV_PERIOD_L.  D ADDR   0056H   A 
PGM_DIR_REV. . . .  N NUMB   0005h            
PGM_PWMOFF_DAMPED~  N NUMB   0003h            
INITIAL_RUN_PHASE.  N NUMB   0004h            
TEMP8. . . . . . .    REG    R7             
RCP_VALIDATE . . .  N NUMB   0002h            
DEFAULT_PGM_PPM_M~  N NUMB   00D0h            
MUX_C2 . . . . . .  N NUMB   0003h            
DEBUGPIN . . . . .  N NUMB   0004h            
ANFET. . . . . . .  N NUMB   0002h            
TF5LEN . . . . . .  B ADDR   00C8H.5 A 
EX1. . . . . . . .  B ADDR   00A8H.2 A 
IT1. . . . . . . .  B ADDR   0088H.2 A 
TMR5RLH. . . . . .  D ADDR   00CBH   A 
TMR3H. . . . . . .  D ADDR   0095H   A 
OSCXCN . . . . . .  D ADDR   00B1H   A 
IE . . . . . . . .  D ADDR   00A8H   A 
CKCON. . . . . . .  D ADDR   008EH   A 
POLARIS_THUNDER_1~  N NUMB   009Ch            
TURNIGY_PLUSH_80A~  N NUMB   0035h            
TURNIGY_PLUSH_25A~  N NUMB   002Ah            
DECODE_DEMAG_COMP.  C ADDR   1230H   A 
EVAL_COMP_EXIT . .  C ADDR   0EA9H   A 
EVAL_COMP_NO_DEMAG  C ADDR   0E91H   A 
STEPPER_STEP_LOW .  C ADDR   0CA4H   A 
MEASURE_LIPO_ADJU~  C ADDR   0B1FH   A 
SKYPUP_04. . . . .  C ADDR   07A2H   A 
PCA_INT_SET_TIMEO~  C ADDR   07B7H   A 
PWM_AFET_ON. . . .  C ADDR   01CFH   A 
T0_INT_PWM_ON_EXE~  C ADDR   00CCH   A 
EEP_PGM_STARTUP_M~  C ADDR   1A18H   A 
EEP_PGM_COMM_TIMI~  C ADDR   1A15H   A 
PGM_DEMAG_COMP . .  I ADDR   009CH   A 
WT_STEPPER_STEP_H.  D ADDR   0051H   A 
PREV_COMM_H. . . .  D ADDR   003BH   A 
RCP_TIMEOUT_CNT. .  D ADDR   0028H   A 
DEFAULT_PGM_TAIL_~  N NUMB   0003h            
DEFAULT_PGM_MAIN_~  N NUMB   0000h            
DEFAULT_PGM_MAIN_~  N NUMB   0004h            
BNFET. . . . . . .  N NUMB   0005h            
TEMP_LIMIT_STEP. .  N NUMB   0004h            
TXBMT. . . . . . .  B ADDR   00F8H.1 A 
RXOVRN . . . . . .  B ADDR   00F8H.4 A 
TMR4H. . . . . . .  D ADDR   0095H   A 
TMR2RLL. . . . . .  D ADDR   00CAH   A 
REVISION . . . . .  D ADDR   00ACH   A 
PCA0CPH0 . . . . .  D ADDR   00FCH   A 
IDA0CN . . . . . .  D ADDR   00B9H   A 
EIP1 . . . . . . .  D ADDR   00F6H   A 
TURNIGY_PLUSH_80A~  N NUMB   0036h            
TURNIGY_PLUSH_18A~  N NUMB   0026h            
XP_12A_MAIN. . . .  N NUMB   000Ah            
STEPPER_ROT_EXIT .  C ADDR   169CH   A 
STEPPER_METHOD_ST~  C ADDR   15D6H   A 
DECODE_PARAMS_DIR~  C ADDR   11DDH   A 
COMM12_DAMP. . . .  C ADDR   0EFCH   A 
SETUP_COMM_WAIT. .  C ADDR   0EAAH   A 
CALC_NEXT_COMM_TI~  C ADDR   0CBDH   A 
CHECK_VOLTAGE_LIM.  C ADDR   0BF4H   A 
CALC_GOVERNOR_INT~  C ADDR   0A05H   A 
T2_INT_SET_CURREN~  C ADDR   04D7H   A 
PWM_BFET_ON. . . .  C ADDR   01E1H   A 
T2_INT . . . . . .  C ADDR   03E7H   A 
LIPO_ADC_REFERENC~  D ADDR   0069H   A 
AUTO_BAILOUT_ARMED  D ADDR   005DH   A 
PWM_ON . . . . . .  N NUMB   0002h            
BIT_ACCESS . . . .  D ADDR   0020H   A 
DEFAULT_PGM_ENABL~  N NUMB   0001h            
DEFAULT_PGM_MULTI~  N NUMB   0003h            
APFET. . . . . . .  N NUMB   0003h            
CNFET. . . . . . .  N NUMB   0006h            
COMP1_USED . . . .  N NUMB   0000h            
P. . . . . . . . .  B ADDR   00D0H.0 A 
TMR5H. . . . . . .  D ADDR   00CDH   A 
TMR3RLL. . . . . .  D ADDR   0092H   A 
TL0. . . . . . . .  D ADDR   008AH   A 
PCON . . . . . . .  D ADDR   0087H   A 
PCA0L. . . . . . .  D ADDR   00F9H   A 
PCA0CPH1 . . . . .  D ADDR   00EAH   A 
IDA1CN . . . . . .  D ADDR   00B9H   A 
EIP2 . . . . . . .  D ADDR   00BFH   A 
ALIGN_RCE_BL15P_T~  N NUMB   0071h            
RCTIMER_6A_MAIN. .  N NUMB   006Ah            
TURNIGY_PLUSH_NFE~  N NUMB   003Dh            
TURNIGY_PLUSH_18A~  N NUMB   0027h            
DP_3A_TAIL . . . .  N NUMB   0017h            
XP_7A_FAST_MAIN. .  N NUMB   0007h            
ARM_END_BEEP . . .  C ADDR   14AFH   A 
THROTTLE_HIGH_CAL~  C ADDR   1419H   A 
WAIT_FOR_COMP_OUT~  C ADDR   0DF1H   A 
LOAD_MIN_TIME. . .  C ADDR   0D88H   A 
CALC_NEW_WAIT_TIM~  C ADDR   0D47H   A 
SET_STARTUP_PWM. .  C ADDR   0C1AH   A 
GOVERNOR_STORE_IN~  C ADDR   09FFH   A 
GOVERNOR_ACTIVATE~  C ADDR   0962H   A 
PWM_CFET_ON. . . .  C ADDR   01F3H   A 
DEMAG_POWER_TABLE.  C ADDR   00A7H   A 
GOV_GAIN_TABLE . .  C ADDR   0080H   A 
T3_INT . . . . . .  C ADDR   053CH   A 
PGM_DAMPING_FORCE.  I ADDR   0093H   A 
PGM_MOTOR_IDLE . .  I ADDR   0085H   A 
TX_PGM_PARAVAL_NO.  D ADDR   0071H   A 
ADC_CONVERSION_CNT  D ADDR   006CH   A 
GOV_ARM_TARGET . .  D ADDR   0048H   A 
COMP_WAIT_READS. .  D ADDR   003FH   A 
DEFAULT_PGM_TAIL_~  N NUMB   0001h            
DEFAULT_PGM_TAIL_~  N NUMB   0004h            
DEFAULT_PGM_TAIL_~  N NUMB   000Dh            
DEFAULT_PGM_TAIL_~  N NUMB   0003h            
BPFET. . . . . . .  N NUMB   0004h            
ADC_LIMIT_L. . . .  N NUMB   0055h            
HIGH_DRIVER_PRECH~  N NUMB   0000h            
EEP_ESC_LAYOUT . .  C ADDR   1A40H   A 
TMR4RLL. . . . . .  D ADDR   0092H   A 
TMR2L. . . . . . .  D ADDR   00CCH   A 
TL1. . . . . . . .  D ADDR   008BH   A 
SN0. . . . . . . .  D ADDR   00ABH   A 
PCA0CPH2 . . . . .  D ADDR   00ECH   A 
TAROT_30A_MAIN . .  N NUMB   00A3h            
ALIGN_RCE_BL15P_M~  N NUMB   0072h            
DP_3A_MULTI. . . .  N NUMB   0018h            
FUNC_PARAVAL . . .  C ADDR   1D2EH   A 
WAIT1S_LOOP. . . .  C ADDR   1CBAH   A 
STORE_MULTI_FUNC_1  C ADDR   1C65H   A 
RUN6_CHECK_RCP_TI~  C ADDR   181CH   A 
DECREMENT_STEP . .  C ADDR   10AEH   A 
COMM23_DAMP. . . .  C ADDR   0F2CH   A 
WAIT_DEMAG_DEFAUL~  C ADDR   0EDAH   A 
ADJUST_TIMING. . .  C ADDR   0D8CH   A 
STEPPER_STEP_MED_~  C ADDR   0C7AH   A 
MEASURE_LIPO_DIVI~  C ADDR   0B3FH   A 
MEASURE_LIPO_START  C ADDR   0ACCH   A 
CALC_GOVERNOR_PRO~  C ADDR   0A69H   A 
GOVERNOR_INT_MIN_~  C ADDR   09FAH   A 
GOVERNOR_LIMIT_PR~  C ADDR   09A0H   A 
BEEP_F1. . . . . .  C ADDR   0814H   A 
EEP_PGM_BEACON_DE~  C ADDR   1A1DH   A 
EEP_PGM_BEACON_ST~  C ADDR   1A1CH   A 
TAG_TEMPORARY_STO~  I ADDR   00D0H   A 
PGM_MOTOR_GAIN . .  I ADDR   0084H   A 
CURRENT_AVERAGE_T~  D ADDR   006DH   A 
PWM_OFF_CNT. . . .  D ADDR   0063H   A 
PWM_SPOOLUP_BEG. .  D ADDR   0060H   A 
PWM_LIMIT. . . . .  D ADDR   005EH   A 
WT_ZC_SCAN_H . . .  D ADDR   004DH   A 
STEPPER_STEP_BEG_H  D ADDR   0034H   A 
DEFAULT_PGM_MULTI~  N NUMB   0001h            
DEFAULT_PGM_MULTI~  N NUMB   0001h            
DEFAULT_PGM_MULTI~  N NUMB   000Dh            
DEFAULT_PGM_MULTI~  N NUMB   0001h            
DEFAULT_PGM_TAIL_~  N NUMB   0001h            
DEFAULT_PGM_MAIN_~  N NUMB   0007h            
CPFET. . . . . . .  N NUMB   0007h            
LOCK_BYTE_ADDRESS~  N NUMB   3FFFh            
SPIF . . . . . . .  B ADDR   00F8H.7 A 
T2SPLIT. . . . . .  B ADDR   00C8H.3 A 
TMR5RLL. . . . . .  D ADDR   00CAH   A 
TMR3L. . . . . . .  D ADDR   0094H   A 
SN1. . . . . . . .  D ADDR   00ACH   A 
ALIGN_RCE_BL35P_T~  N NUMB   0077h            
STORE_MULTI_FUNC_2  C ADDR   1C6AH   A 
INITIAL_RUN_PHASE~  C ADDR   1815H   A 
TEST_THROTTLE_GAIN  C ADDR   125CH   A 
STEPPER_STEP_MED .  C ADDR   0C88H   A 
GOVERNOR_STORE_PR~  C ADDR   0A67H   A 
GOVERNOR_CHECK_PR~  C ADDR   0A2BH   A 
MULT_S16_BY_U8_PO~  C ADDR   08D6H   A 
DIV_U16_BY_U16 . .  C ADDR   0884H   A 
BEEP_ONOFF . . . .  C ADDR   0837H   A 
BEEP_F2. . . . . .  C ADDR   081BH   A 
PCA_INT_PPM_BIDIR~  C ADDR   06F0H   A 
PCA_INT_CHECK_DIFF  C ADDR   0652H   A 
T2_INT_SKIP_START.  C ADDR   044BH   A 
T0_INT_PWM_OFF_FU~  C ADDR   01C6H   A 
_EEP_PGM_GOV_RANGE  C ADDR   1A17H   A 
EEPROM_LAYOUT_REV~  N NUMB   0011h            
PGM_GOV_MODE . . .  I ADDR   0082H   A 
WT_STEPPER_STEP_L.  D ADDR   0050H   A 
PREV_COMM_L. . . .  D ADDR   003AH   A 
PGM_PWMOFF_DAMPED~  N NUMB   0004h            
STEPPER_PHASE. . .  N NUMB   0002h            
DEFAULT_PGM_MULTI~  N NUMB   0001h            
P0_INIT. . . . . .  N NUMB   00FFh            
PS0. . . . . . . .  B ADDR   00B8H.4 A 
TMR4L. . . . . . .  D ADDR   0094H   A 
SN2. . . . . . . .  D ADDR   00ADH   A 
SFRPGCN. . . . . .  D ADDR   00CFH   A 
PCA0CPL0 . . . . .  D ADDR   00FBH   A 
CRC0FLIP . . . . .  D ADDR   009AH   A 
ALIGN_RCE_BL35P_M~  N NUMB   0078h            
ALIGN_RCE_BL15X_M~  N NUMB   006Dh            
TURNIGY_KFORCE_70~  N NUMB   004Fh            
TURNIGY_KFORCE_40~  N NUMB   004Ch            
XP_25A_MAIN. . . .  N NUMB   0010h            
PARAVAL_NO_ENTRY .  C ADDR   1D28H   A 
STORE_MULTI_FUNC_3  C ADDR   1C6FH   A 
SUCCESS_BEEP_INVE~  C ADDR   1CE0H   A 
SUCCESS_BEEP . . .  C ADDR   1CC0H   A 
FIND_THROTTLE_GAIN  C ADDR   123FH   A 
DECREMENT_STEPPER~  C ADDR   10A2H   A 
COMM61_DAMP. . . .  C ADDR   102DH   A 
COMM34_DAMP. . . .  C ADDR   0F80H   A 
TEMP_AVERAGE_INC_~  C ADDR   0B8EH   A 
GOVERNOR_INT_MAX_~  C ADDR   09F3H   A 
GOVERNOR_LIMIT_IN~  C ADDR   09D7H   A 
BEEP_F3. . . . . .  C ADDR   0822H   A 
PCA_INT_FAIL_MINI~  C ADDR   0585H   A 
T0_INT_PWM_ON_EXI~  C ADDR   03E0H   A 
T0_INT_PWM_OFF_EX~  C ADDR   01B6H   A 
LIPO_ADC_REFERENC~  D ADDR   0068H   A 
SPOOLUP_LIMIT_CNT.  D ADDR   0064H   A 
PWM_ON_CNT . . . .  D ADDR   0062H   A 
FULL_THROTTLE_RAN~  N NUMB   0007h            
RCP_PWM_FREQ_12KHZ  N NUMB   0004h            
CURR_PWMOFF_DAMPED  N NUMB   0005h            
COMM_TIME_RED. . .  N NUMB   000Ah            
P1_INIT. . . . . .  N NUMB   0002h            
TEMP_LIMIT . . . .  N NUMB   0072h            
TF2H . . . . . . .  B ADDR   00C8H.7 A 
PT0. . . . . . . .  B ADDR   00B8H.1 A 
TMR5L. . . . . . .  D ADDR   00CCH   A 
TMOD . . . . . . .  D ADDR   0089H   A 
TCON . . . . . . .  D ADDR   0088H   A 
SN3. . . . . . . .  D ADDR   00AEH   A 
PCA0CPM0 . . . . .  D ADDR   00DAH   A 
PCA0CPL1 . . . . .  D ADDR   00E9H   A 
FLSCL. . . . . . .  D ADDR   00B6H   A 
TURNIGY_PLUSH_NFE~  N NUMB   003Ah            
XP_12A_TAIL. . . .  N NUMB   000Bh            
STORE_MULTI_FUNC_4  C ADDR   1C74H   A 
DAMPED_TRANSITION.  C ADDR   16F4H   A 
BEEP_DELAY_SET . .  C ADDR   14F9H   A 
PROGRAM_BY_TX_ENT~  C ADDR   13FFH   A 
LOCK_BYTE_OK . . .  C ADDR   128AH   A 
DECODE_PWM_FREQ_L~  C ADDR   11F5H   A 
DECODE_DAMPING_3 .  C ADDR   117BH   A 
CALC_NEW_WAIT_RED~  C ADDR   0D57H   A 
BEEP_F4. . . . . .  C ADDR   0829H   A 
PCA_INT_PPM_MAX_C~  C ADDR   074AH   A 
PCA_INT_RESTORE_E~  C ADDR   063EH   A 
T2H_INT_RCP_EXIT .  C ADDR   0530H   A 
EEP_PGM_GOV_P_GAIN  C ADDR   1A03H   A 
PGM_STARTUP_PWR_D~  I ADDR   00A2H   A 
PGM_GOV_I_GAIN . .  I ADDR   0081H   A 
RCP_EDGE_NO. . . .  N NUMB   0001h            
DEMAG_CUT_POWER. .  N NUMB   0004h            
DEFAULT_PGM_MULTI~  N NUMB   0001h            
DEFAULT_PGM_MAIN_~  N NUMB   0078h            
DEFAULT_PGM_MAIN_~  N NUMB   0001h            
P2_INIT. . . . . .  N NUMB   00FFh            
DAMPED_MODE_ENABLE  N NUMB   0001h            
NSSMD0 . . . . . .  B ADDR   00F8H.2 A 
WCOL . . . . . . .  B ADDR   00F8H.6 A 
AD0CM0 . . . . . .  B ADDR   00E8H.0 A 
CR . . . . . . . .  B ADDR   00D8H.6 A 
RS0. . . . . . . .  B ADDR   00D0H.3 A 
T5SPLIT. . . . . .  B ADDR   00C8H.3 A 
PT1. . . . . . . .  B ADDR   00B8H.3 A 
REN0 . . . . . . .  B ADDR   0098H.4 A 
SPI0DAT. . . . . .  D ADDR   00A3H   A 
PCA0MD . . . . . .  D ADDR   00D9H   A 
PCA0CPM1 . . . . .  D ADDR   00DBH   A 
PCA0CPL2 . . . . .  D ADDR   00EBH   A 
PCA0CN . . . . . .  D ADDR   00D8H   A 
H_KING_10A_MAIN. .  N NUMB   007Ch            
ALIGN_RCE_BL35X_M~  N NUMB   0073h            
RCTIMER_6A_TAIL. .  N NUMB   006Bh            
TURNIGY_PLUSH_NFE~  N NUMB   003Eh            
XP_18A_MAIN. . . .  N NUMB   000Dh            
XP_12A_MULTI . . .  N NUMB   000Ch            
XP_7A_FAST_TAIL. .  N NUMB   0008h            
PROGRAM_BY_TX_EXIT  C ADDR   1D8CH   A 
STORE_MULTI_FUNC_5  C ADDR   1C79H   A 
READ_EEPROM_BYTE .  C ADDR   1C00H   A 
DIRECT_START_PARA~  C ADDR   17D1H   A 
THROTTLE_LOW_CAL .  C ADDR   1451H   A 
DECODE_DAMPING_4 .  C ADDR   1185H   A 
COMM45_DAMP. . . .  C ADDR   0FB1H   A 
WAIT_FOR_COMM_SET~  C ADDR   0EEAH   A 
TEMP_AVERAGE_UPDA~  C ADDR   0BA6H   A 
GOVERNOR_APPLY_IN~  C ADDR   0AA2H   A 
GOVERNOR_LIMIT_PR~  C ADDR   0A36H   A 
BEEP_OFF . . . . .  C ADDR   0878H   A 
WAIT10MS . . . . .  C ADDR   07F5H   A 
PCA_INT_PPM_BIDIR~  C ADDR   06F7H   A 
T2H_INT_RCP_NO_LI~  C ADDR   052EH   A 
T0_INT_PWM_ON_EXIT  C ADDR   03D3H   A 
EEP_PGM_BEC_VOLTA~  C ADDR   1A20H   A 
EEP_INITIALIZED_H.  C ADDR   1A0EH   A 
EEP_PGM_INPUT_POL.  C ADDR   1A0CH   A 
EEPROM_FW_MAIN_RE~  N NUMB   000Bh            
PGM_STARTUP_METHOD  I ADDR   0095H   A 
PGM_COMM_TIMING. .  I ADDR   0092H   A 
TX_PGM_FUNC_NO . .  D ADDR   0070H   A 
WT_ZC_SCAN_L . . .  D ADDR   004CH   A 
STEPPER_STEP_BEG_L  D ADDR   0033H   A 
MOTOR_SPINNING . .  N NUMB   0000h            
CURRENT_PWM. . . .  D ADDR   0024H   A 
PWM_STEPPER. . . .  N NUMB   0078h            
P0_SKIP. . . . . .  N NUMB   FFFFFFDFh            
DEFAULT_PGM_MAIN_~  N NUMB   0009h            
NSSMD1 . . . . . .  B ADDR   00F8H.3 A 
AD0CM1 . . . . . .  B ADDR   00E8H.1 A 
AD0TM. . . . . . .  B ADDR   00E8H.6 A 
RS1. . . . . . . .  B ADDR   00D0H.4 A 
F0 . . . . . . . .  B ADDR   00D0H.5 A 
PT2. . . . . . . .  B ADDR   00B8H.5 A 
TR0. . . . . . . .  B ADDR   0088H.4 A 
TMR2CN . . . . . .  D ADDR   00C8H   A 
PCA0CPM2 . . . . .  D ADDR   00DCH   A 
TAROT_30A_TAIL . .  N NUMB   00A4h            
H_KING_20A_MAIN. .  N NUMB   007Fh            
RCTIMER_6A_MULTI .  N NUMB   006Ch            
HIMODEL_COOL_22A_~  N NUMB   0061h            
TURNIGY_PLUSH_NFE~  N NUMB   003Fh            
TURNIGY_PLUSH_NFE~  N NUMB   0037h            
XP_7A_FAST_MULTI .  N NUMB   0009h            
STORE_MULTI_FUNC_6  C ADDR   1C7EH   A 
READ_TAG . . . . .  C ADDR   1C48H   A 
RESET_CAL_DONE . .  C ADDR   12A6H   A 
DECODE_DAMPING_5 .  C ADDR   118FH   A 
DECODE_PARAMETERS.  C ADDR   1167H   A 
STEPPER_TIMER_WAIT  C ADDR   1107H   A 
STORE_TIMES_INCRE~  C ADDR   0DBEH   A 
CHECK_VOLTAGE_GOOD  C ADDR   0BEDH   A 
MEASURE_LIPO_CELLS  C ADDR   0ACCH   A 
CALC_GOVERNOR_INT~  C ADDR   09A9H   A 
PCA_INT_PPM_CALCU~  C ADDR   06CDH   A 
PCA_INT_EXIT . . .  C ADDR   07D1H   A 
T2_INT_RCP_UPDATE~  C ADDR   047CH   A 
T0_INT_PWM_OFF_DO~  C ADDR   012DH   A 
RCP_PERIOD_DIFF_A~  D ADDR   0058H   A 
THR_DELTA. . . . .  N NUMB   0002h            
RCP_TIMEOUT_PPM. .  N NUMB   000Ah            
DEFAULT_PGM_MAIN_~  N NUMB   0001h            
P1_SKIP. . . . . .  N NUMB   0002h            
AD0CM2 . . . . . .  B ADDR   00E8H.2 A 
AD0WINT. . . . . .  B ADDR   00E8H.3 A 
F1 . . . . . . . .  B ADDR   00D0H.1 A 
TF5H . . . . . . .  B ADDR   00C8H.7 A 
TR1. . . . . . . .  B ADDR   0088H.6 A 
TMR3CN . . . . . .  D ADDR   0091H   A 
P0SKIP . . . . . .  D ADDR   00D4H   A 
EIP1H. . . . . . .  D ADDR   0085H   A 
TAROT_30A_MULTI. .  N NUMB   00A5h            
HIMODEL_COOL_41A_~  N NUMB   0067h            
TURNIGY_PLUSH_6A_~  N NUMB   001Ch            
STORE_MULTI_FUNC_7  C ADDR   1C83H   A 
RUN6_CHECK_SPEED .  C ADDR   1826H   A 
WAIT_FOR_POWER_ON~  C ADDR   1525H   A 
DECODE_DAMPING_6 .  C ADDR   1199H   A 
DEC_STEP_LOW . . .  C ADDR   10F4H   A 
COMM56_DAMP. . . .  C ADDR   0FFCH   A 
SWITCH_POWER_OFF .  C ADDR   1090H   A 
WAIT30MS . . . . .  C ADDR   07FAH   A 
PCA_INT_PPM_BIDIR~  C ADDR   073BH   A 
PCA_INT_CHECK_1KHZ  C ADDR   062FH   A 
T2H_INT. . . . . .  C ADDR   04F6H   A 
T0_INT_PWM_OFF_CO~  C ADDR   017BH   A 
GOV_INTEGRAL_X . .  D ADDR   0044H   A 
DEFAULT_PGM_MULTI~  N NUMB   0009h            
NFETON_DELAY . . .  N NUMB   0006h            
EEP_ESC_MCU. . . .  C ADDR   1A50H   A 
AD0BUSY. . . . . .  B ADDR   00E8H.4 A 
T2XCLK . . . . . .  B ADDR   00C8H.0 A 
TR2. . . . . . . .  B ADDR   00C8H.2 A 
TF2L . . . . . . .  B ADDR   00C8H.6 A 
STA0 . . . . . . .  B ADDR   00C0H.5 A 
PX0. . . . . . . .  B ADDR   00B8H.0 A 
TS0DATH. . . . . .  D ADDR   00D3H   A 
TMR4CN . . . . . .  D ADDR   0091H   A 
PCA0PWM. . . . . .  D ADDR   00F7H   A 
P1SKIP . . . . . .  D ADDR   00D5H   A 
EIP2H. . . . . . .  D ADDR   0086H   A 
EAZY_3AV2_MAIN . .  N NUMB   00A0h            
ALIGN_RCE_BL15X_T~  N NUMB   006Eh            
HIMODEL_COOL_33A_~  N NUMB   0064h            
TURNIGY_KFORCE_70~  N NUMB   0050h            
TURNIGY_KFORCE_40~  N NUMB   004Dh            
XP_25A_TAIL. . . .  N NUMB   0011h            
FUNC_PARAVAL_CONT~  C ADDR   1D5BH   A 
STORE_MULTI_FUNC_8  C ADDR   1C88H   A 
WRITE_TAGS . . . .  C ADDR   1C52H   A 
WAIT1S . . . . . .  C ADDR   1CB8H   A 
RUN_TO_WAIT_FOR_P~  C ADDR   1830H   A 
EVAL_COMP_CHECK_T~  C ADDR   0E9FH   A 
ADJUST_TIMING_TWO~  C ADDR   0DAEH   A 
CHECK_VOLTAGE_RET.  C ADDR   0C19H   A 
CALC_GOVERNOR_PRO~  C ADDR   0A0DH   A 
GOVERNOR_ACTIVATE~  C ADDR   0969H   A 
WAITXMS_M. . . . .  C ADDR   080BH   A 
PCA_INT_CHECK_2KHZ  C ADDR   061EH   A 
T0_INT_PWM_OFF_ST~  C ADDR   0100H   A 
PGM_BEACON_DELAY .  I ADDR   009AH   A 
PGM_BEACON_STRENG~  I ADDR   0099H   A 
GOV_TARGET_H . . .  D ADDR   0041H   A 
DEFAULT_PGM_MAIN_~  N NUMB   0001h            
DEFAULT_PGM_MAIN_~  N NUMB   0007h            
STA1 . . . . . . .  B ADDR   00C0H.5 A 
PX1. . . . . . . .  B ADDR   00B8H.2 A 
TMR5CN . . . . . .  D ADDR   00C8H   A 
SMBTC. . . . . . .  D ADDR   00C7H   A 
P2SKIP . . . . . .  D ADDR   00D6H   A 
IP . . . . . . . .  D ADDR   00B8H   A 
CRC0CN . . . . . .  D ADDR   00DFH   A 
SKYIII_30A_MAIN. .  N NUMB   00A6h            
POLARIS_THUNDER_2~  N NUMB   008Bh            
H_KING_50A_MAIN. .  N NUMB   0085h            
GAUI_GE_183_18A_M~  N NUMB   0079h            
ALIGN_RCE_BL15X_M~  N NUMB   006Fh            
TURNIGY_KFORCE_70~  N NUMB   0051h            
TURNIGY_KFORCE_40~  N NUMB   004Eh            
TURNIGY_PLUSH_NFE~  N NUMB   003Bh            
XP_25A_MULTI . . .  N NUMB   0012h            
STORE_MULTI_FUNC_9  C ADDR   1C8DH   A 
READ_INITIAL_TEMP.  C ADDR   1574H   A 
WAIT_FOR_POWER_ON~  C ADDR   1516H   A 
DECODE_PWM_FREQ_E~  C ADDR   11FAH   A 
WAIT_FOR_COMM_WAIT  C ADDR   0EECH   A 
PWM_WAIT_STARTUP .  C ADDR   0E65H   A 
START_ADC_CONVERS~  C ADDR   0B67H   A 
MULT_S16_BY_U8_EX~  C ADDR   090AH   A 
PCA_INT_PPM_LIMIT~  C ADDR   075CH   A 
T2H_INT_RCP_GOV_P~  C ADDR   0523H   A 
T2_INT_PWM_MIN_RUN  C ADDR   04A4H   A 
PWM_BNFET_APFET_O~  C ADDR   02E0H   A 
PWM_ANFET_BPFET_O~  C ADDR   020DH   A 
T0_INT_PWM_OFF_CO~  C ADDR   0195H   A 
EEP_NAME . . . . .  C ADDR   1A60H   A 
EEP_INITIALIZED_L.  C ADDR   1A0DH   A 
BIT_ACCESS_INT . .  D ADDR   0021H   A 
DEFAULT_PGM_TAIL_~  N NUMB   00FAh            
DEFAULT_PGM_TAIL_~  N NUMB   0005h            
COMP_COMM. . . . .  N NUMB   0001h            
PFETON_DELAY . . .  N NUMB   0006h            
PSW. . . . . . . .  D ADDR   00D0H   A 
POLARIS_THUNDER_3~  N NUMB   008Eh            
POLARIS_THUNDER_1~  N NUMB   0088h            
H_KING_10A_TAIL. .  N NUMB   007Dh            
ALIGN_RCE_BL35X_T~  N NUMB   0074h            
TURNIGY_PLUSH_NFE~  N NUMB   003Ch            
XP_18A_TAIL. . . .  N NUMB   000Eh            
STORE_IN_RAM_EXIT.  C ADDR   1CB5H   A 
VALIDATE_RCP_START  C ADDR   1389H   A 
LOCK_BYTE_TEST . .  C ADDR   1283H   A 
DEC_STEP_MED_HIGH.  C ADDR   10D9H   A 
COMM_RESTORE_POWER  C ADDR   108DH   A 
COMM12_NONDAMP . .  C ADDR   0F11H   A 
COMM1COMM2 . . . .  C ADDR   0EF2H   A 
TEMP_AVERAGE_UPDA~  C ADDR   0BA4H   A 
TEMP_AVERAGE_DEC .  C ADDR   0B9AH   A 
CALC_GOVERNOR_PRO~  C ADDR   0A06H   A 
WAITXMS_O. . . . .  C ADDR   0809H   A 
PCA_INT_PPM_TIMEO~  C ADDR   07C3H   A 
PCA_INT_CHECK_4KHZ  C ADDR   060DH   A 
PWM_CNFET_APFET_O~  C ADDR   0321H   A 
PWM_ANFET_CPFET_O~  C ADDR   025EH   A 
T0_INT_PWM_OFF_CO~  C ADDR   01A7H   A 
T0_INT_PWM_ON_STO~  C ADDR   00D0H   A 
T0_INT_PWM_OFF . .  C ADDR   00D3H   A 
EEPROM_FW_SUB_REV~  N NUMB   0002h            
PGM_GOV_RANGE. . .  I ADDR   0094H   A 
GOV_PROPORTIONAL_H  D ADDR   0046H   A 
STEPPER_STEP_END_H  D ADDR   0036H   A 
DEFAULT_PGM_MULTI~  N NUMB   0028h            
DEFAULT_PGM_MULTI~  N NUMB   0005h            
RCP_IN . . . . . .  N NUMB   0005h            
DEFAULT_PGM_TAIL_~  N NUMB   0009h            
COMP_PWM_LOW_OFF_~  N NUMB   0014h            
ONE_S_CAPABLE. . .  N NUMB   0000h            
T5XCLK . . . . . .  B ADDR   00C8H.0 A 
TR5. . . . . . . .  B ADDR   00C8H.2 A 
TF5L . . . . . . .  B ADDR   00C8H.6 A 
SMB0CF . . . . . .  D ADDR   00C1H   A 
FLKEY. . . . . . .  D ADDR   00B7H   A 
ADC0GTH. . . . . .  D ADDR   00C4H   A 
POLARIS_THUNDER_4~  N NUMB   0091h            
H_KING_20A_TAIL. .  N NUMB   0080h            
H_KING_10A_MULTI .  N NUMB   007Eh            
ALIGN_RCE_BL35X_M~  N NUMB   0075h            
HIMODEL_COOL_22A_~  N NUMB   0062h            
TURNIGY_PLUSH_NFE~  N NUMB   0038h            
XP_18A_MULTI . . .  N NUMB   000Fh            
READ_EEPROM_EXIT .  C ADDR   18A8H   A 
WAIT_FOR_POWER_ON~  C ADDR   14D6H   A 
DEC_STEP_MED . . .  C ADDR   10E2H   A 
READ_TIMER . . . .  C ADDR   0CC8H   A 
CHECK_VOLTAGE_STA~  C ADDR   0BCCH   A 
CALC_GOVERNOR_INT~  C ADDR   0ACBH   A 
GOVERNOR_LIMIT_IN~  C ADDR   09E0H   A 
MULT_S16_BY_U8_DI~  C ADDR   08EFH   A 
BEEP . . . . . . .  C ADDR   0830H   A 
PCA_INT_PPM_BIDIR~  C ADDR   0705H   A 
PCA_INT_FALL . . .  C ADDR   066BH   A 
T2_INT_PWM_EXIT. .  C ADDR   04E7H   A 
T2_INT_SKIP_END. .  C ADDR   0453H   A 
PWM_CNFET_BPFET_O~  C ADDR   0372H   A 
PWM_BNFET_CPFET_O~  C ADDR   029FH   A 
T0_INT_PWM_OFF_DA~  C ADDR   0144H   A 
TX_PGM_PARAMS_MUL~  C ADDR   00AAH   A 
PGM_GOV_I_GAIN_DE~  I ADDR   00A0H   A 
PGM_GOV_P_GAIN . .  I ADDR   0080H   A 
DAMPING_ON . . . .  D ADDR   0067H   A 
COMM_PHASE . . . .  D ADDR   003EH   A 
PGM_PWMOFF_DAMPED.  N NUMB   0002h            
RCP_PREV_EDGE_H. .  D ADDR   0027H   A 
DEFAULT_PGM_TAIL_~  N NUMB   0001h            
P0_PUSHPULL. . . .  N NUMB   0000h            
DEFAULT_PGM_MULTI~  N NUMB   0009h            
CCF0 . . . . . . .  B ADDR   00D8H.0 A 
CY . . . . . . . .  B ADDR   00D0H.7 A 
MASTER0. . . . . .  B ADDR   00C0H.7 A 
RB80 . . . . . . .  B ADDR   0098H.2 A 
XBR0 . . . . . . .  D ADDR   00E1H   A 
TS0DATL. . . . . .  D ADDR   00D2H   A 
SPI0CKR. . . . . .  D ADDR   00A2H   A 
SMB1CF . . . . . .  D ADDR   00C1H   A 
PFE0CN . . . . . .  D ADDR   00B5H   A 
EMI0CN . . . . . .  D ADDR   00AAH   A 
DPH. . . . . . . .  D ADDR   0083H   A 
CPT0MX . . . . . .  D ADDR   009FH   A 
H_KING_35A_MAIN. .  N NUMB   0082h            
H_KING_20A_MULTI .  N NUMB   0081h            
HIMODEL_COOL_41A_~  N NUMB   0068h            
HIMODEL_COOL_22A_~  N NUMB   0063h            
TURNIGY_PLUSH_NFE~  N NUMB   0039h            
TURNIGY_PLUSH_6A_~  N NUMB   001Dh            
ERASE_FLASH. . . .  C ADDR   1C19H   A 
PROGRAM_BY_TX. . .  C ADDR   1D1FH   A 
COMM23_NFET. . . .  C ADDR   0F49H   A 
COMM23_NONDAMP . .  C ADDR   0F46H   A 
COMM2COMM3 . . . .  C ADDR   0F24H   A 
STEPPER_STEP_HIGH.  C ADDR   0C6CH   A 
MEASURE_LIPO_CELL~  C ADDR   0B04H   A 
GOVERNOR_STORE_IN~  C ADDR   0AC9H   A 
GOVERNOR_CHECK_IN~  C ADDR   0A8BH   A 
GOVERNOR_CORR_PRO~  C ADDR   0A54H   A 
GOVERNOR_ACTIVATE~  C ADDR   0956H   A 
EEP_PGM_THROTTLE_~  C ADDR   1A1EH   A 
EEP_PGM_STARTUP_R~  C ADDR   1A12H   A 
_EEP_PGM_GOV_SETU~  C ADDR   1A11H   A 
EEP_PGM_DIRECTION.  C ADDR   1A0BH   A 
EEP_PGM_PWM_FREQ .  C ADDR   1A0AH   A 
PGM_BEC_VOLTAGE_H~  I ADDR   009DH   A 
PGM_INPUT_POL. . .  I ADDR   0089H   A 
WT_COMM_H. . . . .  D ADDR   004FH   A 
GOV_TARGET_L . . .  D ADDR   0040H   A 
DIRECT_STARTUP_PH~  N NUMB   0003h            
FLAGS0 . . . . . .  D ADDR   002BH   A 
RCP_EDGE_CNT . . .  D ADDR   002AH   A 
CURRENT_PWM_LIMIT~  D ADDR   0025H   A 
COMM_TIME_MIN. . .  N NUMB   0001h            
DEFAULT_PGM_MULTI~  N NUMB   0002h            
P1_PUSHPULL. . . .  N NUMB   00FCh            
P0_DIGITAL . . . .  N NUMB   FFFFFFF0h            
COMP_PWM_LOW_ON_D~  N NUMB   000Ah            
CCF1 . . . . . . .  B ADDR   00D8H.1 A 
MASTER1. . . . . .  B ADDR   00C0H.7 A 
XBR1 . . . . . . .  D ADDR   00E2H   A 
OSCICL . . . . . .  D ADDR   00B3H   A 
EAZY_3AV2_TAIL . .  N NUMB   00A1h            
POLARIS_THUNDER_6~  N NUMB   0094h            
HIMODEL_COOL_41A_~  N NUMB   0069h            
HIMODEL_COOL_33A_~  N NUMB   0065h            
TURNIGY_AE_20A_MA~  N NUMB   0040h            
TURNIGY_PLUSH_6A_~  N NUMB   001Eh            
XP_35A_SW_MAIN . .  N NUMB   0013h            
FUNC_PARAVAL_STORE  C ADDR   1D4DH   A 
WRITE_EEPROM_BYTE~  C ADDR   1C05H   A 
READ_EEPROM_BLOCK1  C ADDR   1890H   A 
READ_EEPROM_READ .  C ADDR   1889H   A 
MEASURE_LIPO_EXIT.  C ADDR   0B66H   A 
GOVERNOR_LIMIT_PR~  C ADDR   0A3CH   A 
GOVERNOR_CHECK_PR~  C ADDR   098DH   A 
PCA_INT_SECOND_ME~  C ADDR   05B1H   A 
T2H_INT_RCP_STOP_~  C ADDR   0506H   A 
PCA_INT. . . . . .  C ADDR   0546H   A 
EEP_PGM_PPM_CENTE~  C ADDR   1A21H   A 
FLAGS1 . . . . . .  D ADDR   002CH   A 
TEMP_CHECK_RATE. .  N NUMB   0008h            
DEFAULT_PGM_TAIL_~  N NUMB   0005h            
DEFAULT_PGM_TAIL_~  N NUMB   0004h            
DEFAULT_PGM_MAIN_~  N NUMB   0003h            
P2_PUSHPULL. . . .  N NUMB   0010h            
P1_DIGITAL . . . .  N NUMB   FFFFFFFDh            
DEFAULT_PGM_MAIN_~  N NUMB   0002h            
CCF2 . . . . . . .  B ADDR   00D8H.2 A 
TB80 . . . . . . .  B ADDR   0098H.3 A 
IE0. . . . . . . .  B ADDR   0088H.1 A 
REF0CN . . . . . .  D ADDR   00D1H   A 
CLKSEL . . . . . .  D ADDR   00A9H   A 
SKYIII_30A_TAIL. .  N NUMB   00A7h            
EAZY_3AV2_MULTI. .  N NUMB   00A2h            
POLARIS_THUNDER_2~  N NUMB   008Ch            
H_KING_50A_TAIL. .  N NUMB   0086h            
GAUI_GE_183_18A_T~  N NUMB   007Ah            
HIMODEL_COOL_33A_~  N NUMB   0066h            
TURNIGY_AE_30A_MA~  N NUMB   0046h            
READ_EEPROM_BLOCK2  C ADDR   189EH   A 
MEASURE_PWM_FREQ_~  C ADDR   1351H   A 
COMM61_NFET. . . .  C ADDR   1052H   A 
COMM61_NONDAMP . .  C ADDR   104FH   A 
COMM6COMM1 . . . .  C ADDR   1025H   A 
COMM34_NONDAMP . .  C ADDR   0F8DH   A 
COMM3COMM4 . . . .  C ADDR   0F6EH   A 
COMP_WAIT_SET_MAX~  C ADDR   0E1EH   A 
WAIT_FOR_COMP_OUT~  C ADDR   0DFAH   A 
STARTUP_PWM_EXIT .  C ADDR   0C49H   A 
MEASURE_LIPO_LIMI~  C ADDR   0B56H   A 
GOVERNOR_CORR_PRO~  C ADDR   0A65H   A 
PCA_INT_PPM_BIDIR~  C ADDR   06E7H   A 
PCA_INT_CHECK_8KHZ  C ADDR   05FCH   A 
T0_INT_PWM_OFF_CL~  C ADDR   0127H   A 
GOV_PROP_PWM . . .  D ADDR   0047H   A 
GOV_PROPORTIONAL_L  D ADDR   0045H   A 
STEPPER_STEP_END_L  D ADDR   0035H   A 
FLAGS2 . . . . . .  D ADDR   002DH   A 
DEMAG_DETECTED . .  N NUMB   0003h            
RCP_SKIP_CNT . . .  D ADDR   0029H   A 
THR_SWITCH . . . .  N NUMB   00A0h            
DEFAULT_PGM_MULTI~  N NUMB   0006h            
DEFAULT_PGM_MULTI~  N NUMB   0009h            
P2_DIGITAL . . . .  N NUMB   FFFFFFF1h            
SPIEN. . . . . . .  B ADDR   00F8H.0 A 
ACK0 . . . . . . .  B ADDR   00C0H.1 A 
IE1. . . . . . . .  B ADDR   0088H.3 A 
REG0CN . . . . . .  D ADDR   00C9H   A 
OSCICN . . . . . .  D ADDR   00B2H   A 
CRC0IN . . . . . .  D ADDR   009CH   A 
CKCON1 . . . . . .  D ADDR   00F4H   A 
ADC0GTL. . . . . .  D ADDR   00C3H   A 
SKYIII_30A_MULTI .  N NUMB   00A8h            
POLARIS_THUNDER_8~  N NUMB   0097h            
POLARIS_THUNDER_3~  N NUMB   008Fh            
POLARIS_THUNDER_2~  N NUMB   008Dh            
POLARIS_THUNDER_1~  N NUMB   0089h            
H_KING_50A_MULTI .  N NUMB   0087h            
GAUI_GE_183_18A_M~  N NUMB   007Bh            
TURNIGY_KFORCE_12~  N NUMB   0052h            
XP_3A_MAIN . . . .  N NUMB   0001h            



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   6758    ----
   XDATA SIZE       =   ----    ----
   DATA SIZE        =     86    ----
   IDATA SIZE       =     84    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


REGISTER BANK(S) USED : 0 

ASSEMBLY COMPLETE.   0 WARNING(S)   0 ERROR(S)
